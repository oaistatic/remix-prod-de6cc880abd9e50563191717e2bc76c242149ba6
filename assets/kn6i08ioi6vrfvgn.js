import{cH as _,aL as R,cW as E,cX as V,a as W,V as S,cF as I,cG as ae,P as N,cr as pe,gu as _e,cm as Cs,eO as ks,m as ws,dE as Ms,e3 as Ns,hj as Ss,bX as As,R as se,M as Ds,fB as Es}from"./haannt40upmuwmtk.js";import{d as Q,r as u,j as e,e as C,u as U,a8 as Be,M as l,c as X,a9 as We}from"./khl8ktun31iepecq.js";import{e as Ts,f as Os,b as Is,c as qe}from"./gfrr7h86bcoshbke.js";import{d as je,e as Ve,f as Ze,b as Me,g as q,a as Ye}from"./iqgtlgql06vo3uc8.js";import{B as Ps}from"./id3olky7887s2bz2.js";import{i as b,kA as ze,bk as Ls,qJ as Fs,qK as Rs,qL as Us,qM as Z,dO as Gs,qN as He,bK as Bs,qO as te,h2 as Ws,qP as L,g$ as qs,ck as Vs,qQ as xe,e7 as Ke,aH as Zs,L as J,qR as Ne,qS as $,f3 as Qe,f0 as Xe,qT as oe,qU as Je,gd as $e,dJ as es,bm as Ys,cD as zs,qV as Se,qW as Hs,qX as Ks,qY as Ae,qZ as Qs,q_ as De,bh as Xs,bi as Js,bN as $s,q$ as et,e6 as st,r0 as ne,k1 as tt,hX as nt,ay as at,aA as Ee,ax as ot,r1 as Te,r2 as it,r3 as lt,r4 as rt,r5 as ct,h1 as O,c8 as dt,c9 as ut}from"./n4exq6o15ap1g74l.js";import{b as F,c as ss}from"./dblaaxd78ezocyc0.js";import{S as mt}from"./hexcdj2i3ct6w6r4.js";import{g as xt}from"./fyhtu3byt16th38d.js";import{S as ft}from"./brlfaqq2l0eg9ucx.js";import{I as gt}from"./kkvepmv0ij3dcl10.js";import{A as ht}from"./hfl3zoxlv1ar4jhs.js";import{a as pt,g as Oe}from"./kmj1q93aeao2z6ct.js";import{c as ts}from"./ctjt1fjp3mtlelcg.js";import"./hyae97tnl7ms3bn9.js";import"./e473oe6zkw5lqbph.js";import"./m4g7yy9fehqi204r.js";import"./jjqeoesb3rhorlyg.js";import"./dfz2bdgqh4yduujb.js";import"./b3mht1lg7zv7qd3d.js";import"./eiq9v0oy1lyfg3c8.js";import"./dlwdwnl197lh1mf5.js";import"./lk6form9dwf6vk73.js";import"./cvxq2e4ugtgn6d3k.js";import"./mhqi8r5v3dwotfod.js";import"./hvdwpbr2ljyv44tg.js";const _t=ts("Search16Regular","16",["M9.3 10.02a4.5 4.5 0 1 1 .7-.7l3.85 3.83a.5.5 0 0 1-.7.7L9.3 10.02ZM10 6.5a3.5 3.5 0 1 0-7 0 3.5 3.5 0 0 0 7 0Z"]),jt=ts("SettingsCogMultiple20Filled","20",["M8 2c-.37 0-.73.04-1.08.1a.5.5 0 0 0-.4.4l-.26 1.36c-.05.25-.3.4-.54.31l-1.3-.45a.5.5 0 0 0-.55.14A5.5 5.5 0 0 0 2.8 5.74c-.07.2-.01.4.14.54l1.05.9c.19.17.19.47 0 .63l-1.05.91a.5.5 0 0 0-.14.54c.23.7.6 1.34 1.08 1.88.14.15.35.2.54.14l1.3-.45c.25-.08.5.06.55.31l.27 1.36c.03.2.19.35.39.4a5.52 5.52 0 0 0 2.17 0 .5.5 0 0 0 .4-.4l.25-1.36c.05-.25.3-.4.55-.31l1.3.45c.19.06.4 0 .54-.14a5.5 5.5 0 0 0 1.08-1.89.5.5 0 0 0-.14-.53l-1.04-.9a.42.42 0 0 1 0-.63l1.04-.9a.5.5 0 0 0 .14-.54 5.5 5.5 0 0 0-1.08-1.89.5.5 0 0 0-.54-.14l-1.3.45a.42.42 0 0 1-.55-.31L9.48 2.5a.5.5 0 0 0-.4-.4C8.75 2.05 8.39 2 8 2ZM6.5 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm4.66 4.95a.46.46 0 0 1 .53-.15l.8.27c.26.1.54-.07.6-.34l.15-.83c.04-.2.2-.36.4-.38a3.55 3.55 0 0 1 .72 0c.2.02.35.18.4.38l.15.83c.06.27.34.43.6.34l.8-.27c.19-.07.4-.02.52.15.14.2.27.4.36.62.09.19.03.4-.13.53l-.64.56c-.2.18-.2.5 0 .68l.64.56c.16.13.22.34.13.53-.1.22-.22.43-.36.62a.46.46 0 0 1-.52.15l-.8-.27a.45.45 0 0 0-.6.34l-.16.83c-.04.2-.19.36-.4.38a3.55 3.55 0 0 1-.71 0 .46.46 0 0 1-.4-.38l-.16-.83a.45.45 0 0 0-.6-.34l-.8.27c-.18.07-.4.02-.52-.15a3.5 3.5 0 0 1-.36-.62.46.46 0 0 1 .13-.53l.64-.56c.21-.18.21-.5 0-.68l-.64-.56a.46.46 0 0 1-.13-.53c.1-.22.22-.43.36-.62ZM15 14.5a1 1 0 1 0-2 0 1 1 0 0 0 2 0Z"]),G=Q({fileSingular:{id:"TKyiaj",defaultMessage:"file"},filesPlural:{id:"krAMi5",defaultMessage:"files"},domainSingular:{id:"ExZP9r",defaultMessage:"domain"},domainsPlural:{id:"PmkQD7",defaultMessage:"domains"}});function Ie(s,t){return s==="google_drive_dwd"||s==="google_drive_oauth"?{objectTypeSingular:t.formatMessage(G.fileSingular),objectTypePlural:t.formatMessage(G.filesPlural),externalLinkableUnitSingular:t.formatMessage(G.domainSingular),externalLinkableUnitPlural:t.formatMessage(G.domainsPlural)}:s==="slack"?{objectTypeSingular:t.formatMessage({id:"Y22i2G",defaultMessage:"channel"}),objectTypePlural:t.formatMessage({id:"UXSOIk",defaultMessage:"channels"}),externalLinkableUnitSingular:t.formatMessage({id:"yyIyWp",defaultMessage:"workspace"}),externalLinkableUnitPlural:t.formatMessage({id:"LuznzN",defaultMessage:"workspaces"})}:{objectTypeSingular:t.formatMessage(G.fileSingular),objectTypePlural:t.formatMessage(G.filesPlural),externalLinkableUnitSingular:t.formatMessage(G.domainSingular),externalLinkableUnitPlural:t.formatMessage(G.domainsPlural)}}const ns=-1;function ie(s){switch(s.knowledge_connector_type){case void 0:return 0;case"slack":case"github":case"google_drive_dwd":return ns;case"google_drive_oauth":return 10;case"merge_file_storage":return 10}}const fe={max_instances:0},vt=s=>u.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("g",{id:"icon / connected, dynamic, gpt"},u.createElement("path",{id:"vector",d:"M5.23841 3.95847C5.73982 3.95517 6.38371 4.09048 7.13793 4.39217C7.58 4.569 8.04665 4.79764 8.52798 5.07508C7.9105 5.56392 7.29772 6.10893 6.70332 6.70333C6.10893 7.29772 5.56392 7.9105 5.07508 8.52798C4.79764 8.04665 4.569 7.58 4.39217 7.13793C4.09048 6.38371 3.95517 5.73982 3.95847 5.23841C3.96174 4.74203 4.09727 4.4464 4.27183 4.27183C4.4464 4.09727 4.74203 3.96174 5.23841 3.95847ZM10.0001 4.02079C9.23413 3.52937 8.47766 3.13301 7.75692 2.84471C6.87793 2.49312 6.01323 2.28667 5.22743 2.29184C4.4366 2.29705 3.66642 2.52023 3.09332 3.09332C2.52023 3.66642 2.29705 4.4366 2.29184 5.22743C2.28667 6.01323 2.49312 6.87793 2.84471 7.75692C3.13301 8.47766 3.52937 9.23413 4.02079 10.0001C3.52937 10.766 3.13301 11.5225 2.84471 12.2432C2.49312 13.1222 2.28667 13.9869 2.29184 14.7727C2.29705 15.5636 2.52023 16.3337 3.09332 16.9068C3.66642 17.4799 4.4366 17.7031 5.22743 17.7083C6.01323 17.7135 6.87793 17.507 7.75692 17.1555C8.47766 16.8672 9.23413 16.4708 10.0001 15.9794C10.766 16.4708 11.5225 16.8672 12.2432 17.1555C13.1222 17.507 13.9869 17.7135 14.7727 17.7083C15.5636 17.7031 16.3337 17.4799 16.9068 16.9068C17.4799 16.3337 17.7031 15.5636 17.7083 14.7727C17.7135 13.9869 17.507 13.1222 17.1555 12.2432C16.8672 11.5225 16.4708 10.766 15.9794 10.0001C16.4708 9.23413 16.8672 8.47766 17.1555 7.75692C17.507 6.87793 17.7135 6.01323 17.7083 5.22743C17.7031 4.43661 17.4799 3.66642 16.9068 3.09332C16.3337 2.52023 15.5636 2.29705 14.7727 2.29184C13.9869 2.28667 13.1222 2.49312 12.2432 2.84471C11.5225 3.13301 10.766 3.52937 10.0001 4.02079ZM10.0001 6.04624C10.7059 6.57001 11.4212 7.18471 12.1183 7.88184C12.8154 8.57896 13.4301 9.29429 13.9539 10.0001C13.4301 10.7059 12.8154 11.4212 12.1183 12.1183C11.4212 12.8154 10.7059 13.4301 10.0001 13.9539C9.29429 13.4301 8.57896 12.8154 7.88184 12.1183C7.18471 11.4212 6.57001 10.7059 6.04624 10.0001C6.57001 9.29429 7.18471 8.57896 7.88184 7.88184C8.57896 7.18471 9.29429 6.57001 10.0001 6.04624ZM14.9251 8.52798C14.4362 7.9105 13.8912 7.29772 13.2968 6.70332C12.7024 6.10893 12.0897 5.56392 11.4722 5.07508C11.9535 4.79764 12.4202 4.569 12.8622 4.39217C13.6164 4.09048 14.2603 3.95517 14.7618 3.95847C15.2581 3.96174 15.5538 4.09727 15.7283 4.27184C15.9029 4.4464 16.0384 4.74203 16.0417 5.23841C16.045 5.73982 15.9097 6.38371 15.608 7.13793C15.4312 7.58 15.2025 8.04665 14.9251 8.52798ZM14.9251 11.4722C15.2025 11.9535 15.4312 12.4202 15.608 12.8622C15.9097 13.6164 16.045 14.2603 16.0417 14.7618C16.0384 15.2581 15.9029 15.5538 15.7283 15.7283C15.5538 15.9029 15.2581 16.0384 14.7618 16.0417C14.2603 16.045 13.6164 15.9097 12.8622 15.608C12.4202 15.4312 11.9535 15.2025 11.4722 14.9251C12.0897 14.4362 12.7024 13.8912 13.2968 13.2968C13.8912 12.7024 14.4362 12.0897 14.9251 11.4722ZM8.52798 14.9251C8.04665 15.2025 7.58 15.4312 7.13793 15.608C6.38371 15.9097 5.73982 16.045 5.23841 16.0417C4.74203 16.0384 4.4464 15.9029 4.27183 15.7283C4.09727 15.5538 3.96174 15.2581 3.95847 14.7618C3.95517 14.2603 4.09048 13.6164 4.39217 12.8622C4.569 12.4202 4.79764 11.9535 5.07508 11.4722C5.56392 12.0897 6.10893 12.7024 6.70332 13.2968C7.29772 13.8912 7.91049 14.4362 8.52798 14.9251Z",fill:"currentColor"})));function K({label:s,value:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-medium w-full border-t"}),e.jsxs("div",{className:"flex w-full flex-row justify-between py-2",children:[e.jsx("span",{className:"text-token-text-primary",children:s}),e.jsx("span",{className:"text-token-text-secondary",children:t})]})]})}function yt({connection:s,adminUserConnectionState:t}){const a=t&&t.user_connection_details.activation_status!=="inactive"&&t.user_connection_details.auth_status!=="not_connected";switch(s.connection_config.knowledge_connector_type){case"google_drive_oauth":return e.jsx(bt,{connectionConfig:s.connection_config,connectionStatus:s.connection_status,isAdminConnected:a});case"slack":return e.jsx(kt,{connectionConfig:s.connection_config,connectionStatus:s.connection_status,isAdminConnected:a});case"github":case"merge_file_storage":case"google_drive_dwd":return e.jsx(Ct,{});case void 0:return null}}function bt({connectionConfig:s,connectionStatus:t,isAdminConnected:a}){const n=C(),o=t==="activating"||t==="partially_activated"||t==="active";return e.jsxs("div",{className:"px-4",children:[o&&a!=null&&!a&&e.jsx(as,{connectionConfig:s}),e.jsx(K,{label:n.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:n.formatMessage({id:"DSWj22",defaultMessage:"Self-service"})}),!!s.domain_name&&e.jsx(K,{label:n.formatMessage({id:"DtrjbM",defaultMessage:"Domain name"}),value:s.domain_name})]})}function Ct(){const s=C();return e.jsx("div",{className:"px-4",children:e.jsx(K,{label:s.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:s.formatMessage({id:"voo3FC",defaultMessage:"Admin-managed"})})})}function kt({connectionConfig:s,connectionStatus:t,isAdminConnected:a}){const n=C();return e.jsxs("div",{className:"px-4",children:[t==="activating"&&a!=null&&!a&&e.jsx(as,{connectionConfig:s}),e.jsx(K,{label:n.formatMessage({id:"JXKtnI",defaultMessage:"Slack domain"}),value:s.team_domain}),e.jsx(K,{label:n.formatMessage({id:"a1Cjhf",defaultMessage:"Team ID"}),value:s.team_id})]})}function as({connectionConfig:s}){const{data:t,isLoading:a,refetch:n}=U({queryKey:["user_connection_status"],queryFn:b.user_connection_status}),{refetch:o}=ze({skip:!0}),i=()=>{n(),o()},r=t?.connection_statuses.some(m=>m.user_connection_details.connection_instance_id===s.connection_config_id&&m.user_connection_details.auth_status==="user_connected");if(a||r)return null;const c=({isLoading:m,disabled:d,onClick:f})=>e.jsx(_,{color:"primary",loading:m,disabled:d,onClick:f,children:e.jsx(l,{id:"9ZiK24",defaultMessage:"Connect"})});return e.jsxs(Be.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.2,duration:.5},className:"bg-token-hint-bg dark:bg-token-main-surface-tertiary mb-2 flex flex-col gap-2 rounded-xl p-4",children:[e.jsxs("div",{className:"flex flex-row items-start gap-4",children:[e.jsx(Ls,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(l,{id:"gdALIj",defaultMessage:"This connection will not finish activating until a user connects."})})]}),e.jsx(Fs,{connectionId:s.connection_config_id,connectorType:s.knowledge_connector_type,renderButton:c,location:"admin_settings",refetch:i})]})}const wt=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12Z",fill:"currentColor"}),u.createElement("path",{d:"M13.3 12.0002C13.3 12.7182 12.718 13.3002 12 13.3002C11.282 13.3002 10.7 12.7182 10.7 12.0002C10.7 11.2822 11.282 10.7002 12 10.7002C12.718 10.7002 13.3 11.2822 13.3 12.0002Z",fill:"currentColor"}),u.createElement("path",{d:"M17.3 12.0002C17.3 12.7182 16.718 13.3002 16 13.3002C15.282 13.3002 14.7 12.7182 14.7 12.0002C14.7 11.2822 15.282 10.7002 16 10.7002C16.718 10.7002 17.3 11.2822 17.3 12.0002Z",fill:"currentColor"}),u.createElement("path",{d:"M9.30001 12.0002C9.30001 12.7182 8.71798 13.3002 8.00001 13.3002C7.28204 13.3002 6.70001 12.7182 6.70001 12.0002C6.70001 11.2822 7.28204 10.7002 8.00001 10.7002C8.71798 10.7002 9.30001 11.2822 9.30001 12.0002Z",fill:"currentColor"})),le={isOpen:!0,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,shouldIgnoreClickOutside:!0,hideSeparator:!0,noPadding:!0},Y={...le,title:e.jsx(Rs,{})},os={...le,title:e.jsx(Us,{})};function re({onClose:s,footerContent:t,primaryButton:a,secondaryButton:n,pageSize:o=qs,accountId:i,connectionId:r,connectorType:c,fallbackEstimatedMaxNumUsers:m}){const d=C(),[f,x]=u.useState(""),g=R(),[h,p]=u.useState(0),j=Z(),{data:v,isLoading:y}=Gs(g?.getWorkspaceId(),h*o,f,o),{data:k,isLoading:w,refetch:A,error:D}=U({queryKey:["admin_connection_get_access_policy",r],queryFn:()=>b.admin_connection_get_access_policy(i,r)}),T=Math.ceil((v?.total??0)/o);h>=T&&T!==0&&p(Math.max(T-1,0));const[P,ps]=u.useState(!1),[_s,js]=u.useState(0),ce=_s>0||P,ke=w||y||ce,de=k?.limits?.max_allowed_users??m,ue=de===-1,vs=!j&&(ue||(k?.allowed_users.length??0)<de);return e.jsxs(E,{...le,title:He(c),onClose:s,testId:"modal-allowed-users-picker",children:[e.jsxs("div",{className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("div",{className:"mb-3 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsx("div",{className:"text-token-text-secondary mb-4",children:ue?e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}):w?e.jsx(F,{lines:1,className:"w-full"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}),e.jsx("p",{children:e.jsx(St,{numSelectedUsers:k?.allowed_users.length??0,maxAllowedUsers:de})})]})}),e.jsxs("div",{className:"mb-4 flex flex-row items-center",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("input",{type:"text",value:f,onChange:H=>{x(H.target.value),p(0)},disabled:!!k?.allow_all_in_workspace,placeholder:d.formatMessage({id:"RWqomV",defaultMessage:"Search"}),className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid ps-10"}),e.jsx("div",{className:"absolute start-2 top-0 flex h-full w-8 items-center justify-center",children:e.jsx(Bs,{className:"icon-md text-token-text-tertiary group-focus-within:text-token-text-secondary"})})]}),ke&&e.jsx(V,{className:"ms-4 h-4 w-4"})]}),D&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(l,{id:"ZhxtEO",defaultMessage:"Failed to load allowed users."}),e.jsx("button",{onClick:()=>A(),className:"underline",children:e.jsx(l,{id:"y/IEAC",defaultMessage:"Try again"})})]}),e.jsx("div",{className:W("h-[200px] max-h-[600px] overflow-y-auto px-2",k?.allow_all_in_workspace&&"opacity-50"),children:e.jsx("table",{children:e.jsx("tbody",{children:v?.items.length?v.items.map(({id:H,name:ys,email:bs})=>{const we=!!k?.allowed_users.includes(H);return e.jsx("tr",{className:"mb-2",children:e.jsx("td",{children:e.jsx(Mt,{controlDisabled:!we&&!vs||!!k?.allow_all_in_workspace||P,userId:H,isUserEnabled:we||!!k?.allow_all_in_workspace,accountId:i,connectionId:r,refetch:A,setNumPendingUserOperations:js,name:ys,email:bs})})},H)}):e.jsx("tr",{children:e.jsx("td",{children:e.jsx(l,{id:"n3uhaN",defaultMessage:"No users found"})})})})})}),T>1&&e.jsx("div",{className:"my-4",children:e.jsx(Ws,{currentPage:h,onChangeIndex:p,length:T})}),ue&&e.jsx(Nt,{allowAllInWorkspace:!!k?.allow_all_in_workspace,controlDisabled:ke||j&&!k?.allow_all_in_workspace,refetch:A,accountId:i,connectionId:r,setShouldBlockOtherInteractions:ps})]}),e.jsx(L,{footerContent:t,primaryButton:ce&&a?u.cloneElement(a,{disabled:!0,onClick:()=>{}}):a,secondaryButton:ce&&n?u.cloneElement(n,{disabled:!0,onClick:()=>{}}):n})]})}function Mt({userId:s,controlDisabled:t,isUserEnabled:a,refetch:n,setNumPendingUserOperations:o,accountId:i,connectionId:r,name:c,email:m}){const d=C(),f=S(),[x,g]=u.useState(!1),h=async v=>{if(!t){g(!0),o(y=>y+1);try{await b.admin_connection_allow_user(i,r,v),await n()}catch{f.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{g(!1),o(y=>y-1)}}},p=async v=>{g(!0),o(y=>y+1);try{await b.admin_connection_disallow_user(i,r,v),await n()}catch{f.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{g(!1),o(y=>y-1)}},j=e.jsxs("p",{children:[e.jsx("span",{className:"text-token-text-primary",children:c}),e.jsx("span",{className:"text-token-text-tertiary ms-2",children:m})]});return e.jsx(is,{isLoading:x,id:`is-user-enabled--${s}`,disabled:t,checked:a,onChange:v=>{t||x||(v.currentTarget.checked?h(s):p(s))},label:j})}function Nt({allowAllInWorkspace:s,controlDisabled:t=!1,accountId:a,connectionId:n,refetch:o,setShouldBlockOtherInteractions:i}){const r=C(),c=S(),[m,d]=u.useState(!1),f=async x=>{if(!t){d(!0),i(!0);try{await b.admin_connection_update_access_policy(a,n,x),await o()}catch{await o(),c.danger(r.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{d(!1),i(!1)}}};return e.jsx(is,{isLoading:m,id:"enabled-for-everyone-checkbox",checked:s,disabled:t,onChange:x=>{t||f(x.currentTarget.checked)},label:e.jsx("span",{className:"text-token-text-primary ms-2",children:e.jsx(l,{id:"MsFKpF",defaultMessage:"Enable for everyone"})})})}function is({isLoading:s,...t}){return s?e.jsxs("div",{className:"form-check flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("div",{className:"form-check-label text-token-text-primary",children:t.label})]}):e.jsx(Vs,{...t})}function St({maxAllowedUsers:s,numSelectedUsers:t}){return t>=s?e.jsx(l,{id:"JWJ5gc",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You cannot select any more.`,values:{numSelectedUsers:t}}):t>0?e.jsx(l,{id:"dYtUgP",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You can select up to {remainingAllowedUsers} more.`,values:{numSelectedUsers:t,remainingAllowedUsers:s-t}}):e.jsx(l,{id:"nVfqBL",defaultMessage:`Select up to {maxAllowedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        }.`,values:{maxAllowedUsers:s}})}const ve=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.53 2.5C18.9777 2.5 18.53 2.94772 18.53 3.5V5.07196C16.8313 3.47759 14.5452 2.5 12.03 2.5C6.78329 2.5 2.53 6.75329 2.53 12C2.53 17.2467 6.78329 21.5 12.03 21.5C16.8993 21.5 20.9117 17.8375 21.465 13.1164C21.5293 12.5679 21.1367 12.0711 20.5882 12.0068C20.0397 11.9425 19.5429 12.3351 19.4786 12.8836C19.042 16.6089 15.8729 19.5 12.03 19.5C7.88786 19.5 4.53 16.1421 4.53 12C4.53 7.85786 7.88786 4.5 12.03 4.5C14.2504 4.5 16.2464 5.46469 17.6205 7H15.5C14.9477 7 14.5 7.44772 14.5 8C14.5 8.55228 14.9477 9 15.5 9H19.53C20.0694 9 20.509 8.57299 20.5293 8.03859C20.5302 8.01771 20.5304 7.99677 20.53 7.9758V3.5C20.53 2.94772 20.0823 2.5 19.53 2.5Z",fill:"currentColor"}));function At({isOpen:s,onClose:t,objectType:a,connectionId:n,accountId:o}){const[i,r]=u.useState(null),[c,m]=u.useState([]),[d,f]=u.useState(!1),[x,g]=u.useState(!1),h=C(),p=async y=>{f(!0),g(!1);try{const k=await b.admin_connection_list_item_scopes(o,n,a,y);r(k.page_token??null),m(w=>[...w,...k.object_selections.map(A=>A.object_handle)])}catch{g(!0)}finally{f(!1)}},j=async()=>{r(null),f(!1),m([]),g(!1),p(null)},v=u.useRef(!1);return u.useEffect(()=>{v.current||(v.current=!0,j())},[]),e.jsx(E,{testId:"modal-connection-blocked-items",isOpen:s,onClose:t,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:h.formatMessage({id:"BVUVRc",defaultMessage:"Block items"}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"LYXIh1",defaultMessage:"Found something that shouldn't be synced? You can block items here to prevent them from being synced or shown in search results."})}),e.jsx(Tt,{connectionId:n,accountId:o,onItemBlocked:j,objectType:a}),e.jsx(Dt,{connectionId:n,accountId:o,isLoading:d,hasError:x,hasMoreItems:i!=null,loadMoreItems:()=>p(i),objectType:a,objectHandles:c,onItemUnblocked:j})]})})}function Dt({connectionId:s,accountId:t,objectHandles:a,isLoading:n,hasError:o,hasMoreItems:i,loadMoreItems:r,onItemUnblocked:c,objectType:m}){return e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-medium",children:e.jsx(l,{id:"gimLZo",defaultMessage:"Currently blocked items"})}),o?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(_,{color:"secondary",icon:ve,onClick:r,children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsxs(e.Fragment,{children:[a.length>0||n?e.jsx("ul",{className:"flex flex-col gap-1",children:a.map(d=>e.jsx(Et,{connectionId:s,accountId:t,objectType:m,objectHandle:d,onItemUnblocked:c},d))}):e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"IGg+fh",defaultMessage:"No items are currently being blocked."})}),n?e.jsx(F,{lines:1}):i&&e.jsx(_,{color:"ghost",icon:mt,onClick:r,children:e.jsx(l,{id:"g+Tw+y",defaultMessage:"See more"})})]})]})}function Et({connectionId:s,accountId:t,objectHandle:a,onItemUnblocked:n,objectType:o}){const i=S(),r=C();return e.jsx(ge,{scopeChangeIcon:xe,scopeChangeLabel:r.formatMessage({id:"yaj/om",defaultMessage:"Unblock item"}),scopeChangeTarget:"include",objectHandle:a,objectType:o,onError:()=>{i.danger(r.formatMessage({id:"yRm6yX",defaultMessage:"Failed to unblock item. Please try again later."}))},onScopeUpdated:()=>{i.success(r.formatMessage({id:"Xot/uQ",defaultMessage:"Item successfully unblocked."})),n()},connectionId:s,accountId:t})}function ge({connectionId:s,accountId:t,objectType:a,objectHandle:n,scopeChangeTarget:o,scopeChangeLabel:i,scopeChangeIcon:r,onScopeUpdated:c,onError:m}){const[d,f]=u.useState(!1),{isPending:x,mutate:g}=X({mutationFn:async()=>o==="exclude"?await b.admin_connection_block_items(t,s,a,[n]):await b.admin_connection_unblock_items(t,s,a,[n]),mutationKey:["admin_connection_update_item_scope",s,a,o,n],onSuccess:()=>{c(),f(!1)},onError:()=>{f(!1),m()}});return e.jsxs("li",{className:"group hover:bg-token-surface-hover flex w-full flex-row rounded-xl px-4 py-1 text-sm",children:[e.jsx("span",{className:"flex-1",children:n}),e.jsxs(I.Root,{open:d||x,onOpenChange:f,children:[e.jsx(I.Trigger,{className:W("h-6 flex-0 group-hover:visible",!d&&"invisible"),children:e.jsx(Ke,{className:"icon-sm"})}),e.jsx(I.Portal,{children:e.jsx(I.Content,{size:"small",children:e.jsx(I.Item,{icon:x?V:r,onSelect:()=>g(),disabled:x,children:i})})})]})]})}function Tt({accountId:s,connectionId:t,onItemBlocked:a,objectType:n}){const o=S(),i=C();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-medium",children:e.jsx(l,{id:"dU+IPT",defaultMessage:"Block an item"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"y6yn/t",defaultMessage:"Enter the ID or URL of the item you want to block."})}),e.jsx(he,{accountId:s,connectionId:t,objectType:n,onSuccess:()=>{o.success(i.formatMessage({id:"Q+KnAh",defaultMessage:"Item successfully blocked."})),a()},onError:()=>{o.danger(i.formatMessage({id:"UH92LU",defaultMessage:"Failed to block item. Please try again later."}))},targetScopeSelection:"exclude",buttonLabel:e.jsx(l,{id:"5FIVI9",defaultMessage:"Block"})})]})}function he({accountId:s,connectionId:t,objectType:a,onSuccess:n,onError:o,placeholder:i,targetScopeSelection:r,buttonLabel:c}){const m=C(),[d,f]=u.useState(""),{isPending:x,mutate:g}=X({mutationFn:async()=>{if(d.trim())return r==="exclude"?await b.admin_connection_block_items(s,t,a,[d]):await b.admin_connection_unblock_items(s,t,a,[d])},mutationKey:["admin_connection_update_item_scope",t,a,r,d],onSuccess:()=>{n(),f("")},onError:o});return e.jsx("form",{onSubmit:h=>{h.preventDefault(),d.trim()&&g()},children:e.jsxs("div",{className:"flex w-full flex-row gap-2",children:[e.jsx(Zs,{type:"text",className:"flex-1",name:"objectHandle",ariaLabel:"object handle",value:d,onChange:h=>f(h.target.value),placeholder:i??m.formatMessage({id:"sPUyj/",defaultMessage:"ID or URL"}),disabled:x}),e.jsx(_,{color:"primary",type:"button",onClick:()=>g(),loading:x,disabled:x||!d.trim(),className:"flex-0",children:c})]})})}function ls({accountId:s,connectionId:t,onClose:a,onNext:n,secondaryButton:o,footerContent:i}){const r=C(),c=S(),m=u.useId(),[d,f]=u.useState(""),[x,g]=u.useState(null),[h,p]=u.useState(!1),{isLoading:j,refetch:v,data:y}=U({queryKey:["admin:connection_instance",t],queryFn:async()=>await b.admin_get_connection_instance(s,t)});u.useEffect(()=>{y?.connection_config.knowledge_connector_type==="google_drive_dwd"&&f(y.connection_config.admin_email_address??"")},[y]);const k=y?.connection_config.knowledge_connector_type==="google_drive_dwd"?y.connection_config.service_account_credential_id:void 0,w=d.trim().length>0&&(!!x||k),A=async()=>{if(!(!w||!s||h)){p(!0);try{let D;x&&(D=await x.text()),await b.admin_connection_update_credential(s,t,{admin_email:d,new_service_credential_content:D,credential_id:k&&!D?k:void 0}),c.success(r.formatMessage({id:"q/AX/d",defaultMessage:"Credentials successfully updated."})),n()}catch(D){let T=r.formatMessage({id:"qbD4Az",defaultMessage:"Failed to update credentials."});const P=xt(D);P&&(T=r.formatMessage({id:"pzfjhv",defaultMessage:"Failed to update credentials: {error}"},{error:P.message})),N.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_dwd",error:P?.error_type}),c.danger(T)}finally{v(),p(!1)}}};return e.jsx(E,{...Y,onClose:a,testId:"modal-gdrive-dwd-credentials",children:j?e.jsx(F,{lines:4,className:"px-6 pt-4 pb-10"}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:D=>{D.preventDefault(),w&&A()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("button",{type:"submit",className:"display-none"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"qq+Txa",defaultMessage:"Setup a new connection"})}),e.jsx("div",{className:"text-token-text-secondary mt-2",children:e.jsx(l,{id:"xlzWm6",defaultMessage:"To setup an Admin-managed connection, follow the steps linked below, then enter the key from Google. {readMoreLink}",values:{readMoreLink:e.jsx(J,{href:Ne,className:"underline",onClick:()=>$({link:Ne,location:"admin_onboarding_dwd_credentials"}),children:e.jsx(l,{id:"wVvI34",defaultMessage:"Read setup instructions"})})}})})]}),e.jsx(Ot,{existingServiceKeyId:k,serviceKeyFile:x,setServiceKeyFile:g}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:m,className:"text-base font-medium",children:e.jsx(l,{id:"sPqjJA",defaultMessage:"Google Workspace admin email address"})}),e.jsx("input",{type:"text",value:d,onChange:D=>f(D.target.value),placeholder:r.formatMessage({id:"+zP1RE",defaultMessage:"admin@example.com"}),id:m,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Y8w9Sz",defaultMessage:"We require a Google Workspace admin user's email to perform administrative actions like listing users and discovering Shared Drives with the provided service account key."})})]})]})]}),e.jsx(L,{primaryButton:e.jsx(_,{loading:h,color:"primary",disabled:!w||h,onClick:A,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:o,footerContent:i})]})})}function Ot({existingServiceKeyId:s,serviceKeyFile:t,setServiceKeyFile:a}){const n=u.useRef(null),o=u.useId();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-base font-medium",children:e.jsx(l,{id:"gI0O53",defaultMessage:"Service account key"})}),!!s&&!t&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(ae,{className:"icon-sm"}),e.jsx(l,{id:"B+/4/L",defaultMessage:"Service account key already exists."})]}),!!t&&e.jsx("p",{className:"text-token-text-secondary",children:t.name}),e.jsxs("div",{className:"flex flex-row gap-2",children:[!s&&!t&&e.jsx(_,{color:"primary",type:"button",onClick:()=>n.current?.click(),children:e.jsx(l,{id:"4GjErm",defaultMessage:"Upload key"})}),(!!s&&!t||!s&&!!t)&&e.jsx(_,{color:"secondary",type:"button",onClick:()=>n.current?.click(),children:e.jsx(l,{id:"qV3zuG",defaultMessage:"Replace key"})}),!!s&&!!t&&e.jsx(_,{color:"danger-outline",type:"button",onClick:()=>a(null),children:e.jsx(l,{id:"NFpNok",defaultMessage:"Clear"})})]}),e.jsx("input",{type:"file",className:"hidden",id:o,ref:n,onChange:i=>{i.target.files&&i.target.files.length>0?a(i.target.files[0]):a(null)},accept:".json"})]})}function rs({isOpen:s,onClose:t,connectionId:a,accountId:n,primaryButton:o,secondaryButton:i,footerContent:r}){const{refetch:c,data:m,error:d,isLoading:f}=U({queryFn:()=>Pt({accountId:n,connectionId:a}),queryKey:["admin_connection_list_item_scopes",a,"shared_drive"]});return e.jsxs(E,{...Y,isOpen:s,onClose:t,testId:"modal-gdrive-dwd-shared-drive-picker",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:f?e.jsx(F,{lines:4}):d?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(_,{color:"secondary",icon:ve,onClick:()=>c(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsx(e.Fragment,{children:m&&e.jsx(It,{accountId:n,connectionId:a,sharedDriveDefaultScope:m.default_selection,sharedDriveScopes:m.object_selections,refetch:c})})}),e.jsx(L,{primaryButton:o,secondaryButton:i,footerContent:r})]})}function It({refetch:s,accountId:t,connectionId:a,sharedDriveDefaultScope:n,sharedDriveScopes:o}){const i=C(),r=S(),{isPending:c,mutate:m}=X({mutationFn:async d=>await b.admin_connection_update_item_default_scope(t,a,"shared_drive",d),mutationKey:["admin_connection_update_item_default_scope",a,"shared_drive"],onError:()=>{r.danger(i.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}))},onSettled:()=>{s()}});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"CIWfUm",defaultMessage:"How do you want to handle Shared Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"BXG6kp",defaultMessage:"Add any Shared Drives you’d like to exclude or include by default."})}),e.jsx(ft,{ariaLabel:{id:"ca.scope-selector.aria-label",defaultMessage:"Select whether Shared drives are included or exlcuded from syncing by default.",description:"@nocommit"},onChange:d=>{c||m(d)},value:n,leftItem:{ariaLabel:ee.includeToggleLabel,label:ee.includeToggleLabel,value:"include"},rightItem:{ariaLabel:ee.excludeToggleLabel,label:ee.excludeToggleLabel,value:"exclude"}}),c?e.jsx(F,{lines:3}):n==="include"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"dmDuO6",defaultMessage:"All Shared drives will be synced except for ones you choose to exclude."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"buyi/M",defaultMessage:"Excluded Shared drives"})}),e.jsx("ul",{children:o.filter(d=>d.selection==="exclude").map(d=>e.jsx(ge,{objectHandle:d.object_handle,objectType:"shared_drive",accountId:t,connectionId:a,scopeChangeIcon:xe,scopeChangeLabel:i.formatMessage({id:"NLi7nF",defaultMessage:"Remove exclusion"}),scopeChangeTarget:"include",onError:()=>{r.danger(i.formatMessage({id:"tdBT+A",defaultMessage:"Failed to remove exclusion. Please try again later."}))},onScopeUpdated:()=>{r.success(i.formatMessage({id:"AC/4a7",defaultMessage:"Sucessfully removed exclusion."})),s()}},d.object_handle))}),e.jsx(he,{objectType:"shared_drive",targetScopeSelection:"exclude",accountId:t,connectionId:a,buttonLabel:i.formatMessage({id:"ThGxVh",defaultMessage:"Exclude"}),onSuccess:()=>{r.success(i.formatMessage({id:"1hsj8s",defaultMessage:"Shared drive has been excluded."})),s()},onError:()=>{r.danger(i.formatMessage({id:"4JkX1y",defaultMessage:"Failed to exclude Shared drive. Please try again later."}))}})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Pa+iyD",defaultMessage:"Only the Shared drives you select will be synced."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"e4EV27",defaultMessage:"Included Shared drives"})}),e.jsx("ul",{children:o.filter(d=>d.selection==="include").map(d=>e.jsx(ge,{objectHandle:d.object_handle,objectType:"shared_drive",accountId:t,connectionId:a,scopeChangeIcon:xe,scopeChangeLabel:i.formatMessage({id:"/oSk2L",defaultMessage:"Remove inclusion"}),scopeChangeTarget:"exclude",onError:()=>{r.danger(i.formatMessage({id:"JhaVH0",defaultMessage:"Failed to remove inclusion. Please try again later."}))},onScopeUpdated:()=>{r.success(i.formatMessage({id:"m6h3gf",defaultMessage:"Sucessfully removed inclusion."})),s()}},d.object_handle))}),e.jsx(he,{objectType:"shared_drive",targetScopeSelection:"include",accountId:t,connectionId:a,buttonLabel:i.formatMessage({id:"At82Iq",defaultMessage:"Include"}),onSuccess:()=>{r.success(i.formatMessage({id:"IMoGWZ",defaultMessage:"Shared drive has been included."})),s()},onError:()=>{r.danger(i.formatMessage({id:"De2z4Y",defaultMessage:"Failed to include Shared drive. Please try again later."}))}})]})]})}const ee=Q({includeToggleLabel:{id:"ca.scope-selection.include-by-default",defaultMessage:"Include by default"},excludeToggleLabel:{id:"ca.scope-selection.exclude-by-default",defaultMessage:"Exclude by default"},includeUserDrivesLabel:{id:"pDGrBu",defaultMessage:"Include user-owned files?"}});async function Pt({accountId:s,connectionId:t}){const a=[];let n=await b.admin_connection_list_item_scopes(s,t,"shared_drive",null);for(a.push(n);n.page_token!=null;)n=await b.admin_connection_list_item_scopes(s,t,"shared_drive",n.page_token),a.push(n);return{object_type:"shared_drive",default_selection:a[0].default_selection,object_selections:a.flatMap(i=>i.object_selections)}}const cs=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM9.70711 8.29289C9.31658 7.90237 8.68342 7.90237 8.29289 8.29289C7.90237 8.68342 7.90237 9.31658 8.29289 9.70711L10.5858 12L8.29289 14.2929C7.90237 14.6834 7.90237 15.3166 8.29289 15.7071C8.68342 16.0976 9.31658 16.0976 9.70711 15.7071L12 13.4142L14.2929 15.7071C14.6834 16.0976 15.3166 16.0976 15.7071 15.7071C16.0976 15.3166 16.0976 14.6834 15.7071 14.2929L13.4142 12L15.7071 9.70711C16.0976 9.31658 16.0976 8.68342 15.7071 8.29289C15.3166 7.90237 14.6834 7.90237 14.2929 8.29289L12 10.5858L9.70711 8.29289Z",fill:"currentColor"}));function ds({isOpen:s,onClose:t,connectionId:a,accountId:n,isPostActivation:o,footerContent:i,primaryButton:r,secondaryButton:c}){const m=C(),d=S(),{refetch:f,data:x,error:g,isLoading:h}=U({queryFn:async()=>await b.admin_connection_list_item_scopes(n,a,"user_drive"),queryKey:["admin_connection_list_item_scopes",a,"user_drive"]}),{isPending:p,mutate:j}=X({mutationFn:async y=>await b.admin_connection_update_item_default_scope(n,a,"user_drive",y?"include":"exclude"),mutationKey:["admin_connection_update_item_default_scope",a,"user_drive"],onError:()=>{d.danger(m.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}))},onSettled:()=>{f()}}),v=x?.default_selection==="include";return e.jsxs(E,{...Y,isOpen:s,onClose:t,testId:"modal-gdrive-dwd-user-drives",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:h?e.jsx(F,{lines:4}):g?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(_,{color:"secondary",icon:ve,onClick:()=>f(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):o?e.jsx("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:v?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"rWqZ31",defaultMessage:"User owned files in My Drives are being synced."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"/dUChW",defaultMessage:"User owned files in My Drives are not being synced."})})]})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"K4ZFoX",defaultMessage:"How do you want to handle My Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"kAW/VW",defaultMessage:"Choose whether you want to sync the My Drive folder for your users."})}),e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(Qe,{enabled:v,disabled:p,label:m.formatMessage(Pe.includeUserDrivesLabel),onChange:()=>{!p&&j(!v)}}),e.jsx("p",{children:e.jsx(l,{...Pe.includeUserDrivesLabel})}),p&&e.jsx(V,{}),e.jsx("div",{className:"grow"}),e.jsx(pe,{label:e.jsx("p",{children:e.jsx(l,{id:"xJvlxk",defaultMessage:"Enable this setting to sync files in users' individual My Drives."})}),children:e.jsx(Xe,{className:"icon-lg text-token-text-tertiary"})})]}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(_e,{className:"icon-lg"}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"4vN9WK",defaultMessage:"You will not be able to change whether user My Drives are included once the connection starts syncing data."})})]})]})}),e.jsx(L,{footerContent:i,primaryButton:r,secondaryButton:c})]})}const Pe=Q({includeUserDrivesLabel:{id:"75ojp7",defaultMessage:"Include user My Drives?"}});function us({connectionDisplayInfo:s}){return e.jsxs("span",{className:"bg-token-main-surface-secondary rounded-xl px-2 py-1 font-bold whitespace-nowrap",children:[s.icon_url&&e.jsx("img",{src:s.icon_url,alt:"",className:"icon-sm me-2 inline"}),s.display_name]})}function ye({isOpen:s,onClose:t,onActivate:a,connectionId:n,accountId:o,connectionDisplayInfo:i,footerContent:r,secondaryButton:c,connectorType:m}){const d=C(),f=S(),x=Z(),[g,h]=u.useState(!1),p=()=>{h(!0),b.admin_activate_connection_instance(o,n).then(()=>{N.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:m}),f.success(d.formatMessage({id:"y5DD0Z",defaultMessage:"Connection successfully activated."})),a?.(),t?.()}).catch(()=>{f.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{h(!1)})},j=e.jsx(_,{color:"primary",loading:g,onClick:p,disabled:x,children:e.jsx(l,{id:"C2dZRO",defaultMessage:"Done"})});return e.jsxs(E,{...le,testId:"modal-review-and-activate",isOpen:s,onClose:t,title:He(m),children:[e.jsxs("div",{className:"flex flex-col gap-3 px-6 pt-4 pb-10",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"38WXzu",defaultMessage:"Review"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"yQhjtE",defaultMessage:"Confirm everything looks good to you, then click the button to activate the connection and start syncing. "})}),e.jsx(us,{connectionDisplayInfo:i})]}),e.jsx(L,{primaryButton:x?e.jsx(oe,{children:j}):j,secondaryButton:c,footerContent:r})]})}function ms({isOpen:s,onClose:t,connectionId:a,accountId:n,isPostActivation:o,footerContent:i,primaryButton:r,secondaryButton:c}){const m=C(),{data:d,isLoading:f,error:x,refetch:g}=U({queryKey:["slack_channel_type_scopes",a],queryFn:()=>b.admin_connection_list_item_scopes(n,a,"channel_type")});let h,p;return d?.object_selections.forEach(({object_handle:j,selection:v})=>{j==="public"?h=v==="include":j==="private"&&(p=v==="include")}),e.jsxs(E,{testId:"modal-slack-channel-scope",...os,isOpen:s,onClose:t,children:[e.jsxs("div",{className:"flex flex-col gap-4 px-6 pt-4 pb-10",children:[e.jsx("p",{className:"text-token-text-primary",children:e.jsx(l,{id:"Ot9UkQ",defaultMessage:"Control which types of channels should be synced."})}),!o&&e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(_e,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(l,{id:"qByMz2",defaultMessage:"You will not be able to modify the sync policy once the connection starts syncing data."})})]}),x&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(l,{id:"F9HsRh",defaultMessage:"Something went wrong."}),e.jsx("button",{onClick:()=>g(),className:"underline",children:e.jsx(l,{id:"y/IEAC",defaultMessage:"Try again"})})]}),f?e.jsx(F,{lines:4}):e.jsxs(e.Fragment,{children:[h!=null&&e.jsx(Le,{connectionId:a,accountId:n,slackChannelScope:"public",title:m.formatMessage({id:"CXSVXf",defaultMessage:"Public channels"}),refetch:g,value:h,isPostActivation:o}),p!=null&&e.jsx(Le,{connectionId:a,accountId:n,slackChannelScope:"private",title:m.formatMessage({id:"5XrboJ",defaultMessage:"Private channels"}),refetch:g,value:p,isPostActivation:o})]})]}),e.jsx(L,{footerContent:i,primaryButton:r,secondaryButton:c})]})}function Le({connectionId:s,accountId:t,slackChannelScope:a,title:n,refetch:o,value:i,isPostActivation:r}){const c=S(),m=C(),[d,f]=u.useState(!1),x=async g=>{if(!d){f(!0);try{g?await b.admin_connection_unblock_items(t,s,"channel_type",[a]):await b.admin_connection_block_items(t,s,"channel_type",[a]),o()}catch{c.danger(m.formatMessage({id:"7QF5n6",defaultMessage:"Failed to update policy. Please try again later."}))}finally{f(!1)}}};return r?e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[i?e.jsx(ae,{className:"icon-lg"}):e.jsx(cs,{className:"icon-lg"}),e.jsx("p",{className:"flex-1",children:n})]}):e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(Qe,{enabled:i,disabled:d,label:n,onChange:x}),e.jsx("p",{children:n}),d&&e.jsx(V,{})]})}const xs=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{d:"M8.7587 3H15.2413C16.0463 2.99999 16.7106 2.99998 17.2518 3.04419C17.8139 3.09012 18.3306 3.18868 18.816 3.43597C19.5686 3.81947 20.1805 4.43139 20.564 5.18404C20.8113 5.66937 20.9099 6.18608 20.9558 6.74817C21 7.28936 21 7.95372 21 8.75868V15.2413C21 16.0463 21 16.7106 20.9558 17.2518C20.9099 17.8139 20.8113 18.3306 20.564 18.816C20.1805 19.5686 19.5686 20.1805 18.816 20.564C18.3306 20.8113 17.8139 20.9099 17.2518 20.9558C16.7106 21 16.0463 21 15.2413 21H8.75868C7.95372 21 7.28936 21 6.74817 20.9558C6.18608 20.9099 5.66937 20.8113 5.18404 20.564C4.43139 20.1805 3.81947 19.5686 3.43597 18.816C3.18868 18.3306 3.09012 17.8139 3.04419 17.2518C2.99998 16.7106 2.99999 16.0463 3 15.2413V8.7587C2.99999 7.95373 2.99998 7.28937 3.04419 6.74817C3.09012 6.18608 3.18868 5.66937 3.43597 5.18404C3.81947 4.43139 4.43139 3.81947 5.18404 3.43597C5.66937 3.18868 6.18608 3.09012 6.74817 3.04419C7.28937 2.99998 7.95373 2.99999 8.7587 3ZM6.91104 5.03755C6.47262 5.07337 6.24842 5.1383 6.09202 5.21799C5.7157 5.40973 5.40973 5.7157 5.21799 6.09202C5.1383 6.24842 5.07337 6.47262 5.03755 6.91104C5.00078 7.36113 5 7.94342 5 8.8V15.2C5 16.0566 5.00078 16.6389 5.03755 17.089C5.07337 17.5274 5.1383 17.7516 5.21799 17.908C5.40973 18.2843 5.7157 18.5903 6.09202 18.782C6.24842 18.8617 6.47262 18.9266 6.91104 18.9624C7.36113 18.9992 7.94342 19 8.8 19H15.2C16.0566 19 16.6389 18.9992 17.089 18.9624C17.5274 18.9266 17.7516 18.8617 17.908 18.782C18.2843 18.5903 18.5903 18.2843 18.782 17.908C18.8617 17.7516 18.9266 17.5274 18.9624 17.089C18.9992 16.6389 19 16.0566 19 15.2V8.8C19 7.94342 18.9992 7.36113 18.9624 6.91104C18.9266 6.47262 18.8617 6.24842 18.782 6.09202C18.5903 5.7157 18.2843 5.40973 17.908 5.21799C17.7516 5.1383 17.5274 5.07337 17.089 5.03755C16.6389 5.00078 16.0566 5 15.2 5H8.8C7.94342 5 7.36113 5.00078 6.91104 5.03755ZM16.3255 7.93219C16.7772 8.25003 16.8856 8.87383 16.5678 9.32549L11.8178 16.0755C11.6431 16.3237 11.3652 16.4792 11.0623 16.4981C10.7593 16.517 10.4642 16.3973 10.2601 16.1727L7.76006 13.4227C7.38855 13.014 7.41867 12.3816 7.82733 12.0101C8.23599 11.6386 8.86843 11.6687 9.23994 12.0773L10.9004 13.9039L14.9322 8.17451C15.25 7.72285 15.8738 7.61436 16.3255 7.93219Z",fill:"currentColor"}));function z({label:s,onClick:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsxs("div",{className:"flew-row hover:bg-token-surface-hover flex cursor-pointer items-center gap-4 px-4 py-2",onClick:t,children:[e.jsx("p",{className:"flex-1",children:s}),t&&e.jsx(Cs,{className:"icon-md text-token-text-secondary shrink-0"})]})]})}function Lt({accountId:s,connectionId:t,refetch:a}){const[n,o]=u.useState(!1),i=Z(),[r,c]=u.useState(!1),m=e.jsx(_,{color:"primary",disabled:i,icon:xs,onClick:()=>o(!0),loading:r,children:e.jsx(l,{id:"S6paZh",defaultMessage:"Finish connecting"})}),d=async()=>{c(!0),await b.admin_activate_connection_instance(s,t),N.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:t,adminQuickstart:!0}),a(),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsx("div",{className:"flex w-full flex-col gap-2 p-4",children:i?e.jsx(oe,{children:m}):m}),n&&e.jsx(Je,{connectionId:t,location:"admin_connection_quickstart_row",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>o(!1),onSuccess:d,accountId:s})]})}function Ft({accountId:s,connectionId:t,refetch:a}){const[n,o]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>o(!0),label:e.jsx(l,{id:"wM9lvD",defaultMessage:"Configure credentials"})}),n&&e.jsx(ls,{onClose:()=>o(!1),onNext:()=>{a(),o(!1)},accountId:s,connectionId:t})]})}function Rt({accountId:s,connectionId:t,isPostActivation:a}){const[n,o]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>o(!0),label:e.jsx(l,{id:"lTeSGb",defaultMessage:"Sync policy"})}),n&&e.jsx(ms,{isOpen:!0,onClose:()=>o(!1),accountId:s,connectionId:t,isPostActivation:a})]})}function Ut({accountId:s,connectionId:t,isPostActivation:a}){const[n,o]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>o(!0),label:e.jsx(l,{id:"AgDWHl",defaultMessage:"User drives"})}),n&&e.jsx(ds,{isOpen:!0,isPostActivation:a,onClose:()=>o(!1),accountId:s,connectionId:t})]})}function Gt({accountId:s,connectionId:t}){const[a,n]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>n(!0),label:e.jsx(l,{id:"gsRcYT",defaultMessage:"Shared drives"})}),a&&e.jsx(rs,{isOpen:!0,onClose:()=>n(!1),accountId:s,connectionId:t})]})}function Bt({accountId:s,connectionId:t,objectType:a}){const[n,o]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>o(!0),label:e.jsx(l,{id:"tisZLQ",defaultMessage:"Block items"})}),n&&e.jsx(At,{isOpen:!0,onClose:()=>o(!1),accountId:s,connectionId:t,objectType:a})]})}function Wt({accountId:s,connection:t}){const[a,n]=u.useState(!1);return t.connection_config.knowledge_connector_type?e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>n(!0),label:e.jsx(l,{id:"9iRaQo",defaultMessage:"User access"})}),a&&e.jsx(re,{connectorType:t.connection_config.knowledge_connector_type,fallbackEstimatedMaxNumUsers:ie(t.connection_config),onClose:()=>n(!1),accountId:s,connectionId:t.connection_config.connection_config_id})]}):null}function qt({accountId:s,connectionId:t,connectorType:a,connectionDisplayInfo:n,onActivate:o,activationBlockingError:i}){const[r,c]=u.useState(!1),m=Z(),d=e.jsx(_,{color:i?"secondary":"primary",disabled:!!i||m,icon:xs,onClick:()=>c(!0),children:e.jsx(l,{id:"tVDCWM",defaultMessage:"Review and finish setup"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsxs("div",{className:"flex w-full flex-col gap-2 p-4",children:[i&&e.jsx("p",{className:"text-token-text-secondary text-sm",children:i}),m?e.jsx(oe,{children:d}):d]}),r&&e.jsx(ye,{isOpen:!0,onClose:()=>c(!1),accountId:s,connectionId:t,connectionDisplayInfo:n,onActivate:o,connectorType:a})]})}const Vt=({open:s,onOpenChange:t,deleteConnection:a,isDeleting:n,connectionDisplayInfo:o})=>{const i=C();return e.jsx(E,{testId:"modal-delete-connection",isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:i.formatMessage({id:"oXdl2Z",defaultMessage:"Confirm deletion"}),type:"danger",icon:_e,primaryButton:e.jsx(_,{color:"danger",onClick:a,disabled:n,loading:n,children:e.jsx(l,{id:"knS5PY",defaultMessage:"Delete"})}),secondaryButton:e.jsx(_,{color:"secondary",disabled:n,onClick:()=>{t(!1)},children:e.jsx(l,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("ul",{className:"px-4",children:[e.jsx("li",{className:"mb-2 list-disc ps-2",children:e.jsx(l,{id:"BvnNwE",defaultMessage:"You are about to delete the connection {connection_name}.",values:{connection_name:e.jsx(us,{connectionDisplayInfo:o})}})}),e.jsx("li",{className:"mb-2 list-disc ps-2",children:e.jsx(l,{id:"0m+fk7",defaultMessage:"Deleting this connection will stop syncing and delete synced data."})}),e.jsx("li",{className:"mb-2 list-disc ps-2 font-bold",children:e.jsx(l,{id:"a86dO+",defaultMessage:"This action cannot be undone."})})]})})},Zt=({open:s,onOpenChange:t,defaultName:a,accountId:n,connectionId:o,refetch:i})=>{const r=C(),[c,m]=u.useState(a),[d,f]=u.useState(!1),x=u.useId(),g=S(),h=u.useCallback(()=>{f(!0),b.admin_edit_name_connection_instance(n,o,{name:c}).then(()=>{g.success(r.formatMessage({id:"pepxEP",defaultMessage:"Connection updated successfully."})),i(),t(!1)}).catch(()=>{g.danger(r.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{f(!1)})},[n,o,r,c,t,i,g]);return e.jsx(E,{testId:"modal-rename",isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:r.formatMessage({id:"mmCJWI",defaultMessage:"Rename"}),type:"success",icon:$e,primaryButton:e.jsx(_,{onClick:()=>h(),loading:d,children:e.jsx(l,{id:"LebexD",defaultMessage:"Rename"})}),secondaryButton:e.jsx(_,{color:"secondary",onClick:()=>{t(!1)},children:e.jsx(l,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("form",{onSubmit:p=>{p.preventDefault(),h()},className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:x,className:"text-token-text-secondary text-base font-medium",children:e.jsx(l,{id:"Gk2g3Q",defaultMessage:"Connection name"})}),e.jsx("input",{type:"text",value:c,onChange:p=>m(p.target.value),id:x,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("button",{type:"submit",className:"display-none"})]})})};function fs({accountId:s,refetchConnectionInstances:t,connection:a,showIcon:n=!1,adminUserConnectionState:o}){const[i,r]=u.useState(!1),c=C();let m;switch(a.connection_config.knowledge_connector_type){case void 0:break;case"github":case"merge_file_storage":case"google_drive_oauth":case"google_drive_dwd":m="synced_object";break;case"slack":m="synced_channel";break}if(!a.connection_config.knowledge_connector_type)return null;let d;return a.connection_status!=="draft"||(a.connection_config.knowledge_connector_type==="google_drive_oauth"&&!a.connection_config.domain_name?d=e.jsx(Lt,{accountId:s,connectionId:a.connection_config.connection_config_id,refetch:t}):d=e.jsx(qt,{connectorType:a.connection_config.knowledge_connector_type,connectionId:a.connection_config.connection_config_id,accountId:s,connectionDisplayInfo:a.display_info,onActivate:t,activationBlockingError:Ht(a,c)})),e.jsxs(Be.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"group bg-token-main-surface-secondary w-full rounded-xl pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 p-4 pb-6",children:[n&&a.display_info.icon_url&&e.jsx("img",{src:a.display_info.icon_url,alt:"",className:"icon-xl self-center"}),e.jsxs("div",{className:"w-full shrink overflow-hidden",children:[e.jsx("div",{className:"text-token-text-primary mb-1 overflow-hidden font-medium text-ellipsis whitespace-nowrap",children:e.jsx(pe,{label:a.display_info.display_name,side:"top",align:"center",children:a.display_info.display_name})}),e.jsx("div",{children:e.jsx(Yt,{connectionStatus:a.connection_status})})]}),e.jsx(zt,{isOpen:i,setIsOpen:r,accountId:s,refetch:t,connectionId:a.connection_config.connection_config_id,connectionDisplayInfo:a.display_info,className:W("hover:bg-token-main-surface-secondary-selected h-8 w-8",i?"bg-token-main-surface-secondary-selected":"bg-transparent")})]}),e.jsx(yt,{connection:a,adminUserConnectionState:o}),e.jsx(Wt,{connection:a,accountId:s}),a.connection_config.knowledge_connector_type==="google_drive_dwd"&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{connectionId:a.connection_config.connection_config_id,accountId:s,refetch:t}),e.jsx(Ut,{connectionId:a.connection_config.connection_config_id,accountId:s,isPostActivation:a.connection_status!=="draft"}),e.jsx(Gt,{connectionId:a.connection_config.connection_config_id,accountId:s})]}),a.connection_config.knowledge_connector_type==="slack"&&e.jsx(Rt,{connectionId:a.connection_config.connection_config_id,accountId:s,isPostActivation:a.connection_status!=="draft"}),m!=null&&e.jsx(Bt,{connectionId:a.connection_config.connection_config_id,accountId:s,objectType:m}),d]})}const Yt=({connectionStatus:s})=>{switch(s){case"active":case"partially_activated":case"activating":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ks,{className:"icon-sm text-token-text-primary"}),e.jsx("span",{className:"text-token-text-primary ms-1 text-sm",children:e.jsx(l,{id:"JGGafW",defaultMessage:"Configured"})})]});case"draft":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(wt,{className:"icon-sm text-token-text-primary"}),e.jsx("span",{className:"text-token-text-primary ms-1 text-sm",children:e.jsx(l,{id:"m4Lx1j",defaultMessage:"Draft"})})]});case"deleting":case"deleted":return null}};function zt({isOpen:s,setIsOpen:t,className:a,connectionId:n,connectionDisplayInfo:o,accountId:i,refetch:r}){const c=S(),m=C(),[d,f]=u.useState(!1),[x,g]=u.useState(!1),[h,p]=u.useState(!1),j=async()=>{if(!h){p(!0);try{await b.admin_delete_connection_instance(i,n),c.success(m.formatMessage({id:"zM0Z9u",defaultMessage:"Connection deleted."}))}catch{c.danger(m.formatMessage({id:"3lBGk2",defaultMessage:"Failed to delete this connection. Please try again later."}))}finally{r(),p(!1),g(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(I.Root,{open:s,onOpenChange:t,children:[e.jsx(I.Trigger,{className:a,children:e.jsx(Ke,{className:"icon-lg"})}),e.jsx(I.Portal,{children:e.jsxs(I.Content,{size:"medium",children:[e.jsx(I.Item,{icon:$e,onSelect:()=>f(!0),disabled:h||x,children:e.jsx(l,{id:"XSQcFy",defaultMessage:"Rename connection"})}),e.jsx(I.Item,{icon:h||x?V:es,onSelect:()=>g(!0),color:"danger",disabled:h||x,children:e.jsx(l,{id:"EAIYOb",defaultMessage:"Delete connection"})}),!1]})})]}),e.jsx(Zt,{open:d,onOpenChange:f,defaultName:o.display_name,connectionId:n,accountId:i,refetch:r}),e.jsx(Vt,{open:x,onOpenChange:g,deleteConnection:j,isDeleting:h,connectionDisplayInfo:o})]})}function Ht(s,t){if(s.connection_config.knowledge_connector_type==="google_drive_dwd"){if(!s.connection_config.admin_email_address||!s.connection_config.service_account_credential_id)return t.formatMessage({id:"BfNdzb",defaultMessage:"Credential configuration is incomplete"})}else if(s.connection_config.knowledge_connector_type==="google_drive_oauth"&&!s.connection_config.domain_name)return t.formatMessage({id:"PxrodU",defaultMessage:"Google Workspace domain must be set"})}function be({steps:s,onClose:t}){const a=s.length,[n,o]=u.useState(0),i=s[0]?.connectorType,r=s[0]?.name;u.useEffect(()=>{!i||!r||N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:i,stepName:r})},[i,r]);const c=m=>{o(m),!(m<0||m>=s.length)&&N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:s[m].connectorType,stepName:s[m].name})};return n<s.length?s[n].fn({goForward:n<a-1?()=>c(n+1):void 0,goBackward:n>0?()=>c(n-1):void 0,close:t,stepNumber:n,totalSteps:a}):null}function Kt({onClose:s,backButton:t}){const[a,n]=u.useState(),o=R();return o?a?e.jsx(Xt,{accountId:o.id,connection:a,onClose:s}):e.jsx(Qt,{onClose:s,backButton:t,setConnection:n}):null}function Qt({onClose:s,setConnection:t,backButton:a}){const n=C(),o=S(),i=R(),r=u.useId();u.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_dwd",stepName:"basic_info"})},[]);const[c,m]=u.useState(""),d=c.length>128,f=c.trim().length>0&&!d,[x,g]=u.useState(!1),h=u.useCallback(()=>{!f||!i||x||(g(!0),b.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_dwd",connection_config_id:"--fake-local-id"},c.trim()).then(p=>{t(p)}).catch(()=>{o.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{g(!1)}))},[i,c,n,f,x,t,o]);return e.jsxs(E,{...Y,onClose:()=>s?.(),testId:"modal-gdrive-dwd-basic-info",children:[e.jsxs("form",{onSubmit:p=>{p.preventDefault(),f&&h()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:r,className:"text-xl font-medium",children:e.jsx(l,{id:"+wLWeZ",defaultMessage:"Enter display name"})}),e.jsx("input",{type:"text",value:c,onChange:p=>m(p.target.value),id:r,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(l,{id:"CPXVQO",defaultMessage:"This is the name your members will see in their ChatGPT connectors."})}),d?e.jsx("p",{className:"text-red-500",children:e.jsx(l,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(L,{secondaryButton:a,primaryButton:e.jsx(_,{color:"primary",disabled:!f||x,loading:x,onClick:h,children:e.jsx(l,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]})}function Xt({connection:s,accountId:t,onClose:a}){return e.jsx(be,{onClose:a,steps:[{connectorType:"google_drive_dwd",name:"credential",fn:({goForward:n,close:o,stepNumber:i,totalSteps:r})=>e.jsx(ls,{onClose:()=>o?.(),accountId:t,connectionId:s.connection_config.connection_config_id,onNext:n??(()=>null),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})},{connectorType:"google_drive_dwd",name:"user_drives",fn:({goForward:n,goBackward:o,close:i,stepNumber:r,totalSteps:c})=>e.jsx(ds,{onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:n&&e.jsx(_,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:o&&e.jsx(_,{color:"secondary",onClick:o,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0,isPostActivation:!1})},{connectorType:"google_drive_dwd",name:"shared_drives",fn:({goForward:n,goBackward:o,close:i,stepNumber:r,totalSteps:c})=>e.jsx(rs,{onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:n&&e.jsx(_,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:o&&e.jsx(_,{color:"secondary",onClick:o,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0})},{connectorType:"google_drive_dwd",name:"allowed_users",fn:({goForward:n,goBackward:o,close:i,stepNumber:r,totalSteps:c})=>e.jsx(re,{connectorType:"google_drive_dwd",fallbackEstimatedMaxNumUsers:ie(s.connection_config),onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:n&&e.jsx(_,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:o&&e.jsx(_,{color:"secondary",onClick:o,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})})})},{connectorType:"google_drive_dwd",name:"review_and_activate",fn:({goBackward:n,close:o,stepNumber:i,totalSteps:r})=>e.jsx(ye,{isOpen:!0,onClose:()=>o?.(),accountId:t,connectorType:"google_drive_dwd",connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:n&&e.jsx(_,{color:"secondary",onClick:n,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})}]})}const Jt=({domainName:s,intl:t})=>s.trim().toLocaleLowerCase()==="gmail.com"?{valid:!1,errorType:"domainChecker.error.gmail",error:t.formatMessage({id:"domainChecker.error.gmail",defaultMessage:"Personal Google Accounts (e.g. gmail.com) are not supported"})}:{valid:!0},$t=({domainName:s,intl:t})=>{const a=s.trim();if(/^https?:\/\//i.test(a))return{valid:!1,errorType:"domainChecker.error.noHttp",error:t.formatMessage({id:"domainChecker.error.noHttp",defaultMessage:"Do not include http:// or https:// in the domain."})};if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return{valid:!1,errorType:"domainChecker.error.noEmail",error:t.formatMessage({id:"domainChecker.error.noEmail",defaultMessage:"Do not use an email address. Use only the domain name."})};if(/[^a-zA-Z0-9.-]/.test(a))return{valid:!1,errorType:"domainChecker.error.invalidCharacters",error:t.formatMessage({id:"domainChecker.error.invalidCharacters",defaultMessage:"Domain contains invalid characters. Only letters, numbers, hyphens, and dots are allowed."})};const n=a.split(".");if(n.length<2)return{valid:!1,errorType:"domainChecker.error.missingDot",error:t.formatMessage({id:"domainChecker.error.missingDot",defaultMessage:"Domain must include at least one dot (e.g., example.com)."})};for(const i of n){if(!i)return{valid:!1,errorType:"domainChecker.error.emptySection",error:t.formatMessage({id:"domainChecker.error.emptySection",defaultMessage:"Domain has empty sections between dots (e.g., '..' or '.com.')."})};if(i.length>63)return{valid:!1,errorType:"domainChecker.error.labelTooLong",error:t.formatMessage({id:"domainChecker.error.labelTooLong",defaultMessage:"Each part of the domain must be 63 characters or less."})};if(!/^[a-zA-Z0-9-]+$/.test(i))return{valid:!1,errorType:"domainChecker.error.invalidLabelCharacters",error:t.formatMessage({id:"domainChecker.error.invalidLabelCharacters",defaultMessage:'Domain label "{label}" has invalid characters.'},{label:i})};if(/^-|-$/.test(i))return{valid:!1,errorType:"domainChecker.error.hyphenPosition",error:t.formatMessage({id:"domainChecker.error.hyphenPosition",defaultMessage:'Domain label "{label}" cannot start or end with a hyphen.'},{label:i})}}const o=n[n.length-1];return o.length<2||!/^[a-zA-Z]+$/.test(o)?{valid:!1,errorType:"domainChecker.error.invalidTLD",error:t.formatMessage({id:"domainChecker.error.invalidTLD",defaultMessage:"Top-level domain must be at least 2 letters."})}:{valid:!0}};function en({onClose:s,backButton:t}){const[a,n]=u.useState(),o=R();return o?a?e.jsx(nn,{accountId:o.id,connection:a,onClose:s}):e.jsx(sn,{onClose:s,backButton:t,setConnection:n}):null}function sn({onClose:s,setConnection:t,backButton:a}){const n=C(),o=S(),i=R(),r=u.useId();u.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"basic_info"})},[]);const c=Ys(),m=u.useMemo(()=>{const y=c?.email?.split("@")[1];return y&&c.email_domain_type!=="social"?y:""},[c]),[d,f]=u.useState(m),[x,g]=u.useState(""),h=u.useCallback(y=>{let{valid:k,error:w,errorType:A}=Jt({domainName:y,intl:n});return k&&({valid:k,error:w,errorType:A}=$t({domainName:y,intl:n})),w&&N.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_oauth",stepName:"basic_info",error:`invalid_domain-${A}`}),{valid:k,error:w}},[n]),[p,j]=u.useState(!1),v=u.useCallback(async()=>{if(!d||!i)return;const{valid:y,error:k}=h(d);if(g(k??""),!!y){j(!0);try{const w=await b.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_oauth",domain_name:d,connection_config_id:"--fake-local-id"});c&&await b.admin_connection_allow_user(i.id,w.connection_config.connection_config_id,c.id),await b.admin_activate_connection_instance(i.id,w.connection_config.connection_config_id),N.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:w.connection_config.connection_config_id}),t(w)}catch{o.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{j(!1)}}},[i,d,n,t,o,c,h]);return e.jsxs(E,{...Y,onClose:()=>s?.(),testId:"modal-gdrive-basic-info",children:[e.jsxs("form",{onSubmit:y=>{y.preventDefault(),v()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("label",{htmlFor:r,children:[e.jsx("div",{className:"mb-4 text-xl font-medium",children:e.jsx(l,{id:"EbU972",defaultMessage:"Enter your Google Workspace domain"})}),e.jsx("div",{className:"text-token-text-secondary mb-4 text-sm font-normal",children:e.jsx(l,{id:"i83LbI",defaultMessage:"Only users from this Google Workspace domain will be able to connect their account. You domain name should look like example.com"})})]}),e.jsx(gt,{type:"text",value:d,placeholder:"example.com",onChange:y=>{f(y.target.value),g("")},onBlur:()=>{const{error:y}=h(d);g(y??"")},name:r,ariaLabel:"Domain name",className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid",error:x}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary mt-6 flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(zs,{className:"icon-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-secondary text-xs font-medium",children:e.jsx(l,{id:"h6elsv",defaultMessage:"Double-check this is the right domain for your Google Workspace."})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(l,{id:"9LPdfq",defaultMessage:"Entering the wrong domain will prevent this feature from working."})})]})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(L,{footerContent:e.jsx("div",{children:e.jsx(J,{href:Se,className:"text-token-text-secondary text-sm underline",onClick:()=>$({link:Se,location:"admin_onboarding_basic_info"}),children:e.jsx(l,{id:"6WfLis",defaultMessage:"Where do I find my domain name?"})})}),primaryButton:e.jsx(_,{color:"primary",disabled:d.trim()===""||!!x,loading:p,onClick:v,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:a})]})}function tn({onClose:s,onSuccess:t,connection:a,accountId:n}){u.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"quickstart"})},[]);const o=async()=>{await b.admin_activate_connection_instance(n,a.connection_config.connection_config_id),N.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:a.connection_config.connection_config_id,adminQuickstart:!0}),t()};return e.jsx(Je,{connectionId:a.connection_config.connection_config_id,location:"admin_connection_quickstart",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>{s?.()},onSuccess:o,accountId:n})}function nn({connection:s,accountId:t,onClose:a,hasAdminAlreadyConnected:n=!1}){const o=C(),i=[{connectorType:"google_drive_oauth",name:"allowed_users",fn:({goForward:r,close:c})=>e.jsx(re,{connectorType:"google_drive_oauth",fallbackEstimatedMaxNumUsers:ie(s.connection_config),onClose:()=>c?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:n?e.jsx(_,{color:"primary",onClick:a,children:o.formatMessage(B.finish)}):r&&e.jsx(_,{color:"primary",onClick:r,children:o.formatMessage(B.continue)})})}];return n||i.push({connectorType:"google_drive_oauth",name:"admin_oauth_disclaimer",fn:({goForward:r,goBackward:c,close:m})=>e.jsx(Hs,{isOpen:!0,onClose:()=>m?.(),isAdminFlow:!0,isAdminQuickstartFlow:!1,secondaryButton:c&&e.jsx(_,{color:"secondary",onClick:c,children:o.formatMessage(B.back)}),primaryButton:e.jsx(_,{color:"primary",onClick:r,children:o.formatMessage(B.continue)})})},{connectorType:"google_drive_oauth",name:"admin_oauth_cta",fn:({goForward:r,goBackward:c,close:m})=>e.jsx(Ks,{isOpen:!0,onClose:()=>m?.(),secondaryButton:c&&e.jsx(_,{color:"secondary",onClick:c,children:o.formatMessage(B.back)}),primaryButton:e.jsx(Ae,{onSuccess:()=>m?.(),onError:()=>r?.(),label:o.formatMessage(B.loginWithGoogle),connectionId:s.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow"})})},{connectorType:"google_drive_oauth",name:"admin_oauth_error",fn:({close:r})=>e.jsx(Qs,{isOpen:!0,onClose:()=>r?.(),primaryButton:e.jsx(Ae,{onSuccess:()=>r?.(),label:o.formatMessage(B.reconnect),connectionId:s.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow",isReconnect:!0})})}),e.jsx(be,{onClose:a,steps:i})}const B=Q({back:{id:"RDaXnk",defaultMessage:"Back"},cancel:{id:"CfN1/v",defaultMessage:"Cancel"},continue:{id:"XGnWba",defaultMessage:"Continue"},loginWithGoogle:{id:"9ImAmL",defaultMessage:"Log in with Google"},reconnect:{id:"0qUCBD",defaultMessage:"Reconnect"},finish:{id:"5Wpd39",defaultMessage:"Finish"}});function an({onClose:s,isDwdEnabled:t}){const[a,n]=u.useState("gdrive-oauth"),[o,i]=u.useState(!0),[r,c]=u.useState(),[m,d]=u.useState(!1),f=o&&t&&!r,x=R(),g=ws(),h=Ms(g,"218915747"),p=async()=>{if(!(a==="gdrive-oauth"&&h)){i(!1);return}if(!(!x?.id||r))try{d(!0),c(await b.admin_create_connection_instance(x.id,{knowledge_connector_type:"google_drive_oauth",domain_name:"",connection_config_id:"--fake-local-id"}))}catch{s()}finally{d(!1)}};return u.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive",stepName:"options"})},[]),e.jsxs(e.Fragment,{children:[e.jsxs(E,{testId:"modal-gdrive-add-workspace",...Y,isOpen:f,onClose:s,children:[e.jsx("div",{className:"px-6 pt-4 pb-10",children:e.jsx(on,{selectedConnector:a,setSelectedConnector:n})}),e.jsx(L,{footerContent:e.jsx(J,{href:De,className:"text-token-text-secondary text-sm underline",onClick:()=>$({link:De,location:"admin_onboarding_gdrive_options"}),children:e.jsx(l,{id:"ADGK4d",defaultMessage:"Which option is right for my team?"})}),primaryButton:e.jsx(_,{color:"primary",onClick:p,loading:m,disabled:m,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:e.jsx(_,{color:"secondary",onClick:s,disabled:m,children:e.jsx(l,{id:"5Oo8TW",defaultMessage:"Cancel"})})})]}),!f&&(r&&x?e.jsx(tn,{onClose:()=>{i(!0),c(void 0),s()},onSuccess:()=>{i(!0),c(void 0),s()},connection:r,accountId:x.id}):a==="gdrive-oauth"?e.jsx(en,{onClose:()=>{s(),i(!0)},backButton:t&&e.jsx(_,{color:"secondary",onClick:()=>i(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):a==="gdrive-dwd"?e.jsx(Kt,{onClose:()=>{s(),i(!0)},backButton:e.jsx(_,{color:"secondary",onClick:()=>i(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):null)]})}function on({selectedConnector:s,setSelectedConnector:t}){const a=C();return e.jsxs("div",{children:[e.jsx("div",{className:"-mt-2 mb-6 text-start text-lg font-medium",children:e.jsx(l,{id:"JKSyU3",defaultMessage:"Choose how your team connects Google Drive"})}),e.jsxs(Xs,{value:s,onValueChange:n=>t(n),className:"flex w-full flex-col gap-4",children:[e.jsx(Fe,{optionValue:"gdrive-oauth",optionName:a.formatMessage({id:"PToV7K",defaultMessage:"Quick setup (Best for small teams)"}),isSelected:s==="gdrive-oauth",checkedBulletPoints:[a.formatMessage({id:"FWY+Q/",defaultMessage:"Up to {no} users"},{no:10}),a.formatMessage({id:"kKUnE9",defaultMessage:"Each user authenticates their account"})]}),e.jsx(Fe,{optionValue:"gdrive-dwd",optionName:a.formatMessage({id:"Fv9Vz6",defaultMessage:"Admin-controlled access (Best for larger teams)"}),isSelected:s==="gdrive-dwd",checkedBulletPoints:[a.formatMessage({id:"UkcpBq",defaultMessage:"No user limit"}),a.formatMessage({id:"wQNb3H",defaultMessage:"Centralized setup with granular access controls"})]})]})]})}function Fe({optionName:s,optionValue:t,isSelected:a,checkedBulletPoints:n,disabled:o}){const i=a?ae:Ss;return e.jsxs(Js,{value:t,id:`connector-group-option-${t}`,className:W("border-token-border-heavy flex w-full justify-between rounded-xl border border-solid p-4",o&&"opacity-50",a&&"border-token-text-primary"),disabled:o,children:[e.jsxs("div",{className:"max-w-96 shrink-0",children:[e.jsx("div",{className:"text-start font-medium",children:s}),e.jsx("div",{className:"font-tertiary mt-1 text-start text-sm",children:n.length&&e.jsx("ul",{className:"text-token-text-secondary mt-1 mb-2 flex-1",children:n.map((r,c)=>e.jsxs("li",{className:"flex flex-row items-baseline text-start",children:[e.jsx(Ns,{className:"icon-sm relative top-1 me-2"}),e.jsx("span",{className:"text-sm",children:r})]},c))})})]}),e.jsx(i,{className:"icon-lg shrink-0"})]})}function ln({onClose:s}){const[t,a]=u.useState(),n=R();return n?t?e.jsx(cn,{accountId:n.id,connection:t,onClose:s}):e.jsx(rn,{accountId:n.id,onClose:s,setConnection:a}):null}function rn({onClose:s,setConnection:t,accountId:a}){const n=C(),o=S(),[i,r]=u.useState({teamDomain:"app"});u.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"slack",stepName:"basic_info"})},[]);const[c,m]=u.useState(!1),d=u.useCallback(()=>{!(i.teamDomain&&i.teamId)||!a||(m(!0),b.admin_create_connection_instance(a,{connection_config_id:"--fake-local-id",knowledge_connector_type:"slack",team_id:i.teamId,team_domain:i.teamDomain},i.connectionName).then(j=>{t(j)}).catch(()=>{o.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{m(!1)}))},[a,i.connectionName,i.teamDomain,i.teamId,n,t,o]),f=!!i.connectionName?.length&&i.connectionName.length>128,x=!!(i.teamDomain&&i.teamId&&!f),g=u.useId(),h=u.useId(),p=u.useId();return e.jsxs(E,{...os,onClose:s,testId:"modal-slack-basic-info",children:[e.jsxs("form",{onSubmit:j=>{j.preventDefault(),x&&d()},className:"flex flex-col gap-4 px-6 pt-4 pb-6",children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:g,className:"text-token-text-secondary text-base font-medium",children:e.jsx(l,{id:"e2yF8/",defaultMessage:"Connection display name"})}),e.jsx("input",{type:"text",value:i.connectionName??"",onChange:j=>r(v=>({...v,connectionName:j.target.value})),placeholder:n.formatMessage({id:"0gZ+BA",defaultMessage:"(optional)"}),id:g,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),f?e.jsx("p",{className:"text-red-500",children:e.jsx(l,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:h,className:"text-token-text-secondary text-base font-medium",children:e.jsx(l,{id:"hEnKIS",defaultMessage:"Slack workspace domain"})}),e.jsxs("p",{children:[e.jsx("input",{type:"text",value:i.teamDomain??"",onChange:j=>r(v=>({...v,teamDomain:j.target.value})),id:h,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("span",{className:"text-token-text-secondary ms-1 font-medium",children:".slack.com"})]})]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:p,className:"text-token-text-secondary text-base font-medium",children:e.jsx(l,{id:"azUOrk",defaultMessage:"Slack workspace ID"})}),e.jsx("input",{type:"text",value:i.teamId??"",onChange:j=>r(v=>({...v,teamId:j.target.value})),placeholder:n.formatMessage({id:"vUK9Kc",defaultMessage:"T0000000000"}),id:p,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(L,{primaryButton:e.jsx(_,{color:"primary",disabled:!x,onClick:d,loading:c,children:e.jsx(l,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]})}function cn({connection:s,accountId:t,onClose:a}){return e.jsx(be,{onClose:a,steps:[{connectorType:"slack",name:"allowed_users",fn:({goForward:n,close:o,stepNumber:i,totalSteps:r})=>e.jsx(re,{fallbackEstimatedMaxNumUsers:ie(s.connection_config),onClose:()=>o?.(),accountId:t,connectionId:s.connection_config.connection_config_id,connectorType:"slack",primaryButton:n&&e.jsx(_,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})},{connectorType:"slack",name:"slack_channel_scope",fn:({goForward:n,goBackward:o,close:i,stepNumber:r,totalSteps:c})=>e.jsx(ms,{isOpen:!0,isPostActivation:!1,onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:n&&e.jsx(_,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:o&&e.jsx(_,{color:"secondary",onClick:o,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})})})},{connectorType:"slack",name:"review_and_activate",fn:({goBackward:n,close:o,stepNumber:i,totalSteps:r})=>e.jsx(ye,{isOpen:!0,onClose:()=>o?.(),accountId:t,connectorType:"slack",connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:n&&e.jsx(_,{color:"secondary",onClick:n,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})}]})}const Ce=As.div`w-full border-b-2 border-token-border-medium`;async function dn(s){const[t,a]=await Promise.all([b.admin_list_knowledge_connectors(s),b.admin_list_connection_instances(s)]),n=new Map;return t.knowledge_conectors.forEach(o=>n.set(o.connector_details.knowledge_connector_type,{displayInfo:o.display_info,availability:o.connector_details.availability,connections:[],limits:o.connector_details.limits??{max_instances:3}})),a.connection_instances.forEach(o=>{if(!o.connection_config.knowledge_connector_type)return;let i=n.get(o.connection_config.knowledge_connector_type)?.connections;i!=null?i.push(o):n.set(o.connection_config.knowledge_connector_type,{displayInfo:o.display_info,availability:"unavailable",limits:fe,connections:[o]})}),n}function me(s){return!(s.connection_status==="deleted"||s.connection_status==="deleting")}function un(){const s=C(),t=R(),[a,n]=u.useState(!1),[o,i]=u.useState(!1);u.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Page Visited","chatgpt_contextual_answers_admin_page_visited")},[]);const{data:r,isLoading:c,error:m,refetch:d}=U({queryKey:["admin:knowledge_connectors_with_connections",t?.id],queryFn:async()=>{if(!t)throw new Error("No current account");return await dn(t.id)},enabled:!!t}),{refetch:f,connectionInstanceData:x}=ze(),g=()=>{d(),f()},h=r?.get("google_drive_oauth")?.availability==="available"||r?.get("google_drive_dwd")?.availability==="available",{combinedGoogleDriveConnections:p,slackConnections:j,otherConnections:v}=u.useMemo(()=>{const w=[],A=[],D=[];return r?.forEach((T,P)=>{if(T.availability!=="available"){D.push(...T.connections.filter(me));return}P==="google_drive_dwd"||P==="google_drive_oauth"?w.push(...T.connections.filter(me)):P==="slack"&&A.push(...T.connections.filter(me))}),{combinedGoogleDriveConnections:w,slackConnections:A,otherConnections:D}},[r]),y=r?.get("slack")?.availability==="available",k=Z();return t?.id?e.jsxs(je,{children:[e.jsx(gs,{badge:e.jsx(Ps,{})}),m&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(l,{id:"zNCx93",defaultMessage:"Failed to get connection instances. Please refresh to try again."})]}),k&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(l,{id:"hnTY+Z",defaultMessage:"Our systems are experiencing high load. Some operations may be temporarily unavailable."})]}),e.jsx(Ce,{}),c&&e.jsx(F,{lines:4}),h&&e.jsx(Re,{accountId:t.id,connectorType:"google_drive",connectorName:s.formatMessage({id:"oDI3Mt",defaultMessage:"Google Drive"}),limits:r?.get("google_drive_oauth")?.limits??r?.get("google_drive_dwd")?.limits??fe,description:s.formatMessage({id:"3yZLm6",defaultMessage:"Connect Google Drives, Docs, Sheets, Slides and other files."}),onClickConnect:()=>n(!0),Icon:$s,connectionInstancesLoading:c,connectionInstances:p,adminUserConnectionStatus:x?.connection_statuses,refetchConnectionInstances:g,singularNounConnectedObjectName:Ie("google_drive_oauth",s).externalLinkableUnitSingular}),y&&e.jsx(Re,{accountId:t.id,connectorType:"slack",connectorName:s.formatMessage({id:"pUDRLC",defaultMessage:"Slack"}),limits:r?.get("slack")?.limits??fe,description:s.formatMessage({id:"p1qvhM",defaultMessage:"Connect messages and channels."}),Icon:et,onClickConnect:()=>i(!0),connectionInstancesLoading:c,connectionInstances:j,adminUserConnectionStatus:x?.connection_statuses,refetchConnectionInstances:g,singularNounConnectedObjectName:Ie("slack",s).externalLinkableUnitSingular}),v.length>0&&e.jsx(mn,{accountId:t.id,connectionInstancesLoading:c,connectionInstances:v,refetchConnectionInstances:g}),a&&e.jsx(an,{isDwdEnabled:r?.get("google_drive_dwd")?.availability==="available",onClose:()=>{n(!1),g()}}),o&&e.jsx(ln,{onClose:()=>{i(!1),g()}})]}):null}function Re({accountId:s,Icon:t,connectorName:a,connectorType:n,description:o,onClickConnect:i,connectionInstances:r,connectionInstancesLoading:c,adminUserConnectionStatus:m,refetchConnectionInstances:d,singularNounConnectedObjectName:f,limits:x}){const g=Z(),h=r!=null&&!g&&(x.max_instances===ns||r.length<x.max_instances),p=()=>{N.logEventWithStatsig("Contextual Answers Admin Create Connection Button Clicked","chatgpt_contextual_answers_admin_create_connection_button_clicked",{connectorType:n}),i?.()},j=e.jsx(_,{className:"text-nowrap",color:r?.length?"secondary":"primary",onClick:p,icon:st,disabled:!h,children:r?.length?e.jsx(l,{id:"Ou779X",defaultMessage:"Connect another {connectedKnowledgeSource}",values:{connectedKnowledgeSource:f}}):e.jsx(l,{id:"Uvs01u",defaultMessage:"Connect"})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx(t,{className:"icon-2xl my-1 shrink-0"}),e.jsxs("div",{className:"flex min-w-[240px] flex-1 flex-col gap-1",children:[e.jsx("p",{className:"font-semibold",children:a}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:o})]}),!c&&e.jsx("div",{className:"flex shrink-0 items-center",children:h?j:g?e.jsx(oe,{children:j}):e.jsx(pe,{side:"top",label:e.jsx(l,{id:"QktxrB",defaultMessage:"Max connections reached"}),children:j})})]}),c?e.jsx(F,{lines:2}):r?.length?e.jsx(We,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[r.filter(v=>!["deleted","deleting"].includes(v.connection_status)).map(v=>e.jsx(fs,{connection:v,accountId:s,refetchConnectionInstances:d,adminUserConnectionState:m?.find(y=>y.user_connection_details.connection_instance_id===v.connection_config.connection_config_id)},v.connection_config.connection_config_id)),r.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]}),e.jsx(Ce,{className:"mt-4"})]})}function mn({accountId:s,connectionInstances:t,connectionInstancesLoading:a,refetchConnectionInstances:n}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx(vt,{className:"icon-2xl my-1 shrink-0"}),e.jsx("div",{className:"flex min-w-[240px] flex-1 flex-col gap-1",children:e.jsx("p",{className:"font-semibold",children:e.jsx(l,{id:"WFgOAD",defaultMessage:"Other connections"})})})]}),a?e.jsx(F,{lines:2}):t?.length?e.jsx(We,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[t.map(o=>e.jsx(fs,{connection:o,showIcon:!0,accountId:s,refetchConnectionInstances:n},o.connection_config.connection_config_id)),t.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]}),e.jsx(Ce,{className:"mt-4"})]})}function gs({badge:s}){const t=C();return e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{className:"flex flex-row items-center gap-2",children:[e.jsx("span",{children:t.formatMessage({id:"ohOhqy",defaultMessage:"Internal knowledge"})}),s]}),e.jsx(Ze,{className:"text-token-text-secondary",children:e.jsx(l,{id:"KKGA4q",defaultMessage:"Connect your organization’s Google Drive so your team gets up‑to‑date, relevant answers from your internal knowledge. ChatGPT semantically searches your content—surfacing only what users are authorized to see—and admins control which sources are connected and who accesses them. {learnMore}",values:{learnMore:e.jsx(J,{href:ne,className:"underline",onClick:()=>$({link:ne,location:"admin_settings_header"}),children:e.jsx(l,{id:"WGpoE2",defaultMessage:"Learn more"})})}})})]})}function xn({feedbackMetadata:s,currentWorkspaceId:t,onClose:a,onFeedbackActionTaken:n}){const o=C(),{data:i,refetch:r,isLoading:c}=U({queryKey:["adminGetCaMessageFeedback",t,s.feedback_id],queryFn:()=>se.safeGet("/ca/admin/feedback/{feedback_id}",{parameters:{path:{feedback_id:s.feedback_id},query:{account_id:t}}})}),m=S(),d=X({mutationFn:x=>x.operation==="delete"?se.safeDelete("/ca/admin/feedback/{feedback_id}",{parameters:{path:{feedback_id:x.feedbackId},query:{account_id:x.workspaceId}}}):se.safePost("/ca/admin/feedback/{feedback_id}/approve",{parameters:{path:{feedback_id:x.feedbackId},query:{account_id:x.workspaceId,with_sources:x.withSources}}}),onSuccess:(x,g)=>{n(),a(),m.success(g.operation==="approve"?o.formatMessage(M.feedbackApproved):o.formatMessage(M.feedbackDeleted))},onError:(x,g)=>{r(),m.warning(g.operation==="approve"?o.formatMessage(M.errorApprovingFeedback):o.formatMessage(M.errorDeletingFeedback))}}),f=u.useMemo(()=>{const x=s.review_status==="unreviewed",g=s.review_status==="unreviewed";let h;switch(s.review_status){case"approved_with_sources":case"approved_without_sources_data_expired":{h=o.formatMessage(M.actionMessageNoActionsAvailable);break}case"approved_without_sources_data_available":{h=o.formatMessage(M.actionMessageApprovedWithoutSources);break}case"deleted":{h=o.formatMessage(M.actionMessageFeedbackDeleted);break}}const p={workspaceId:t,feedbackId:s.feedback_id,withSources:!0};return e.jsxs("div",{className:"bg-token-main-surface-secondary sticky bottom-0 flex w-full flex-col gap-2 rounded-lg p-4",children:[!!h&&e.jsx("div",{children:e.jsx("p",{children:h})}),e.jsxs("div",{className:"flex flex-row gap-2",children:[x&&e.jsx(_,{color:"primary",icon:tt,onClick:()=>d.mutate({...p,operation:"approve"}),loading:d.isPending,children:e.jsx(l,{id:"Zq8YOH",defaultMessage:"Approve Feedback"})}),g&&e.jsx(_,{color:"danger-outline",icon:es,onClick:()=>d.mutate({...p,operation:"delete"}),loading:d.isPending,children:e.jsx(l,{id:"qeIjD9",defaultMessage:"Delete Feedback"})})]})]})},[s.review_status,s.feedback_id,d,t,o]);return e.jsx(fn,{actionBar:f,onClose:a,isLoading:c,feedbackData:i,feedbackMetadata:s})}function fn({actionBar:s=null,onClose:t=()=>{},isLoading:a=!1,isDebugView:n=!1,feedbackData:o,feedbackMetadata:i}){const r=C();return e.jsx(E,{testId:"modal-admin-feedback",size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:!0,icon:nt,onClose:t,showCloseButton:!0,type:"success",title:r.formatMessage(M.modalTitle),children:e.jsx("div",{className:"flex flex-col",children:o&&!a?e.jsxs(e.Fragment,{children:[e.jsx(gn,{feedbackData:o,feedbackMetadata:i,isDebugView:n}),e.jsx(Me,{className:"my-4"}),e.jsx(pn,{fileRefs:o.file_references}),e.jsx(Me,{className:"my-4"}),e.jsx(_n,{retrievalMessages:o.retrieval_messages,userDisplayName:i.submitter_display_name??i.submitter_email,isDebugView:n}),s]}):e.jsx(ss,{lines:8})})})}function gn({feedbackMetadata:s,feedbackData:t,isDebugView:a=!1}){const n=C(),o=s.submitter_display_name&&s.submitter_email?n.formatMessage(M.userDisplayName,{displayName:s.submitter_display_name,email:s.submitter_email}):s.submitter_id,i=u.useMemo(()=>t.sources_feedback?Object.entries(t.sources_feedback).map(([r,c])=>{if(!c.rating&&!(c.tags&&c.tags.length>0))return null;const m=t.file_references.find(f=>f.document_id===r)?.title,d=c.tags&&c.tags.length===1&&c.tags[0]===pt;return e.jsxs("li",{className:"flex flex-col p-1 text-sm break-words",children:[e.jsxs("div",{className:"mb-1 flex flex-row items-center gap-2",children:[c.rating==="thumbsUp"?e.jsx(at,{className:"icon-sm"}):c.rating==="thumbsDown"?e.jsx(Ee,{className:"icon-sm"}):null,e.jsx("a",{href:c.url??void 0,className:"text-sm font-semibold",children:m??c.url??r})]}),e.jsx("div",{className:"flex flex-row flex-wrap gap-1",children:d?e.jsx("span",{className:"italic",children:e.jsx(l,{id:"yNGc6H",defaultMessage:"This source should have been used."})}):c.tags?.map(f=>e.jsx("div",{className:"border-token-border-default text-token-text-secondary rounded-lg border px-3 py-1 text-xs",children:Oe(f,n)},f))})]},r)}).filter(r=>!!r):[],[t.file_references,t.sources_feedback,n]);return e.jsxs("div",{children:[!a&&e.jsx("div",{className:"mb-2",children:e.jsx(hs,{reviewStatus:s.review_status})}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.rating==="thumbsUp"?e.jsx(ot,{className:"icon-xl m-2"}):e.jsx(Ee,{className:"icon-xl m-2"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:o}),s.submitted_at&&e.jsx("p",{className:"text-token-text-secondary text-xs",children:new Date(s.submitted_at).toLocaleString()})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:t.tags?.map(r=>e.jsx("div",{className:"border-token-border-default text-token-text-secondary rounded-lg border px-3 py-1 text-sm",children:Oe(r,n)},r))}),e.jsxs("div",{className:"mb-2",children:[e.jsx(q,{className:"mb-1",children:e.jsx(l,{id:"VrPx6x",defaultMessage:"Feedback"})}),e.jsx("p",{className:"rounded-sm border p-2 text-sm break-words",children:t.text?t.text:e.jsx("span",{className:"italic",children:e.jsx(l,{id:"pEEJ/8",defaultMessage:"No written feedback was provided."})})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(q,{className:"mb-1",children:e.jsx(l,{id:"LUg6Vl",defaultMessage:"Additional Sources"})}),e.jsx("p",{className:"rounded-sm border p-2 text-sm break-words",children:t.additional_sources?t.additional_sources:e.jsx("span",{className:"italic",children:e.jsx(l,{id:"u24Zo5",defaultMessage:"No additional sources were provided."})})})]}),i.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(q,{className:"mb-1",children:e.jsx(l,{id:"lNSdNZ",defaultMessage:"Sources Feedback"})}),e.jsx("ul",{className:"flex flex-col gap-1",children:i})]})]})}const hn=["citation","context_stuff","search_result"];function Ue(s){return Array.from(s.map(t=>ct({type:"file",id:t.document_id,cloud_doc_url:t.external_url??void 0,name:t.title??"",source:"google_drive",extra:{cloud_doc_url:t.external_url??void 0}})).filter(t=>!!t))}function pn({fileRefs:s}){const[t,a]=u.useMemo(()=>{const n=new Map,o=new Map;return s.forEach(i=>{hn.includes(i.reference_source)&&i.external_url&&!n.has(i.document_id)?n.set(i.document_id,i):i.reference_source==="user_feedback"&&i.external_url&&!o.has(i.document_id)&&o.set(i.document_id,i)}),[Ue(Array.from(n.values())),Ue(Array.from(o.values()))]},[s]);return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(q,{className:"mb-2",children:e.jsx(l,{id:"FB4YIA",defaultMessage:"Sources In Conversation"})}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary mb-2 text-xs",children:e.jsx(l,{id:"iTNNoN",defaultMessage:"These sources were considered or cited in the conversation. Snapshots of these sources will be included with the feedback if you choose to approve the feedback."})}),e.jsx("div",{className:"flex flex-col gap-1",children:t.map(n=>e.jsx(Te,{compact:!0,citationMetadata:n},n.url))})]}):e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(l,{id:"Q+DKpB",defaultMessage:"No synced sources were considered or cited in the conversation, however there may be other sources present such as user uploaded files. If you choose to approve this feedback, only the snippets of those files that ChatGPT looked at will be shared with this feedback."})})]}),a.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx(q,{className:"mb-2",children:e.jsx(l,{id:"SCwQnr",defaultMessage:"Sources From Feedback"})}),e.jsx("p",{className:"text-token-text-secondary mb-2 text-xs",children:e.jsx(l,{id:"Rr+4KZ",defaultMessage:"The feedback submitter mentioned these documents in their feedback. Snapshots of these documents will be included with the feedback if you choose to approve the feedback with sources and the user had access to them."})}),e.jsx("div",{className:"flex flex-col gap-1",children:a.map(n=>e.jsx(Te,{compact:!0,citationMetadata:n},n.url))})]})]})}function _n({retrievalMessages:s,userDisplayName:t,isDebugView:a=!1}){return e.jsxs("div",{className:"mb-8",children:[e.jsx(q,{className:"mb-4",children:e.jsx(l,{id:"pOb00r",defaultMessage:"Conversation"})}),s.map(n=>e.jsx(jn,{message:n,userDisplayName:t,isDebugView:a},n.id))]})}function jn({message:s,userDisplayName:t,isDebugView:a=!1}){const n=C();switch(s.type){case"visible_text":{if(s.author==="unknown")return null;const o={id:s.id,author:{role:s.author},clientMetadata:{canRetry:!1},metadata:{citations:s.citations??[],attachments:s.attachments??[],content_references:s.content_refs?s.content_refs:(s.citations??[]).map(i=>i.metadata?.type!=="file"?null:{start_idx:i.start_ix,end_idx:i.end_ix,refs:[],matched_text:s.text.slice(i.start_ix,i.end_ix),type:"file",source:i.metadata.source,name:i.metadata.name,id:i.metadata.id,cloud_doc_url:i.metadata.cloud_doc_url??i.metadata.extra?.cloud_doc_url}).filter(i=>!!i)},content:{content_type:Ds.Text,parts:[s.text]}};return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:W("text-token-text-secondary mb-1 text-xs",s.author==="user"?"pe-4 text-end":"text-start"),children:s.author==="assistant"?n.formatMessage(M.authorChatGPT):s.author==="user"?t??n.formatMessage(M.authorUser):s.author}),e.jsx(lt,{id:s.id,messages:[o],attachments:o.metadata?.attachments,citations:o.metadata?.citations,contentReferences:o.metadata?.content_references,parts:[s.text],displayParts:rt({isUserTurn:s.author==="user",parts:[s.text]}),isActivelyStreaming:!1,isCompletionInProgress:!1,isFinalUserTurn:!1,hasActiveRequest:!1,clientThreadId:"--fake-thread-id--",isUserTurn:s.author==="user",turnIndex:0,isFeedbackEnabled:!1})]})}case"query":return e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(_t,{className:"me-2"}),a?e.jsx(l,{id:"AVzRit",defaultMessage:"ChatGPT performed a search: {query}",values:{query:s.query}}):e.jsx(l,{id:"bJ9BXd",defaultMessage:"ChatGPT performed a search."})]});case"result":return a?e.jsx(vn,{message:s}):null;case"fetch":return a?e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(it,{className:"me-2"}),e.jsx(l,{id:"uH5X47",defaultMessage:"Read file: {fileName}",values:{fileName:s.content.content_type==="tether_quote"?s.content.title:"unknown"}})]}):null;case"generic_file_search_tool":return a?e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(jt,{className:"me-2"}),e.jsx(l,{id:"pJmg4S",defaultMessage:"Tool message with command: {command}.",values:{command:s.command}})]}):null;case"system":case void 0:return null}}function vn({message:s}){const[t,a]=u.useState(!1);return s.type!=="result"?null:e.jsxs("div",{className:"text-token-text-primary mt-2 mb-4 text-xs",children:[e.jsxs("div",{onClick:()=>a(n=>!n),className:"flex flex-row",children:[e.jsx(ht,{checked:t,className:"flex-0"}),e.jsx("div",{className:"flex-1",children:e.jsx(l,{id:"94EEkt",defaultMessage:"Found {numResults} results.",values:{numResults:s.result.chunks.length}})})]}),t&&e.jsxs("div",{className:"mt-2",children:[s.result.chunks.map(n=>e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-token-text-primary mb-1 text-sm font-bold",children:e.jsx(l,{id:"zyGUoc",defaultMessage:"Result {number}: {title}",values:{number:n.result_num,title:n.title}})}),e.jsx("h4",{className:"text-token-text-secondary mb-1 text-xs",children:n.document_id}),e.jsx("pre",{className:"max-h-[200px] max-w-full overflow-auto p-2 text-wrap",children:n.contents})]},n.result_num)),e.jsxs("div",{className:"p-2 text-center",onClick:()=>a(!1),children:[e.jsx("p",{className:"text-token-text-secondary mb-1 font-bold",children:e.jsx(l,{id:"8UUzYt",defaultMessage:"Collapse Results"})}),e.jsx("hr",{className:""})]})]})]})}function hs({reviewStatus:s,onClick:t,disabled:a}){let n;const o=C();switch(s){case"unreviewed":n=o.formatMessage(M.reviewStatusUnreviewed);break;case"approved_with_sources":n=o.formatMessage(M.reviewStatusApprovedWithSouces);break;case"approved_without_sources_data_available":case"approved_without_sources_data_expired":n=o.formatMessage(M.reviewStatusApprovedWithoutSources);break;case"deleted":n=o.formatMessage(M.reviewStatusDeleted);break}return e.jsx("button",{className:W("text-token-text-primary rounded-2xl px-3 py-1 text-sm",s==="unreviewed"&&"bg-[#e2c541] dark:bg-[#EA8444]"),onClick:t,disabled:!!a||!t,children:n})}const M=Q({modalTitle:{id:"zufVun",defaultMessage:"Review Feedback"},feedbackApproved:{id:"DS+YGt",defaultMessage:"Feedback approved."},feedbackDeleted:{id:"Rz/tmW",defaultMessage:"Feedback deleted."},errorApprovingFeedback:{id:"UVsTlf",defaultMessage:"Encountered an error approving this feedback. Please refresh and try again."},errorDeletingFeedback:{id:"cI6gt9",defaultMessage:"Encountered an error deleting this feedback. Please refresh and try again."},actionMessageFeedbackCreating:{id:"urBely",defaultMessage:"You can't take actions on this feedback yet because it's still being processed. Once it's done processing, it will be available for review."},actionMessageNoActionsAvailable:{id:"JGNhjT",defaultMessage:"This feedback has been reviewed."},actionMessageApprovedWithoutSources:{id:"68PAfK",defaultMessage:"This feedback has already been approved without sources, but you can re-approve it with sources."},actionMessageFeedbackDeleted:{id:"Kel9lE",defaultMessage:"This feedback has been deleted."},labelIncludeSources:{id:"8UlZM0",defaultMessage:"Include Sources"},authorChatGPT:{id:"7Fo5p2",defaultMessage:"ChatGPT"},authorUser:{id:"TpT0hg",defaultMessage:"User"},userDisplayName:{id:"3OKTcX",defaultMessage:"{displayName} ({email})"},reviewStatusUnreviewed:{id:"FEHKZj",defaultMessage:"Needs Review"},reviewStatusCreating:{id:"7lVVU7",defaultMessage:"Preparing for Review"},reviewStatusApprovedWithSouces:{id:"kpZ41g",defaultMessage:"Approved With Sources"},reviewStatusApprovedWithoutSources:{id:"Y0lc+p",defaultMessage:"Approved Without Sources"},reviewStatusDeleted:{id:"gKoYhr",defaultMessage:"Deleted"}});function yn({currentWorkspaceId:s}){const{data:t,refetch:a,isLoading:n}=U({queryKey:["adminListCaMessageFeedback",s],queryFn:()=>se.safeGet("/ca/admin/feedback",{parameters:{query:{account_id:s}}})}),[o,i]=u.useState();return e.jsxs(je,{className:"mb-8",children:[e.jsx(Ve,{children:e.jsx(l,{id:"r4Y3mj",defaultMessage:"Review Feedback"})}),e.jsx(Ze,{className:"text-token-text-secondary",children:e.jsx(l,{id:"mqh7NS",defaultMessage:"Review feedback your workspace users have submitted. Feedback is not shared with OpenAI until you approve it."})}),t&&!n?e.jsx(bn,{feedbackList:t.feedback,setSelectedFeedback:i}):e.jsx(ss,{lines:12,widthVariance:0}),o&&e.jsx(xn,{feedbackMetadata:o,currentWorkspaceId:s,onClose:()=>i(void 0),onFeedbackActionTaken:()=>a()})]})}function Ge(s){switch(s){case"unreviewed":return 1;case"approved_with_sources":return 2;case"approved_without_sources_data_available":return 3;case"approved_without_sources_data_expired":return 4;case"deleted":return 5}}function bn({feedbackList:s,setSelectedFeedback:t}){const a=u.useMemo(()=>[...s].sort((n,o)=>{const i=Ge(n.review_status)-Ge(o.review_status);return i!==0?i:n.submitted_at>o.submitted_at?-1:n.submitted_at<o.submitted_at?1:0}),[s]);return e.jsxs(O.Root,{size:"normal",children:[e.jsxs(O.Header,{children:[e.jsx(O.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(l,{id:"KcGNl2",defaultMessage:"Review Status"})}),e.jsx(O.HeaderCell,{className:"bg-token-main-surface-primary w-40",children:e.jsx(l,{id:"joba0B",defaultMessage:"Submitted By"})}),e.jsx(O.HeaderCell,{className:"bg-token-main-surface-primary w-40",children:e.jsx(l,{id:"yl1cCR",defaultMessage:"Submitted At"})})]}),e.jsx(O.Body,{children:a.length===0?e.jsx(O.Row,{children:e.jsx(O.Cell,{children:e.jsx(l,{id:"AYwCJD",defaultMessage:"No feedback yet."})})}):a.map(n=>{const o=n.review_status==="deleted",i=o?void 0:()=>t(n);return e.jsxs(O.Row,{className:W("my-2",o?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary hover:cursor-pointer"),onClick:i,children:[e.jsx(O.Cell,{className:"truncate",children:e.jsx(hs,{reviewStatus:n.review_status,onClick:i,disabled:o})}),e.jsx(O.Cell,{className:"truncate",children:e.jsx("span",{children:n.submitter_display_name&&n.submitter_email?e.jsx(l,{id:"3OKTcX",defaultMessage:"{displayName} ({email})",values:{displayName:n.submitter_display_name,email:n.submitter_email}}):e.jsx("code",{children:n.submitter_id.split("__")[0]})})}),e.jsx(O.Cell,{className:"truncate",children:e.jsx("span",{children:new Date(n.submitted_at).toLocaleString()})})]},n.feedback_id)})})]})}function Cn(){const s=C();Ts(!0);const t=R(),a=dt(),n=Os();return e.jsxs(e.Fragment,{children:[e.jsx(Is,{title:s.formatMessage({id:"q9azuh",defaultMessage:"Connectors"})}),n?e.jsx(qe,{skipLegacyWorkspaceCheck:!0,children:e.jsxs(Ye,{className:"mt-6 gap-6",children:[e.jsx(un,{}),t!=null&&a===ut.ALPHA&&e.jsx(yn,{currentWorkspaceId:t.id})]})}):e.jsx(kn,{})]})}function kn(){return e.jsxs(qe,{skipLegacyWorkspaceCheck:!0,children:[e.jsx(Ye,{className:"mt-6 gap-6",children:e.jsx(je,{children:e.jsx(gs,{badge:e.jsx("div",{children:e.jsx("span",{className:"text-token-text-secondary rounded-xl border px-2 py-1 text-[8px] font-bold uppercase",children:e.jsx(l,{id:"IrfQIu",defaultMessage:"Coming soon"})})})})})}),e.jsxs("div",{className:"bg-token-main-surface-tertiary text-token-text-secondary flex flex-row gap-2 rounded-xl p-4",children:[e.jsx(Xe,{className:"icon-md"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs font-bold",children:e.jsx(l,{id:"ES5xU+",defaultMessage:"When will this feature be available?"})}),e.jsxs("p",{className:"text-xs",children:[e.jsx(l,{id:"9w5rs5",defaultMessage:"Internal knowledge will be rolled out incrementally to ChatGPT Team workspaces over the next few weeks. We will notify you in ChatGPT when your workspace is eligible."})," ",e.jsx(J,{href:ne,className:"underline",onClick:()=>$({link:ne,location:"admin_settings_coming_soon_widget"}),children:e.jsx(l,{id:"WGpoE2",defaultMessage:"Learn more"})})]})]})]})]})}const Xn=Es(function(){return e.jsx(Cn,{})});export{Xn as default};
//# sourceMappingURL=kn6i08ioi6vrfvgn.js.map
