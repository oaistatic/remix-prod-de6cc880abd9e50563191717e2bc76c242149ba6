import{bD as q,a as w,b5 as T,aj as R,aH as I,aL as K,R as O,D as V,m as W,j as Y,J as Q,n as H}from"./haannt40upmuwmtk.js";import{W as C,d8 as J,x as X,d9 as $,da as B,db as v,bm as Z,dc as ee,dd as te,de as re,df as se}from"./n4exq6o15ap1g74l.js";import{u as ae,b as oe}from"./jjqeoesb3rhorlyg.js";import{r as h,j as d,a8 as D,u as ne}from"./khl8ktun31iepecq.js";function he({suggestions:e,composerController:t,onSelect:p,onChange:r}){const{isUXUpdatesEnabled:l}=q(),i=ae(),m=h.useCallback((a,s,o,b)=>{p?.(s,o,b),i(a,s,o,b)},[p,i]),[c,f]=h.useState(()=>e.length>0),[u,x]=h.useState(-1),[k,E]=h.useState(!1);return h.useEffect(()=>{const a=s=>{if(!s.isComposing)if(s.key==="ArrowDown"){const o=u===e.length-1?0:u+1;x(o),r?.(o,!0,e[o])}else if(s.key==="ArrowUp"){s.preventDefault();const o=u<=0?e.length-1:u-1;x(o),r?.(o,!0,e[o])}else s.key==="Enter"&&!s.shiftKey&&e[u]&&m(s,e[u],e,u)};return t.subscribe("keydown",a)},[e,u,r,m,t]),h.useEffect(()=>t.subscribe("blur",()=>{x(-1),f(!1),r?.(-1,!1)}),[t,r]),h.useEffect(()=>t.subscribe("focus",()=>f(!0)),[t]),h.useEffect(()=>{if(!k){const a=()=>{E(!0),window.removeEventListener("mousemove",a)};return window.addEventListener("mousemove",a),()=>{window.removeEventListener("mousemove",a)}}},[k]),h.useEffect(()=>{x(-1),r?.(-1,!1),E(!1)},[e,r]),d.jsx(D.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:w("w-full flex-col p-2.5 max-lg:flex-col-reverse",c?"flex":"hidden"),children:e.map((a,s)=>d.jsxs(D.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:s*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[s>0&&d.jsx("div",{className:w("h-[1px] opacity-60 max-lg:hidden",u===s||u===s-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")}),d.jsxs("button",{className:w("flex w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-3 text-start whitespace-pre-wrap",u===s?"bg-token-main-surface-secondary":l?"bg-transparent":"bg-token-main-surface-primary"),onClick:o=>{o.preventDefault(),m(o,a,e,s)},onMouseDown:o=>{o.preventDefault()},onMouseEnter:()=>{k&&(x(s),r?.(s,!1,a))},onMouseLeave:()=>{x(-1),r?.(-1,!1,a)},children:[a.icon?d.jsx("span",{className:"text-token-text-secondary me-2 h-[18px] w-[18px]",children:a.icon}):null,d.jsx("span",{className:"text-sm whitespace-pre-wrap",children:a.autocompletionChunks&&a.autocompletionChunks.length>0?d.jsx(d.Fragment,{children:a.autocompletionChunks.map((o,b)=>d.jsx("span",{className:w(o.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:o.text},b))}):d.jsxs(d.Fragment,{children:[d.jsx("span",{className:w(a.type===C.Starter||a.type===C.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:a.title}),d.jsx("span",{className:"text-token-text-primary",children:a.body})]})})]}),s>0&&d.jsx("div",{className:w("h-[1px] opacity-60 lg:hidden",u===s||u===s-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")})]},a.id??s))})}function ie(e,t){e=e.toLocaleLowerCase();const p=t;t=t.toLocaleLowerCase();const r=[];let l=0;for(let c=0;c<t.length&&(l<e.length&&e[l]===t[c]&&(r.push(c),l++),l!==e.length);c++);const i=[];let m=0;if(r.forEach(c=>{if(c>m){const f=p.slice(m,c);f&&i.push({text:f,isMatched:!1})}i.push({text:p[c],isMatched:!0}),m=c+1}),m<t.length){const c=p.slice(m);c&&i.push({text:c,isMatched:!1})}return ce(i)}function ce(e){if(e.length===0)return e;let t=[e[0]];for(let r=1;r<e.length;r++){const l=t[t.length-1],i=e[r];l.isMatched===i.isMatched?l.text+=i.text:t.push(i)}const p=t.filter(r=>r.isMatched).reduce((r,l)=>r+l.text.trim().length,0);return t.length<=4&&p>=2?t:[{text:t.map(r=>r.text).join(""),isMatched:!1}]}function U(e){return(J(e)?e.promptStarters:e.gizmo.display.prompt_starters)?.map(t=>({type:C.Starter,title:"",body:t,prompt:t}))}const le=()=>{const e=W(),t=Y(e),p=Z(),r=ee(te),l=Q(e),i=l?t.getLayer("4031588851"):t.getLayer("3533083032"),m=l?t.getLayer("4031588851",{disableExposureLog:!0}):t.getLayer("3533083032",{disableExposureLog:!0});return l?p==null?!1:Date.now()/1e3-p.created<m.get("new-user-age-seconds",14*24*60*60)&&i.get("web-enable-for-new-users",!1):r<m.get("new-user-message-count",20)&&i.get("web-enable-for-new-users",!1)},xe=({clientThreadId:e,limit:t,shouldBeEnabledForDefaultAssistant:p,isModelLoaded:r,modelSlug:l})=>{const i=oe(),m=T(),c=R(e,n=>n?.mode),f=X(c?.kind===I.GizmoInteraction?c.gizmo_id:void 0).data,{gizmoEditorData:u,mode:x}=$(),k=le(),E=B(c),a=K(),s=k&&p&&!E&&!a?.isEnterprisey(),{data:o,isSuccess:b}=ne({queryKey:["promptStarters",e,t,l],queryFn:async()=>{const n=await O.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:l}},anonAware:!0});return V.addFirstTiming("load.promptStarters"),n},enabled:s});if(m==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(x==="test"&&u)return{promptStarters:U(u)??[],isLoading:!1,isSuccess:!0};if(f!=null)return{promptStarters:U(f),isLoading:!1,isSuccess:!0};if(!s)return{promptStarters:[],isLoading:!1,isSuccess:!0};const N=o?.items.map(n=>({type:C.Starter,id:n.id,title:n.title,body:n.description,prompt:n.prompt,category:n.category,oneliner:n.oneliner,theme:n.theme,requires_file_upload:n.requires_file_upload}))??[],z=(n,y,ue,G)=>{const g=y.title;i.setAutocompletions([]),i.focus(),i.setText(g),requestAnimationFrame(()=>{const A=N.filter(S=>S.theme===y.theme).map(S=>{const j=H(S.oneliner),_=j.startsWith(S.title);return{...S,title:_?`${S.title} `:"",body:_?S.body:j,autocompletionChunks:ie(g,j),type:C.Autocomplete}});i.setAutocompletions(A),A.length>0&&re(A,e),se(y,G,e)})},M=N?.reduce((n,y)=>(y.theme&&!n[y.theme]&&(n[y.theme]=y),n),{}),L=[];if(M)for(const n in M)n!=="For you"&&L.push(M[n]);const F=L.length>0,P=!!(p&&b&&F&&r);return p&&(v.markStart("StarterPromptChips",v.NS_COMPOSER),P&&v.markRendered("StarterPromptChips",v.NS_COMPOSER)),{onSelectStarterPrompt:z,shouldShowStarterPrompts:P,promptStarters:L}};export{he as A,U as g,xe as u};
//# sourceMappingURL=b3mht1lg7zv7qd3d.js.map
