const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lv4lezp34hgbotc4.js","assets/haannt40upmuwmtk.js","assets/khl8ktun31iepecq.js","assets/root-eulobrch.css","assets/n4exq6o15ap1g74l.js","assets/conversation-small-bh1estgu.css","assets/jjqeoesb3rhorlyg.js","assets/dfz2bdgqh4yduujb.js","assets/opqccoi9jnqsmzvy.js","assets/b3mht1lg7zv7qd3d.js","assets/m4g7yy9fehqi204r.js","assets/d7qdtm0x38jq0qqt.js","assets/dblaaxd78ezocyc0.js","assets/iwbl4itf6ohkmahq.js","assets/i7mohl0pdm5438yu.js","assets/ce74if69ckoer67u.js","assets/hvdwpbr2ljyv44tg.js"])))=>i.map(i=>d[i]);
import{a as G,T as Z,aG as ue,bb as je,cr as q,bX as ke,bL as Ce,l as Re,D as oe,M as $,cK as Ee,z as Ne,co as Ae,cp as Ge,I as Te,h6 as Se,cW as De}from"./haannt40upmuwmtk.js";import{j as t,a8 as Q,e as V,r as n,d as Oe,b as Pe}from"./khl8ktun31iepecq.js";import{I as ae,D as Le,a as ge,u as Ue}from"./clnsff4iry6w4nrt.js";import{an as me,eD as Fe,g8 as He,cs as Be,aq as ie,ar as D,g9 as $e,oQ as ze,aE as fe,aC as Ve,ay as pe,aA as he,oR as We,oS as Ke,ap as Ye,gr as Qe,gM as xe,gP as Xe}from"./n4exq6o15ap1g74l.js";import{C as qe}from"./e4mtqust07fsbtad.js";import{I as Je}from"./ce74if69ckoer67u.js";import"./jbl38r5yycb2mrt9.js";import"./hvdwpbr2ljyv44tg.js";function Ze({title:e,description:a,shimmer:s}){return!e&&!a?null:t.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&t.jsx("p",{className:G("text-lg font-medium",s&&"loading-shimmer-pure-text-inverted",!!a&&"mb-1"),children:e}),!!a&&t.jsx("p",{children:a})]})}const be=({children:e,isDimensionsUnknown:a})=>t.jsxs(Q.div,{className:G(["relative max-w-[480px] rounded-2xl",a&&"aspect-square overflow-hidden"]),children:[t.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),t.jsx("div",{className:"relative h-full",children:e})]});var h=(e=>(e.Unavailable="unavailable",e.Thinking="thinking",e.Generating="generating",e.AsyncGenerating="async_generating",e.AsyncHanging="async_hanging",e.Complete="complete",e.Errored="errored",e.Empty="empty",e))(h||{});const et="sj1i4kz",z=`${Z.T2UAY3K}.${et}`,tt=({cotMessages:e,visualPercentComplete:a,isInterrupted:s,state:i})=>{const c=V().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),o=i===h.Complete||a===1,u=n.useMemo(()=>{if(s)return c;if(!e)return;if(o)return e.complete;if(a){const g=Object.keys(e.generating);for(let f=0;f<g.length;f+=1){const r=parseFloat(g[f]);if(a<r)return e.generating[g[f]]}}else return e.thinking;return e.complete},[e,c,s,o,a]);return u&&t.jsx(qe,{activeHeadline:u,finishedText:u,isComplete:o||s,isExpandDisabled:!0})},at="ChatGPT Image",nt=300,re=1e3;function ne({rightAlign:e=!1,bottomAlign:a=!1,fullWidth:s=!1,justifyBetween:i=!1,alwaysVisible:l=!1,children:c}){return t.jsxs("div",{className:G("absolute z-2 transition-opacity duration-300",l?"opacity-100":"opacity-0 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100 focus-within:opacity-100",e?"end-0":"start-0",a?"bottom-0":"top-0",s&&"w-full"),children:[t.jsx("div",{className:G(a?"bg-linear-to-b":"bg-linear-to-t","from-transparent to-black/30","h-20 w-full")}),t.jsx("div",{className:G("absolute inset-0 flex",a?"items-end pt-3 pb-1":"items-start pt-1 pb-3",e?"justify-end pe-1":"justify-start ps-1",i&&"justify-between"),children:c})]})}function Y({icon:e,selected:a,onClick:s,ariaLabel:i}){return t.jsx("button",{className:G("hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 z-11 flex h-10 w-10 items-center justify-center rounded-xl"),onClick:s,disabled:a,"aria-label":i,children:t.jsx(e,{style:{filter:"drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.20))"},className:G("icon-lg",a?"fill-current text-white":"fill-transparent text-white")})})}function J(e){return a=>{a.stopPropagation(),e()}}const st=({image:e,imageUrl:a,onEditorClick:s,isEditorAvailable:i,messageId:l,serverThreadId:c,shouldShowOverflow:o=!1})=>{const{value:u}=ue("706943082"),{config:g}=je("2248456840"),f=g.get("enabled",!1),r=V(),[b,m]=n.useState(!1),[d,M]=n.useState(null),[v,I]=n.useState(!0),[p,R]=n.useState(!1),E=me(),T=d==null,_=y=>{T&&(D.imageRated({liked:y,analyticsContext:E}),M(y),I(!1),setTimeout(()=>{R(!0)},re))},x=n.useCallback(()=>{const y=new Date,A=r.formatDate(y,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${at} ${A}.png`},[r]),j=Fe(),O=He(),N=O?.type===Be.Image&&O.image.asset_pointer===e?.asset_pointer,[k,P]=n.useState(!1),H=n.useCallback(()=>{e?.asset_pointer&&(ie({url:e?.asset_pointer,fileName:x()}),D.download({analyticsContext:E}))},[e,x,E]),L=n.useCallback(y=>{y.stopPropagation()},[]);return t.jsxs(t.Fragment,{children:[j?!N&&t.jsx(ne,{rightAlign:!0,fullWidth:!0,children:t.jsx(Y,{icon:$e,ariaLabel:r.formatMessage(B.expand)})}):t.jsxs(t.Fragment,{children:[t.jsx(ne,{rightAlign:!0,fullWidth:!0,alwaysVisible:k,children:t.jsxs("div",{className:"flex flex-row",onClick:L,children:[i&&!u&&t.jsx(q,{sideOffset:4,label:r.formatMessage({id:"UH0Ly0",defaultMessage:"Edit image"}),side:"top",children:t.jsx(Y,{icon:ze,ariaLabel:r.formatMessage(B.inpaint),onClick:J(()=>{s?.(),D.inpaintStarted({analyticsContext:E})})})}),a&&t.jsx(q,{sideOffset:4,label:r.formatMessage({id:"0EYire",defaultMessage:"Download"}),side:"top",children:t.jsx(Y,{icon:fe,ariaLabel:r.formatMessage(B.download),onClick:J(()=>{ie({url:a,fileName:x()}),D.download({analyticsContext:E})})})}),f&&o&&t.jsx(Ve,{onOpenChange:P,onDownload:H,triggerClassName:"z-11 flex h-10 w-10 items-center justify-center rounded-xl bg-transparent hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 focus-visible:bg-token-icon-surface/10",iconClassName:"icon-lg fill-transparent text-white",dropdownClassName:"z-11 min-w-fit origin-top-right text-token-text-primary"})]})}),t.jsx(ne,{bottomAlign:!0,rightAlign:!0,fullWidth:!0,justifyBetween:T,children:t.jsxs("div",{className:G("flex w-full items-center justify-between transition-opacity ease-in-out",v?"opacity-100":"opacity-0"),style:{transitionDuration:`${re}ms`},children:[t.jsx("div",{className:"flex items-center ps-4 font-semibold text-white",style:{textShadow:"0px 2px 4px rgba(0, 0, 0, 0.20)"},children:r.formatMessage(d===!0?B.feedbackMessage:B.rateThisImage)}),!p&&t.jsxs("div",{className:G("flex flex-row transition-opacity ease-in-out",d===!0?"opacity-0":"opacity-100"),style:{transitionDuration:`${nt}ms`},children:[t.jsx(q,{sideOffset:4,label:r.formatMessage({id:"U99PVw",defaultMessage:"Like"}),side:"top",children:t.jsx(Y,{icon:pe,onClick:J(()=>_(!0)),ariaLabel:r.formatMessage(B.thumbsUp)})}),t.jsx(q,{sideOffset:4,label:r.formatMessage({id:"ncGqTt",defaultMessage:"Dislike"}),side:"top",children:t.jsx(Y,{icon:he,onClick:J(()=>{_(!1),m(!0)}),ariaLabel:r.formatMessage(B.thumbsDown)})})]})]})})]}),b&&t.jsx(Je,{messageId:l??"",serverThreadId:c??"",rating:d,onClose:()=>m(!1)})]})},B=Oe({rateThisImage:{id:"imageGenActionOverlay.rateThisImage",defaultMessage:"Rate this image"},thumbsUp:{id:"imageGenActionOverlay.thumbsUp",defaultMessage:"Like this image"},thumbsDown:{id:"imageGenActionOverlay.thumbsDown",defaultMessage:"Dislike this image"},inpaint:{id:"imageGenActionOverlay.inpaint",defaultMessage:"Enter inpainting mode"},download:{id:"imageGenActionOverlay.download",defaultMessage:"Download this image"},expand:{id:"imageGenActionOverlay.expand",defaultMessage:"Expand this image"},feedbackMessage:{id:"imageGenActionOverlay.feedbackMessage",defaultMessage:"Thanks for your feedback"}}),le=ke.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,it=({imageUrl:e})=>{const[a,s]=n.useState(void 0),i=V(),l=me(),c=n.useCallback(()=>{const o=new Date;return`${i.formatDate(o,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[i]);return t.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[t.jsxs(le,{$alwaysVisible:!0,children:[a!==!1&&t.jsx(ae,{icon:pe,selected:a===!0,variant:"large",onClick:o=>{o.stopPropagation(),D.paragenImageRated({liked:!0,analyticsContext:l}),s(!0)}}),a!==!0&&t.jsx(ae,{icon:he,selected:a===!1,variant:"large",onClick:o=>{o.stopPropagation(),D.paragenImageRated({liked:!1,analyticsContext:l}),s(!1)}})]}),t.jsx(le,{$alwaysVisible:!0,$rightAlign:!0,children:t.jsx(ae,{icon:fe,variant:"large",onClick:o=>{o.stopPropagation(),D.paragenDownload({analyticsContext:l}),ie({url:e,fileName:c()})}})})]})};function ot({size:e=60,strokeWidth:a=2,arcPercentage:s=.25,ariaMessage:i,children:l}){const c=(e-a)/2,o=2*Math.PI*c,u=o*s,g=`${u} ${o-u}`;return t.jsxs("div",{className:"relative flex items-center justify-center",role:"progressbar","aria-live":"assertive","aria-valuetext":i,children:[t.jsxs(Q.svg,{width:e,height:e,viewBox:`0 0 ${e} ${e}`,animate:{rotate:360},transition:{repeat:1/0,duration:1.2,ease:"linear"},children:[t.jsx("circle",{className:"text-[var(--sidebar-surface-secondary)]",stroke:"currentColor",fill:"transparent",strokeWidth:a,cx:e/2,cy:e/2,r:c}),t.jsx("circle",{className:"text-[var(--main-surface-primary-inverse)]",stroke:"currentColor",fill:"transparent",strokeWidth:a,strokeDasharray:g,strokeDashoffset:"0",strokeLinecap:"butt",cx:e/2,cy:e/2,r:c})]}),l&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l})]})}function Me({withLottie:e}){const s=V().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return t.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":s,children:t.jsx(ot,{size:40,arcPercentage:.2,children:t.jsx(Le,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const ye=300,rt=1.3,ce=.05,lt=/blur\(([\d.]+)px\)/,ct={duration:ye/1e3,ease:"linear"};function se(e,a,s){e.sort((o,u)=>o.lastSrcReceivedTime-u.lastSrcReceivedTime);const i=new Array(e.length).fill(0);for(let o=0;o<=e.length;o+=1){const u=o-1,g=o,f=e[u]?.availablePercentComplete??0,r=e[g]?.availablePercentComplete??1;if(a>=f&&a<=r&&f!==r){const b=(a-f)/(r-f);i[u]=1-b,i[g]=b}}const l=i[i.length-1],c=i[i.length-2];return l===1&&c===0&&(i[i.length-2]=.01),s&&a<=e[0]?.availablePercentComplete&&(i[0]=1),i}const dt=({alt:e,src:a,availablePercentComplete:s,onAnimationUpdate:i,isInterrupted:l,ignoreFirstChunk:c=!1,isTransparent:o=!1,dimensions:u,onError:g,unconstrainedWidth:f=!1})=>{const r=Ce(),b=n.useMemo(()=>`url(${r?We:Ke})`,[r]),[m,d]=n.useState(!1),[M,v]=n.useState(1e3),[I,p]=n.useState(s??0),[R,E]=n.useState(0),T=n.useRef(performance.now()),_=n.useRef(0),x=n.useRef([]),[j,O]=n.useState([0]),[N,k]=n.useState(!1),P=n.useRef(!1),H=n.useRef(null),L=I===1,y=s===1&&N,A=u?u.width/u.height:1;n.useEffect(()=>{!m&&s&&(d(!0),_.current=performance.now())},[m,s]),n.useEffect(()=>{const C=x.current[x.current.length-1]?.src;if(a&&a!==C){const S=x.current.findIndex(K=>K.availablePercentComplete===s);S!==-1?x.current[S]={src:a,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}:x.current.push({src:a,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}),O(se(x.current,I,c))}},[a,I,c,s]);const U=n.useCallback(()=>{H.current&&s&&(v(y?ye:(performance.now()-T.current)*rt),(!c||P.current||s>=ce)&&s!==1&&E(s),P.current=!0,T.current=performance.now())},[s,y,c]),F=n.useCallback(C=>{const S=parseFloat(C.height)/100;i?.(S),p(S),O(se(x.current,parseFloat(C.height)/100,c))},[i,c]),W=n.useCallback(C=>{const S=C.filter.toString().match(lt)?.[1]??"0",X=(16-parseFloat(S))/16,_e=1-R,te=R+_e*X;i?.(te),p(te),O(se(x.current,te,c))},[c,R,i]);if(!m)return l?null:t.jsx(be,{isDimensionsUnknown:!0,children:t.jsx(Me,{withLottie:!0})});const ee={duration:M/1e3,ease:"linear"},we=s!==1||!o;return t.jsxs("div",{className:G("relative z-0 cursor-pointer overflow-hidden",A<1?"max-w-[400px]":"max-w-[480px]",!L&&"pointer-events-none",!P.current&&"bg-token-main-surface-secondary",f&&"max-w-full"),"aria-label":e,style:{aspectRatio:A},children:[s&&s<ce&&t.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:t.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:t.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),t.jsxs(Q.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:y?!1:{height:"0%"},animate:L?{height:"100%"}:{height:`${R*100}%`},onUpdate:y?void 0:F,transition:y?{duration:0,ease:"linear"}:ee,style:L?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[a&&t.jsx("img",{ref:H,src:a,onLoad:U,onError:g,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:A}}),o&&t.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:t.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:b,backgroundSize:"auto"}})})]}),t.jsx(Q.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:y?{filter:"blur(0px)"}:void 0,transition:y?ct:void 0,onUpdate:y?W:void 0,style:{aspectRatio:A},children:x.current.map((C,S)=>{const K=j[S],X=C.availablePercentComplete===1;return K!==0||X?t.jsx("img",{src:C.src,alt:e,style:{opacity:K,willChange:"opacity",aspectRatio:A},className:"absolute top-0 w-full",onLoad:X?()=>k(!0):void 0},C.src):null})}),t.jsx(Q.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:A},children:we&&x.current.filter((C,S)=>j[S]!==0).map(C=>t.jsx("img",{src:C.src,alt:e,className:"absolute top-0 w-full"},C.src))})]})},de=2,ve=({pointer:e,altLabel:a,isInterrupted:s,isEditorAvailable:i,onPercentageRendered:l,messageId:c,serverThreadId:o,isMultiGen:u,onEditorClick:g})=>{const f=Pe(),[r,b]=n.useState(void 0),m=n.useRef(void 0),d=e.metadata?.generation?.gen_id,M=e.metadata?.generation?.height??void 0,v=e.height,I=(M??0)/v,p=n.useRef({}),{isUnauthenticated:R}=Re(),[E,T]=n.useState(!1),_=n.useContext(ge),x=e.width/e.height,j=Ye({imageAssetPointer:e,serverThreadId:o}),N=n.useCallback((w=!1)=>{!w&&m.current===e.asset_pointer||(m.current=e.asset_pointer,Qe.fetch(f,{asset:e,conversationId:o,force:w,isUnauthenticated:R}).then(ee=>{b(ee)}).finally(()=>{m.current=void 0}))},[e,f,o,R,null]);n.useEffect(()=>{const w=e.asset_pointer!==r?.asset_pointer;(!r||w)&&N()},[r,e.asset_pointer,N]);const k=n.useMemo(()=>xe({pointer:r,conversationId:o,messageId:c,source:_?"paragen":"chat"}),[r,o,c,_]),P=n.useRef(I);n.useEffect(()=>{I===1&&P.current<1&&D.renderingComplete({analyticsContext:k})},[I,k]);const H=n.useCallback(()=>{r&&g?.({image:r,messageId:c,analyticsContext:k})},[r,c,g,k]),L=n.useMemo(()=>({width:e.width,height:e.height}),[e]),y=n.useCallback(()=>{const w=(p.current[e.asset_pointer]??0)+1;if(p.current[e.asset_pointer]=w,p.current[e.asset_pointer]>de)return oe.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:o,asset_pointer:e.asset_pointer,max_retries:de});oe.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:o,asset_pointer:e.asset_pointer,current_retry:w}),p.current[e.asset_pointer]=w,N(!0)},[e.asset_pointer,N,o]),A=n.useCallback(w=>{w===1&&T(!0),l?.(w)},[l]),U=r?.url,F=u?"rounded-lg":"rounded-2xl",W=j??U;return t.jsx(Xe.Provider,{value:k,children:t.jsxs("div",{className:G("group/imagegen-image relative overflow-hidden",x<1?"max-w-[400px]":"max-w-[480px]",F,_&&"max-w-full"),style:{aspectRatio:x},onClick:i?H:void 0,tabIndex:0,children:[j&&t.jsx("img",{alt:a,className:"absolute inset-0 z-1 opacity-0",src:j}),t.jsx(dt,{alt:a,src:U,availablePercentComplete:I,onAnimationUpdate:A,isInterrupted:s,isEditorAvailable:i,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:L,onError:y,unconstrainedWidth:_},d),E&&(_?t.jsx(it,{imageUrl:U??""}):t.jsx(st,{image:U?{asset_pointer:U,alt:a,fileId:k.fileId}:void 0,imageUrl:W,onEditorClick:H,isEditorAvailable:i,messageId:c,serverThreadId:o,shouldShowOverflow:j!==void 0}))]},d)})},ut=({pointersToRender:e,altLabel:a,isInterrupted:s,isEditorAvailable:i,updatePercentageRendered:l,messageIds:c,serverThreadId:o,handleEditorClick:u})=>{const g=n.useRef({}),f=n.useCallback(r=>b=>{g.current[r]=b;const m=Object.keys(g.current).length,d=Object.values(g.current).reduce((M,v)=>M+v,0);l?.(d/m)},[l]);return e.map((r,b)=>{const m=r.metadata?.generation?.gen_id;return t.jsx(ve,{pointer:r,altLabel:a,isInterrupted:s,isEditorAvailable:i,onPercentageRendered:m?f(m):void 0,messageId:c[b],serverThreadId:o,isMultiGen:!0,onEditorClick:u},m)})};function gt(e){const a=e.find(o=>o.author.role==="tool"&&o.author.name===z&&o.content.content_type==="text"),[s,...i]=a?.content.content_type==="text"?a.content.parts:[],l=i.pop(),c=i.length;return s&&l&&i.length>0?{thinking:s,complete:l,generating:i.reduce((o,u,g)=>{const f=(g+1)/c;return o[f.toFixed(2)]=u,o},{})}:void 0}function Ie(e){const a=e.filter(l=>l.author.role==="tool"&&l.author.name===z&&l.content.content_type===$.MultimodalText),s=a.flatMap(l=>Ee.getImageAssetPointers(l)),i=a.map(l=>l.id);return{imageAssetPointers:s,messageIds:i}}const mt=(e,a)=>{const s=e.find(d=>d.author.role===Ne.Tool&&[$.Error,$.SystemError].includes(d.content.content_type)||d.metadata?.is_error),{imageAssetPointers:i}=Ie(e),l=e.some(d=>{const M=d.author.name===z,v=d.content.content_type===$.MultimodalText,I=!!d.metadata?.is_visually_hidden_from_conversation;return M&&v&&I}),c=e.some(d=>{if(d.metadata?.image_gen_async)return!1;const M=d.author.name===Z.IMAGE_GEN_HALLUCINATED||d.author.name===z,v=d.content.content_type===$.Text,I=!!d.metadata?.is_visually_hidden_from_conversation;return M&&v&&I}),o=e.length>0&&!!e[e.length-1]?.metadata?.image_gen_async,g=!e.some(d=>[z,Z.IMAGE_GEN_HALLUCINATED].includes(d.author.name??"")&&d.content.content_type===$.MultimodalText)&&e.some(d=>{const M=[z,Z.IMAGE_GEN_HALLUCINATED].includes(d.author.name??""),v=d.recipient==="assistant";return M&&v});let f=0;for(const d of i){const M=d.height,v=d.metadata?.generation?.height??void 0;f+=M!==void 0&&v!==void 0?v/M:0}const r=i.length>0?f/i.length:0,b=s!==void 0,m=a?h.AsyncGenerating:h.AsyncHanging;if(l||c||g)return h.Empty;if(b)return h.Errored;if(r){if(r<1)return o?m:h.Generating;if(r===1)return h.Complete}else return o?m:h.Thinking;return h.Unavailable},ft=e=>{const a=V(),{size:s="image",count:i=1}=e||{};return i>1?{thinking:a.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":a.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":a.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:a.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:s==="xlimage"?{thinking:a.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":a.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":a.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:a.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:a.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":a.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":a.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:a.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},pt=Ae(async()=>Ge(()=>import("./lv4lezp34hgbotc4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.ImageGenNewEditor)),ht=[h.Empty,h.Errored],jt=({messages:e,clientThreadId:a,isLastTurnInConversation:s,disableClickThru:i=!1})=>{const l=Te(a),c=V(),o=c.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[u,g]=n.useState(!1),[f,r]=n.useState(null),{messageIds:b,imageAssetPointers:m}=n.useMemo(()=>Ie(e),[e]),d=m?.[0]?.metadata?.generation?.gen_size,M=ft({size:d??"image",count:m?.length??1}),v=n.useMemo(()=>gt(e)??M,[e,M]),I=e.find(F=>F.metadata?.image_gen_async),p=n.useMemo(()=>mt(e,s),[e,s]),R=n.useRef(!1),E=n.useRef(!1),T=n.useRef(null),_=n.useMemo(()=>xe({pointer:m[0],conversationId:l,messageId:b[0],source:i?"paragen":"chat"}),[m,b,l,i]);n.useEffect(()=>{if(!R.current&&(p===h.Thinking||p===h.Generating))R.current=!0,T.current=performance.now();else if(R.current&&!E.current)if(p===h.Complete){const F=T.current?performance.now()-T.current:void 0;D.generationSuccess({analyticsContext:_,durationMs:F}),E.current=!0}else p===h.Errored&&(D.generationFailure({analyticsContext:_,errorReason:"assistant_error"}),E.current=!0)},[p,_]);const x=e[e.length-1],j=n.useMemo(()=>x&&Se(x),[x]),{value:O}=ue("3058498100"),N=n.useMemo(()=>O?m:m.slice(0,1),[O,m]),k=N.length>1,P=Ue({clientThreadId:a})&&p===h.Complete,[H,L]=n.useState(0),[y,A]=n.useState(null),U=n.useCallback(({image:F,messageId:W,analyticsContext:w})=>{r(F),A(W),g(!0),D.editorClick({sourceOperation:F.metadata?.dalle?.edit_op??"none",analyticsContext:w})},[]);return ht.includes(p)?null:t.jsxs(ge.Provider,{value:i,children:[t.jsxs("div",{className:"flex flex-col",children:[p!==h.Unavailable&&p!==h.AsyncGenerating&&p!==h.AsyncHanging&&t.jsx("div",{className:"pb-3",children:t.jsx(tt,{cotMessages:v,visualPercentComplete:H,isInterrupted:j,state:p})}),p===h.Thinking&&!j&&t.jsx(be,{isDimensionsUnknown:!0,children:t.jsx(Me,{withLottie:!0})}),p===h.AsyncGenerating&&!I?.metadata?.is_visually_hidden_from_conversation&&t.jsx(Ze,{shimmer:!0,title:I?.metadata?.ui_card_title,description:I?.metadata?.ui_card_description}),(p===h.Generating||p===h.Complete)&&t.jsx("div",{className:G("grid pb-2",{"grid-cols-2 gap-2":k,"grid-cols-1":!k}),children:k?t.jsx(ut,{pointersToRender:N,altLabel:o,isInterrupted:j,isEditorAvailable:P,updatePercentageRendered:L,messageIds:b,serverThreadId:l,handleEditorClick:U}):t.jsx(ve,{pointer:N[0],altLabel:o,isInterrupted:j,isEditorAvailable:P,onPercentageRendered:L,messageId:b[0],serverThreadId:l,onEditorClick:U})})]}),t.jsx(De,{testId:"modal-image-gen-content",type:"success",size:"fullscreen",isOpen:u,onClose:()=>g(!1),title:c.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-(--gray-800)",children:f&&t.jsx(pt,{image:f,isLoadingNewImage:!1,clientThreadId:a,onClose:()=>g(!1),messageId:y??""})})]})};export{jt as ImageGenMessage};
//# sourceMappingURL=lipljdtfaomxepb8.js.map
