const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nwcojmzvycgkk8y5.js","assets/khl8ktun31iepecq.js","assets/n4exq6o15ap1g74l.js","assets/haannt40upmuwmtk.js","assets/root-eulobrch.css","assets/conversation-small-bh1estgu.css","assets/o5lwpov0aqbkd311.js","assets/j5uw87upfwtjavqn.js","assets/oq6n0ezffar2zqj9.js","assets/i7mohl0pdm5438yu.js","assets/jjqeoesb3rhorlyg.js","assets/dfz2bdgqh4yduujb.js","assets/b3mht1lg7zv7qd3d.js","assets/m4g7yy9fehqi204r.js","assets/d7qdtm0x38jq0qqt.js","assets/dblaaxd78ezocyc0.js"])))=>i.map(i=>d[i]);
import{f as qt,r as g,e as K,j as e,M as F,d as Te,L as pl,an as Aa,a9 as be,a8 as $,k as Ma,u as fl,at as gl,C as hl}from"./khl8ktun31iepecq.js";import{b as ht,P as Ns,s as xl,f as bl,g as Ss,h as Sl,u as vl}from"./jjqeoesb3rhorlyg.js";import{aF as _e,a6 as ce,rZ as yl,r_ as Ra,mS as Bs,mu as D,W as vs,lX as Et,mz as Se,o as Cn,iL as Is,cY as wn,af as Nt,n9 as Pa,qA as kn,r$ as Ea,b9 as Xe,fM as Cl,cB as wl,I as Ds,e6 as Ta,h3 as kl,eu as _l,fL as jl,s0 as Al,f6 as ft,aX as ks,d$ as Yt,dY as Ls,dZ as Kt,d_ as Qt,s1 as Ml,s2 as Rl,s3 as dt,s4 as Pl,s5 as Bt,nY as Qe,my as Xt,eR as _n,s6 as El,s7 as Tl,s8 as Nl,s9 as Bl,sa as Il,sb as Dl,h4 as Jt,ce as Zt,G as jn,sc as Ll,sd as _s,oh as Fl,n1 as Ol,a7 as An,L as Hl,se as Na,oq as Ba,sf as Ul,sg as Gl,sh as zl,si as pe,a4 as Wl,sj as Fe,sk as Ia,sl as Da,cL as It,sm as La,nJ as Ze,sn as Vl,so as ue,sp as gt,sq as $l,sr as ql,ss as Yl,st as Kl,su as Ql,sv as Xl,sw as Jl,hJ as Fa,sx as Zl,sy as ec,sz as tc,cM as mt,sA as Oa,oo as Fs,sB as Cs,sC as sc,sD as xe,sE as nc,sF as oc,sG as ac,sH as ic,sI as pt,sJ as lt,sK as Ha,sL as rc,i3 as lc,lZ as cc,sM as uc,mD as dn,sN as oe,f5 as dc,cd as mc,sO as pc,sP as fc,sQ as gc,sR as hc,sS as xc,sT as bc,is as rn,sU as Yo,sV as Sc,sW as vc,sX as yc,lO as Cc,lR as wc,iv as kc,B as Ua,ek as _c,sY as jc,sZ as Ac,s_ as Mc,mx as je,s$ as Rc,nF as $t,jo as Pc,t0 as Ec,t1 as T,t2 as Ga,t3 as Tc,t4 as Nc,t5 as Bc,t6 as Ic,t7 as Dc,t8 as Lc,t9 as Fc,ta as Oc,tb as Hc,tc as Uc,td as Gc,te as zc,tf as Wc,tg as Vc,th as $c,ti as qc,tj as Yc,tk as Kc,tl as Qc,tm as Xc,tn as Jc,to as Zc,tp as eu,bk as tu,tq as su,g6 as nu,tr as ou,ts as au,tt as iu,tu as ru,tv as lu,tw as cu,tx as uu,ty as du,tz as mu,tA as pu,tB as fu,tC as gu,tD as hu,tE as xu,tF as bu,tG as Su,tH as vu,tI as yu,tJ as Cu,tK as wu,tL as ku,tM as _u,tN as ju,aO as Au,d as za,tO as Mu,tP as Wa,oQ as Ru,k8 as Ko,tQ as js,cj as ct,m8 as mn,tR as Mn,tS as Rn,d9 as Pn,cf as En,cg as Tn,dp as Nn,k7 as Bn,dm as In,dn as Dn,ka as Pu,tT as Eu,cc as Ln,nX as Va,ch as ws,ci as Tu,gR as Nu,ou as $a,tU as Bu,tV as Iu,tW as Du,hf as qa,tX as As,f_ as Lu,tY as Ya,tZ as Ka,t_ as Qa,t$ as Xa,u0 as zt,u1 as Fu,me as Ms,u2 as Ja,u3 as Ou,u4 as Hu,u5 as Uu,u6 as Gu,u7 as zu,u8 as Wu,cb as Fn,ec as On,fV as Za,op as Rs,u9 as Vu,ua as $u,ub as qu,aZ as Yu,uc as Hn,bP as Ku,f2 as Qu,gm as Xu,ud as ei,ue as Ju,uf as Zu,ug as Qo,f7 as ed,bN as ti,gN as td,uh as sd,ui as nd,uj as Xo,uk as od,ul as ad,um as id,un as rd,eP as si,aL as ld,uo as cd,nz as ud,eO as dd,up as Os,eQ as ni,h5 as oi,eS as ai,uq as ii,eT as ri,ur as pn,us as md,e7 as pd,ut as fd,kA as li,uu as gd,uv as hd,uw as xd,ux as bd,kB as Sd,kC as vd,uy as yd,uz as ci,uA as Cd,ok as ui,uB as wd,dS as kd,uC as _d,uD as jd,o2 as Ad,uE as Jo,uF as Md,uG as di,uH as Rd,uI as Pd,ae as mi,uJ as pi,uK as fi,uL as fn,uM as Ed,uN as Td,db as Zo,bm as Nd,eB as Bd,eD as Id,mA as Dd,c3 as Ld,uO as Fd,nk as Od,uP as Hd,uQ as Ud,uR as Gd,uS as zd,uT as Wd,uU as Vd,ht as $d,uV as ea,lz as qd,hp as Yd,uW as Kd,uX as Qd,uY as Xd,rW as ta,hw as Jd,uZ as Zd,u_ as sa,bH as em,u$ as tm,e_ as sm,a5 as na,am as nm,nn as om,ii as am,v0 as im,v1 as rm,v2 as lm,v3 as cm,eN as um,v4 as oa,v5 as aa,v6 as dm,v7 as mm,v8 as pm,v9 as ia,va as fm,vb as gm,vc as hm,dr as xm,o6 as bm,de as ra,vd as Sm,lY as gi,ve as vm,vf as ym,hL as Cm,x as hi,hP as wm,vg as km,vh as _m,o5 as jm,gS as Am,ki as ln,kj as cn,kP as Mm,nA as Rm,vi as Pm,vj as Em,l4 as Tm,gT as Nm}from"./n4exq6o15ap1g74l.js";import{l as ve,aG as ie,c_ as Bm,P as k,cW as Im,dI as Dm,cH as Oe,aL as et,hu as xi,aj as de,F as te,m as es,dE as Un,dS as He,aA as Je,hv as ee,E as Ue,g$ as bi,A as Si,bX as Gn,cX as zn,a as N,hw as vi,h4 as gn,f7 as yi,ft as Wn,cr as tt,hx as Ci,hy as Lm,fu as wi,bG as Vn,aH as Ee,f8 as ki,d9 as Ps,bW as Fm,cL as $n,hz as Om,hA as Hm,hB as Um,hC as Gm,hD as Hs,cF as Pe,a_ as ts,bD as xt,cm as zm,fD as Wm,am as Vm,bx as $m,ak as _i,hE as ji,bj as la,b as qm,x as Ym,fb as Ai,L as Pt,co as qn,cp as Yn,g as un,dG as Es,z as Mi,aB as Km,bM as Qm,R as Ri,hF as Xm,e9 as Jm,V as Dt,d8 as Pi,hG as Zm,I as Ei,dC as ep,dx as tp,dv as sp,cG as Ti,b_ as np,d5 as ca,cY as Ke,ht as op,fq as ua,f2 as it,aD as ut,C as ap,h as ip,gC as rp,em as lp,dR as cp,u as up,aT as dp,fE as mp,b5 as pp,ag as fp,gB as Kn,bw as gp,fi as hp,fa as xp,bP as bp,bQ as Sp,o as Wt,ac as vp,hH as yp,hI as Cp,hJ as wp,dM as kp,D as _p,as as jp,at as Ap,di as da,ah as Mp,eb as Rp,hK as Pp,gg as Ep,gh as Tp}from"./haannt40upmuwmtk.js";import{A as Np,u as Ni}from"./b3mht1lg7zv7qd3d.js";import{G as Bi}from"./m4g7yy9fehqi204r.js";import{F as Bp}from"./d7qdtm0x38jq0qqt.js";import{T as Ip}from"./dfz2bdgqh4yduujb.js";import{b as Dp}from"./dblaaxd78ezocyc0.js";const Lp="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",Fp="https://help.openai.com/en/articles/8932459",lh=()=>{const{isLoading:t,eligible:s}=_e(ce.hasSeenShibaHomeNux),{isUnauthenticated:n}=ve(),[a]=yl(),{value:o}=ie("2781425969");return n||!o||a?"hide":t?"loading":s?"show":"hide"};function Ii(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:vs.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"})},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:vs.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"})},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:vs.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"})},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:vs.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"})}]}const ch=({onClose:t,clientThreadId:s})=>{const{markAsViewed:n}=_e(ce.hasSeenShibaHomeNux),a=ht(),o=qt(),r=Bm("2604379743").config.value,i=typeof r.nux_video_url=="string"?r.nux_video_url:Lp,c=typeof r.nux_image_url=="string"?r.nux_image_url:"",[l,p]=g.useState(!1),d=Ra(a,s),{activeSystemHints:u}=Bs(s),m=u.find(y=>y.systemHint===D.PictureV2);g.useEffect(()=>{k.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const h=K(),f=Ii(h),x=()=>{n(),t(),k.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},b=()=>{n(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{m&&d({hint:m,enable:!0}),a.focus()})}),a.setAutocompletions(f)};return e.jsx(e.Fragment,{children:e.jsxs(Im,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:Dm,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!l&&e.jsx("img",{src:c,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:i,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>p(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(F,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(F,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:y=>e.jsx("a",{href:Fp,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:y})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(F,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(Oe,{color:"secondary",onClick:x,className:"flex-1",children:e.jsx(F,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(Oe,{color:"primary",onClick:()=>{b(),o("/?model=gpt-4o"),k.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(F,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})},Op=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:a,onMount:o})=>{const{name:r,title:i,call_to_action:c,description:l}=s,p=et(),d=Et(!0),{updateSystemHint:u}=Se(),m=ht(),h=Et(!1),f=xi(),x=de(t,te.getIsNewConversation),b=p?.planType??"unknown",y=es(),C=Un(y,"3809605125"),w=f&&"block_reason"in f?f.block_reason:null,A="banner_description",E=g.useMemo(()=>({type:r||"unknown",location:A,plan_type:b,is_new_conversation:x,is_hard_block:!!f,hard_block_reason:w??"",call_to_action:c}),[r,A,b,x,f,w,c]),_=qt(),I=Cn(),{isUnauthenticated:j}=ve(),L=Is(),O=wn(He.signUpButtonText),S=Nt(),z=Pa({clientThreadId:t}),{layer:M}=Je("1368081792"),U=G=>{switch(G){case ee.AUTHENTICATE:return{text:L?He.logInButtonText:O,onClick:()=>{I({authType:L?"login":"signup",callback:R=>{L?k.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:R}):k.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:R})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:L?O:He.logInButtonText,onClick:()=>{I({authType:L?"signup":"login",callback:R=>{L?k.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:R}):k.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:R})}})}};case ee.GET_PLUS:return{text:Rt.getPlusButton,onClick:()=>{k.logRateLimitGetPlusButtonClicked(E),j?I({authType:L?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:R=>{L?k.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:R}):k.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:R})}}):Xe(_,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:Rt.newChatButton,onClick:()=>{d({modelId:"",location:A})}};case ee.PAID_USER_O3_MINI_HIGH:{const R=te.getCurrentLeafId(Ue(t)),Y=()=>{k.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:M.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:E}),M.get("should_change_model_picker",!0)&&h(C?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(C?{sourceEvent:new Event("click"),nodeId:R,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:R,requestedModelId:"o3-mini-high"})};return{text:Rt.tryItButton,onClick:Y}}case ee.FREE_USER_O3_MINI_HIGH:return{text:Rt.getPlusButton,onClick:()=>{k.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:E}),Xe(_,"Prompt textarea in-context upsell banner")}};case ee.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const R=te.findNode(Ue(t),re=>bi(re.message)),Y=R?Si(R.message):void 0;return{text:Rt.tryItButton,onClick:()=>{k.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:E}),u(D.Research,{clientThreadId:t}),m.focus(),m.setText(Y??"")}}}case"get_pro":return{text:Rt.getProButton,onClick:()=>{k.logRateLimitUpgradePlanButtonClicked({...E,upgrade_plan_tye:"pro"}),j?I({authType:L?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:R=>{L?k.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:R}):k.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:R})}}):Xe(_,"Prompt textarea rate limit banner")}}}};kn(()=>{!M.get("should_change_model_picker",!0)&&E.type==="o3-mini-high-in-context-upsell-plus"&&(E.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),k.logRateLimitBannerShown(E),o?.()});let[q,W]=c??[];q===ee.AUTHENTICATE&&S&&(W=ee.AUTHENTICATE_SECONDARY);const B={primaryAction:U(q),secondaryAction:U(W)};return e.jsx(Ea,{onDismiss:n,title:i,description:l,actions:B,onInteract:a})},Rt=Te({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Hp=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:a,onMount:o})=>{const{name:r,title:i,call_to_action:c,description:l}=s,p=et(),d=Et(!0),{updateSystemHint:u}=Se(),m=ht(),h=Et(!1),f=xi(),x=de(t,te.getIsNewConversation),b=p?.planType??"unknown",y=Nt(),C=es(),w=Un(C,"3809605125"),A=f&&"block_reason"in f?f.block_reason:null,E="banner_description",_=g.useMemo(()=>({type:r||"unknown",location:E,plan_type:b,is_new_conversation:x,is_hard_block:!!f,hard_block_reason:A??"",call_to_action:c}),[r,E,b,x,f,A,c]),I=qt(),j=Cn(),{isUnauthenticated:L}=ve(),O=Is(),S=wn(He.signUpButtonText),z=Pa({clientThreadId:t}),{layer:M}=Je("1368081792"),U=G=>{switch(G){case ee.AUTHENTICATE:return{text:O?He.logInButtonText:S,onClick:()=>{j({authType:O?"login":"signup",callback:R=>{O?k.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:R}):k.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:R})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:O?S:He.logInButtonText,onClick:()=>{j({authType:O?"signup":"login",callback:R=>{O?k.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:R}):k.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:R})}})}};case ee.GET_PLUS:return{text:Vt.getPlusButton,onClick:()=>{k.logRateLimitGetPlusButtonClicked(_),L?j({authType:O?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:R=>{O?k.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:R}):k.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:R})}}):Xe(I,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:Vt.newChatButton,onClick:()=>{d({modelId:"",location:E})}};case ee.PAID_USER_O3_MINI_HIGH:{const R=te.getCurrentLeafId(Ue(t)),Y=()=>{k.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:M.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:_}),M.get("should_change_model_picker",!0)&&h(w?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(w?{sourceEvent:new Event("click"),nodeId:R,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:R,requestedModelId:"o3-mini-high"})};return{text:Vt.tryItButton,onClick:Y}}case ee.FREE_USER_O3_MINI_HIGH:return{text:Vt.getPlusButton,onClick:()=>{k.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:_}),Xe(I,"Prompt textarea in-context upsell banner")}};case ee.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const R=te.findNode(Ue(t),re=>bi(re.message)),Y=R?Si(R.message):void 0;return{text:Vt.tryItButton,onClick:()=>{k.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:_}),u(D.Research,{clientThreadId:t}),m.focus(),m.setText(Y??"")}}}}};kn(()=>{!M.get("should_change_model_picker",!0)&&_.type==="o3-mini-high-in-context-upsell-plus"&&(_.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),k.logRateLimitBannerShown(_),o?.()}),g.useEffect(()=>()=>{k.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",_)},[_]);let[q,W]=c??[];q===ee.AUTHENTICATE&&y&&(W=ee.AUTHENTICATE_SECONDARY);const B={primaryAction:U(q),secondaryAction:U(W)};return e.jsx(Ea,{onDismiss:n,title:i,description:l,actions:B,onInteract:a})},Vt=Te({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Di=t=>{const{value:s}=ie("1028682714");return s?e.jsx(Op,{...t}):e.jsx(Hp,{...t})},Li=Gn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Up(){const{data:t,isLoading:s}=jl({cutId:"recent",limit:8}),{data:n,isLoading:a}=Al();return{isLoading:s||a,recent:t,pinned:n}}function Gp({query:t,onSelectGizmo:s,selectedIdx:n},a){const o=Cl(),r=g.useRef([]),{isLoading:i,recent:c,pinned:l}=Up();g.useImperativeHandle(a,()=>({handleEnterOnIndex:u=>{if(!d[u])return u<p.length?p[u].resource:"create"},getResultsLength:()=>p.length+1,scrollToItem:u=>{const m=r.current[u];m&&m.scrollIntoView({behavior:"instant",block:"nearest"})}}));let p=[];if(i)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(zn,{})});c&&p.push(...c.pages.flatMap(u=>u.list.items).map(u=>({resource:u.resource,from:"recent"}))),l&&p.push(...l.items.map(u=>({resource:u,from:"pinned"}))),p=wl(p,u=>u.resource.gizmo.id);const d=p.map(u=>u.resource.gizmo.tags?.includes(Ds.WorkspaceDisabled));return t&&t!==""&&(p=p.filter(u=>(u.resource.gizmo.display.name.toLowerCase()+u.resource.gizmo.display.description?.toLowerCase()+u.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[p.map((u,m)=>e.jsx("div",{ref:h=>{r.current[m]=h},tabIndex:m,onClick:()=>{d[m]||s(u.resource)},children:e.jsx($p,{gizmoResource:u.resource,from:u.from,showDescription:o,isSelected:n===m,grayedOut:d[m]})},u.resource.gizmo.id)),e.jsx("div",{ref:u=>{r.current[p.length]=u},tabIndex:p.length,onClick:()=>{s("create")},children:e.jsx(Wp,{isSelected:n===p.length})},"create")]})}const zp=g.forwardRef(Gp),Wp=({isSelected:t})=>e.jsx(Li,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(pl,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(Ta,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(F,{...Fi.dropdownCreateLabel})})]})}),Vp=({onClick:t,onClose:s})=>{const[n,a]=g.useState(null),o=g.useRef(null),r=g.useRef(null),[i,c]=g.useState(0),l=K(),p=d=>{k.logEvent("Mentions Click Gizmo",{gizmo_id:d==="create"?"create":d.gizmo.id}),d!=="create"&&t(d)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(Fi.searchPlaceholder),ref:o,onKeyDown:d=>{if(d.nativeEvent.isComposing)return;const u=r.current?.getResultsLength()??0;if((d.key==="Escape"||d.key==="Backspace"&&!n)&&(d.preventDefault(),s()),d.key==="Enter"||d.key==="Tab"){d.preventDefault();const m=r.current?.handleEnterOnIndex(i);if(!m)return;m==="create"?(window.open("/gpts/editor","_blank"),s()):p(m)}if(d.key==="ArrowDown"&&i<u-1){d.preventDefault();const m=i+1;r.current?.scrollToItem(m),c(m)}if(d.key==="ArrowUp"&&i>0){d.preventDefault();const m=i-1;r.current?.scrollToItem(m),c(m)}},onChange:d=>{a(d.target.value),c(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(zp,{ref:r,query:n,selectedIdx:i,onSelectGizmo:p})]})},ma=({onClick:t,onClose:s})=>{const n=vi(),a=!!n;return kn(()=>{k.logEvent("Mentions Opened",{gizmo_selector_disabled:a})}),a?e.jsx(Di,{clientThreadId:gn,rateLimitInfo:n}):e.jsx("div",{onBlur:o=>{o.currentTarget.contains(o.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Vp,{onClick:t,onClose:s})})};function $p({gizmoResource:t,from:s,showDescription:n,isSelected:a,grayedOut:o}){const r=!!t.gizmo.tags?.includes(Ds.FirstParty);return e.jsxs(Li,{className:N(a?"bg-token-main-surface-secondary":"",o&&"opacity-50"),children:[e.jsx(Bi,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:N("icon-xl h-7 w-7 shrink-0",o&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(kl,{className:"icon-sm"}):e.jsx(_l,{className:"icon-sm"})})]})]})}const Fi=Te({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}}),ss=({pressed:t,disabled:s,icon:n,label:a,ariaLabel:o,animatedLabel:r,showLabel:i,onClick:c,splitButtonDropdownContent:l,dropdownContent:p,dataTestid:d})=>{const[u,m]=g.useState(!1),h=Aa(),f=!s&&t,x=a&&e.jsx("div",{className:N("[display:var(--force-hide-label)] ps-1 pe-1 whitespace-nowrap"),children:a}),b=e.jsxs("button",{className:N("flex h-full min-w-8 items-center justify-center p-2",{"pe-1.5":!!l}),"data-testid":d,"aria-pressed":t,"aria-label":o,disabled:s,onTransitionEnd:()=>m(!1),onClick:w=>{p||(m(!0),c(w))},children:[n,!r&&i?x:null,r&&e.jsx(be,{initial:!1,children:i&&e.jsx($.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:h?0:.15},children:x})})]}),y=l||p?e.jsx(e.Fragment,{children:e.jsx(Kt,{children:e.jsx(yi,{className:"p-0",$as:Qt,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:p??l})})}):null,C=e.jsxs("div",{className:N("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",{"duration-75 motion-safe:transition-all":u,"text-token-text-secondary":!t,"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":!!f,"border-token-border-default can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white":!f,"opacity-30":s}),children:[p?e.jsx(ft,{asChild:!0,children:b}):b,!p&&l?e.jsx(ft,{asChild:!0,children:e.jsx("button",{className:"border-token-border-default border-s p-2",style:{borderColor:f?"#0285FF0D":void 0},disabled:s,children:e.jsx(ks,{className:"h-[18px] w-[18px]"})})}):null]});return l||p?e.jsxs(Yt,{children:[e.jsx(Ls,{asChild:!0,children:C}),y]}):C};var rt=(t=>(t.Hover="hover",t.Enable="enable",t.Disable="disable",t))(rt||{});const Oi=new Map([[D.Think,{hover:["Composer Think Button Hovered","composer_think_button_hovered"],enable:["Composer Think Button Enabled","composer_think_button_enabled"],disable:["Composer Think Button Disabled","composer_think_button_disabled"]}],[D.Research,{hover:["Composer Research Button Hovered","composer_research_button_hovered"],enable:["Composer Research Button Enabled","composer_research_button_enabled"],disable:["Composer Research Button Disabled","composer_research_button_disabled"]}]]);function qp({systemHint:t,label:s,logo:n,isDisabled:a=!1,composerController:o,analyticsMetadata:r,onClick:i,showLabel:c=!1,splitButtonDropdownContent:l,dropdownContent:p,dataTestid:d}){const{name:u,systemHint:m}=t,h=m,{setThreadSystemHintMode:f,clearAllSystemHintModeTriggers:x}=Se(),b=Bt(h),y=!!t.composerBarButtonInfo?.upsell,C=Qe.useStore(),{value:w}=ie("2454940646"),A=Xt(),E=[D.Search,D.Think].includes(h);g.useEffect(()=>{a&&A.has(h)&&f(h,!1,r)},[a,h,r,f,A,E]);const _=g.useCallback(L=>{L.stopPropagation(),L.preventDefault();let O=!0;w&&E&&(C.getState().persistedSystemHints.has(D.Search)||C.getState().persistedSystemHints.has(D.Think))&&(O=!1),O&&x(),f(h,!b,r),b||(o.removeSystemHints(),o.focus());const{enable:S,disable:z}=Oi.get(h)??{},[M,U]=(b?z:S)??[];M&&U&&k.logEventWithStatsig(M,U,r),i?.(L)},[r,w,x,o,h,E,b,i,f,C]),I=y?e.jsx("div",{className:"py-2",children:e.jsx(_n,{location:h,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(ss,{pressed:b,disabled:a,icon:n,label:s,ariaLabel:u,animatedLabel:!c,showLabel:c||b,onClick:_,dropdownContent:p??I,splitButtonDropdownContent:l,dataTestid:d})}function Yp({composerController:t,systemHint:s,composerBarButtonInfo:n,isDisabled:a,clientThreadId:o,showLabel:r,labelOverride:i,disabledReason:c,rateLimitProgress:l,dropdownContent:p,splitButtonDropdownContent:d,logoOverride:u,dataTestid:m,tooltipPosition:h,disableNuxMarkdown:f}){const x={clientThreadId:o};return e.jsx(Kp,{composerBarButtonInfo:n,isDisabled:a,analyticsMetadata:x,systemHint:s.systemHint,disabledReason:c,rateLimitProgress:l,tooltipPosition:h,disableNuxMarkdown:f,children:e.jsx(qp,{isDisabled:a,systemHint:s,label:i??s.name,logo:u??e.jsx(Wn,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:x,showLabel:r,dropdownContent:p,splitButtonDropdownContent:d,dataTestid:m})})}function Kp({children:t,isDisabled:s,systemHint:n,composerBarButtonInfo:a,analyticsMetadata:o,disabledReason:r,rateLimitProgress:i,tooltipPosition:c="bottom",disableNuxMarkdown:l}){const p=Ml(a.announcementKey,n),d=Rl({composerBarButtonInfo:a,children:t,disableMarkDown:l}),u=K();let m=null;return i&&i.remaining?m=e.jsx(Hi,{remaining:i.remaining,reset_date:i.reset_after,text:a.tooltipText}):a.tooltipText&&(m=e.jsx(Qn,{text:a.tooltipText})),p?d:e.jsx("div",{children:e.jsx(tt,{sideOffset:10,label:s?r===dt.HasAttachedFiles?u.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):r===dt.DeepResearchHighLoad?u.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):r===dt.RateLimitReached?a.rateLimitReachedText:a.disabledText:m,side:c,onOpenChange:h=>{if(h){const{hover:f}=Oi.get(n)??{},[x,b]=f??[];x&&b&&k.logEventWithStatsig(x,b,o)}},children:t})})}const Qn=({text:t})=>e.jsx("span",{children:t}),Hi=({remaining:t,reset_date:s,text:n})=>{const{locale:a}=K(),o=Pl(s,a);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(F,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:o}})}),e.jsx(Qn,{text:n})]})},Qp=()=>Lm().find(t=>t.feature_name===Nl(D.Research))??null;function Xp({clientThreadId:t,showLabel:s=!1,isDisabled:n}){const a=El(t),o=ht(),r=Bt(D.Research),{setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:c}=Se(),l=!!Ci(),{value:p}=ie("1416952492"),d=p?dt.DeepResearchHighLoad:l?dt.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${D.Research}-action)`},children:e.jsx(Jp,{composerController:o,isThreadInSystemHintMode:r,setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:c,clientThreadId:t,showLabel:s,isDisabled:n||!!d,disabledReason:d})},`system-hint-${D.Research}`):null}function Jp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:a,clientThreadId:o,showLabel:r=!1,isDisabled:i=!1,disabledReason:c}){const l=K(),p={clientThreadId:o},d=l.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),u=h=>{h===rt.Hover?k.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",p):h===rt.Enable?k.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",p):h===rt.Disable&&k.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",p)},m=h=>{h.stopPropagation(),h.preventDefault(),a(),n(D.Research,!s,p),s||(t.removeSystemHints(),t.focus()),u(s?rt.Disable:rt.Enable)};return e.jsx(Zp,{disabledReason:c,isDisabled:i,logEvent:u,children:e.jsx(ss,{pressed:s,disabled:i,icon:e.jsx(Tl,{className:"h-[18px] w-[18px]"}),label:d,animatedLabel:!r,showLabel:r||s,onClick:m,ariaLabel:d,dataTestid:"composer-button-deep-research"})})}function Zp({children:t,isDisabled:s,disabledReason:n,logEvent:a}){const o=K(),r=Ci(),i=Qp(),c=o.formatMessage({id:"LtcsGJ",defaultMessage:"Get detailed insights on any topic"});let l=null;i&&i.remaining?l=e.jsx(Hi,{remaining:i.remaining,reset_date:i.reset_after,text:c}):l=e.jsx(Qn,{text:c});const p=n===dt.DeepResearchHighLoad?o.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):n===dt.RateLimitReached&&r?o.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:r.resets_after_text}):void 0;return e.jsx("div",{children:e.jsx(tt,{className:"inline-block",sideOffset:0,label:s?p:l,side:"bottom",onOpenChange:d=>{d&&a(rt.Hover)},children:t})})}function ef({clientThreadId:t,gizmoId:s,composerController:n,isDisabled:a}){return Bl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${D.Think}-action)`},children:e.jsx(tf,{clientThreadId:t,composerController:n,isDisabled:a})},`system-hint-${D.Think}`):null}function tf({clientThreadId:t,composerController:s,isDisabled:n}){const a=K(),o=!!wi();n=n||o;const r=a.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:c}=Se(),l=Bt(D.Think),p=Qe.useStore(),d=Xt(),{isUnauthenticated:u}=ve();g.useEffect(()=>{n&&d.has(D.Think)&&i(D.Think,!1,{clientThreadId:t})},[n,d,i,t]);const m=x=>{if(x.stopPropagation(),x.preventDefault(),u)return;let b=!0;p.getState().persistedSystemHints.has(D.Search)&&(b=!1),b&&c(),i(D.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?k.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):k.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},h=u?e.jsx(_n,{location:D.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,f=e.jsx(ss,{pressed:l,disabled:n,icon:e.jsx(Dl,{className:"h-[18px] w-[18px]"}),label:r,ariaLabel:r,animatedLabel:!0,showLabel:!0,onClick:m,dropdownContent:h,dataTestid:"composer-button-reason"});return e.jsx(Il,{isDisabled:n,clientThreadId:t,children:f})}const sf=["o1","o1-pro","gpt-4"];function nf({account:t,clientBootstrapFlags:s,features:n,clientThreadId:a,currentModelConfig:o,composerController:r,isDisabled:i,gizmoId:c,hasFiles:l}){const{prospectiveModelId:p}=Jt(a);let d=Zt(a);const u=jn(c),{userIsInSearchHoldoutWithWebDisabled:m}=Ll(),h=o?.enabledTools?.includes(Vn.Search),f=d==null||d?.kind===Ee.PrimaryAssistant||d?.kind===Ee.GizmoInteraction&&u,{isUnauthenticated:x}=ve(),b=ki(D.Search);return x&&s?.includes(Ps.AnonSearchHoldout)||!x&&(t==null||t.isFree())&&(s?.includes(Ps.FreeSearchHoldout)||m)||!b||!x&&(t==null||t.isEnterprisey())&&!n?.includes(Fm.BrowsingAvailable)||!f?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${D.Search}-action)`},children:e.jsx(of,{clientThreadId:a,composerController:r,modelSupportsSearch:h??(x||t?.isFree()||!!p&&!sf.includes(p)),isDisabled:i,disabledReason:h?l?_s.HasAttachedFiles:void 0:_s.ModelNotSupported,currentModelName:o?.title??""})},`system-hint-${D.Search}`)}function of({clientThreadId:t,composerController:s,isDisabled:n,disabledReason:a,currentModelName:o,modelSupportsSearch:r}){const i=K(),c=Fl(),l=i.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:p,clearAllSystemHintModeTriggers:d}=Se(),u=Qe.useStore(),m=Xt();n=n||!r,g.useEffect(()=>{n&&m.has(D.Search)&&p(D.Search,!1,{clientThreadId:t})},[n,m,p,t]);const h=f=>{f.stopPropagation(),f.preventDefault();let x=!0;u.getState().persistedSystemHints.has(D.Think)&&(x=!1),x&&d(),p(D.Search,!c,{clientThreadId:t}),c||(s.removeSystemHints(),s.focus()),k.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),c&&s.trimLeadingText(/^search\b/i)};return e.jsx(rf,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:c,isDisabled:n,disabledReason:a,currentModelName:o,children:e.jsx(ss,{pressed:c,disabled:n??!1,icon:e.jsx(Ol,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:h,dataTestid:"composer-button-search"})})}function af(){const t=Na(),s=_e(ce.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function rf({children:t,analyticsMetadata:s,isThreadUsingSearchMode:n,isDisabled:a,disabledReason:o,currentModelName:r}){const i=af()&&!n,c=_e(ce.hasSeenComposerSearchButtonTooltip);return i?e.jsx(An,{announcementKey:ce.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(F,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:c.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(F,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Hl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(F,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(tt,{className:"inline-block",sideOffset:0,label:a?o===_s.ModelNotSupported?e.jsx(F,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${r}`}}):o===_s.HasAttachedFiles?e.jsx(F,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(F,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(F,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&k.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const lf=1;function cf({value:t=lf,size:s,onStateChange:n}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs($.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>n?.("animating"),onAnimationComplete:()=>n?.("idle"),className:N("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx($.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute start-0 top-0",children:e.jsx(Ba,{"aria-label":"",className:N(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx($.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Ul,{"aria-label":"",className:N(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx($.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Gl,{"aria-label":"",className:N(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function uf(t){const{reasoningLevelTypes:s,reasoningLevelType:n}=t,{ReasoningLevels:a}=s;let o=1;return n===a.medium.type?o=2:n===a.high.type&&(o=3),e.jsx("div",{className:N("relative flex h-5 w-5 items-center justify-center"),children:e.jsx(cf,{size:"small",value:o})})}const df=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:n,reasoningLevelType:a,modelName:o,onResetReasoningLevel:r,onReasoningLevelChanged:i,type:c})=>{const[l,p]=g.useState(!1),d=Aa(),{reasoningLevel:u}=zl({reasoningLevelTypes:n,reasoningLevelType:a}),m=a!=="low"||t||!1,h=pe(x=>x.isVisuallyOverflowing),f=h;return e.jsxs("div",{className:N("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",m?"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":"border-token-border-default text-token-text-secondary can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white",l&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":m,onTransitionEnd:()=>p(!1),onClick:x=>{c==="think"&&!t&&!h&&(x.stopPropagation(),x.preventDefault(),i(a==="low"?"medium":"low"))},children:[e.jsx(uf,{reasoningLevelTypes:n,reasoningLevelType:a}),s&&e.jsx(be,{initial:!1,children:e.jsx($.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:d?0:.15},children:e.jsx("div",{className:N("ps-1 pe-1 whitespace-nowrap",f&&!t&&"hidden"),children:t?o:u?.shortLabel})})}),!t&&c==="auto"&&!m&&!f&&e.jsx(ks,{"aria-label":"",className:"h-[18px] w-[18px] opacity-50"})]}),m&&!h&&(t||c!=="think")?e.jsx("div",{className:"border-token-border-default mt-[1px] border-s p-2",style:{borderColor:m?"#0285FF28":void 0},onClick:x=>{x.stopPropagation(),x.preventDefault(),r()},children:e.jsx($n,{"aria-label":"",className:"h-[16px] w-[16px]"})}):c==="think"?e.jsx("div",{className:N("border-token-border-default border-s p-2",f&&"hidden"),style:{borderColor:m?"#0285FF28":void 0},children:e.jsx(ks,{className:"h-[18px] w-[18px]"})}):null]})},Ui=({clientThreadId:t,rateLimitPopup:s,children:n,disabled:a,highlightTooltip:o=!1,disabledReason:r,currentModelName:i})=>{const c=K(),l=de(t,te.getIsNewConversation),p=et(),d=f=>{s!=null&&f&&k.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:p?.planType??"unknown"})},u=wn(He.signUpButtonText),{isEligible:m}=Wl(t),h=!!s;return e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"h-8",children:e.jsxs(Om,{delayDuration:150,onOpenChange:d,children:[e.jsx(Hm,{asChild:!0,children:n}),e.jsx(Um,{children:e.jsx(yi,{$as:Gm,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(mf,{isNewConversation:l,rateLimitPopup:s,signUpButtonText:u})})})]})}):!a&&m?e.jsx(Bp,{clientThreadId:t,children:n}):e.jsx(tt,{sideOffset:0,label:a?r===Fe.ModelNotSupported?c.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${i}`}):r===Fe.ThinkModeInUse?c.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):r===Fe.SearchModeInUse?c.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):c.formatMessage({id:"9Wgi7B",defaultMessage:"Attach files is unavailable"}):c.formatMessage({id:"wkpQmi",defaultMessage:"Upload files and more"}),className:"flex",open:o?!0:void 0,side:"bottom",children:n})})},mf=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:n})=>{const a=et(),o=qt(),r=Cn(),i=Is(),c=Nt();if(s==null)return null;const{call_to_action:l,description:p}=s,d=p||e.jsx(F,{...pa.defaultDescription}),u=l?.includes(ee.GET_PLUS),m=l?.includes(ee.AUTHENTICATE),h=m&&c;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:d}),u?e.jsx(Oe,{size:"small",color:"secondary",onClick:()=>{Xe(o,"Rate limited file upload popover"),k.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:a?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(F,{...pa.getPlus})}):null,m?e.jsx(Oe,{size:"small",color:"primary",onClick:()=>{r({authType:i?"login":"signup",callback:f=>{i?k.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:f}):k.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:f})}})},children:i?e.jsx(F,{...He.logInButtonText}):e.jsx(F,{...n})}):null,h?e.jsx(Oe,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{r({authType:i?"signup":"login",callback:f=>{i?k.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:f}):k.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:f})}})},children:i?e.jsx(F,{...n}):e.jsx(F,{...He.logInButtonText})}):null]})},pa=Te({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function pf({setOpen:t,open:s,...n}){return e.jsxs(e.Fragment,{children:[e.jsx(Pe.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Gi,{...n,onClick:()=>t(!0),open:s})]})}function Gi({clientThreadId:t,icon:s,isDisabled:n=!1,showLabel:a=!1,highlightTooltip:o=!1,hideBorder:r=!1,isSmall:i=!1,disabledReason:c,currentModelName:l,visualTreatment:p,onClick:d,open:u,hasPopoverTrigger:m=!1,showGlowingBorder:h}){const f=Hs(),x=K();n=n||!!f;const b=e.jsxs(Ia,{disabled:n,"aria-disabled":n,"aria-label":n?x.formatMessage({id:"NTwThg",defaultMessage:"Attach files is unavailable"}):x.formatMessage({id:"ixBxc3",defaultMessage:"Upload files and more"}),onClick:y=>{y.preventDefault(),d()},$open:u,$showLabel:a,$showGlowingBorder:h,$hideBorder:r,$isSmall:i,$visualTreatment:p,children:[s,a&&e.jsx(Da,{})]});return e.jsx(Ui,{clientThreadId:t,rateLimitPopup:f,highlightTooltip:o,disabled:n,disabledReason:c,currentModelName:l,children:m?e.jsx(ft,{asChild:!0,children:b}):b})}function zi({clientThreadId:t,icon:s,isDisabled:n=!1,showLabel:a=!1,highlightTooltip:o=!1,hideBorder:r=!1,isSmall:i=!1,disabledReason:c,currentModelName:l,visualTreatment:p,isLoading:d,handleLocalFileUploadClick:u,noAvailableConnectors:m,showMenuForNoAuth:h,announcement:f}){const{openPopover:x,isOpen:b}=It(),{openMenu:y,confirmMenuOpened:C}=La();g.useEffect(()=>{y&&(x(),C())},[y,C,x]);const w=()=>{if(m&&!d&&!h){u();return}x(),f.eligible&&f.markAsViewed(),k.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker")};return e.jsx(Gi,{clientThreadId:t,icon:s,isDisabled:n,showLabel:a,highlightTooltip:o,hideBorder:r,isSmall:i,disabledReason:c,currentModelName:l,visualTreatment:p,onClick:w,open:b,hasPopoverTrigger:!0})}const hn=({children:t,sideOffset:s=-35,...n})=>{const a=Ze(),{isOpen:o,closePopover:r,popoverContentRef:i}=It();return g.useEffect(()=>{if(o)return Vl(r,i)},[o,i,r]),g.useEffect(()=>{if(!o)return;const c=l=>{l.key==="Escape"&&r()};return document.addEventListener("keydown",c,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",c,{capture:!0})},[o,r]),e.jsx(Kt,{forceMount:!0,children:e.jsx(Qt,{forceMount:!0,asChild:!0,align:"center",sideOffset:s,onClick:c=>{c.stopPropagation(),c.preventDefault()},onOpenAutoFocus:c=>{c.preventDefault()},...n,children:e.jsx("div",{ref:i,className:N(!o&&"pointer-events-none"),children:e.jsx(be,{mode:"sync",children:o&&e.jsx($.div,{className:N("border-token-border-xlight origin-radix-popover dark:bg-token-main-surface-secondary flex overflow-clip rounded-2xl border bg-white shadow-2xl dark:border-white/5 dark:shadow-[0px_24px_64px_rgba(0,0,0,0.32)]"),variants:{open:{scale:[.7,1],opacity:1,transition:a?ue:gt},closed:{opacity:0,scale:.8,transition:a?ue:{...gt,duration:.2}}},initial:"closed",animate:"open",exit:"closed",children:t})})})})})},Wi=({as:t="div",children:s,className:n,isSelected:a=!1,shape:o="rectangle",spacing:r="normal",disableHover:i=!1,isLegacyStyle:c=!1,borderVisible:l=!1,...p})=>{const d=t==="div"?$.div:$.button,u=!i&&"hover:border-black/0 hover:bg-black/5 motion-safe:transition-colors dark:hover:bg-white/5",m=!i&&"hover:bg-black/[0.075]! dark:hover:bg-white/10!";return e.jsx(d,{className:N("relative -ms-1 flex cursor-pointer flex-row items-center justify-center gap-1 rounded-3xl border py-1 font-medium whitespace-nowrap select-none *:pointer-events-none","[font-size:var(--pill-font-size,14px)]",r==="compact"&&o==="round"&&"px-1.5",r==="compact"&&o==="rectangle"&&"px-2.5",r==="normal"&&o==="rectangle"&&"px-3.5",c?"min-h-9":"min-h-8",l?"border-token-border-default":"border-transparent",a?c?"text-token-interactive-label-accent-default bg-token-composer-blue-bg hover:bg-[#BDDCF4] focus-visible:outline-black dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A] dark:focus-visible:outline-white":N("dark:text-token-composer-blue-text bg-black/[0.045] dark:bg-white/5",m):c?"hover:bg-token-main-surface-secondary":N("[color:var(--pill-color,var(--text-secondary))]",u),n),...p,children:s})},xn=({children:t,className:s,isSelected:n=!1,onClick:a,tooltipLabel:o,...r})=>{const{isOpen:i,openPopover:c,popoverTriggerRef:l}=It(),p=g.useCallback(u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),c())},[c]),d=g.useCallback(u=>{a?.(u),!u.defaultPrevented&&c()},[a,c]);return e.jsx(tt,{sideOffset:0,label:o,delayDuration:500,children:e.jsx(ft,{asChild:!0,onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(Wi,{animate:i?"inactive":"active",as:"div",role:"button",className:N("group motion-safe:[transition:border-color_0.1s_ease-in-out]",s),isSelected:n,"data-reasoning-popover-action":!0,onClick:d,onKeyDown:p,ref:l,tabIndex:0,...r,children:t})})})};function ff(t=!1){const[s,n]=g.useState(t),[a,o]=g.useState(!1);return{isOpen:s,isStartingToOpen:a,setIsOpen:n,setIsStartingToOpen:o}}function Xn({layoutMode:t,initialOpen:s=!1,forceOpen:n=!1,restoreFocus:a,children:o,onClose:r,mode:i="default",modal:c}){const{isOpen:l,isStartingToOpen:p,setIsOpen:d,setIsStartingToOpen:u}=ff(s||n),m=n||l,h=g.useRef(null),f=g.useRef(null),x=g.useCallback((w=!0)=>{m||(d(!0),$l(),requestAnimationFrame(()=>{u(!0),w&&ql({root:h.current,autoFocus:!0})}))},[d,u,m]),b=g.useCallback(()=>{!p&&!m||(d(!1),u(!1),requestAnimationFrame(()=>{const w=new Event("focus");a?.(w),w.defaultPrevented||f.current?.focus()}),r?.())},[r,d,u,p,m,a]),y=w=>{w?x():b()},C={Trigger:{type:xn,instance:null},Content:{type:hn,instance:null}};return g.Children.forEach(o,w=>{if(g.isValidElement(w))if(w.type===xn||w.type===ft||w.type===zi){if(C.Trigger.instance)throw new Error("Only one trigger is allowed");C.Trigger.instance=w}else w.type===hn&&(C.Content.instance=w)}),e.jsx(Yl,{value:{closePopover:b,isOpen:m,isStartingToOpen:p,layoutMode:t,openPopover:x,popoverContentRef:h,popoverTriggerRef:f,mode:i},children:e.jsxs(Yt,{open:m,onOpenChange:y,modal:c,children:[C.Trigger.instance,C.Content.instance]})})}const Vi=ft,gf=xn,Jn=hn,hf=({clientThreadId:t,currentModelId:s,onModelSelection:n,closePopover:a,setIsModelPickerOpen:o,ref:r})=>{const i=K(),{data:c}=ts(),{mode:l}=It(),p=Kl({clientThreadId:t}),{hasInternalModels:d}=Ql(),{isUXUpdatesEnabled:u}=xt(),f=Xl(b=>b.query).toLowerCase().trim().length>0,x=Jl();return e.jsxs($.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:gt,className:N("flex flex-col",x&&"scroll-mt-[44px]"),ref:r,children:[l!=="model-picker-only"&&!u&&e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b p-3",children:[e.jsx("button",{onClick:()=>{o(!1)},id:"reasoning-level-popover-model-list-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Fa,{className:"text-token-text-secondary h-5 w-5"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:i.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:N("flex w-full flex-col pb-2",u?"pt-3":"pt-2",x&&"min-h-[375px]"),children:f?e.jsx(Zl,{currentModelId:s,onModelSelection:n,closePopover:a,rootRef:r}):e.jsxs(e.Fragment,{children:[c?.categories?.map(b=>{const y=b?.defaultModel;return e.jsx(ec,{model:b,modelSwitcherDenialsBySlug:p,isSelected:y===s,onClick:()=>{n(y),a()}},y)}),d&&e.jsxs(e.Fragment,{children:[e.jsx(tc,{modelsData:c,clientThreadId:t,triggerButton:e.jsx(mt,{className:"relative mt-1 border-transparent",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:i.formatMessage({id:"ZDpo4I",defaultMessage:"Internal Models"})}),e.jsx(zm,{className:"icon-md text-token-text-tertiary absolute end-1 w-7"})]})}),onModelItemClick:b=>{b&&(n(b),a())}}),e.jsx(Oa,{})]})]})})]})},xf={modelPickerOpen:{maxHeight:375,width:320},modelPickerClosed:{maxHeight:245,width:320},vanguardModelPickerClosed:{maxHeight:320,width:264}},bf=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:a,isManualModelSelection:o,currentModelId:r,onModelSelection:i,resetReasoningLevel:c})=>{const{layoutMode:l,closePopover:p,mode:d}=It(),u=!Fs(),[m,h]=g.useState(!!(o||d==="model-picker-only")),f=g.useRef(null),x=g.useRef(null),{isUXUpdatesEnabled:b}=xt();return g.useEffect(()=>{b&&m&&!o?requestAnimationFrame(()=>{x.current?.scrollIntoView({block:"start",behavior:"smooth"}),document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()}):b&&o&&requestAnimationFrame(()=>{x.current?.scrollIntoView({block:"start",behavior:"instant"}),document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()}),m?b||(f.current?.scrollTo({top:-1e3,behavior:"instant"}),document.getElementById("reasoning-level-popover-model-list-back-button")?.focus()):document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()},[o,m,b]),e.jsxs($.div,{className:N("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex flex-1 origin-center snap-y snap-proximity scroll-pt-[30px] overflow-y-auto overscroll-contain scroll-smooth [scrollbar-gutter:stable]",!b&&u&&!m&&"pt-4",l==="bottom"&&!b?"flex-col-reverse":"flex-col"),animate:m?"modelPickerOpen":b?"vanguardModelPickerClosed":"modelPickerClosed",transition:Cs,variants:xf,ref:f,children:[(!m||b)&&d!=="model-picker-only"&&e.jsx(sc,{clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:a,resetReasoningLevel:c,shouldShowModelPicker:u,setIsModelPickerOpen:h,isModelPickerOpen:m,showAccountPaymentModal:Xe}),e.jsx(be,{children:m&&u&&e.jsx(hf,{clientThreadId:t,setIsModelPickerOpen:h,ref:x,currentModelId:r,onModelSelection:i,closePopover:p})})]})},Sf=({clientThreadId:t,layoutMode:s,currentModel:n,category:a,type:o,...r})=>{const{data:i}=ts(),l=pe(j=>j.threads[t]?.modelSelection)?.type===xe.SPECIFIC,p=pe(j=>j.setThreadModelSelection),d=Fs(),u=qt(),m=g.useMemo(()=>{const j=n?.id??"";return nc(j)?"low":oc(j)?"medium":ac(j)?"high":"low"},[n?.id]),h=ic(),f=Et(),x=g.useCallback(j=>{pt(t,p,{type:xe.EFFORT_MODE,effortMode:lt[j]}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const L=Ha(j,i?.categories.map(O=>O.defaultModel)??[]);L&&(d&&j==="high"?Xe(u,"Model picker upsell"):f({location:"PromptTextarea",modelId:L}))})})},[t,f,u,d,i,p]),b=j=>{const L=n?.id??"";j&&(k.logEvent("Model Switcher Model Changed",{from:L,to:j,source:"popover"}),Vm.logEvent("chatgpt_model_switcher_model_changed",j,{from:L,to:j,source:"popover"}),f({modelId:j,location:"Model switcher menu item"}),j!==cc&&uc({type:xe.SPECIFIC,modelSlug:j}),pt(t,p,{type:xe.SPECIFIC,modelSlug:j}))},y=!rc(n?.id??""),C=l||y,A=(a?.label&&a?.label?.length<10?a?.label:a?.shortLabel)??n?.title??"",E=n?.id??"",_=()=>{x("low")},I=g.useCallback(()=>{const{reasoningLevelList:j}=h,O=(j.findIndex(S=>S.type===m)+1)%j.length;x(j[O].type)},[x,m,h]);return g.useEffect(()=>Wm(lc,{cycleReasoningLevel:I}),[I]),e.jsxs(Xn,{layoutMode:s,...r,children:[e.jsx(Vi,{children:e.jsx(df,{isManualModelSelection:C,modelName:A,animatedLabel:!0,reasoningLevelTypes:h,reasoningLevelType:m,onResetReasoningLevel:_,onReasoningLevelChanged:x,type:o})}),e.jsx(Jn,{align:"start",children:e.jsx(bf,{clientThreadId:t,reasoningLevelTypes:h,reasoningLevelType:m,onReasoningLevelChanged:x,modelName:A,isManualModelSelection:C,currentModelId:E,onModelSelection:b,resetReasoningLevel:_})})]})},$i=({className:t,children:s})=>e.jsx($.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function vf({canContinue:t,onContinueGenerating:s}){const n=g.useCallback(o=>{s(o),dn()},[s]);let a=null;return t&&(a=e.jsx(Cf,{onHandleContinueGenerating:n})),a&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:a})}function yf({className:t}){return e.jsx(dc,{className:N("-rotate-180",t)})}const Cf=({onHandleContinueGenerating:t})=>e.jsx($i,{children:e.jsx(Oe,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:yf,size:"small",children:e.jsx(F,{...oe.continueGenerating})})}),wf=({clientThreadId:t})=>{const s=ji(),n=de(t,te.getRequestId),a=de(t,te.getCurrentLeafId),o=_i(n),{layer:r}=Je("1368081792"),i=s?.name?()=>{switch(s.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":bc(a);break}}:void 0,{value:c}=ie("3612584454");g.useEffect(()=>{o&&!(s?.name==="gpt-4l"&&c)&&la.dismissBanner()},[o,s?.name,c]);const l=s?.is_dismissible?()=>{k.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!r.get("should_change_model_picker",!0)&&s?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":s?.name}),la.dismissBanner()}:void 0,p=()=>{switch(s?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":yc({interactedInPeriod:!0});break}};return e.jsx(be,{children:s&&e.jsx($.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Di,{clientThreadId:t,rateLimitInfo:s,onDismiss:l,onInteract:p,onMount:i})})})};function kf(t,s,n,a,o,r,i,c,l,p,d){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(C=>C.model_slug==="o3-mini-high")||n.id==="o3-mini-high")||c&&i&&rn(Date.now(),i)<Yo)return!1;const m=a==null||rn(Date.now(),a)>=Sc,h=o===p,f=i==null||r==null||rn(Date.now(),i)>=Yo||r<vc;if(!(m&&f||h))return!1;switch(t.name){case"deep-research-in-context-upsell":return d("should_show_deep_research_upsell_banner",!1);case"o3-mini-high-in-context-upsell-free":return d("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return d("should_show_o3_mini_high_upsell_banner_plus_user",!1);default:return!1}}function _f(t){const s=$m(),n=mc(t),a=de(t,te.getRequestId),o=de(t,te.getCurrentLeafId),r=_i(a),i=ji(),c=pc(f=>f.lastSeenInContextUpsellBannerAt),l=fc(f=>f.inContextUpsellBannerPeriodExposureCount),p=gc(f=>f.inContextUpsellBannerPeriodStartAt),d=hc(f=>f.inContextUpsellBannerLastSeenId),u=xc(f=>f.inContextUpsellBannerInteractedInPeriod),{layer:m}=Je("1368081792");let h=!1;switch(i?.name){case null:case void 0:h=!1;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":h=kf(i,s,n,c,d,l,p,u,r,o,m.get);break;default:h=!0}return!r&&h}const bn=window.sessionStorage,Sn=qm(Ym(()=>({memoryFullBannerDismissed:!!bn?.getItem(Pt.MemoryFullBannerDismissed)}))),qi={dismissBanner(){Sn.setState(t=>{t.memoryFullBannerDismissed=!0}),bn?.setItem(Pt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Sn.setState(t=>{t.memoryFullBannerDismissed=!1}),bn?.removeItem(Pt.MemoryFullBannerDismissed)}};function jf(t){const s=Ai(t),n=Cc(),{data:a}=wc(s,!1,n),o=a!=null,r=o&&a.memoryFullPct>=100,[i,c]=g.useState(!1);g.useEffect(()=>{!r&&o&&(c(!0),qi.clearDismissedBanner())},[r,o]);const l=Sn(p=>p.memoryFullBannerDismissed);return r&&i&&!l}function Af(){const t=K(),{openSettings:s}=kc();return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Ua,{title:t.formatMessage(ys.memoryFullTitle),content:t.formatMessage(ys.memoryFullTooltip,ys.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ys.memoryManageButton),onPrimaryCtaClick:()=>s(_c.Personalization),onDismiss:()=>qi.dismissBanner()})})}const ys=Te({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories wont be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:jc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Mf=()=>{const{shouldShowSkipButton:t}=Ac();return t?e.jsx($i,{className:"flex justify-center",children:e.jsx(Oe,{as:"button",color:"secondary",onClick:()=>Mc.skipParagen(),children:e.jsx(F,{...Rf.skip})})}):null},Rf=Te({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Pf=qn(()=>Yn(()=>import("./nwcojmzvycgkk8y5.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),Yi=g.memo(function({className:s}){const{store:n}=je(),a=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:N(s??"absolute start-0 end-0 bottom-full",Tc.PromptTextareaHeader),children:e.jsx(Rc,{shouldRender:a,contentArea:$t.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Ef,{}),e.jsx(Tf,{})]})})})});function Ef(){const{store:t}=je(),s=t.useSharedProps(c=>c?.clientThreadId),n=t.useContentAreaId($t.HeaderTop),a=Pc(),o=de(s,c=>c?.modelId),r=Ec.useStore();let i;switch(n){case T.ProjectConversationTaskNoFileAccess:i=e.jsx(Df,{});break;case T.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(Xc,{clientThreadId:s});break;case T.S09KM1:i=null;break;case T.ParagenControls:i=e.jsx(Mf,{});break;case T.BannerSignup:i=e.jsx(If,{});break;case T.BannerTermsDisclaimer:i=e.jsx(Lf,{});break;case T.PromptTextareaAction:i=e.jsx(Ff,{});break;case T.BannersRateLimit:i=e.jsx(Of,{});break;case T.BannerSidekickAnnouncement:i=e.jsx(Qc,{});break;case T.SearchBrowserExtensionAnnouncement:i=e.jsx(Kc,{});break;case T.MoonshineAnnouncement:i=e.jsx(Yc,{});break;case T.CustomizeChatGPTAnnouncement:i=e.jsx(qc,{});break;case T.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx($c,{});break;case T.BannerMemoryFull:i=e.jsx(Af,{});break;case T.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case T.JawboneAnnouncement:a?i=e.jsx(Pf,{}):i=null;break;case T.JawboneMaxActiveAnnouncement:a?i=e.jsx(Vc,{}):i=null;break;case T.PromoRedemptionAnnouncement:i=e.jsx(Wc,{});break;case T.OperatorAnnouncement:i=e.jsx(zc,{});break;case T.BannerPlusUpsell:i=e.jsx(Gc,{});break;case T.ContextualAnswersAdminUpsell:i=e.jsx(Uc,{});break;case T.ContextualAnswersUserUpsell:i=e.jsx(Hc,{});break;case T.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(Oc,{});break;case T.RefereeRedemptionAvailableAnnouncement:i=e.jsx(Fc,{});break;case T.ReferralProgramUpsellAnnouncement:i=e.jsx(Lc,{});break;case T.StudentsUpsellAnnouncement:i=e.jsx(Dc,{});break;case T.ModelDeprecationBanner:i=Ic(o);break;case T.TeamsContextualAnswersUpsell:i=e.jsx(Bc,{});break;case T.LanguageUpsellBanner:i=e.jsx(Nc,{onDismissSideEffect:()=>{k.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),r.closeBanner()},onPrimaryCtaClickSideEffect:()=>{k.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),r.closeBanner()}});break;default:i=null;break}return i}function Tf(){const{store:t}=je(),s=t.useContentAreaId($t.HeaderBottom);let n;switch(s){case Ga.DallePromptControls:n=e.jsx(Bf,{});break;default:n=null;break}return n}const Nf=qn(()=>Yn(()=>import("./j5uw87upfwtjavqn.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function Bf(){const{store:t}=je(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Nf,{composerController:s}):null}function If(){const{store:t}=je(),s=t.useSharedProps(o=>o?.clientThreadId),n=Is(),a=Jc();return s?n?e.jsx(Zc,{threadId:s,showSignUp:a}):e.jsx(eu,{threadId:s,showLogin:a}):null}function Df(){return g.useEffect(()=>()=>{un.getItem(Pt.TasksHasSeenProjectDisclaimerBanner)||un.setItem(Pt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(Ua,{icon:e.jsx(tu,{}),title:e.jsx(F,{id:"ibX3g7",defaultMessage:"Tasks cant access project files"}),content:e.jsx(F,{id:"fm94Tm",defaultMessage:"Theres a task in this conversation  just FYI, it wont be able to access project files."}),onDismiss:()=>{un.setItem(Pt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Lf(){const{store:t}=je(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(su,{threadId:s}):null}function Ff(){const{store:t}=je(),s=t.useSharedProps();return s?e.jsx(vf,{...s}):null}function Of(){const{store:t}=je(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(wf,{clientThreadId:s}):null}const Hf=5,Uf=g.memo(function(s){return Gf(s),zf(s),Wf(),null});function Gf(t){const{store:s}=je(),n=s.useSetSharedProps();Es(()=>{n(t)},[t,n])}function zf(t){const{clientThreadId:s,canContinue:n}=t,{store:a}=je(),o=g.useRef({top:a.useContentAreaApi($t.HeaderTop),bottom:a.useContentAreaApi($t.HeaderBottom)}).current,r=nu(s),{shouldShowBannerSignup:i,shouldShowBannerTermsDisclaimer:c}=Vf(s),l=_f(s),p=ou(t),d=au(t),u=Na(),m=iu(),h=ru(t),f=jf(s),x=lu(),b=cu(t),y=uu(s),C=du(s),w=mu(),{eligible:A}=_e(_u),E=pu(),_=fu(),I=gu(),j=hu(),L=xu(s),O=bu(s),S=Su(),z=vu(s),M=yu(s),U=Cu(s),q=de(s,B=>B?.modelId),W=Zt(s);Es(()=>{q&&W?.kind===Ee.GizmoInteraction&&W.gizmo&&ju(q,W.gizmo)?o.top.set(T.ProjectConversationTaskNoFileAccess):b.eligible?o.top.set(T.AdvancedVoiceOnMobileAnnouncement):x?o.top.set(T.ParagenControls):c?o.top.set(T.BannerTermsDisclaimer):l?o.top.set(T.BannersRateLimit):S?o.top.set(T.BannerPlusUpsell):z?o.top.set(T.ContextualAnswersAdminUpsell):M?o.top.set(T.ContextualAnswersUserUpsell):y?o.top.set(T.JawboneAnnouncement):C?o.top.set(T.JawboneMaxActiveAnnouncement):p.eligible?o.top.set(T.BannerSidekickAnnouncement):u?o.top.set(T.MoonshineAnnouncement):m?o.top.set(T.CustomizeChatGPTAnnouncement):d?o.top.set(T.SearchBrowserExtensionAnnouncement):h?o.top.set(T.SearchBrowserExtensionReactiveAnnouncement):w?o.top.set(T.PromoRedemptionAnnouncement):A?o.top.set(T.OperatorAnnouncement):I?o.top.set(T.ReferralProgramUpsellAnnouncement):n?o.top.set(T.PromptTextareaAction):i?o.top.set(T.BannerSignup):f?o.top.set(T.BannerMemoryFull):E?o.top.set(T.ReferrerRedemptionAvailableAnnouncement):_?o.top.set(T.RefereeRedemptionAvailableAnnouncement):j?o.top.set(T.StudentsUpsellAnnouncement):L?o.top.set(T.ModelDeprecationBanner):O?o.top.set(T.TeamsContextualAnswersUpsell):U?o.top.set(T.LanguageUpsellBanner):o.top.set(null)},[o,n,c,i,l,p,f,x,b]),Es(()=>{r&&o.bottom.set(Ga.DallePromptControls)},[o,r])}function Wf(){const{store:t}=je();g.useEffect(()=>()=>{t.reset()},[t])}function Vf(t){const{isUnauthenticated:s}=ve(),{layer:n}=Je("3637408529",{shouldLogExposure:!1}),{layer:a}=Je("3637408529"),o=a.get("no_auth_banner_signup_rate_limit",Hf),r=n.get("should_show_no_auth_signup_banner",!0),i=wu(u=>u.bannerDisclaimerClientThreadId),c=ku(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[p,d]=de(t,u=>[te.getConversationTurns(u).filter(m=>m.role===Mi.User).length,$f(te.getCurrentNode(u)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=d&&s&&p===1&&!c&&(i==null||i===t),l.shouldShowBannerSignup=r&&d&&s&&p>0&&p%o===0),l}function $f(t){return t?.author.role===Mi.Assistant&&Km(t)}const Ki=({serverThreadId:t,clientThreadId:s,getIsDisabled:n,composerController:a,onReset:o,onInfer:r})=>{const[i,c]=g.useState(!1),{isAutoSwitcherEnabled:l,inferenceDebounceTime:p}=xt(),d=Qm(),u=g.useRef(null),m=Au(({enableInferredJuice:C})=>C),h=l||m,f=g.useRef(r);f.current=r;const x=g.useRef(0),b=g.useRef(0),y=g.useCallback(za(C=>{if(n())return;const w=++x.current,A=Date.now();c(A);const E=Ue(s),_=te.getCurrentNode(E);Ri.postAnonAware("/conversation/infer",{prompt:C,conversation_id:t??null,is_history_and_training_disabled:d,parent_message_id:_.message.id},{additionalHeaders:{"x-conduit-token":u.current??""}}).then(I=>{if(u.current=I.conduit_token,n()||b.current>w||a.getContentToSend().content.length<C.length)return;b.current=w;const{juice:j}=I;f.current(j)}).finally(()=>{c(I=>I&&A<I?I:!1)})},p),[n]);return g.useEffect(()=>{if(!(!h||!(a instanceof Ns)))return a.subscribe("change",()=>{const{content:C}=a.getContentToSend();n()||!h||(C?y(C):(u.current=null,o(),c(!1),++x.current,b.current=x.current))})},[h,n,a,y,r,o,t,d]),i!==!1},Ts=D.PictureV2,qf=["o1","o3-mini","o3-mini-high","o1-pro","gpt-4.5","gpt-4-5"];function Yf({clientThreadId:t,composerController:s,currentModelConfig:n,currentModelConfigLoading:a,disableIfNoAccess:o}){const r=es(),[i]=Ma(),c=et()?.planType,l=de(t,_=>Mu(r,t,_,i,c)),{value:p}=ie("2868048419"),u=null!=null;let m=Zt(t);const h=m==null||m?.kind===Ee.PrimaryAssistant,{isUnauthenticated:f}=ve(),x=!f,b=n?.enabledTools?.includes(Vn.ImageGen),y=Xm(),C=!!y,w=b&&!a&&l&&!qf.includes(l),A=x&&p&&!u&&h;return!ki(D.PictureV2)||!(A&&(w||o))?null:e.jsx("div",{"data-testid":"system-hint-picture_v2",style:{viewTransitionName:`var(--vt-composer-${Ts}-action)`},children:e.jsx(Kf,{clientThreadId:t,composerController:s,disabled:!!o&&!w||C,imageGenFeatureBlock:y})},`system-hint-${Ts}`)}function Kf({clientThreadId:t,composerController:s,disabled:n,imageGenFeatureBlock:a}){const r=Wa(s)===Ts,i=K(),c=Ii(i),l=i.formatMessage({id:"rh3NHv",defaultMessage:"Create image"}),p=i.formatMessage({id:"Uh+8Ls",defaultMessage:"Visualize ideas and concepts"}),{clearAllSystemHintModeTriggers:d}=Se(),u=x=>{x.stopPropagation(),x.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{d(),r?s.removeSystemHints():s.addSystemHint(Ts,l),s.focus()})}),s.setAutocompletions(c),r?k.logEventWithStatsig("Composer Think Button Disabled","composer_create_image_button_disabled",{clientThreadId:t}):k.logEventWithStatsig("Composer Think Button Enabled","composer_create_image_button_enabled",{clientThreadId:t})},m=e.jsx(ss,{pressed:r,icon:e.jsx(Ru,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:u,disabled:!!n,dataTestid:"composer-button-create-image"}),h=a?.title??p,f=a?.description??void 0;return e.jsx(tt,{className:"inline-block",sideOffset:0,label:h,secondaryLabel:f,side:"bottom",onOpenChange:x=>{x&&k.logEventWithStatsig("Composer Create Image Button Hovered","composer_create_image_button_hovered",{clientThreadId:t})},children:m})}function Qi({clientThreadId:t,getInputProps:s,openFileDialog:n,uploadType:a,icon:o,isDisabled:r=!1,isSmall:i=!1,showLabel:c=!1,showUpsell:l=!1,hideBorder:p=!1,highlightTooltip:d=!1,disabledReason:u,currentModelName:m}){const h=K(),f=Hs();r=(r||!!f)&&!l;const x=e.jsxs(Ia,{disabled:r,$showLabel:c,$hideBorder:p,$isSmall:i,onClick:C=>{if(C.preventDefault(),l){k.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}k.logEvent("Open File Viewer",{intent:a.toString()}),n()},"aria-label":r?u===Fe.ModelNotSupported?h.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${m}`}):u===Fe.ThinkModeInUse?h.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):u===Fe.SearchModeInUse?h.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):h.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):h.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[o,c&&e.jsx(Da,{})]}),b=e.jsx("input",{disabled:r,...s({className:"hidden"})}),y=e.jsxs("div",{className:"flex",children:[x,b]});return l?e.jsx(tt,{sideOffset:0,label:e.jsx(F,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:d||void 0,children:e.jsx(Jm,{triggerButton:y,sideOffset:0,alignOffset:0,children:e.jsx(_n,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Ui,{disabled:r,clientThreadId:t,rateLimitPopup:f,highlightTooltip:d,children:y})}function Qf({code:t,message:s}){switch(t){case Ko.FileTooLarge:return fa.errorFileTooLarge;case Ko.TooManyFiles:return k.logEvent("Uploaded Max Files Error"),fa.errorTooManyFiles;default:return s}}const fa=Te({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),ga=Te({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Xf(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function uh(t){const{className:s,children:n,clientThreadId:a,currentModelConfig:o,noKeyboard:r}=t,i=K(),c=Dt(),l=Zt(a),p=Xt(),d=js(o,l,p),u=d!==ct.None,m=mn(_=>_.files),h=(d===ct.Multimodal?Mn:Rn)-m.length,f=h<=0,{getGizmoId:x}=Pn(),{handleFileAccepted:b}=eo(i,d,Tn(o,l),"drag",x,En(o,l)?.attachments),y=Hs(),C=Nn(Bn(o,l)),{getRootProps:w,isDragActive:A}=In({maxFiles:h,disabled:!u||f||y!=null,noClick:!0,noKeyboard:r,onDropAccepted:b,onDropRejected:_=>Zn(_,i,c,d),multiple:!0,maxSize:Dn,...C}),E=Xf(C);return e.jsxs("div",{...w({className:s}),children:[n,A&&e.jsxs(Jf,{children:[e.jsx(Pu,{}),e.jsx("h3",{children:e.jsx(F,{...ga.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:E.length>0?E.join(", "):e.jsx(F,{...ga.dragAllAccepted})})]})]})}function Zn(t,s,n,a){const{errors:o}=t[0];o.forEach(r=>{const i=Qf(r);typeof i=="string"?n.danger(i,{hasCloseButton:!0}):n.danger(s.formatMessage(i,{size:Eu,maxNum:a===ct.Multimodal?Mn:Rn}),{hasCloseButton:!0})})}function eo(t,s,n,a,o,r){const i=es(),c=Pi(i).flags,l=Dt(),p=Ln(),d=Va(),{isUnauthenticated:u}=ve(),m=c?.includes(Ps.NoAuthEnableFileUploads);return{handleFileAccepted:g.useCallback(async(f,x)=>{k.logEvent("Upload File",{client:"web",eventSource:a,intent:s.toString()}),d.fileUploadAccepted();const b=o!=null?await o():void 0;f.length>0&&f.forEach(y=>{ws.uploadFile(p,Tu(y),y,s,n,t,l,{gizmoId:b,...m&&{isUnauthenticated:u}},r)})},[a,s,o,p,d,n,t,l,r,m,u])}}const Jf=Gn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Xi=t=>{const s=[];s.push({category:null,systemHints:t.filter(n=>!n.category)});for(const n of Zm)s.push({category:n,systemHints:t.filter(a=>a.category===n)});return s};function Ji({composerController:t,clientThreadId:s,onHintSelected:n}){const a=Ei(s),[o]=de(s,M=>[M?.modelId]),{data:r}=ts(),i=o??Nu(void 0).id,c=$a(r?.models,i),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:p}=Se(),{viewableSystemHints:d,persistedSystemHints:u}=Qe.useState(({availableHints:M,persistedSystemHints:U})=>({viewableSystemHints:M,persistedSystemHints:U})),[m,h]=g.useState([]),[f,x]=g.useState(void 0),[b,y]=g.useState(0);g.useEffect(()=>{if(!f)h([]);else{const M=f.text.toLocaleLowerCase(),U=d.filter(W=>{const B=W.name.toLocaleLowerCase().startsWith(M),G=W.systemHint.toLocaleLowerCase().startsWith(M);let R=!1;return W.regexMatches&&W.regexMatches.length>0&&(R=W.regexMatches.some(Y=>Y.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(M))),B||G||R}).filter(W=>W.requiredFeatures.every(B=>c?.enabledTools?.includes(B))),q=Xi(U).map(W=>W.systemHints).flat();h(q)}},[f]),g.useEffect(()=>{t.view.dispatch(xl(t.view.state.tr,{onHintMatch(M){x(U=>ep(U,M)?U:M)}}))},[t]);const C=!d.length||!m.length||!f;g.useEffect(()=>{y(0)},[C]);const w=m.length,A=g.useCallback(M=>{y(U=>(M(U)%w+w)%w)},[w]),E=g.useCallback(()=>{y(-1)},[]),_=m[b],I=g.useCallback(()=>{f?.range&&t.delete(f.range.from,f.range.to)},[f,t]),j=({hintToSave:M=_,expectPerfectMatch:U})=>{if(!f||!_||U&&M.name.toLowerCase()!==f.text.toLowerCase())return!1;k.logEvent("System Hint Selected",{system_hint:M.systemHint,conversation_id:a??gn});const q=f.range.from===1?M.name:f.text+M.name.slice(f.text.length),W={clientThreadId:s};Ss(t.view),u.size>0&&p();const B=!!M.composerBarButtonInfo,G=M.systemHint===D.Search;return B||G?(l(M.systemHint,!0,W,G?Bu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),I(),t.removeSystemHints(),!0):(t.addSystemHint(M.systemHint,q,f.range.from,f.range.to),!0)},L=g.useRef(j);L.current=j;const O=g.useRef(A);O.current=A;const S=g.useRef(f);S.current=f;const z=t.view;return g.useEffect(()=>(C||bl(z,M=>{if(M==="up")O.current(U=>U-1);else if(M==="down")O.current(U=>U+1);else if(M==="cancel")Ss(z),Sl(z);else if(M==="submit")if(n)I(),n(_.systemHint);else return Ss(z),L.current({expectPerfectMatch:!1});else if(M==="checkMatch")return L.current({expectPerfectMatch:!0})}),()=>Ss(z)),[C,z,_,n,I]),g.useEffect(()=>{C||k.logEvent("System Hint List Opened",{conversation_id:a??gn})},[C]),{suggestorClosed:C,systemHintSuggestions:m,hintMatch:f,selectedIndex:b,resetSelectedIndex:E,setSelectedIndex:y,saveHint:j}}function Zf({composerController:t,clientThreadId:s}){const{selectedIndex:n,systemHintSuggestions:a,suggestorClosed:o,setSelectedIndex:r,saveHint:i}=Ji({composerController:t,clientThreadId:s});return o?null:e.jsx(tp,{className:"max-w-60",onMouseDown:c=>{c.preventDefault()},children:a.map((c,l)=>e.jsx("div",{onMouseOver:()=>r(l),onClick:()=>{i({hintToSave:c,expectPerfectMatch:!1}),t.focus()},children:e.jsx(sp,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:l===n,children:e.jsx(Zi,{title:c.name,description:c.description,logo:c.logo})})},c.systemHint))})}function Zi({title:t,description:s,logo:n,checked:a,badge:o}){const r=K();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Wn,{svgString:n,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,o&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":r.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(F,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),a&&e.jsx(Ti,{className:N("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function ha({composerController:t,clientThreadId:s}){return t instanceof Ns?e.jsx(Zf,{composerController:t,clientThreadId:s}):null}function er({children:t,className:s,showBackground:n,showGlowingBorder:a}){return e.jsxs("div",{className:N("relative",a&&"overflow-clip rounded-full p-0.5"),children:[t,a&&e.jsx("div",{className:"border-glowing-gradient"}),n&&e.jsx($.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:N("pointer-events-none absolute inset-0 rounded-full",s)})]})}const eg=({showUnconnectedInSubmenu:t,unconnectedConnectors:s,handleOauthRedirect:n,handleConnectorClick:a,showOneDriveInSubmenu:o,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d,unconnectedOneDriveConnectors:u})=>{const[m,h]=g.useState("main"),f=m!=="main",x=K(),b=g.useRef(null),y=Ze();return g.useEffect(()=>{f?document.getElementById("vanguard-file-picker-popover-submenu-back-button")?.focus():b.current&&b.current.focus()},[f]),e.jsx("div",{className:N("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 215px)] flex flex-1 snap-y snap-proximity flex-col overflow-y-auto scroll-smooth py-2 [scrollbar-gutter:stable] focus-visible:rounded-[inherit] focus-visible:-outline-offset-1"),ref:b,tabIndex:0,children:e.jsxs(be,{mode:"wait",children:[e.jsx($.div,{className:"flex flex-col",transition:y?ue:gt,children:m==="main"&&e.jsx(tg,{showUnconnectedInSubmenu:t,unconnectedConnectors:s,setActiveMenu:h,handleConnectorClick:a,showOneDriveInSubmenu:o,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d})},"main"),f&&e.jsxs($.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:y?ue:gt,className:"flex flex-col",children:[e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b px-3 py-3",children:[e.jsx("button",{onClick:()=>h("main"),id:"vanguard-file-picker-popover-submenu-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Fa,{className:"text-token-text-secondary h-5 w-5","aria-label":""})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:x.formatMessage({id:"LlLQYj",defaultMessage:"Back"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[m==="connect-apps"&&e.jsx(Iu,{connectorEntries:s,onOauthRedirect:n}),m==="one-drive"&&e.jsx(Du,{connectorEntries:u,onOauthRedirect:n})]})]},m)]})})};function tg({showUnconnectedInSubmenu:t,unconnectedConnectors:s,showOneDriveInSubmenu:n,setActiveMenu:a,handleConnectorClick:o,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d}){const u=K();return e.jsxs(e.Fragment,{children:[t&&s.length>0&&e.jsx(mt,{label:u.formatMessage(xa.connectApps),icon:qa,isSubMenuTrigger:!0,onClick:()=>a("connect-apps")},"connect-apps-submenu-trigger"),!t&&s.map(m=>e.jsx(As,{entry:m,onClick:()=>o(m),visualTreatment:"vanguard"},m.id)),n&&e.jsx(mt,{label:u.formatMessage(xa.oneDriveSubmenuName),icon:Lu,isSubMenuTrigger:!0,onClick:()=>a("one-drive")},"one-drive-submenu-trigger"),r&&e.jsx(mt,{icon:e.jsx(zn,{className:"text-token-text-secondary"})}),(s.length>0||r)&&e.jsx(Oa,{}),i.map(m=>e.jsx(As,{entry:m,onClick:()=>o(m),visualTreatment:"vanguard"},m.id)),c.map(m=>e.jsx(Ya,{entry:m,visualTreatment:"vanguard"},m.key)),e.jsx(Ka,{modelSupportedImageMimeTypes:l,visualTreatment:"vanguard"}),e.jsx(Qa,{handleLocalFileUploadClick:d,showMenuForNoAuth:p,visualTreatment:"vanguard"})]})}const xa=Te({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"},oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),sg=({layoutMode:t,triggerButton:s,restoreFocus:n,...a})=>e.jsxs(Xn,{layoutMode:t,restoreFocus:n,children:[s,e.jsx(Jn,{align:"start",children:e.jsx(eg,{...a})})]});function ng(){const{connectorConfig:t}=Xa(),s=Fn(),n=On(),[a,o]=Ms(Ja([...t.values()],d=>!!d.access_token),d=>!!d.access_token),[r,i]=Ms(o,d=>d.type===Ke.O365_PERSONAL||d.type===Ke.O365_BUSINESS),c=!s&&!n&&a.length>0,l=!s&&!n&&!c&&r.length>1;return{unconnectedConnectors:n?[]:l?i:o,showUnconnectedInSubmenu:c,showOneDriveInSubmenu:l}}function og({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:r,uploadType:i,getInputProps:c,openFileDialog:l,isDisabled:p=!1,highlightTooltip:d=!1,showLabel:u,isSmall:m=!1,hideBorder:h=!1,disabledReason:f,currentModelName:x,visualTreatment:b="vanguard",showMenuForNoAuth:y=!1,showGlowingBorder:C=!1,layoutMode:w="centered",restoreFocus:A}){const E=np().locale,_=K(),I=Dt(),j=Ln(),{connectorConfig:L,isLoading:O}=Xa(),S=_e(ce.ContextConnectors),{getGizmoId:z}=Pn(),{value:M}=ie("58345806"),U=M&&b==="vanguard",[q,W]=g.useState();g.useEffect(()=>{z?z().then(H=>W(H)):W(void 0)},[z]);const B=g.useRef(null),[G,R]=g.useState(!1),Y=g.useRef(!1),re=g.useCallback(()=>{const H=B.current?.files;Array.from(H??[]).forEach(Ce=>zt.uploadFile(j,Ce,a,_,I,o))},[j,a,_,I,o]),[Ae,se]=g.useState(null),Ne=g.useCallback(()=>se(null),[se]),Be=g.useCallback((H,Ce)=>zt.uploadPickedFile(j,H,Ce,a,n,o,q,_,I),[j,a,n,o,q,_,I]),{openMenu:ye,confirmMenuOpened:fe}=La();g.useEffect(()=>{ye&&(R(!0),fe())},[ye,fe,R]);const le=g.useCallback(H=>{zt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,H,r,ca.Picker),r()},[r]),P=g.useCallback(H=>{zt.uploadPickedFile(j,H,Ke.GDRIVE,a,n,o,q,_,I)},[j,a,n,o,q,_,I]),Z=g.useCallback(async H=>{const{access_token:Ce}=H;if(!Ce){le(H);return}switch(zt.logAttemptIfAccessTokenIsExpired(H,ca.Picker),H.type){case Ke.GDRIVE:Fu(E,H.type,Ce,Lt=>Lt.forEach(P));break;case Ke.O365_PERSONAL:case Ke.O365_BUSINESS:se(H.type);break}},[P,le,se,E]),ae=()=>{k.logEvent("Open File Viewer",{intent:i.toString()}),l()},bt=H=>{if(!H&&Y.current&&!O)ae();else if(H&&J&&!O&&!y){ae();return}R(H),H&&(S.eligible&&S.markAsViewed(),k.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),Y.current=!0,setTimeout(()=>{Y.current=!1},250))},[ne,st]=Ms(Ja([...L.values()],H=>!!H.access_token),H=>!!H.access_token);ag(ne,Z);const[nt]=Ms(st,H=>H.type===Ke.O365_PERSONAL||H.type===Ke.O365_BUSINESS),{unconnectedConnectors:ge,showUnconnectedInSubmenu:Me,showOneDriveInSubmenu:Ie}=ng(),{desktopConnectors:St}=Ou(a),J=!ne.length&&!ge.length&&!St.length,De=e.jsxs(e.Fragment,{children:[Me&&ge.length>0&&e.jsx(Hu,{connectorEntries:ge,onOauthRedirect:H=>le(H)}),!Me&&ge.map(H=>e.jsx(As,{entry:H,onClick:()=>Z(H)},H.id)),Ie&&e.jsx(Uu,{connectors:nt,onOauthRedirect:le}),O&&e.jsx(Pe.Item,{icon:e.jsx(zn,{className:"text-token-text-secondary"})}),(ge.length>0||O)&&e.jsx(Pe.Separator,{}),ne.map(H=>e.jsx(As,{entry:H,onClick:()=>Z(H)},H.id)),St.map(H=>e.jsx(Ya,{entry:H},H.key)),e.jsx(Ka,{modelSupportedImageMimeTypes:a}),e.jsx(Qa,{handleLocalFileUploadClick:ae,showMenuForNoAuth:y})]}),Ge=U?e.jsx(zi,{clientThreadId:t,icon:s,isDisabled:p,highlightTooltip:d,showLabel:u,hideBorder:h,isSmall:m,disabledReason:f,currentModelName:x,visualTreatment:b,isLoading:O,handleLocalFileUploadClick:ae,noAvailableConnectors:J,showMenuForNoAuth:y,announcement:S}):e.jsx(pf,{clientThreadId:t,icon:s,setOpen:bt,open:G,isDisabled:p,highlightTooltip:d,showLabel:u,hideBorder:h,isSmall:m,disabledReason:f,currentModelName:x,visualTreatment:b,showGlowingBorder:C}),ze=U?e.jsx(sg,{layoutMode:w,triggerButton:Ge,showUnconnectedInSubmenu:Me,unconnectedConnectors:ge,handleOauthRedirect:le,handleConnectorClick:Z,showOneDriveInSubmenu:Ie,isConnectorConfigLoading:O,connectedConnectors:ne,desktopConnectors:St,modelSupportedImageMimeTypes:a,showMenuForNoAuth:y,handleLocalFileUploadClick:ae,unconnectedOneDriveConnectors:nt,restoreFocus:A}):e.jsxs(Pe.Root,{open:G,onOpenChange:bt,children:[Ge,e.jsx(Pe.Portal,{children:e.jsx(Pe.Content,{alignOffset:-16,side:"top",children:De})})]}),vt=e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Gu,{type:Ae,onClose:Ne,uploadPickedFile:Be}),e.jsx("input",{onChange:re,...c({className:"hidden"})}),ze,e.jsx(zu,{hasConnectors:!O&&!J})]});return{dropdownItems:De,mainComponent:vt}}function ag(t,s){const{connector:n,clearParam:a}=Wu(),o=t.find(r=>r.type===n&&!!r.access_token);g.useEffect(()=>{o&&(s(o),a())},[o,s,a])}function tr(t){const{mainComponent:s}=og(t);return s}function ig({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:r,openFileDialog:i,onOauthRedirect:c,historyDisabled:l,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m,showLabel:h,showUpsell:f,hideBorder:x,isSmall:b,showMenuForNoAuth:y,visualTreatment:C,showGlowingBorder:w}){const A=On(),{gdriveStatus:E,o365Status:_}=Za(),{isUnauthenticated:I}=ve(),j="h-[18px] w-[18px]",L=l?"text-white":d?"text-brand-blue-800":"",S=!f&&(y||E!=="false"||_!=="false"||A)?e.jsx(tr,{showGlowingBorder:w,hideBorder:x,isSmall:b,clientThreadId:t,icon:I?e.jsx(Rs,{"aria-label":"",className:N(j,L)}):e.jsx(Ta,{"aria-label":"",className:N(j,L)}),showLabel:I&&h,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:c,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m,showMenuForNoAuth:y,visualTreatment:C}):e.jsx(Qi,{isSmall:b,hideBorder:x,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:h,showUpsell:f,icon:e.jsx(Rs,{"aria-label":"",className:N(j,L)}),isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m});return e.jsx("div",{className:"relative",children:e.jsx(er,{showBackground:d,showGlowingBorder:w,className:"bg-brand-blue-800/20",children:S})})}function sr({suggestionData:t,visualTreatment:s,composerController:n}){const a=K(),r=a.formatMessage(oe.researchSuggestionInitial),i=g.useMemo(()=>[a.formatMessage(oe.deepResearchPlaceholderBullet1),a.formatMessage(oe.deepResearchPlaceholderBullet2),a.formatMessage(oe.deepResearchPlaceholderBullet3)],[a]);return e.jsx(Vu,{composerController:n,visualTreatment:s,initialSuggestion:r,bulletPoints:i})}const Tt={type:"spring",stiffness:48.7,damping:13.54,mass:1};function rg({enabled:t,children:s,...n}){const a=Ze();return e.jsxs($.div,{initial:{minHeight:0},animate:{minHeight:t?"142px":0},exit:{minHeight:0},transition:a?ue:Tt,className:"flex flex-col justify-start",children:[s,t&&e.jsx(sr,{...n})]})}const lg=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:a,searchPlaceholder:o,handleSelectItem:r,showConfigureRepos:i,showSelectAllRepos:c})=>{const l=$u(),p=a?.includes("$all_accessible_repos");return e.jsx($.div,{variants:l,initial:"initial",animate:"animate",exit:"exit",className:"relative",children:e.jsxs("div",{className:"border-token-border-default bg-token-main-surface-primary flex max-h-60 w-full flex-col gap-2 overflow-y-auto rounded-lg border p-2",children:[e.jsx("input",{type:"text",value:s,onChange:d=>n(d.target.value),placeholder:o,className:"text-token-text-primary bg-token-main-surface-primary w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden"}),t?.map(d=>{const u=a?.includes(d.name);return e.jsx(mt,{onClick:()=>{r(d)},isSelected:u,isActive:u,label:d.name,subtitle:d.description??void 0,className:"mx-0! w-full"},d.name)}),c&&e.jsx(mt,{onClick:()=>{r({name:"$all_accessible_repos"})},className:"mx-0! w-full",isSelected:p,isActive:p,label:e.jsx(F,{id:"pJnTxe",defaultMessage:"All Repositories"}),subtitle:e.jsx(F,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"})},"select-all-repos"),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(mt,{onClick:()=>{window.open(qu,"_blank")},isSelected:!1,isActive:!1,label:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yu,{className:"icon-sm"}),e.jsx(F,{id:"8W+hV0",defaultMessage:"Configure Repos"})]}),subtitle:e.jsx(F,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),className:"mx-0! w-full"},"configure-repos")]})]})})},cg=({searchTerm:t,setSearchTerm:s,selectedRepos:n,handleSelectRepo:a,setRepoSelectorOpen:o,allowMultiSelect:r,showConfigureRepos:i=!1})=>{const c=Dt(),l=K(),{data:p}=fl({queryKey:["github-repos"],queryFn:()=>Ri.safePost("/tasks/get_github_repos",{}).catch(()=>c.danger("Request error fetching Github repositories"))}),d=p?.repos?.filter(m=>{const h=t.toLowerCase();return m.repository_full_name.toLowerCase().includes(h)||m.description?.toLowerCase().includes(h)}),u=m=>{a(m.name,m.name==="$all_accessible_repos"),r||o(!1)};return e.jsx(lg,{showConfigureRepos:i,items:d?.map(m=>({name:m.repository_full_name,description:m.description}))??[],searchTerm:t,setSearchTerm:s,selectedItems:[...n.selectedRepos??[],...n.selectedAllRepos?["$all_accessible_repos"]:[]],searchPlaceholder:l.formatMessage({id:"lo7uaF",defaultMessage:"Search repos"}),handleSelectItem:u,showSelectAllRepos:!0})};function ug({clientThreadId:t,selected:s,isVanguard:n,onToggle:a,repoSelectorOpen:o,setRepoSelectorOpen:r}){const{selectedRepos:i,setSelectedRepos:c}=Hn(t),l=K(),[p,d]=g.useState(""),{triggerRef:u,container:m}=op({isOpen:o,onClose:()=>r(!1)}),h=(x,b)=>{if(b)c({selectedRepos:[],selectedAllRepos:!i?.selectedAllRepos});else if(i?.selectedRepos?.includes(x)){const y=i.selectedRepos?.filter(C=>C!==x);c({selectedRepos:y,selectedAllRepos:!1})}else{const y=[...i?.selectedRepos??[],x];c({selectedRepos:y,selectedAllRepos:!1})}};let f=e.jsx(F,{id:"eC2vew",defaultMessage:"GitHub"});return i?.selectedAllRepos?f=e.jsx(F,{id:"scEauJ",defaultMessage:"All Repositories"}):i?.selectedRepos?.length&&i?.selectedRepos?.length>=1&&(f=i?.selectedRepos?.join(", ")),e.jsx(Yt,{open:o,onOpenChange:r,children:e.jsx(Ls,{children:e.jsxs("div",{className:N("inline-flex min-h-8 items-center rounded-full text-sm font-medium transition-colors focus:outline-hidden",s?"border-token-border-default bg-token-main-surface-primary border":n?"text-token-text-secondary":"text-token-text-tertiary",n?"":"border-token-border-default border"),children:[e.jsxs("button",{type:"button","aria-pressed":s,onClick:x=>{x.stopPropagation(),x.preventDefault(),a()},className:"flex items-center gap-1 px-2 py-1",children:[e.jsx(Ku,{"aria-hidden":!0,className:N("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter")}),e.jsx("span",{children:f}),s&&e.jsx($n,{className:"text-token-text-tertiary h-4 w-4"})]}),s&&e.jsx(ft,{asChild:!0,ref:u,children:e.jsx("button",{type:"button","aria-label":l.formatMessage({id:"eoO5dY",defaultMessage:"Select repository"}),className:"border-token-border-default border-s p-1",onClick:()=>{r(!o)},children:e.jsx(Qu,{className:"h-3 w-3"})})}),o&&e.jsx(Kt,{forceMount:!0,container:m,children:e.jsx(Qt,{side:"bottom",align:"start",children:e.jsx(cg,{searchTerm:p,setSearchTerm:d,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:h,setRepoSelectorOpen:r,allowMultiSelect:!0,showConfigureRepos:!0})})})]})})})}function to(){const t=Xu().has(D.Research),s=ie("3544641259")?.value;return t&&s}function ba({label:t,selected:s,onClick:n,Icon:a,isVanguard:o,iconColor:r}){return e.jsxs("button",{type:"button","aria-pressed":s,onClick:i=>{i.stopPropagation(),i.preventDefault(),n()},className:N("flex min-h-8 items-center gap-1 rounded-full px-2 py-1 text-sm font-medium transition-colors",s?"border-token-border-default bg-token-main-surface-primary border":o?"text-token-text-secondary":"text-token-text-tertiary",o?"":"border-token-border-default border"),children:[e.jsx(a,{"aria-hidden":!0,className:N("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter",r||"text-token-text-primary")}),e.jsx("span",{children:t}),s&&e.jsx($n,{className:"text-token-text-tertiary h-4 w-4"})]})}const nr=({clientThreadId:t,isVanguard:s=!1})=>{const{selectedSources:n,toggleSource:a,deleteSource:o}=ei(t),[r,i]=g.useState(!1),{selectedRepos:c}=Hn(t),{isGdriveActionConnectorEnabled:l,isGitHubLinkEnabled:p}=Ju(),{connectorLinks:d}=Zu(),u=d.get(Qo[ua.GDRIVE_ACTION_CONNECTOR]),m=d.get(Qo[ua.GITHUB_CONNECTOR]),h=!!u,f=!!m,x=b=>{window.location.assign(`#settings/ConnectorSettings${b?`?scroll=${b}`:""}`)};return g.useEffect(()=>{!r&&!c?.selectedRepos?.length&&!c?.selectedAllRepos&&o(it.GitHub)},[t,n,r,c,o]),!t||!n?null:e.jsxs("div",{children:[e.jsx("div",{className:"border-token-border-xlight absolute inset-x-[15px] top-0 h-0 border-t"}),e.jsx("div",{className:N("z-0 w-full p-3","bg-token-main-surface-primary dark:bg-[#303030]"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[!s&&e.jsx("span",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(F,{id:"dyMo44",defaultMessage:"Sources"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(ba,{label:e.jsx(F,{id:"G03bJa",defaultMessage:"Web"}),selected:n.has(it.Web),onClick:()=>a(it.Web),Icon:ed,iconColor:"text-blue-400",isVanguard:s}),p&&e.jsx(ug,{clientThreadId:t,selected:n.has(it.GitHub)&&f,onToggle:()=>{f?(!c?.selectedRepos?.length&&!c?.selectedAllRepos&&i(!0),a(it.GitHub)):x("github-connector")},repoSelectorOpen:r,setRepoSelectorOpen:i,isVanguard:s}),l&&e.jsx(ba,{label:e.jsx(F,{id:"m4j0Bv",defaultMessage:"Drive"}),selected:n.has(it.GoogleDrive)&&h,onClick:()=>h?a(it.GoogleDrive):x("gdrive-connector"),Icon:ti,isVanguard:s})]})]})})]})};function dg(){const t=Ze(),a={initial:{opacity:0,y:"-28px",rotate:45},animate:{opacity:1,y:0,rotate:45,transition:t?ue:{opacity:{delay:.4},default:Tt}},exit:{opacity:0,y:"-28px",rotate:45,transition:t?ue:{opacity:{delay:0},default:Tt}}};return e.jsx($.div,{variants:a,initial:"initial",animate:"animate",exit:"exit",className:"border-token-border-xlight bg-token-main-surface-primary absolute start-1/2 top-full mt-[11px] h-2 w-2 -translate-x-1/2 transform rounded-se-[1px] rounded-es-[1px] border-s border-t dark:bg-[#303030]"})}const so=.0025;function no({composerController:t,composerType:s,renderInComposer:n,composerRightButtonType:a,layoutMode:o}){const r=ut(t.store,b=>b.controlsDisabled),i=Nt(),{isUnauthenticated:c}=ve(),l=s==="vanguard"&&i&&!c,p=td(b=>{b.contentRect&&t.setWaveWidth(b.contentRect.width)}),d=g.useCallback(b=>{if(!(t instanceof Ns))return;const y=t.getSelectionStart();t.setControlsDisabled(!1),requestAnimationFrame(()=>{const{state:C,dispatch:w}=t.view;w(C.tr.insertText(b,y,y)),requestAnimationFrame(()=>{t.setSelection(y+b.length)}),t.usedDictation=!0})},[t]),u=()=>{t.setControlsDisabled(!0)},m=e.jsx(Xo,{size:"small",onExit:u,buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:l,disableTooltip:l}),h=b=>{b.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})};let f;if(l)if(a===sd.SPEECH){const b=ap.getBooleanCookie(ip.LastVoiceInteraction)??!1,y=C=>b?e.jsx(e.Fragment,{children:n?.(l,C)}):e.jsx(Xo,{...C,size:"small",onExit:u,buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:!0,disableTooltip:!0});f=e.jsx(od,{layoutMode:o??"centered",onDictationExit:u,renderVoiceButton:y,restoreFocus:h})}else f=e.jsx(e.Fragment,{children:n?.()});else f=e.jsxs(e.Fragment,{children:[m,n?.()]});return{whisperControls:r?e.jsx(nd,{initialValue:so,onSuccess:d,onWaveformDataUpdate:t.setWaveformData,onExit:()=>{t.setControlsDisabled(!1)},buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}):f,waveContainerRef:p,handleTranscriptionSuccess:d}}const or=({composerController:t,placeholder:s,vanguard:n})=>{const a=g.useRef(null),o=g.useRef(null),{isMobileOS:r}=ad(),i=g.useRef(!1);return g.useEffect(()=>{if(i.current)return;if(!(t instanceof Ns))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);i.current=!0;const c=o.current;if(c!=null){const{value:l,selectionStart:p,selectionEnd:d}=c;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(Ip.create(t.view.state.doc,p+1,d+1))),c.style.display="none",c.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=id,t.view.dom.dataset.virtualkeyboard="true",rd(t.view.dom),!si()&&!rp()&&requestAnimationFrame(()=>{t.view.focus()})},[t]),g.useEffect(()=>{t.setPlaceholder(s)},[s,t]),g.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,onKeyDown:ld.prefetch,className:N([cd["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto [scrollbar-width:thin]",lp()?"firefox":"default-browser"],n&&"min-h-12 pe-3"),children:[e.jsx("textarea",{className:N("text-token-text-primary placeholder:text-token-text-tertiary block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 ring-0 placeholder:ps-px"),autoFocus:!r,placeholder:s,ref:o,"data-virtualkeyboard":!0}),e.jsx(ud,{scriptSrc:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},mg=g.forwardRef(function({type:s,placeholder:n,replyRegions:a,state:o,renderFiles:r,leftSideActions:i,topRightAction:c,onSubmit:l,setIsComposerOverflowing:p,inputState:d,composerController:u,clientThreadId:m,gizmoId:h,disableReason:f,matchaData:x},b){const y=dd();let C=null;const{isLoading:w}=y;w||(C=y.modelId),g.useEffect(()=>{w||si()||u.focus()},[C,u,w]);const{value:A}=ie("3780975974"),{state:E,shouldShowResearchText:_}=Os(m),I=g.useCallback(()=>e.jsx(ni,{useStartButtonText:E==="clarify"||!1,inputState:d,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:h,disableReason:f}),[d,o,l,u,m,h,f,x,E]),{whisperControls:j,waveContainerRef:L}=no({composerController:u,renderInComposer:I,composerType:"legacy"}),{controlsDisabled:O,waveformData:S,waveWidth:z}=ut(u.store),{getShowUpsellReason:M}=oi(),U=A||M(),q=B=>{pg({target:B.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||u.focus()},W=to();return e.jsxs(ai,{id:"composer-background",ref:b,className:N("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:q,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(be,{initial:!1,children:a.length>0&&e.jsx($.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(ii,{replyRegions:a})})})}),e.jsxs(e.Fragment,{children:[r,e.jsx(be,{initial:!1,children:e.jsx(rg,{enabled:_,composerController:u,visualTreatment:"legacy",children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:L,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:O?S?e.jsx(ri,{waveform:S,containerWidth:z,scaleFactor:10,initialValue:so}):null:e.jsx(or,{composerController:u,placeholder:n})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:B=>{if(!U||!("ResizeObserver"in window))return;let G=new AbortController,R=window.innerWidth;const Y=pn({axis:"width",debounce:!0,target:B,onChange:()=>{if(!B)return;B.scrollWidth>B.clientWidth?p?.(!0):Math.abs(R-window.innerWidth)>40&&(p?.(!1),R=window.innerWidth)}});return()=>{Y?.(),G.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:i}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:j})]})]})]}),e.jsx(be,{children:W&&e.jsx(nr,{clientThreadId:m})})]})});function pg({target:t,rootId:s,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const fg=["o3-mini","o3-mini-high","o1-pro"],gg=[D.Search,D.Research],hg=({composerController:t,clientThreadId:s,hideThinkButton:n,disableIfNoAccess:a})=>{const{prospectiveModelId:o}=Jt(s),{activeSystemHints:r,isLoading:i}=Bs(s),c=ie("2868048419"),l=pe(A=>A.isVisuallyOverflowing),{showLegacyReasoningSlider:p,hideSearchInSystemHintOverflow:d,hideReasonInSystemHintOverflow:u}=xt(),m=r.filter(A=>d&&A.systemHint===D.Search||u&&A.systemHint===D.Think?!0:l&&p?A.systemHint!==D.Think&&!A.composerBarButtonInfo&&!gg.includes(A.systemHint):!A.composerBarButtonInfo&&A.systemHint!==D.Search&&(!c||A.systemHint!==D.PictureV2)&&(!n||A.systemHint!==D.Think)),h=Wa(t),f=Ra(t,s),x=o&&fg.includes(o),b=m.length===0&&!i||x;if(!a&&b)return null;const y={clientThreadId:s};function C(){k.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",y)}function w(){k.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",y)}return e.jsx(xg,{systemHints:m,selectedHint:h,disabled:!!b,onHover:C,onOpen:w,onSelect:f})},xg=({systemHints:t,selectedHint:s,disabled:n,onHover:a,onOpen:o,onSelect:r})=>{const i=K(),[c,l]=g.useState(!1),p=t.find(u=>u.systemHint==="contextual_answers")?.name,d=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-9 w-full rounded-md"}),e.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-9 w-full rounded-md"})]}):e.jsx(e.Fragment,{children:t.map(u=>e.jsx(Pe.Item,{className:"px-1 py-2",onClick:()=>r?.({hint:u,enable:u.systemHint!==s}),children:e.jsx(Zi,{title:u.name,description:u.description,logo:u.logo,checked:u.systemHint===s,badge:u.systemHint===D.PictureV2})},u.systemHint))});return e.jsxs(Pe.Root,{open:c,onOpenChange:u=>{l(u),u&&o?.()},children:[e.jsx(bg,{disabled:!!n,contextualAnswersHintNameIfPresent:p,children:e.jsx(cp,{className:N(md.toolsButton,"border-token-border-default text-token-text-secondary radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary flex h-9 min-w-9 items-center justify-center rounded-full border p-1 text-xs font-semibold focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"data-opened":Sg(c),"aria-label":i.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:n,onPointerOver:a,onClick:u=>{u.preventDefault()},onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(pd,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(Pe.Portal,{children:e.jsx(Pe.Content,{alignOffset:-16,onCloseAutoFocus:u=>{u.preventDefault()},children:d})})]})},bg=({disabled:t,children:s,contextualAnswersHintNameIfPresent:n})=>{const a=_e(ce.hasSeenComposerSystemHintButtonTooltip),o=_e(ce.hasSeenCaSystemHint),r=!t&&!a.isLoading&&a.eligible,i=!t&&!a.isLoading&&n&&!o.isLoading&&o.eligible,c=r?{announcementKey:ce.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(F,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:a.markAsViewed,description:e.jsx(F,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:i?{announcementKey:ce.hasSeenCaSystemHint,title:e.jsx(F,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:o.markAsViewed,description:e.jsx(F,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"font-bold whitespace-nowrap",children:'"/'+n+'"'})}})}:void 0;return c?e.jsx(An,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...c,children:s}):e.jsx(tt,{side:"top",sideOffset:0,label:t?e.jsx(F,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(F,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Sg(t){return t?"":null}const vg=({clientThreadId:t})=>{const{setThreadSystemHintMode:s}=Se(),n=window.location.search;g.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){s(D.ContextualAnswers,!0,{clientThreadId:t});const o=new URLSearchParams(window.location.search);o.delete("enable-internal-knowledge");const r=o.toString();window.history.replaceState({},document.title,`${window.location.pathname}${r?`?${r}`:""}`)}},[n,t,s])},yg=({connectionStatuses:t,clientThreadId:s})=>{const{eligible:n,markAsViewed:a}=_e(ce.hasSeenContextualAnswerGoogleSyncFinished),o=K(),{setThreadSystemHintMode:r}=Se(),i=Sd(t),c=vd({exposed:i&&n})==="notification",l=g.useRef(!1);g.useEffect(()=>{n&&c&&i&&!l.current&&(k.logEvent("Contextual Answers User Fully Synced Notification"),yd({id:"contextual-answers-sync-done",title:e.jsxs("span",{className:"flex items-center justify-between",children:[o.formatMessage({id:"GkdUMV",defaultMessage:"Google Drive is ready to search"}),e.jsx(Ti,{className:"icon-md text-black"})]}),subtitle:e.jsx(Oe,{className:"text-caption-regular mt-1 rounded-xs",color:"secondary",size:"xs",children:e.jsx(F,{id:"Y8PQkV",defaultMessage:"Try now"})}),clientThreadId:"WEB:",icon:ti,onClick:()=>{r(D.ContextualAnswers,!0,{clientThreadId:s})},timeout:60*1e3}),l.current=!0,a())},[c,s,n,i,o,a,r])},Cg=({composerController:t,systemHint:s,clientThreadId:n,connectionStatuses:a})=>{const o=Nt(),r=s.systemHint,i=Bt(r);if(yg({connectionStatuses:a,clientThreadId:n}),vg({clientThreadId:n}),!s.composerBarButtonInfo)return null;const c=a.some(l=>l.user_connection_details.activation_status==="partially_activated"||l.user_connection_details.activation_status==="activated");return e.jsx(Yp,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:n,isDisabled:!1,showLabel:o,dropdownContent:c?void 0:e.jsx(Sa,{}),splitButtonDropdownContent:c&&i?e.jsx(Sa,{}):void 0,dataTestid:fd,tooltipPosition:"top",disableNuxMarkdown:!0})},Sa=()=>{const{connectionInstanceData:t,isLoading:s}=li(),n=g.useMemo(()=>[...t?.connection_statuses??[]].sort(gd),[t]),a=n.some(o=>o.user_connection_details.activation_status==="activating"||o.user_connection_details.activation_status==="partially_activated"||o.user_connection_details.activation_status==="inactive"&&o.user_connection_details.auth_status==="user_connected");return g.useEffect(()=>{k.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),s?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Dp,{lines:4,size:"lg"})}):e.jsx(be,{children:e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:[e.jsx("div",{className:"text-token-text-tertiary px-2 py-2 text-sm font-medium",children:e.jsx(F,{id:"gkeRrW",defaultMessage:"Internal knowledge"})}),n.map(o=>e.jsx("div",{className:"px-2 py-3",children:e.jsx(hd,{title:o.connection_display_info.display_name,description:xd({activationStatus:o.user_connection_details.activation_status,authStatus:o.user_connection_details.auth_status}),icon:e.jsx("img",{src:o.connection_display_info.icon_url??"",alt:o.connection_display_info.display_name,className:"icon-lg"}),statusIndicator:e.jsx(bd,{connection:o})})},o.user_connection_details.connection_instance_id)),e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(Oe,{color:"ghost",className:"w-full rounded-xl px-2 py-3",contentsFullWidth:!0,as:"link",to:"#settings/ConnectorSettings",children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx("div",{className:"icon-lg",children:e.jsx(qa,{})}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:a?e.jsx(F,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(F,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})})},wg=({onRemoveThink:t})=>{const s=K();return e.jsxs(Wi,{as:"div",role:"button",onClick:n=>{n.stopPropagation(),n.preventDefault(),t()},tabIndex:0,spacing:"compact",isSelected:!0,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Ba,{className:"icon-md text-token-interactive-label-accent-default flex-1","aria-label":""}),e.jsx("span",{children:s.formatMessage({id:"8y4FP9",defaultMessage:"Think"})}),e.jsx(ci,{"data-remove-think-button":!0,className:"-me-1","aria-label":s.formatMessage({id:"AD7lkL",defaultMessage:"Disable reasoning mode"})})]})},va=48,ya=32,kg="/c/:conversationId",_g=({isNewThread:t,clientThreadId:s,isTemporaryChat:n,placeholder:a,composerController:o,children:r,isExpandedByDefault:i=!1,onSubmit:c})=>{let l=null,p=null,d=[],u=[],m=null,h=[],f=null;g.Children.forEach(r,P=>{if(g.isValidElement(P))if(P.type===Rg){if(m!=null)throw new Error("PromptTextareaComposer only accepts a single app stack");m=P}else if(P.type===ar){if(l!=null)throw new Error("PromptTextareaComposer only accepts a single submit button");l=P}else if(P.type===Pg){if(p!=null)throw new Error("PromptTextareaComposer only accepts a single header action");p=P}else P.type===vn||P.type===ir?d.push(P):P.type===rr?u.push(P):P.type===yn?h.push(P):P.type===lr&&(f=P)});const{shouldShowResearchText:x}=Os(s),b=Bt(D.ContextualAnswers)&&!!t,y=!1,C=Cd(),w=ui({exposed:b})==="bigbox",A=C&&(x||y)||w&&b,E=g.useRef(null),_=g.useRef(null),{waveContainerRef:I}=no({composerController:o,composerType:"vanguard"}),{controlsDisabled:j,waveformData:L,waveWidth:O}=ut(o.store),S=pe(P=>P.isExpanded),z=pe(P=>P.setIsExpanded),M=g.useRef(!1),U=Ze(),q=g.useSyncExternalStore(P=>{const Z=o.subscribe("focus",P),ae=o.subscribe("blur",P);return()=>{ae(),Z()}},()=>o.isFocused(),()=>!1),W=P=>{if(P.target instanceof HTMLElement){if(P.target.dataset.historyItemLink||P.target.parentElement?.dataset.historyItemLink)return!0;const Z=P.target?.closest("a[href]");if(Z instanceof HTMLAnchorElement)return!!gl({path:kg,end:!1},new URL(Z.href).pathname)}return!1};g.useEffect(()=>{if(!M.current)return o.subscribe("input",()=>{M.current=!0})},[o]),g.useEffect(()=>{i&&z(!0),q&&!S&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{z(!0)})})},[q,S,i,z]);const B=pe(P=>P.isVisuallyOverflowing),G=g.useRef(B);Es(()=>{G.current=B},[B]);const R=pe(P=>P.setIsVisuallyOverflowing),Y=g.useRef(null),re=P=>{const Z=ae=>{i||M.current||P?.contains(ae.target)||W(ae)||z(!1)};return document.addEventListener("click",Z),Y.current=P,()=>{document.removeEventListener("click",Z)}},Ae=P=>{P.preventDefault(),c(P)},se=d.length>0,Ne=u.length>0,[Be,ye]=g.useState(0),fe=24,{showLegacyReasoningSlider:le}=xt();return e.jsxs("form",{ref:re,className:"w-full [view-transition-name:var(--vt-composer)]",onSubmit:Ae,"data-type":"unified-composer",children:[e.jsxs(Ag,{isTemporaryChat:n,clientThreadId:s,isNewThread:!!t,children:[e.jsxs($.div,{transition:U?ue:Cs,className:"relative flex w-full flex-auto flex-col",children:[h.length>0&&e.jsx("div",{className:"mb-4 flex flex-col gap-2",children:h}),e.jsxs("div",{className:"relative ms-1.5 grid grid-cols-[auto_minmax(0,1fr)]",children:[e.jsx("div",{className:"items-top flex justify-center",children:e.jsx($.div,{initial:{opacity:S?1:0},animate:{opacity:S?1:0},exit:{opacity:0},transition:U?ue:gt,children:p})}),e.jsx($.div,{initial:{marginBottom:-20,translateX:S?0:ya},onPointerDown:P=>P.stopPropagation(),animate:{translateX:S?0:ya},style:{translateY:-7},transition:U?ue:Cs,className:"relative flex-auto bg-transparent ps-2 pt-0.5",children:e.jsxs(jg,{composerController:o,enabled:A,children:[e.jsx("div",{className:"flex min-h-12 items-start",ref:I,children:e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:j?L?e.jsx(ri,{waveform:L,containerWidth:O,scaleFactor:10,initialValue:so}):null:e.jsx(or,{composerController:o,placeholder:a,vanguard:!0})})}),C&&x?e.jsx(sr,{composerController:o,visualTreatment:"vanguard"}):w&&b?e.jsx(wd,{composerController:o,visualTreatment:"vanguard"}):null]})})]}),e.jsx("div",{className:"justify-content-end relative ms-2 flex w-full flex-auto flex-col",children:e.jsx("div",{className:"flex-auto"})}),e.jsx($.div,{initial:{height:S&&se?va:0},animate:{height:S&&se?va:0},transition:U?ue:Cs})]}),(se||!!l)&&e.jsx("div",{className:N("bg-primary-surface-primary absolute start-[17px] end-0 bottom-[9px] z-2 flex items-center"),children:e.jsxs("div",{className:"w-full",children:[se&&S&&e.jsx("div",{"data-testid":"composer-footer-actions",className:N("max-xs:gap-1 flex items-center gap-2 overflow-x-auto [scrollbar-width:none]",!le&&B&&"[--force-hide-label:none]"),ref:P=>pn({debounce:!0,target:P,axis:"width",onChange:({width:Z})=>{P&&(G.current?G.current&&E.current!==null&&Z>=E.current&&R(!1):_.current!==null&&Z<_.current?R(!0):(E.current=P.scrollWidth,R(P.scrollWidth>P.clientWidth)))}}),style:{marginRight:`${Be+fe}px`},children:d}),e.jsxs("div",{className:"absolute end-3 bottom-0 flex items-center gap-2","data-testid":"composer-trailing-actions",ref:P=>pn({target:P,axis:"width",onChange:({width:Z})=>{ye(Z)}}),children:[Ne&&e.jsx("div",{className:"relative ms-1",children:u}),l]})]})}),e.jsx("div",{className:"absolute start-4 top-3 ms-[1px] flex items-center pb-px",children:e.jsx(be,{children:!S&&m})})]}),e.jsxs(Yt,{open:!!f,children:[e.jsx(Ls,{className:"w-full"}),e.jsx(Kt,{children:e.jsx(Qt,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:P=>P.preventDefault(),children:f})})]})]})};function jg({composerController:t,children:s,enabled:n}){const a=Ze();return e.jsx($.div,{initial:{minHeight:0},animate:{minHeight:n?"142px":0},exit:{minHeight:0},transition:a?ue:Tt,className:"flex flex-col justify-start",onClick:o=>{t.isFocused()?o.preventDefault():t.focus()},children:s})}function Ag({children:t,isTemporaryChat:s,clientThreadId:n,isNewThread:a}){const o=to();return e.jsxs(ai,{className:N("border-token-border-default flex w-full cursor-text flex-col items-center justify-center rounded-[28px] border bg-clip-padding contain-inline-size","overflow-clip shadow-sm sm:shadow-lg dark:shadow-none!",s?"dark bg-[#303030]":"bg-token-main-surface-primary dark:bg-[#303030]"),children:[e.jsx("div",{className:"relative flex w-full items-end px-3 py-3",children:t}),e.jsx(Mg,{children:o?e.jsx(nr,{clientThreadId:n,isVanguard:!0}):null})]})}const Mg=({children:t})=>{const s=Ze(),o={initial:{opacity:0,height:0,y:"-28px"},animate:{opacity:1,y:0,height:"56px",transition:s?ue:{opacity:{delay:.2},default:Tt}},exit:{opacity:0,y:"-28px",height:0,transition:s?ue:{opacity:{delay:0},default:Tt}}};return e.jsx(be,{children:t&&e.jsx($.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"relative w-full",children:t})})},Rg=({children:t})=>e.jsx($.div,{onPointerDown:s=>{s.stopPropagation(),s.preventDefault()},children:t}),ar=({children:t})=>e.jsx("div",{className:"ms-auto flex items-center gap-1.5",onPointerDown:s=>s.stopPropagation(),children:t}),ir=({children:t})=>t?e.jsx(e.Fragment,{children:t}):null,vn=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),rr=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),lr=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),Pg=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),yn=({children:t,width:s="full"})=>e.jsx("div",{className:N(s==="fit"?"w-fit":"w-full"),onPointerDown:n=>n.stopPropagation(),children:t});function Eg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:r,openFileDialog:i,onOauthRedirect:c,historyDisabled:l,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m,showLabel:h,showUpsell:f,hideBorder:x,isSmall:b,visualTreatment:y,layoutMode:C,restoreFocus:w}){const A=On(),{gdriveStatus:E,o365Status:_}=Za(),I="h-[20px] w-[20px]",j=l?"text-white":d?"text-brand-blue-800":"",L=f?e.jsx(Rs,{"aria-label":"",className:N(I,j)}):e.jsx(Rs,{"aria-label":"",className:N(I,j)}),O=(E!=="false"||_!=="false"||A||y==="vanguard")&&!f,S=up(),z=y==="vanguard"&&!S,M=O?e.jsx(tr,{hideBorder:x,isSmall:b,clientThreadId:t,icon:L,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:c,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:z?!1:p,highlightTooltip:d,disabledReason:u,currentModelName:m,visualTreatment:y,layoutMode:C,restoreFocus:w}):e.jsx(Qi,{isSmall:b,hideBorder:x,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:h,showUpsell:f,icon:L,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m});return e.jsx("div",{className:"relative",children:e.jsx(er,{showBackground:d,className:"bg-brand-blue-800/20",children:M})})}const Tg=({clientThreadId:t,currentModel:s,uploadType:n,modelSupportedImageMimeTypes:a,modelAcceptedMimeTypes:o,modelProductFeatures:r,getEditorGizmoId:i,onOauthRedirect:c,disabledReason:l,isTemporaryChat:p,isDisabled:d,highlightTooltip:u,showLabel:m,showUpsell:h,numRemainingFiles:f,visualTreatment:x,layoutMode:b,restoreFocus:y})=>{const C=K(),w=Dt(),{handleFileAccepted:A}=eo(C,n,a,"mouse",i,r?.attachments),{getInputProps:E,open:_}=In({disabled:d,noClick:!0,onDropAccepted:A,onDropRejected:I=>Zn(I,C,w,n),multiple:!0,maxSize:Dn,maxFiles:f,...Nn(o)});return e.jsx(Eg,{isSmall:!0,hideBorder:!0,isDisabled:d,highlightTooltip:u,onOauthRedirect:c,visualTreatment:x,attachmentsProductFeature:r?.attachments,clientThreadId:t,uploadType:n,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,getInputProps:E,openFileDialog:_,historyDisabled:p,showLabel:m,showUpsell:h,disabledReason:l,currentModelName:s?.title??"",layoutMode:b,restoreFocus:y})},Ng=({activeSystemHint:t,showHints:s,showContextChevron:n,onRemoveHint:a,lockSystemHint:o})=>{const r=K(),{popoverTriggerRef:i}=It(),c=()=>{requestAnimationFrame(()=>{i.current?.focus()})};if(t){const{logo:l,name:p}=t;return e.jsxs("div",{className:N("relative flex items-center justify-center",!o&&"-me-1"),children:[e.jsx(Wn,{className:"icon-md text-token-interactive-label-accent-default flex-1",svgString:l}),!o&&e.jsx(ci,{"data-remove-hint-button":!0,onClick:d=>{d.stopPropagation(),d.preventDefault(),a(),c()},"aria-label":r.formatMessage({id:"YQ7uOV",defaultMessage:"Remove {tool} from selection"},{tool:p})}),n&&e.jsx(dg,{})]})}return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-border-default ms-0.5 h-[16px] w-[1px]"}),e.jsx("div",{className:"text-token-text-tertiary hover:text-token-text-primary me-0.5 flex items-center",children:e.jsx(ks,{className:"text-token-text-tertiary hover:text-token-text-primary pointer-events-auto! h-4 w-4"})})]}):e.jsx(kd,{"aria-label":r.formatMessage({id:"xosz07",defaultMessage:"View all tools"}),className:"text-token-text-secondary h-5 w-5"})},Bg={source:{id:"SystemHintCategory.Sources",defaultMessage:"Sources",description:"Label on system hint menu for hints that act as data sources"},tool:{id:"SystemHintCategory.Tools",defaultMessage:"Tools",description:"Label on system hint menu for hints that act as tools"}},Ca=({children:t,clientThreadId:s,layoutMode:n,lockSystemHint:a,composerController:o,onChangeSystemHint:r,systemHints:i,activeSystemHintType:c,recentSystemHintTypes:l,showHints:p,reasonItem:d=!1,gizmoId:u,isInReasonMode:m,type:h,...f})=>{const x=to(),b=Ze(),y=K(),C=i.find(({systemHint:B})=>c===B),w=et(),A=l.map(B=>B===D.PictureV2&&!i.find(({systemHint:G})=>B===G)?i.find(({systemHint:G})=>G===D.Picture):i.find(({systemHint:G})=>B===G)).filter(B=>!!B),[E,_]=g.useState(null),I=(B,G)=>{G?_(B):r(B)},{selectedIndex:j,systemHintSuggestions:L,suggestorClosed:O,resetSelectedIndex:S}=Ji({composerController:o,clientThreadId:s,onHintSelected:r}),z=O?i:L,M=[],U=Xi(z);let q=0;for(const B of U){const G=B.systemHints;G.length!==0&&(M.push({...B.category?{message:Bg[B.category]}:{},systemHints:G,indexOffset:q}),q=G.length)}const W=()=>{o.setReasonMode(!m),m?k.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:s}):k.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:s})};return e.jsxs("div",{className:N("flex items-center rounded-full",p&&"me-1 border",c!==void 0?"border-transparent":h==="toolpile_icon"?"border-token-border-default":"border-token-border-xlight"),children:[!C&&p&&e.jsx(_d,{onChangeSystemHint:I,systemHints:A}),e.jsxs(Xn,{layoutMode:n,forceOpen:!O,...f,children:[t?e.jsx(Vi,{children:t}):e.jsx(gf,{transition:b?ue:gt,shape:c?"rectangle":"round",spacing:"compact",isSelected:c!==void 0,"aria-label":y.formatMessage({id:"NLd5mV",defaultMessage:"Open tool menu"}),className:N(p&&"-mx-0.5",a&&"cursor-default!",h==="config_icon"&&"min-w-9",h==="toolpile_icon"&&"min-h-9"),onClick:B=>{if(a){B.stopPropagation(),B.preventDefault();return}},tooltipLabel:!c&&y.formatMessage({id:"xgQfBi",defaultMessage:"View all tools"}),disableHover:p&&!C||a,isLegacyStyle:h==="config_icon"||h==="toolpile_icon"&&!!c,borderVisible:h==="config_icon"||h==="toolpile_icon"&&!!c,children:e.jsx(Ng,{activeSystemHint:C,showHints:p,showContextChevron:x||!1,onRemoveHint:()=>r(null),lockSystemHint:a})}),e.jsx(Jn,{onMouseDown:B=>{B.preventDefault()},align:"end",children:e.jsx(jd,{onChangeSystemHint:I,systemHintCategories:M,activeSystemHint:c,activeIndex:j,resetActiveIndex:S,reasonItem:d,gizmoId:u,clientThreadId:s,handleToggleReasonItem:W,isInReasonMode:m})})]}),!w||w.planType===dp.FREE&&e.jsx(Ad,{open:!!E,onOpenChange:()=>_(null),systemHint:E})]})},wa="gpt-4o",Ig=({clientThreadId:t,serverThreadId:s,composerController:n,pendingFiles:a,isUploadDisabled:o,highlightUploadTooltip:r,hasFiles:i,conversationMode:c,placeholder:l,isTemporaryChat:p,layoutMode:d,state:u,inputState:m,disableReason:h,gizmoId:f,currentModel:x,replyRegions:b,uploadButtonDisabledReason:y,keepExpanded:C=!1,getEditorGizmoId:w,onOauthRedirect:A,onSubmit:E,visualTreatment:_,legacyFooterActions:I,legacySuggestionsPopoverContent:j,isNewThread:L=!1,isInReasonMode:O})=>{const{data:S}=ts(),[z,M]=Jo(!1),{updateSystemHint:U}=Se(),{isAutoSwitcherEnabled:q,configurationMenuType:W}=xt();Fs();const B=Qe.useState(({persistedSystemHints:V})=>V);Md(t,_==="vanguard");const G=Array.from(B)[0],R=Qe.useState(({recentHints:V})=>V),{state:Y}=Os(t),re=Et(!1),Ae=pe(V=>V.threads[t]?.modelSelection),se=Ae?.type===xe.SPECIFIC,Ne=pe(V=>V.setThreadModelSelection),Be=_==="vanguard"&&q&&x?.id!==wa&&!se&&!z();di(g.useCallback(()=>{Be&&(re({location:"PromptTextarea",modelId:wa}),pt(t,Ne,{type:xe.EFFORT_MODE,effortMode:lt.low}))},[Be,re,t,Ne]));const ye=V=>{M(!0),U(V,{clientThreadId:t}),V&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.focus()})})},fe=!1,le=Y==="clarify"||fe,P=g.useCallback((V,We)=>e.jsx(ni,{...We,isSmall:_==="vanguard",inputState:m,state:u,onSubmit:E,composerController:n,clientThreadId:t,gizmoId:f,disableReason:h,useStartButtonText:le,disableTooltip:V}),[m,u,E,n,t,f,h,le,_]),Z=V=>{z()&&(V.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.focus()})}))},ae=Rd({inputState:m,state:u,composerController:n,clientThreadId:t,gizmoId:f}),{whisperControls:bt}=no({composerController:n,renderInComposer:P,composerType:_,composerRightButtonType:ae,layoutMode:d}),[ne=null,st,nt]=g.useMemo(()=>[En(x,c),Tn(x,c),Bn(x,c)],[x,c]);Bs(t);const ge=Qe.useState(({availableHints:V})=>V),Me=Qe.useState(({locked:V})=>V),Ie=g.useMemo(()=>Ae?.type===xe.EFFORT_MODE?Pd[Ae.effortMode]:"low",[Ae]),[St,J]=Jo(Ie);g.useEffect(()=>{J(Ie)},[Ie,J]);const De=(V,We=!1)=>{We||M(!0),J(V),pt(t,Ne,{type:xe.EFFORT_MODE,effortMode:lt[V],isManual:!We});const Ct=Ha(V,S?.categories.map(Us=>Us.defaultModel)??[]);Ed(Ct??Td[V]),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ct&&re({location:"PromptTextarea",modelId:Ct})})})};_e(ce.ModelPickerMoved);const Ge=jn(f),ze=Y!=="disabled"||fe||c?.kind===Ee.GizmoInteraction&&!Ge,vt=Ge;Ki({serverThreadId:s,clientThreadId:t,composerController:n,getIsDisabled:g.useCallback(()=>!!(z()||ze||vt||_!=="vanguard"||_==="vanguard"&&(se||G)),[z,_,ze,vt,se,G]),onReset:()=>{M(!1),se||De("low",!0)},onInfer:V=>{De(V,!0)}});const{pageType:H}=mi(),Ce=pi(V=>V.selectedApps),Lt=fi()&&Ce.length>0,yt=i||Lt,ns=C||!!G||b&&b.length>0||yt||ge.length<3;return js(x,c,B),e.jsxs(_g,{isNewThread:L,clientThreadId:t,isTemporaryChat:p,placeholder:l,visualTreatment:_,composerController:n,isExpandedByDefault:ns,onSubmit:E,children:[b&&b.length>0&&e.jsx(yn,{width:"full",children:e.jsx(ii,{replyRegions:b})}),yt&&e.jsx(yn,{width:"fit",children:e.jsx(fn,{files:a,selectedApps:Ce,className:"no-scrollbar -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})}),[I?.map((V,We)=>e.jsx(ir,{children:V},`legacy-footer-action-${We}`))??[],(W!=="none"&&e.jsx(vn,{children:e.jsx(Ca,{activeSystemHintType:G,lockSystemHint:H.type==="landing-page"||Me,systemHints:ge,clientThreadId:t,composerController:n,onChangeSystemHint:ye,layoutMode:d,recentSystemHintTypes:R,showHints:W==="toolpile_icon",gizmoId:f,reasonItem:!0,isInReasonMode:O,type:W})},"system-hint-popover"))??[],(W!=="none"&&O&&e.jsx(vn,{children:e.jsx(wg,{onRemoveThink:()=>{n.setReasonMode(!1),k.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.focus()})})}})},"think-button"))??[],e.jsx(lr,{children:j},"legacy-suggestions-popover")],_==="vanguard"&&e.jsx(rr,{children:e.jsx(Ca,{activeSystemHintType:G,lockSystemHint:H.type==="landing-page"||Me,systemHints:ge,clientThreadId:t,composerController:n,onChangeSystemHint:ye,layoutMode:d,recentSystemHintTypes:R,showHints:!L,isInReasonMode:O})},"system-hint-popover"),e.jsx(ar,{children:bt})]})},Dg=qn(()=>Yn(()=>import("./oq6n0ezffar2zqj9.js"),__vite__mapDeps([8,1,3,4,2,5,9,10,11,12,13,14,15])).then(t=>t.ImageGenComposer)),Lg=1,Fg=3e3;function Og({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:a,currentModelConfig:o,disableDraftPersistence:r=!1,modelCategories:i,areModelsLoading:c,clientThreadId:l,isNewThread:p,isCompletionInProgress:d,className:u,disabled:m=!1,disabledReason:h,canPause:f=!1,canContinue:x=!1,isInteractableSharedThread:b,onComposerInput:y,onComposerChange:C,onAutocompleteSelect:w,headerClassName:A,hideHeader:E,onTaggingDropdownOpen:_,onTaggingDropdownClose:I,onlyAllowImageUploads:j}){Zo.markStart("PromptTextarea"),Zo.markRendered("PromptTextarea");const L=es(),O=g.useRef(null),S=ht(),z=Va(),M=mp(z.showUploadSuggestion$),U=Nd(),q=n?.isFree(),W=n?.isTeam(),{isUnauthenticated:B}=ve(),G=K(),R=Dt(),Y=Ln(),re=Fs(),Ae=Bd.useStore(),[se,Ne]=de(l,v=>[te.getCurrentLeafId(v),te.getRequestId(v)]),[Be]=Ma(),{gizmoEditorData:ye,mode:fe,getGizmoId:le}=Pn(),P=pp(),Z=Nt(),ae=fp(),bt=Id(),ne=Ei(l),st=!!vi(),nt=!!wi(),ge=Dd.useIsEnabled(l),Me=!!Kn(),{setThreadSystemHintMode:Ie,clearAllSystemHintModeTriggers:St}=Se(),J=Xt(),{state:De}=Os(l),Ge=Bt(D.ContextualAnswers),ze=!1,vt=null,H=J.has(D.Search),Ce=J.has(D.Think),Lt=J.has(D.PictureV2),yt=_e(ce.ModelPickerMoved),ns=J.has(D.Research),{activeSystemHints:V}=Bs(l),We=V.length>0,Ct=V.find(v=>v.systemHint===D.ContextualAnswers),Us=Ld(),{connectionInstanceData:Gs,isLoading:ur}=li({skip:!Us}),dr=ui({exposed:Ge})==="bigbox",{selectedSources:oo}=ei(l),zs=g.useRef(0),Ws=g.useRef(!1),mr=i?.find(v=>v.defaultModel===a),pr=null;let X=Zt(l),Vs=X&&"gizmo"in X?X.gizmo:void 0;const fr=gp(),wt=Vs?.gizmo.id??fr,Ft=jn(wt),gr=Fd(),ao=Od(),[we,os]=g.useState(null);we!==null&&(X={gizmo:we,gizmo_id:we.gizmo.id,kind:Ee.GizmoInteraction},Vs=we);const Ot=js(o,X,J),hr=Hs(),io=Pi(L).flags,as=io?.includes(Ps.NoAuthEnableFileUploads),{isUXUpdatesEnabled:Le,showLegacyReasoningSlider:ot,showReasoningSliderNux:xr,reasoningSliderType:br,hideReasonInSystemHintOverflow:Sr,hideSearchInSystemHintOverflow:vr,configurationMenuType:yr}=xt(),Cr=Le&&J.size===0,is=pe(v=>v.setThreadModelSelection),ro=pe(v=>v.threads[l]?.modelSelection),lo=ro?.type===xe.EFFORT_MODE?ro.effortMode:null,$s=Un(L,"850280859")&&!Le&&[hp,xp.AUTO].includes(a),co=$s&&!!lo&&lo!==lt.low;di(g.useCallback(()=>{co&&pt(l,is,{type:xe.EFFORT_MODE,effortMode:lt.low})},[co,l,is])),Ki({serverThreadId:ne,clientThreadId:l,composerController:S,getIsDisabled:g.useCallback(()=>!$s,[$s]),onReset:()=>{pt(l,is,{type:xe.EFFORT_MODE,effortMode:lt.low})},onInfer:v=>{pt(l,is,{type:xe.EFFORT_MODE,effortMode:lt[v]})}});const{prospectiveModelId:uo}=Jt(l),wr=q||c&&uo&&!mm.includes(uo),mo=!m&&(Ot!==ct.None||Cr||wr)&&(!B||as),Ve=Tn(o,X),qs=Bn(o,X);let me=mn(v=>v.files);const[rs]=g.useState(()=>Hd());fe==="magic"?me=me.filter(v=>v.gizmoId!=null):me=me.filter(v=>v.gizmoId==null);const po=Ud(),$e=me.length>0||po,fo=mn(Gd.hasUploadInProgress),Ys=pi(v=>v.selectedApps),go=fi()&&Ys.length>0,kr=$e||go,_r=!!vt?.comments.length,jr=zd(l),Ks=S.useState(v=>{const Q=Wd(v);return typeof o?.maxTokens=="number"&&Q>o.maxTokens}),ho=S.useState(v=>!v.isEmpty()),ls=!Ks&&!fo&&(ho||$e||_r),xo=(Ot===ct.Multimodal?Mn:Rn)-me.length,bo=xo<=0,Ar=Vd(),Mr=ie("3544641259")?.value,{selectedRepos:Qs}=Hn(l),So=Ar&&Mr&&oo?.size===0,kt=ls&&!m&&!Me&&(!d||ao)&&!So&&!!1,[vo,Rr]=g.useState(!1),{value:Pr}=ie("3780975974"),{targetedContent:yo,setTargetedContent:cs}=$d(),Re=yo?.isFocusedViewContent&&!bt?void 0:yo;g.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>S.focus()))},[Re]);const Co=X==null||X?.kind===Ee.PrimaryAssistant||X?.kind===Ee.GizmoInteraction&&Ft,{getUpsellLabelType:Er,getUpsellShowsAttach:Tr,getShowUpsellReason:Nr}=oi(),Xs=We&&Co,[Br,Ir]=g.useState(!1),Dr=!B&&Co&&(!W||!ur),_t=ut(S.store,v=>v.controlsDisabled);g.useEffect(()=>{if(!U?.id)return;const v=ea.getAndReset(U.id,ne);v&&S.setText(v.inputText)},[U?.id,ne,S]),g.useEffect(()=>{const v=Be.get("prompt")??"";S.getCurrentText().length===0&&v.length>0&&S.setText(v)},[S,Be]),g.useEffect(()=>{vo!==kt&&(Rr(kt),kt&&bp(!0).then(v=>{qd.startEnforcement(v),Sp.startEnforcement(v)}))},[kt,vo,X?.kind,P]);const us=En(o,X),{handleFileAccepted:Lr}=eo(G,js(o,X,J),Ve,"mouse",le,us?.attachments),{getInputProps:Fr,open:Js,inputRef:wo}=In({disabled:m||!mo||bo,noClick:!0,onDropAccepted:Lr,onDropRejected:v=>Zn(v,G,R,Ot),multiple:!0,maxSize:Dn,maxFiles:xo,...Nn(B||j?Ve:qs)}),ko=ut(rs),_o=g.useCallback(()=>{S.eraseContent(),ko.clearMessages(),S.resize(Lg),S.usedDictation=!1;for(const v of me)ws.remove(Y,v.tempId,"none");Yd.markAllAsSent()},[S,ko,me,Y]),Or=ie("1064007944")?.value,Zs=ut(S.store,v=>v.isInReasonMode),jo=async(v,Q)=>{if(v.preventDefault(),m||!ls&&!Q||!X)return;const he=S.getContentToSend(),ke=gm(he.content),at=ia(Zs,S,J),{content:on,attachments:an}=hm(Y,ke,o,X,J);gr(),t({sourceEvent:v,attachments:an,content:on,contentToSend:he,conversationMode:X,hasSelectedApps:go,isMessageFollowupsEnabled:ge,selectedApps:Ys,selectedGizmoTag:we,selectedRepos:{selectedAllRepos:Qs.selectedAllRepos,selectedRepos:Qs.selectedRepos?[...Qs.selectedRepos]:null},selectedSources:oo,systemHints:at,usedDictation:S.usedDictation}),Re?.onCreateCompletion?.({serverThreadId:ne,currentLeafId:se}),Re?.shouldPersistAcrossMessages!==!0&&cs(void 0),na.hideThreadHeader();for(const Gt of me)Gt.status===xm.Ready&&Ae.addFile(Gt);_o();const ml=V.some(Gt=>Gt.persistBetweenMessages&&J.has(Gt.systemHint));Le&&!ns&&!H&&!(Lt&&Or)&&!ml&&St()},Hr=v=>{cs(v.targetedReply),v.targetedReply&&k.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:ne,sourceMessageId:v.messageId})},Ao=g.useCallback(()=>{Re?.onCleared?.({serverThreadId:ne,currentLeafId:se}),cs(void 0),S.focus()},[se,ne,Re,cs,S]),Mo={Enter:{validator:v=>{const Q=v.isComposing||v.keyCode===229;return!(ms&&Ws.current)&&(v.metaKey||(Z||kp)&&!v.shiftKey&&!Q&&!ze)},handler:v=>{if(!kt){Ks&&R.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}v.preventDefault(),jo(v)}},Escape:{validator:v=>!v.isComposing,handler:v=>{f&&d&&(ta(l),k.logEvent("Pause Completion",{threadId:Wt(l),currentLeafId:te.getCurrentNode(Ue(l)).message.id,eventSource:"keyboard"})),v.target.value===""&&Ao()}}},Ht=g.useRef(Mo);Ht.current=Mo;const ds=Kd(o?.tags,X?.kind),{showTaggingDropdown:en,isFocused:Ur,autocompletions:qe,matchaData:Gr}=ut(S.store),ms=Ur&&qe.length>0,jt=ds&&en&&!Ft,Ro=S.isReady();g.useEffect(()=>S.subscribe("keydown",v=>{S.acceptLegacyKeydown()&&Ht.current[v.key].validator(v)&&Ht.current[v.key].handler(v);const he=S.getCurrentText();if(v.key==="@"){const ke=S.getSelectionStart(),at=he.substring(0,ke);(!at||/\s$/.test(at)||ke===0)&&setTimeout(()=>S.setShowTaggingDropdown(!0),10)}else en&&S.setShowTaggingDropdown(!1);v.key==="Escape"&&(os(null),S.setAutocompletions([])),H&&v.key==="Escape"&&Ie(D.Search,!1,{clientThreadId:l})}),[S,Ro,en,J,H,Ie,l]),g.useEffect(()=>{const v=Object.fromEntries(Object.keys(Ht.current).map(Q=>[Q,ke=>{const at=Ht.current[Q];if(!at||S.acceptLegacyKeydown())return!1;const{validator:on,handler:an}=at;return on(ke)?(an(ke),!0):!1}]));S.registerKeyHandlers(v),S.registerFileInput({openFileDialog:Js,inputRef:wo})},[S,Js,wo,Ro]),g.useEffect(()=>S.subscribe("paste",v=>{Qd({filePickerStore:Y,event:v,intl:G,toaster:R,clientThreadId:l,conversationMode:X,currentModelConfig:o,getEditorGizmoId:le,modelSupportedImageMimeTypes:Ve,persistedSystemHints:J})}),[G,l,X,o,le,Ve,S,R,Y,J]);const Po=v=>{st||os(v),S.trimLeadingText("@"),dn(),S.setShowTaggingDropdown(!1)},zr=Xd(l,rs,Ve,us?.attachments),Wr=g.useCallback(v=>{v.preventDefault(),ta(l),k.logEvent("Pause Completion",{threadId:Wt(l),currentLeafId:te.getCurrentNode(Ue(l)).message.id,eventSource:"mouse"}),dn()},[l]),ps=g.useCallback(()=>{ea.set(U?.id,ne,S.getCurrentText())},[ne,U?.id,S]);g.useEffect(()=>{ye||Jd()||S.focus()},[S]),g.useEffect(()=>{if(Ve.length>0)for(const Q of me)Zd(Q.fileSpec?.mimeType,qs)||ws.remove(Y,Q.tempId,"none");else ws.reset(Y)},[a,Y]),g.useEffect(()=>{(!ds&&we||st)&&os(null)},[ds,we,st]),g.useEffect(()=>{nt&&S.setReasonMode(!1)},[nt,S]);const{layer:Vr}=Je("4031588851"),{layer:Eo}=Je("3637408529"),$r=Eo.get("is_in_composer_text_exp",!1),qr=Eo.get("composer_text","MESSAGE_CHATGPT"),Yr=Vr.get("composer_text","MESSAGE_CHATGPT"),Kr=$r?qr:Yr,[fs,Qr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[oe.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[oe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[oe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[oe.loading,!0];case"noTestGizmoId":return[oe.noTestGizmoId,!0];default:{if(b)return[oe.placeholderWithName,!1];if(Re?.placeholderTextOverride!=null)return[Re.placeholderTextOverride,!1];if(De==="initial"||De==="recurrent")return[oe.deepResearchPlaceholder,!1];if(De==="clarify")return[oe.researchSuggestionInitial,!1];if(Ge)return p&&dr?[sa.caSuggestionPlaceholder,!1]:[sa.caSuggestionInitial,!1];switch(Kr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[oe.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[oe.placeholderAskNameAnythingVariant,!1];default:return[oe.placeholderWithName,!1]}}}})(),tn=Ft?p?G.formatMessage(em.newChatInProject):fs?G.formatMessage(fs,{name:"ChatGPT"}):"":fs?G.formatMessage(fs,{name:ye!=null?fe==="magic"?tm:ye.name||"GPT":Vs?.gizmo.display.name??"ChatGPT"}):"";g.useEffect(()=>S.subscribe("input",()=>{sm.getState().isThreadHeaderVisible&&na.hideThreadHeader()}),[S]),g.useEffect(()=>S.subscribe("input",()=>{zs.current=performance.now(),y?.()}),[S,y]),g.useEffect(()=>{if(C)return S.subscribe("change",()=>{C()})},[S,C]);const Xr=Pr||Nr(),To=nm()&&!!qe.find(v=>!!v.requires_file_upload),Jr={clientThreadId:l,uploadType:Ot,modelAcceptedMimeTypes:qs,modelSupportedImageMimeTypes:Ve,attachmentsProductFeature:us?.attachments,getInputProps:Fr,openFileDialog:Js,historyDisabled:ae,onOauthRedirect:ps,highlightTooltip:To&&!$e},gs=[],No=[],Bo=!m&&!bo&&(mo||hr!=null)&&!H&&!ze,Io=Tr(),Zr=!B||Io||as,Do=Ot===ct.None?Fe.ModelNotSupported:Ce?Fe.ThinkModeInUse:H?Fe.SearchModeInUse:void 0;if(Zr){const v=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(ig,{...Jr,showGlowingBorder:M,showLabel:Er()==="all",showUpsell:Io&&!as,showMenuForNoAuth:as,isDisabled:!Bo||_t,disabledReason:Do,currentModelName:o?.title??"",visualTreatment:Le?"vanguard":"legacy"})},"file-upload-button");gs.push(v),No.push(v)}const Ye=[],Lo=Fn(),Fo=pe(v=>v.isVisuallyOverflowing)&&ot;let hs="bottom";Lo?hs="bottom":p&&(hs="centered"),ot&&(X?.kind!==Ee.GizmoInteraction||Ft)&&Ye.push(e.jsx("div",{"data-testid":"composer-action-reasoning-level",className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:v=>v.stopPropagation(),children:e.jsx(An,{announcementKey:ce.ModelPickerMoved,side:"bottom",show:re&&xr&&!yt.isLoading&&yt.eligible,onDismiss:yt.markAsViewed,theme:"bright",badge:"none",dismissOnOutsideClick:!0,sideOffset:0,title:e.jsx(F,{id:"NGN4SW",defaultMessage:"Set how long ChatGPT should think or pick a different model"}),children:e.jsx(Sf,{clientThreadId:l,layoutMode:hs,currentModel:o,category:mr,type:br,mode:Ft?"model-picker-only":"default"})})},"reasoning-level")),vr||Ye.push(e.jsx(nf,{account:n,clientBootstrapFlags:io,features:P,currentModelConfig:o,hasFiles:$e,isDisabled:_t||$e,clientThreadId:l,composerController:S,gizmoId:wt},"search"));const{value:el}=ie("1830177352");!ot&&!Sr&&Ye.push(e.jsx(ef,{clientThreadId:l,gizmoId:wt,composerController:S,isDisabled:_t},"reason")),el&&Ye.push(e.jsx(Xp,{clientThreadId:l,showLabel:Xr,isDisabled:_t},"deep-research")),Fo||Ye.push(e.jsx(Yf,{clientThreadId:l,composerController:S,isDisabled:_t,currentModelConfig:o,currentModelConfigLoading:c,disableIfNoAccess:ot},"shiba")),Ct&&Gs&&Gs.connection_statuses.length>0&&!Fo&&Ye.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},"data-testid":"composer-action-contextual-answers",children:e.jsx(Cg,{composerController:S,systemHint:Ct,clientThreadId:l,connectionStatuses:Gs.connection_statuses})},"contextual-answers")),Dr&&Ye.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},"data-testid":"composer-action-system-hint-button",children:e.jsx(hg,{composerController:S,clientThreadId:l,disabled:_t,hideThinkButton:ot,disableIfNoAccess:ot})},"system-hint-button")),yr==="none"&&gs.push(...Ye);const sn=Qr?"disabled":"default",tl=om(Wt(l)||l)?.value===vp.STREAMING,Oo=d&&f||tl,sl=yp(),nl=!kt||sl,nn=pm(fo,ho,Ks,jr,!So),At=Oo?"streaming":nl?"disabled":"idle",Ut=g.useRef(null),Mt=g.useRef(null),{value:ol}=ie("222560275"),al=ol||a&&!a.startsWith("o1")&&!a.startsWith("o3");g.useEffect(()=>{const v=()=>{Ut.current!=null&&_p.addAction("composer_state_disabled",{threadId:Wt(l),disabledReason:Ut.current})};if(ls&&At==="disabled"){let Q="unknown";m?Q=h??"component_disabled_unknown":d?Q="completion_in_progress":Me&&(Q="thread_hard_blocked"),Ut.current!==Q&&(Mt.current&&clearTimeout(Mt.current),Mt.current=setTimeout(v,Fg)),Ut.current=Q}else Ut.current=null;return()=>{Mt.current&&(clearTimeout(Mt.current),Mt.current=null)}},[l,ls,At,m,h,d,Me]);const xs=[];if(Re?.label&&xs.push({type:Re.type,value:Re.label,onRemoveRegion:Ao}),we!==null){const v=!!we.gizmo.tags?.includes(Ds.FirstParty);xs.push({type:"mention",value:we.gizmo.display.name,icon:e.jsx(Bi,{isFirstParty:v,src:we.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{os(null),S.focus()}})}g.useEffect(()=>{(!qe||qe.length===0||!ms)&&(Ws.current=!1)},[qe,ms]);const il=(v,Q,he)=>{Ws.current=v>=0,Q&&S.setText(he?`${he.title}${he.body}`:"")},Ho=ms&&qe&&qe.length>0&&!jt&&!ns&&!S.hasMultipleLines()&&S.canShowAutocompletion()&&!ze;g.useEffect(()=>{jt?_?.():I?.()},[jt,_,I]);const bs=v=>{if(v.preventDefault(),v.stopPropagation(),zs.current>0){const Q=performance.now()-zs.current;jp.hist(Ap.DEFAULT,"final_user_input_to_submit_ms",[],Q)}At==="streaming"&&(!ao||S.isEmpty())?Wr(v):jo(v)},rl=am(o,Vn.Canvas),{value:ll}=ie("61299031"),cl=im(),ul=rl&&ll&&!cl&&!po&&!Lo;g.useEffect(()=>{},[pr,S]),g.useEffect(()=>{const v=Wt(l),Q=n?.normalizedAccountUserId;if(!Q||r)return;const he=za(()=>{const ke=S.getContentToSend().content;ke===""?Cp(v):wp(v,ke,Q)},1e3);return S.subscribe("change",he)},[n,l,S,r,ne]);const Uo=e.jsx(Uf,{canUseInlineTagging:ds,isDisabled:m,clientThreadId:l,currentLeafId:se,currentRequestId:Ne,canContinue:x,composerController:S,isNewThread:p,onContinueGenerating:v=>s({event:v,conversationMode:Ue(l)?.mode,systemHints:ia(Zs,S,J)}),onResetState:_o,conversationMode:X,isShowingAutocomplete:!!Ho}),Go=!Oo&&X!=null&&al&&rm.includes(X.kind)&&e.jsx(lm,{clientThreadId:l,onTargetedReply:Hr}),zo=Ho&&e.jsx("div",{className:N("absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",Le?"border-token-border-default md:bg-token-main-surface-primary z-10! bg-transparent md:mt-2 md:rounded-3xl md:border md:shadow-[0px_12px_24px_rgba(0,0,0,0.032)]":"bg-token-main-surface-primary"),children:e.jsx(Np,{suggestions:qe,composerController:S,onSelect:w,onChange:il})}),Wo=e.jsx(fm,{composerController:S,parsedDocumentHandler:zr}),Vo=!E&&e.jsx(Yi,{className:A}),$o=e.jsx(cm,{modelSupportedImageMimeTypes:Ve,uploadType:ct.Multimodal,attachmentsProductFeature:us?.attachments}),dl=e.jsxs(e.Fragment,{children:[jt&&e.jsx(ma,{onClick:v=>Po(v),onClose:()=>{S.setShowTaggingDropdown(!1),S.focus()}}),Xs&&e.jsx(ha,{composerController:S,clientThreadId:l})]}),{isImageGenEditor:qo}=um();return qo?e.jsxs(oa.Provider,{value:rs,children:[e.jsx(aa,{onOauthRedirect:ps,children:e.jsx("form",{id:"prompt",className:u,onSubmit:bs,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[Vo,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":Br?"none":"block"},children:[e.jsxs(Yt,{open:jt||Xs,children:[e.jsx(Ls,{className:"w-full",children:qo?e.jsx(Dg,{type:ae?"temporary":"default",ref:O,placeholder:tn,inputState:sn,composerController:S,leftSideActions:No,state:At,onSubmit:bs,renderFiles:$e&&e.jsxs(e.Fragment,{children:[fe==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(F,{...oe.gizmoKnowledgeWarning})}),e.jsx(fn,{files:me,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:wt,disableReason:nn,modelId:a}):e.jsx(mg,{type:ae?"temporary":"default",ref:O,replyRegions:xs,placeholder:tn,inputState:sn,setIsComposerOverflowing:Ir,composerController:S,matchaData:Gr,leftSideActions:gs,topRightAction:ul&&e.jsx(dm,{composerRef:O,composerController:S,clientThreadId:l}),state:At,onSubmit:bs,renderFiles:kr&&e.jsxs(e.Fragment,{children:[fe==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(F,{...oe.gizmoKnowledgeWarning})}),e.jsx(fn,{files:me,selectedApps:Ys,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:wt,disableReason:nn,modelId:a})}),e.jsx(Kt,{children:e.jsxs(Qt,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:v=>v.preventDefault(),children:[jt&&e.jsx(ma,{onClick:v=>Po(v),onClose:()=>{S.setShowTaggingDropdown(!1),S.focus()}}),Xs&&e.jsx(ha,{composerController:S,clientThreadId:l})]})})]}),zo]}),Wo,$o]})})}),Uo,Go]}):e.jsxs(oa.Provider,{value:rs,children:[e.jsx(aa,{onOauthRedirect:ps,children:e.jsxs("div",{className:N(`relative z-1 flex max-w-full flex-1 flex-col ${Le?"":"h-full"}`,!Le&&"max-xs:[--force-hide-label:none]",ot&&!re&&"[--force-hide-label:none]"),children:[Vo,e.jsx(Ig,{visualTreatment:Le?"vanguard":"legacy",hasFiles:$e,pendingFiles:me,isUploadDisabled:!Bo,isNewThread:p,clientThreadId:l,serverThreadId:ne,getEditorGizmoId:le,highlightUploadTooltip:To&&!$e,disableReason:nn,uploadButtonDisabledReason:Do,currentModel:o,layoutMode:hs,conversationMode:X,onOauthRedirect:ps,state:At,inputState:sn,gizmoId:wt,isTemporaryChat:ae,placeholder:tn,composerController:S,onSubmit:bs,replyRegions:xs,keepExpanded:p||!Le,legacyFooterActions:gs,legacySuggestionsPopoverContent:dl,isInReasonMode:Zs}),zo]})}),Wo,Uo,Go,$o]})}function ka({clientThreadId:t,onClick:s}){g.useEffect(()=>{Sm(t)},[t]);const n=K();return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(gi,{onClick:()=>{vm(t),s()},label:n.formatMessage(Wg.moreStarterPrompts)})})}function Hg({starterPrompt:t,starterPrompts:s,index:n,disabled:a,onSelectStarterPrompt:o}){const r=t.theme??t.title,i=vl(),{mutate:c}=ym(),l=t.category==="onboarding"?p=>{c({key:ce.hasUsedConversationalOnboardingStarterPrompt}),i(p,t,s,n)}:p=>o?.(p,t,s,n);return e.jsx(gi,{disabled:a,onClick:l,icon:e.jsx(Cm,{category:t.category,useV2Colors:!0}),label:r})}const Ug=5,Gg=3;function cr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:r=!1}){const i=r?Gg:Ug,[c,l]=g.useState(i),[p,d]=g.useState(!1),u=g.useRef(null),m=t.length<=c;g.useEffect(()=>{ra(t.slice(0,i),a)},[a]),g.useEffect(()=>{if(!p&&!m&&u.current){const f=u.current,x=f.getBoundingClientRect(),b=x.width,y=Array.from(f.children);let C=0;for(let w=0;w<y.length&&y[w].getBoundingClientRect().right-x.left<=b;w++)C++;l(C),d(!0)}},[t,m,p]);const h=()=>{const f=t.slice(c,t.length).map(x=>({...x,isAdditional:!0}));f.length>0&&ra(f,a),l(t.length),o()};return e.jsxs("div",{className:N("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:N("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",m||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:u,children:[t.slice(0,c).map((f,x)=>e.jsx($.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Hg,{starterPrompt:f,starterPrompts:t,index:x,disabled:n,onSelectStarterPrompt:s})},f.id??x)),r&&t.length>c&&e.jsx(ka,{clientThreadId:a,onClick:h})]}),!r&&t.length>c&&e.jsx(ka,{clientThreadId:a,onClick:h})]})}const dh=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[a,o]=g.useState(!1),r=Kn(),{prospectiveModelId:i}=Jt(t),c=n?s:i??"auto",{promptStarters:l,shouldShowStarterPrompts:p,onSelectStarterPrompt:d}=Ni({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:c});return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:N(!a&&"h-[116px]"),children:p&&l&&e.jsx(cr,{starterPrompts:l,onSelectStarterPrompt:d,disabled:r,clientThreadId:t,onExpand:()=>o(!0),mobileLayout:!0})})},zg=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:a}=ve(),[o,r]=g.useState(!1),i=bm(),c=Kn(),{prospectiveModelId:l}=Jt(s),p=n?t:l??"auto",{promptStarters:d,shouldShowStarterPrompts:u,onSelectStarterPrompt:m}=Ni({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:p});return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:N("hidden min-h-[108px] max-w-full",i?"@lg/thread:block":"lg:block",a&&o?"":"h-[70px]"),children:u&&d&&e.jsx(cr,{starterPrompts:d,onSelectStarterPrompt:m,disabled:c,clientThreadId:s,onExpand:()=>r(!0)})})},Wg=Te({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),_a=Gn.div`m-8 flex flex-col items-center`;function ja(t){return e.jsx($.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Vg({clientThreadId:t}){const n=de(t,o=>o?.promptGptRating)?.gizmoId,{data:a}=hi(n);return n==null||a==null||!wm(a)?null:e.jsx($g,{gizmoId:n})}function $g({gizmoId:t}){const[s,n]=g.useState(!1),[a,o]=g.useState(!1),r=km(t),i=async l=>{n(!0),setTimeout(()=>{o(!0)},5e3),k.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await r.mutateAsync({rating:l})},c=async()=>{o(!0),k.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await r.mutateAsync({})};return g.useEffect(()=>{a||k.logEvent("Show Inline Rating",{gizmo_id:t})},[a,t]),a?null:s?e.jsx(_a,{children:e.jsxs(ja,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(F,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(da,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(F,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(_a,{children:e.jsxs(ja,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(F,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(da,{onClick:c})]}),e.jsx(_m,{rating:void 0,onRating:i})]})})}const mh=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:a,isModelLoaded:o,currentModelId:r,onRequestCompletion:i,shouldUseUnifiedComposer:c,isVanguardUxEnabled:l,onlyAllowImageUploads:p})=>{const d=ht(),{pageType:u}=mi(),m=u?.type==="landing-page",h=g.useContext(Mp),f=Rp(h),x=Fn();et(),jm(d);const b=async A=>{if(Ue(t)?.isLoading!==!1)return;const E=await Nm(A);i(E)},y=g.useCallback(A=>{k.logEvent("Continue Completion"),i(Am(A))},[i]),C=e.jsxs(e.Fragment,{children:[e.jsx(Vg,{clientThreadId:t}),e.jsx(ln,{verticalMargin:"none",verticalPadding:f?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(cn,{children:e.jsx(qg,{clientThreadId:t,currentModelId:r,isNewThread:s,hideHeader:s,onRequestCompletion:b,onContinueGenerating:y,onAutocompleteSelect:d.onAutocompleteSelect,onlyAllowImageUploads:p})})})]}),w=s&&e.jsx("div",{className:N("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(ln,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(cn,{children:e.jsx(Yi,{className:"block flex-1"})})})});return c?e.jsxs(e.Fragment,{children:[x&&w,e.jsx("div",{id:"thread-bottom",children:C}),!x&&w,s&&!m&&!n&&!a&&!l&&e.jsx(ln,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(cn,{children:e.jsx(zg,{clientThreadId:t,currentModelId:r,isModelLoaded:o})})})]}):C};function qg({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:a,onRequestCompletion:o,onContinueGenerating:r,onComposerInput:i,onComposerChange:c,onAutocompleteSelect:l,headerClassName:p,hideHeader:d,onTaggingDropdownClose:u,onTaggingDropdownOpen:m,onlyAllowImageUploads:h}){const{data:f,isLoading:x}=ts(),[b,y,C,w]=de(t,R=>{const Y=te.getCurrentNode(R);return[Y.message.clientMetadata?.errType!=null&&Y.message.clientMetadata.errType!=="info",Pp(te.getCurrentNode(R).message),R?.mode,R?.continuingFromSharedConversationId!=null]}),A=et(),E=ht(),_=Ep({clientThreadId:t}),{isOpen:I,onClose:j}=Mm({type:"just-hit-rate-limit"}),L=g.useMemo(()=>_?!1:!b&&y,[b,y,_]),O=_,S=Ai(t),z=hi(S).data,M=Tp(),U=z?.gizmo.tags?.includes(Ds.WorkspaceDisabled)&&!M?"workspaceDisallowsGizmo":f?.models.size===0?"noModelsAvailable":C?.kind===Ee.GizmoTest&&C.gizmo_id==null?"noTestGizmoId":null,q=hl(),W=Rm(),B=q.action==="moderate",{value:G}=ie("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(Pm,{composerController:E,clientThreadId:t,currentModelId:s,isCompletionInProgress:_}),e.jsx("div",{className:"flex justify-center empty:hidden",children:W&&B&&G?e.jsx(Em,{}):null}),I?e.jsx(Tm,{onClose:j}):null,e.jsx(Og,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:o,onContinueGenerating:r,currentModelId:s,account:A,modelCategories:f?.categories,currentModelConfig:$a(f?.models,s),areModelsLoading:x,isNewThread:a,isCompletionInProgress:_,className:"w-full",canContinue:L,disabled:!!U,disabledReason:U??void 0,canPause:O,isInteractableSharedThread:w,onComposerInput:i,onComposerChange:c,onAutocompleteSelect:l,headerClassName:p,hideHeader:d,onTaggingDropdownClose:u,onTaggingDropdownOpen:m,onlyAllowImageUploads:h},t)]})}export{Vi as B,Jn as C,Jf as D,uh as F,ch as I,dh as M,Xn as P,or as R,mh as T,qg as a,lh as b,Dg as c,Xf as g,Zn as h,no as u};
//# sourceMappingURL=opqccoi9jnqsmzvy.js.map
