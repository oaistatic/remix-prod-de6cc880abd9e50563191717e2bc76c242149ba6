import{g as ae,r as h,f as re,j as e,M as m,a8 as oe,e as w,b as B,u as ne,c as ie}from"./khl8ktun31iepecq.js";import{lK as F,lL as le,lM as de,lN as me,lO as ce,b9 as ue,eJ as P,lP as fe,lQ as ge,lR as he,h1 as y,lS as I,dJ as Me,jJ as xe,aX as ye}from"./n4exq6o15ap1g74l.js";import{ef as ve,a4 as pe,a5 as je,a6 as be,gW as we,gX as Ce,v as ke,gY as Se,ew as _e,P as M,a as S,cr as z,V as A,aG as W,cH as q,cW as H,dF as E,R as $,bX as Re,cF as b,ae as Ne}from"./haannt40upmuwmtk.js";import{G as Ee}from"./m4g7yy9fehqi204r.js";var Te=ve,Ge=pe,Ue="[object RegExp]";function De(s){return Ge(s)&&Te(s)==Ue}var Le=De,Oe=Le,Be=be,T=je,G=T&&T.isRegExp,Fe=G?Be(G):Oe,Pe=Fe,Ie=we,ze=Ie("length"),Ae=ze,Q="\\ud800-\\udfff",We="\\u0300-\\u036f",qe="\\ufe20-\\ufe2f",He="\\u20d0-\\u20ff",$e=We+qe+He,Qe="\\ufe0e\\ufe0f",Ye="["+Q+"]",_="["+$e+"]",R="\\ud83c[\\udffb-\\udfff]",Je="(?:"+_+"|"+R+")",Y="[^"+Q+"]",J="(?:\\ud83c[\\udde6-\\uddff]){2}",V="[\\ud800-\\udbff][\\udc00-\\udfff]",Ve="\\u200d",K=Je+"?",Z="["+Qe+"]?",Ke="(?:"+Ve+"(?:"+[Y,J,V].join("|")+")"+Z+K+")*",Ze=Z+K+Ke,Xe="(?:"+[Y+_+"?",_,J,V,Ye].join("|")+")",U=RegExp(R+"(?="+R+")|"+Xe+Ze,"g");function es(s){for(var r=U.lastIndex=0;U.test(s);)++r;return r}var ss=es,ts=Ae,as=F,rs=ss;function os(s){return as(s)?rs(s):ts(s)}var ns=os,D=Ce,is=le,ls=F,ds=ke,ms=Pe,cs=ns,us=de,fs=Se,L=_e,gs=30,hs="...",Ms=/\w*$/;function xs(s,r){var i=gs,n=hs;if(ds(r)){var a="separator"in r?r.separator:a;i="length"in r?fs(r.length):i,n="omission"in r?D(r.omission):n}s=L(s);var t=s.length;if(ls(s)){var o=us(s);t=o.length}if(i>=t)return s;var l=i-cs(n);if(l<1)return n;var d=o?is(o,0,l).join(""):s.slice(0,l);if(a===void 0)return d+n;if(o&&(l+=d.length-l),ms(a)){if(s.slice(l).search(a)){var u,f=d;for(a.global||(a=RegExp(a.source,L(Ms.exec(a))+"g")),a.lastIndex=0;u=a.exec(f);)var g=u.index;d=d.slice(0,g===void 0?l:g)}}else if(s.indexOf(D(a),l)!=l){var v=d.lastIndexOf(a);v>-1&&(d=d.slice(0,v))}return d+n}var ys=xs;const vs=ae(ys),ps=s=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1ZM6.75 3.75C6.75 4.16421 6.41421 4.5 6 4.5C5.58579 4.5 5.25 4.16421 5.25 3.75C5.25 3.33579 5.58579 3 6 3C6.41421 3 6.75 3.33579 6.75 3.75ZM6.75 6C6.75 5.58579 6.41421 5.25 6 5.25C5.58579 5.25 5.25 5.58579 5.25 6V8C5.25 8.41421 5.58579 8.75 6 8.75C6.41421 8.75 6.75 8.41421 6.75 8V6Z",fill:"currentColor"})),js=91,N=100;function bs(s){return s<N?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-[rgba(229,76,66,0.16)] text-[#DC2626] dark:bg-[rgba(202,58,49,0.16)] dark:text-[#DC2626]"}function X(s){return ce()&&s!=null&&s>=js}function ws({memoryFullPct:s,className:r,children:i,showInfoLabel:n,onManageMemories:a}){return X(s)?e.jsx("div",{className:S("border-token-border-default rounded-lg border p-1 text-sm",r),children:e.jsxs(oe.div,{className:S("flex items-center overflow-hidden rounded-sm px-2 py-1.5 whitespace-nowrap",bs(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(m,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),i,n&&e.jsx(z,{interactive:!0,label:s<N?e.jsx("div",{className:"whitespace-normal",children:e.jsx(m,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:o=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:l=>{l.preventDefault(),a?.()},children:o})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(m,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:o=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:l=>{l.preventDefault(),a?.()},children:o})}})}),children:e.jsx(ps,{className:"icon-sm text-token-text-secondary ms-1"})})]})}):null}function Cs({memoryFullPct:s,className:r}){const i=X(s),n=me(),a=re();if(!i)return null;n&&M.logEventWithStatsig("Memory Full Warning Upsell Shown","chatgpt_memory_full_warning_upsell_shown_memory_modal");const t=e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:o=>{o.preventDefault(),M.logEventWithStatsig("Memory Full Warning Upsell Clicked","chatgpt_memory_full_warning_upsell_clicked_memory_modal"),ue(a,"MemoryUsageWarning Memory Modal Upsell")},children:e.jsx(m,{id:"djYoOr",defaultMessage:"ChatGPT Plus"})});return e.jsxs("div",{className:S("flex flex-col gap-2",r),children:[e.jsx(ws,{memoryFullPct:s}),e.jsx("div",{className:"text-token-text-secondary ps-3 text-sm",children:s<N?n?e.jsx(m,{id:"2Gnp5W",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room, or get 4x more space with {upsellLink}.",values:{strong:o=>e.jsx("strong",{children:o}),upsellLink:t}}):e.jsx(m,{id:"SnInO0",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room.",values:{strong:o=>e.jsx("strong",{children:o})}}):n?e.jsx(m,{id:"VfmXw+",defaultMessage:"<strong>You’re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories, or get 4x more space with {upsellLink}.",values:{strong:o=>e.jsx("strong",{children:o}),upsellLink:t}}):e.jsx(m,{id:"fSy74S",defaultMessage:"<strong>You’re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories.",values:{strong:o=>e.jsx("strong",{children:o})}})})]})}function O({description:s,onClose:r,onConfirm:i}){const n=w();return e.jsx(H,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:r,type:"success",title:n.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(E.Button,{title:n.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:i,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(E.Button,{title:n.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:r})})}function ks({onReset:s,gizmoId:r,memoryName:i}){const[n,a]=h.useState(!1),t=w(),o=A(),{value:l}=W("604639887"),d=P(),u=async()=>{M.logEvent("Memory Manage Reset Button Confirmed");try{await $.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:r}}),o.success(t.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s?.(),a(!1)}catch{o.danger(t.formatMessage({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory."}))}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{color:"danger-outline",onClick:()=>{M.logEvent("Memory Manage Reset Button Clicked"),a(!0)},"data-testid":"reset-memories-button",children:r?e.jsx(m,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(m,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),n&&(l&&d?e.jsx(O,{description:t.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:i,link:f=>e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:f})}),onClose:()=>a(!1),onConfirm:u}):e.jsx(O,{description:t.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:i}),onClose:()=>a(!1),onConfirm:u}))]})}function Ss({gizmo:s,memory:r}){const i=w(),n=A(),a=B(),{mutate:t,isPending:o}=ie({mutationFn:async f=>{const{success:g}=await $.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:f}},requestBody:{gizmo_id:s?.id}});if(!g)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{a.invalidateQueries({queryKey:I(s?.id)})},onError:()=>{n.danger(i.formatMessage({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed"})}}),[l,d]=h.useState(!1),u=i.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(y.Row,{disabled:o,children:[e.jsx(y.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:r.content})}),e.jsx(y.Cell,{textAlign:"right",children:e.jsx(y.Actions,{children:e.jsx("button",{onClick:()=>{M.logEvent("Memory Manage Modal Memory Delete Clicked"),d(!0)},"aria-label":u,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(z,{className:"leading-none",label:u,sideOffset:4,side:"top",children:e.jsx(Me,{className:"icon-sm"})})})})})]}),l&&e.jsx(xe,{isOpen:!0,primaryButtonColor:"danger",title:u,confirmText:i.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{M.logEvent("Memory Manage Modal Memory Delete Confirmed"),t(r.id),d(!1)},onClose:()=>{d(!1)},children:e.jsx(m,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:s?.name??"ChatGPT",title:e.jsx("strong",{children:vs(r.content,{length:130,omission:"..."})}),link:f=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:f})}})})]})}function _s({selectedGizmoId:s,onSelect:r,items:i}){const n=i.find(t=>t.id===s);function a(t){return e.jsx(Ee,{isFirstParty:t.id===void 0,src:t.iconUrl??null,className:"icon-md"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(b.Root,{children:[e.jsx(b.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsxs(e.Fragment,{children:[a(n),e.jsx("span",{className:"text-token-text-primary",children:n.name})]}):e.jsx(m,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(ye,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(b.Portal,{children:e.jsx(b.Content,{children:i.map(t=>e.jsxs(b.Item,{className:"flex items-center gap-3",onClick:()=>{r(t.id)},children:[a(t),t.name]},t.id))})})]})})}const k=Re.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default`;function Rs({onClose:s,initialGizmoId:r}){const i=w(),n=B(),a=fe(),[t,o]=h.useState(r),l=ge(),d=P();h.useEffect(()=>{M.logEvent("Memory Modal Shown")},[]);const{data:u,isLoading:f,isError:g,refetch:v}=he(t,!0,a),x=u?.memories,{data:ee,refetch:se}=ne({queryKey:["memory_gizmos"],queryFn:()=>Ne.getGizmosWithMemory(),refetchOnMount:"always"}),C=[{id:void 0,name:"ChatGPT",iconUrl:null},...ee?.items.map(({gizmo:c})=>({id:c.id,name:c.display.name,iconUrl:c.display.profile_picture_url}))??[]],p=C.find(c=>c.id===t);h.useEffect(()=>{!f&&!g&&t!==void 0&&(!x||x.length===0)&&o(void 0)},[f,g,x,t]);const{value:te}=W("604639887");let j;return f?j=e.jsx(k,{children:e.jsx(m,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):g?j=e.jsx(k,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(m,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(q,{color:"secondary",onClick:()=>{v()},children:e.jsx(m,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!x||x.length===0?j=e.jsx(k,{children:e.jsx("div",{className:"max-w-sm text-center",children:a?e.jsx(m,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:p?.name??"ChatGPT"}}):e.jsx(m,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):j=e.jsx(y.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(y.Body,{children:x.map(c=>e.jsx(Ss,{gizmo:p?{id:p.id,name:p.name}:void 0,memory:c},c.id))})}),e.jsxs(H,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:i.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:te?d?i.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:c=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:c})}):i.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:c=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:c})}):null}),showCloseButton:!0,children:[l&&C.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(_s,{selectedGizmoId:t,items:C,onSelect:c=>{n.invalidateQueries({queryKey:I(c)}),o(c)}})}),e.jsx(Cs,{memoryFullPct:u?.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:j}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(ks,{onReset:()=>{v(),se(),t&&o(void 0)},gizmoId:t,memoryName:p?.name??"ChatGPT"})})]})}const Us=Object.freeze(Object.defineProperty({__proto__:null,default:Rs},Symbol.toStringTag,{value:"Module"}));export{ws as M,Rs as a,Us as b,X as u};
//# sourceMappingURL=n5hhcdj0vwv4yndd.js.map
