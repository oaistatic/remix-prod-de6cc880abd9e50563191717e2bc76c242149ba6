import{j as t,e as k,a9 as D,a8 as p,M as S,an as we,u as Me,r as i}from"./khl8ktun31iepecq.js";import{cp as U,db as M,z as se,D as ke,a as C,eO as _e,cr as le,cm as be,l as Ne,cN as Te,P as T,as as z,at as B,dG as Ie,dE as Re,m as Ae,K as Ee,B as P}from"./haannt40upmuwmtk.js";import{S as Oe,a as qe}from"./jbl38r5yycb2mrt9.js";import{gF as G,f9 as Fe,iS as ue,f7 as H,mE as Pe,dg as Le,mF as de,bK as De,L as He,M as Ue,jc as ze,R as Be,aJ as Ge,gC as We,hm as Ve}from"./n4exq6o15ap1g74l.js";import{h as Ye,g as Qe,a as Xe,b as Je,i as Ke,c as Ze,C as $e,d as et}from"./ici1r2pdfnai9c6r.js";import{F as me,l as tt}from"./jows9759jdyt51hg.js";import{u as st}from"./kw97lv1qq6sjlhnf.js";import"./kiredz58u04n7vci.js";import"./oyqlb501dhlk5b61.js";import"./dryvpx92fe6zevra.js";import"./b9iv65ef6it0bnl8.js";import"./h1em0bjkpkjv8ykw.js";import"./i3axmsntxbz0hz1f.js";import"./cv6si9v270pdl3vk.js";import"./mh4bwze9qp65qu97.js";import"./iuzjvviw85b4ghdw.js";import"./miy9m4xp0yschmng.js";import"./dlwdwnl197lh1mf5.js";import"./eiq9v0oy1lyfg3c8.js";import"./dblaaxd78ezocyc0.js";import"./ougcm9i7phfim0kn.js";import"./mr4t2sawqo9d3nrg.js";import"./pc2givv05uuq8g6l.js";import"./gna4hr6ugwtsnaih.js";import"./ctjt1fjp3mtlelcg.js";const N=24,ae=12,L=4,at=5e3,nt=G({animationLoader:()=>U(()=>import("./lfzuyl34fk01vyea.js"),[]),StaticIcon:Fe}),ot=G({animationLoader:()=>U(()=>import("./xondl5c9ooyfnze7.js"),[]),StaticIcon:ue}),ne=G({animationLoader:()=>U(()=>import("./hep2fnaoibm5tyk4.js"),[]),StaticIcon:H});var l=(e=>(e[e.Thought=0]="Thought",e[e.Recap=1]="Recap",e[e.Search=2]="Search",e[e.CodeAnalysis=3]="CodeAnalysis",e[e.ImageAnalysis=4]="ImageAnalysis",e[e.ComputerOutput=5]="ComputerOutput",e))(l||{});const oe=new WeakMap;function rt(e){const a=[];for(const s of e){let n=oe.get(s);n||(n=it(s),n&&oe.set(s,n)),n&&a.push(...n)}return a}function it(e){switch(e.type){case M.ReasoningRecap:return[{type:1,content:e.messages[e.messages.length-1].content.content}];case M.StructuredThoughts:{const a=[];for(const s of e.messages){const{thoughts:n}=s.content;for(const o of n)!o.content&&!o.summary||a.push({type:0,thought:o})}return a}case M.CodeInterpreter:{const[a,s]=e.messages;if(a.author.role!==se.Assistant||s&&s.author.role!==se.Tool){ke.addError(new Error("[cot] out of order code tool messages"));break}return[{type:s!=null&&Ye(s)?4:3,messages:e.messages}]}case M.CoTSearchTool:{const a={type:2,queries:[],sources:[]};for(const s of e.messages)if(s.metadata?.search_queries?.length&&(a.queries=s.metadata.search_queries),s.metadata?.search_result_groups?.length)for(const n of s.metadata.search_result_groups)a?.sources?.some(o=>o.domain===n.domain)||a.sources?.push(n);return[a]}case M.n7jupd_c:{const a=[];for(const s of e.messages)a.push({type:5,messages:[s]});return a}}}function ct(e){const a=new Set,s=new Set;for(const n of e)if(n.type===2){for(const o of n.queries)a.add(o.q);for(const o of n.sources)s.add(o.domain)}return{queries:a.size,sources:s.size}}const he=({chunk:e,size:a="small",isAnimated:s=!1,className:n})=>{const o=a==="small"?C("h-[15px] w-[15px]",n):C("h-[18px] w-[18px]",n);switch(e.type){case l.Search:return s?t.jsx(ne,{matchTextColor:!0,className:o}):t.jsx(H,{className:o});case l.CodeAnalysis:return s?t.jsx(nt,{matchTextColor:!0,className:o}):t.jsx(Pe,{className:o});case l.ImageAnalysis:return s?t.jsx(ot,{matchTextColor:!0,className:o}):t.jsx(ue,{className:o});case l.Recap:return t.jsx(_e,{className:o});case l.ComputerOutput:return s?t.jsx(ne,{matchTextColor:!0,className:o}):t.jsx(H,{className:o});default:return t.jsx("div",{className:C("bg-token-icon-secondary h-[6px] w-[6px] rounded-full",n)})}},lt=({isExpanded:e=!1,isExpandDisabled:a=!1,isComplete:s,latestHeadline:n,latestChunk:o,counters:r,onToggleExpanded:x})=>{const h=k(),g=n??(s?h.formatMessage({id:"nkvZJE",defaultMessage:"Thought"}):h.formatMessage({id:"hgnsat",defaultMessage:"Thinking"})),u=o!=null&&o.type!==l.Thought&&o.type!==l.Recap;return t.jsx(le,{open:s&&(r.queries>0||r.sources>0)?void 0:!1,align:"start",side:"bottom",sideOffset:0,label:t.jsx(mt,{counters:r}),children:t.jsx("button",{disabled:a,onClick:x,className:"relative w-full text-start",children:t.jsxs("div",{className:"flex w-full items-center justify-between text-start",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{mode:"popLayout",children:t.jsxs(p.span,{className:C("flex items-center gap-1 align-middle",!s&&"loading-shimmer font-medium",s&&(a?"text-token-text-secondary":"text-token-text-secondary hover:text-token-text-primary")),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,overflow:"hidden",whiteSpace:"nowrap"},transition:{duration:.3},children:[u&&t.jsx(he,{chunk:o,isAnimated:!s,size:"medium",className:"text-token-text-secondary"}),g]},g)}),!a&&s&&t.jsx(ut,{isExpanded:e})]}),!a&&!s&&t.jsx(dt,{isExpanded:e})]})})})},ut=({isExpanded:e})=>t.jsx(be,{className:C("icon-sm text-token-text-secondary inline align-middle transition-transform",e&&"rotate-90")}),dt=({isExpanded:e})=>t.jsx(le,{delayDuration:0,label:e?t.jsx(S,{id:"B/w5NU",defaultMessage:"Collapse"}):t.jsx(S,{id:"FWOPW7",defaultMessage:"Expand"}),className:"hover:bg-token-surface-hover absolute end-0 flex rounded-md p-1.5",children:e?t.jsx(Oe,{className:"icon-md text-token-text-secondary"}):t.jsx(qe,{className:"icon-md text-token-text-secondary"})}),mt=({counters:e})=>t.jsx(t.Fragment,{children:(e.queries>0||e.sources>0)&&t.jsxs(t.Fragment,{children:[e.queries>0&&t.jsx(S,{id:"JPkpiw",defaultMessage:"{queriesCount} searches",values:{queriesCount:e.queries}}),e.queries>0&&e.sources>0&&t.jsxs(t.Fragment,{children:[" Â·"," "]}),e.sources>0&&t.jsx(S,{id:"QnBAXR",defaultMessage:"{sourcesCount} sources",values:{sourcesCount:e.sources}})]})}),ht="_markdown_1frq2_10",gt="_fade_1frq2_1",ft={markdown:ht,fade:gt};function I(e,a,s){switch(a.type){case l.Thought:return a.thought.summary;case l.Recap:return a.content;case l.Search:return s?e.formatMessage({id:"+a5J9x",defaultMessage:"Searched the web"}):e.formatMessage({id:"GamH3R",defaultMessage:"Searching the web"});case l.CodeAnalysis:return s?e.formatMessage({id:"SGdXPO",defaultMessage:"Analyzed"}):e.formatMessage({id:"rEhiFx",defaultMessage:"Analyzing"});case l.ImageAnalysis:return s?e.formatMessage({id:"fjqIXj",defaultMessage:"Analyzed image"}):e.formatMessage({id:"D//PTx",defaultMessage:"Analyzing image"});case l.ComputerOutput:return s?"Reasoned":"Reasoning"}}const xt=({chunk:e,isExpanded:a,isComplete:s})=>{const n=k(),[o,r]=e.messages,x=Qe(o)!=null;return t.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[a&&I(n,e,s),x&&t.jsxs("div",{children:[t.jsx(Xe,{message:o,forceDarkMode:!0,FormattedText:me,showActionBar:!1,codeRendererClassName:C("rounded-md max-h-[calc(clamp(20px,1/4*var(--thread-safe-area-height,100lvh),400px))] overflow-auto",r&&"rounded-b-none"),codeContainerClassName:"overflow-visible!"}),r&&t.jsx(Je,{forceDarkMode:!0,wrapperClassName:"max-h-[calc(clamp(20px,1/8*var(--thread-safe-area-height,100lvh),200px))] w-full overflow-auto dark rounded-b-md",codeContainerClassName:"whitespace-pre-wrap",message:r,showLabel:!1})]})]})},pt=({chunk:e,isExpanded:a,isComplete:s})=>{const n=k(),o=e.messages[1],r=we(),{isUnauthenticated:x}=Ne(),h=o.metadata?.aggregate_result?.messages.find(Ke),g=h?.image_url&&Le(h.image_url),{data:u}=Me(g?Ze(g,x):{enabled:!1,queryKey:[]}),f=u?.status===Te.Success?u.download_url:void 0,{isSuccess:c}=de(f),[v]=i.useState(c);return t.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[a&&I(n,e,s),t.jsxs("div",{className:"bg-token-bg-secondary relative flex h-[calc(clamp(150px,1/4*var(--thread-safe-area-height,100lvh),400px))] justify-center overflow-hidden rounded-md p-2",children:[f&&t.jsx(p.div,{initial:{opacity:v?.5:0,scale:1.1},animate:{opacity:c?.5:0,scale:s||r?1.1:[1.1,1.25,1.1]},transition:{opacity:{ease:"easeInOut"},scale:s?{type:"spring",stiffness:300,damping:20}:{duration:2.5,repeat:1/0,ease:"easeInOut"}},className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-40 blur-lg filter",style:{backgroundImage:`url(${JSON.stringify(f)})`}}),t.jsx(p.div,{initial:{opacity:v?1:0},animate:{opacity:c?1:0},className:"relative *:m-0 *:h-full *:w-full *:rounded-md *:object-center *:shadow-lg",children:t.jsx($e,{isCoT:!0,message:o})})]})]})},vt=4,yt=3,Ct=3,jt={hidden:{opacity:0},visible:{opacity:1}},re={hidden:{opacity:0,x:-5},visible:{opacity:1,x:0}},St=({chunk:e,isExpanded:a,isComplete:s})=>{const{queries:n,sources:o}=e,r=k(),[x,h]=i.useState(s);return t.jsxs("div",{className:"flex min-w-0 flex-col gap-2 text-sm",children:[a&&I(r,e,s),t.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[t.jsx(ie,{isComplete:s,items:n,max:Ct,getKey:g=>g.q,Item:wt,ShowMoreButton:_t,onAnimationComplete:()=>h(!0)}),t.jsx(ie,{isComplete:s,items:x?o:[],max:vt,getKey:g=>g.entries[0].url,Item:Mt,ShowMoreButton:kt})]})]})},ie=({isComplete:e,items:a,max:s,getKey:n,Item:o,ShowMoreButton:r,onAnimationComplete:x})=>{const[h,g]=i.useState(!1),[u,f]=a.length>s?[a.slice(0,s-1),a.slice(s-1)]:[a];return t.jsxs(p.div,{className:"flex flex-wrap items-center gap-1",initial:e?"visible":"hidden",animate:"visible",transition:{duration:.25,staggerChildren:.1,delayChildren:.3},onAnimationComplete:x,children:[u.map(c=>t.jsx(p.div,{variants:jt,className:"flex max-w-full items-center",children:t.jsx(o,{item:c})},n(c))),h&&t.jsx(p.div,{className:"contents",initial:"hidden",animate:"visible",transition:{duration:.2,staggerChildren:.02},children:f?.map(c=>t.jsx(p.div,{variants:re,className:"flex max-w-full items-center",children:t.jsx(o,{item:c})},n(c)))}),f&&t.jsx(p.div,{variants:re,className:"flex items-center",children:t.jsx(r,{moreItems:f,isShowingMore:h,onClick:()=>g(c=>!c)})},"more")]})},wt=({item:e})=>t.jsxs(R,{componentType:"span",children:[t.jsx(De,{className:"-ms-1 h-3 w-3 shrink-0"}),t.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:e.q})]}),Mt=({item:e})=>{const a=e.entries[0],s=i.useMemo(()=>({url:a.url,title:a.title}),[a.url,a.title]);i.useEffect(()=>{T.logEventWithStatsig("link_action","link_action",{...s,action:"show"})},[s]);const n=()=>{T.logEventWithStatsig("link_action","link_action",{...s,action:"click"})};return t.jsxs(R,{componentType:He,href:a.url,onClick:n,children:[t.jsx(ge,{url:a.url}),a.attribution??Ue(a.url)]})},ge=({url:e,withBorder:a=!1})=>{const{isSuccess:s,isError:n}=de(ze(e,32)),[o]=i.useState(s);return n?null:t.jsx(p.div,{initial:{opacity:o?1:0},animate:{opacity:s?1:0},className:C("bg-token-main-surface-primary -ms-3 box-content h-3 w-3 shrink-0 overflow-hidden rounded-full first:-ms-1",a&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:t.jsx(Be,{url:e,size:32,minSize:16,className:"m-0"})})},kt=({moreItems:e,isShowingMore:a,onClick:s})=>t.jsx(R,{onClick:s,children:a?t.jsx(S,{id:"19fGXl",defaultMessage:"Show less"}):t.jsxs(t.Fragment,{children:[e.slice(0,yt).map((n,o)=>t.jsx(ge,{url:n.entries[0].url,withBorder:!0},o)),t.jsx(S,{id:"5ob5C8",defaultMessage:"{count} more",values:{count:e.length}})]})}),_t=({moreItems:e,isShowingMore:a,onClick:s})=>t.jsx(R,{onClick:s,children:a?t.jsx(S,{id:"0SWns2",defaultMessage:"Show less"}):t.jsx(S,{id:"PpZw7t",defaultMessage:"{count} more",values:{count:e.length}})}),R=({className:e,componentType:a="button",children:s,...n})=>t.jsx(a,{className:C(tt,"group max-w-full gap-1",(n.href!=null||n.onClick!=null)&&"hover:bg-token-main-surface-primary-inverse hover:text-token-text-inverted dark:hover:bg-token-text-primary",e),...n,children:s}),bt=({children:e,onMeasure:a})=>{const[{height:s},n]=We();return Ie(()=>{s&&a?.(s)},[s]),t.jsx("div",{className:"flex",ref:n,children:e})};var fe=(e=>(e.STATIC="static",e.ENTER="enter",e.STAGE="stage",e))(fe||{});const Nt=({isAnimationComplete:e=!1,isExpanded:a=!1,isLast:s=!1,index:n,chunk:o,onClick:r,onMeasure:x,onAnimationComplete:h,showBullet:g=!1})=>{const u=s||a,f=!s||e,c=f?"static":"stage",v=f?"static":"enter",m=i.useRef(null);m.current=()=>{h?.(n,"enter")},i.useEffect(()=>{if(v!=="enter")return;const y=setTimeout(()=>{z.count(B.COT_SUMMARIZER,"cot_chunk_timeout"),m.current?.()},at);return()=>clearTimeout(y)},[v]);const A=v==="static";return t.jsx(p.div,{role:a?void 0:"button",variants:{static:{opacity:1,scale:1,position:"static",translateY:0},enter:{position:"static",translateY:0,scale:1,opacity:1},stage:{position:"absolute",translateY:-N,scale:.95,opacity:0}},initial:c,animate:v,exit:a?void 0:{opacity:0,pointerEvents:"none",position:"absolute",translateY:N,filter:"blur(8px)"},style:{zIndex:n},transition:e||v==="static"?{duration:0}:{type:"spring",bounce:.05},className:C("text-token-text-secondary start-0 end-0 top-0 origin-left",!u&&"pointer-events-none"),onAnimationComplete:y=>y!=="enter"&&h(n,y),onClick:r,children:t.jsx(bt,{onMeasure:y=>{x(n,y*(c==="stage"?1/.95:1))},children:t.jsx(Ge,{onComplete:m.current,isDisabled:A,defaultDelayPerSegmentMs:20,children:g?t.jsxs("div",{className:"flex w-full items-start gap-2 overflow-clip",children:[t.jsxs("div",{className:"flex h-full w-4 shrink-0 flex-col items-center gap-2",children:[t.jsx("div",{className:"flex h-5 shrink-0 items-center justify-center",children:t.jsx(he,{chunk:o,size:"small"})}),!s&&t.jsx(p.div,{initial:{translateY:-N,opacity:0},animate:{translateY:0,opacity:1},className:"bg-token-border-medium h-full w-[1px] rounded-full"})]}),t.jsx(ce,{chunk:o,isExpanded:a,isComplete:f})]}):t.jsx(ce,{chunk:o,isExpanded:a,isComplete:f})})})})},Tt=i.memo(Nt),ce=({chunk:e,isExpanded:a,isComplete:s})=>{switch(e.type){case l.Thought:return t.jsx(It,{content:e.thought.content});case l.Recap:return t.jsx("div",{className:"text-token-text-secondary text-sm",children:t.jsx(S,{id:"Eo2n2s",defaultMessage:"Done"})});case l.Search:return t.jsx(St,{chunk:e,isExpanded:a,isComplete:s});case l.CodeAnalysis:return t.jsx(xt,{chunk:e,isExpanded:a,isComplete:s});case l.ImageAnalysis:return t.jsx(pt,{chunk:e,isExpanded:a,isComplete:s});case l.ComputerOutput:return null}},It=({content:e})=>t.jsx(me,{className:C(ft.markdown,"text-token-text-secondary text-sm"),componentOverrides:{code:a=>t.jsx(et,{...a,wrapperClassName:"",showActionBar:!1})},children:e}),Rt={duration:.3,ease:"easeInOut"},At=.2,is=({isStreaming:e,expandByDefault:a=!1,messageGroups:s})=>{const n=k(),o=Re(Ae(),"3133027893"),[r,x]=i.useState(e?a:!1),[h,g]=i.useState(()=>new Map),u=i.useMemo(()=>rt(s),[s]),f=i.useMemo(()=>ct(u),[u]),c=!e,v=Ee(u,d=>d.type!==l.Recap&&(o||!(e&&d===P(u)))),[m,A]=i.useState(e?-1:u.length),y=m===-1?void 0:u[m],W=m<v||m===v&&!e,V=e?v:u.length,_=Ot(y),[Y,Q]=i.useState(!e||m<0),X=i.useRef(performance.now()),J=i.useRef(performance.now());i.useEffect(()=>{X.current=performance.now()},[m]),i.useEffect(()=>{J.current=performance.now()},[y]);const[K]=i.useState(e);i.useEffect(()=>{if(K&&W&&Y){const d=performance.now(),j=Math.max(0,Et(y)-(d-X.current),_-(d-J.current));setTimeout(()=>{A(V),Q(!1)},j)}},[K,W,Y,_,y,V]);const b=c?u:u.slice(0,m+1),E=P(b),xe=E&&I(n,E,c),Z=[...b.entries()];let $=r?Z:Z.slice(-1);qt(m,c);const w=b.length>0&&u[0].type!==l.Recap,pe=w&&(!c||r),ee=w&&!c&&!r,O=Array.from(h.values()),ve=Ve(O)+(O.length-1)*ae+2*L,ye=c?"auto":r?ve:(P(O)??0)+2*L,Ce=i.useCallback((d,j)=>{d===m&&j===fe.ENTER&&setTimeout(()=>{Q(!0)},_)},[m,_]),q=i.useCallback((d,j)=>{x(d),z.count(B.COT_SUMMARIZER,d?"expand":"collapse",[{key:"is_streaming",value:String(e)},{key:"source",value:j}]),T.logEventWithStatsig(d?"CoT Expanded":"CoT Collapsed",d?"chatgpt_cot_expanded":"chatgpt_cot_collapsed",{is_streaming:String(e),source:j})},[e]),je=i.useCallback(()=>{q(!0,"chunk")},[q]),Se=i.useCallback((d,j)=>{g(F=>{const te=new Map(F);return te.set(d,j),te})},[]);return i.useEffect(()=>{c||m<0||T.logEventWithStatsig(r?"Streamed CoT Chunk Viewed":"Streamed CoT Chunk Ignored",r?"chatgpt_streamed_cot_chunk_viewed":"chatgpt_streamed_cot_chunk_ignored")},[m,c,r,e]),c&&!w?null:t.jsxs("div",{className:"relative my-1 min-h-6",children:[e&&(!w||ee)&&t.jsx("div",{className:"loading-shimmer text-token-text-secondary absolute top-0 select-none",children:t.jsx(S,{id:"hgnsat",defaultMessage:"Thinking"})}),w&&t.jsxs(p.div,{className:C("relative flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] origin-top-left flex-col gap-2 overflow-x-clip",ee&&"bg-token-main-surface-primary border-token-border-default mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4 @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4"),initial:e&&{opacity:0,scale:.85},animate:{opacity:1,scale:1},transition:{ease:"easeOut",duration:At},children:[t.jsx(lt,{latestHeadline:xe,latestChunk:E,counters:f,onToggleExpanded:()=>q(!r,"header"),isExpanded:r,isExpandDisabled:b.length<2,isComplete:c}),t.jsx(D,{children:pe&&t.jsx(p.div,{className:"relative z-0",initial:c?{opacity:0,height:0,overflowY:"hidden"}:!1,animate:{opacity:1,height:ye},exit:{height:0,opacity:0,pointerEvents:"none",overflowY:"hidden",filter:c?"blur(8px)":void 0,translateY:-N},transition:Rt,children:t.jsx("div",{className:"relative flex h-full flex-col",style:{gap:ae,margin:`${L}px 0`},children:t.jsx(D,{children:$.map(([d,j],F)=>t.jsx(Tt,{index:d,chunk:j,isLast:$.length-1===F,onClick:je,onAnimationComplete:Ce,onMeasure:Se,isAnimationComplete:c,isExpanded:r,showBullet:r},d))})})})})]})]})};function Et(e){return e?.type===l.Thought?Math.min(3e3,1e3+e.thought.content.length*3.5):1200}function Ot(e){return e?.type===l.Thought?500:0}function qt(e,a){const s=i.useRef(null),n=st(e),o=i.useCallback(()=>{if(s.current!=null){const r=performance.now()-s.current;z.hist(B.COT_SUMMARIZER,"cot_chunk_display_time",void 0,r)}},[n]);i.useEffect(()=>{if(a){o();return}e!==-1&&(o(),s.current=performance.now())},[e,a,o])}export{is as CoT};
//# sourceMappingURL=c0o2d6hkugb6w3of.js.map
