const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iw93lwbfwtucgu1i.js","assets/khl8ktun31iepecq.js"])))=>i.map(i=>d[i]);
import{e as h,j as t,M,r as g,R as Z,u as Y,d as ee,q as te}from"./khl8ktun31iepecq.js";import{bG as se,cr as ae,bX as N,m as ne,V as re,ag as oe,gM as ie,o as le,dn as F,a as C,cp as ce,l as de,cN as S,ae as ue,bL as P,D as b,M as U}from"./haannt40upmuwmtk.js";import{hE as me,ih as ge,ii as pe,iN as xe,gj as fe,gk as he,hp as R,gl as ye,iO as Ce,hq as be,iP as ve,eY as A,iQ as Se,iR as we,ei as je,bT as Te,f3 as Ee,c1 as Me,ac as Ne,iS as _e,dg as ke,iT as Ie}from"./n4exq6o15ap1g74l.js";import{C as Fe}from"./kiredz58u04n7vci.js";function Re(e){return"children"in e?L(e):"value"in e?e.value:""}function Ae(e){return e.type==="text"?e.value:"children"in e?L(e):""}function L(e){let n=-1;const s=[];for(;++n<e.children.length;)s[n]=Ae(e.children[n]);return s.join("")}const Oe=({content:e,codeLanguage:n,codeSnippetRef:s,clientThreadId:a})=>{const r=h(),o=me(),i=ge(a);if(!pe(i,se.Canvas))return null;function d(){fe.logButtonClick(he.EDIT_IN_CANVAS_CODE_SNIPPET),o&&R.removeTempTextdoc(o.textdocId),s?.current&&ye(s.current);const l=R.createTempTextdoc(e,r.formatMessage({id:"9e0Zzr",defaultMessage:"New document"}),Ce.MESSAGE_CODE_SNIPPET,n);requestAnimationFrame(()=>{be(l)})}return t.jsx(ae,{label:t.jsx(M,{id:"EditInCanvasButton.editTooltip",defaultMessage:"Edit in canvas"}),sideOffset:0,children:t.jsxs("button",{className:"flex items-center gap-1 px-4 py-1 select-none",onClick:d,children:[t.jsx(xe,{className:"icon-xs"}),r.formatMessage({id:"5k0sSJ",defaultMessage:"Edit"})]})})},B=g.createContext({isWithinDataAnalysisToolMessage:!1}),De=Se(()=>ce(()=>import("./iw93lwbfwtucgu1i.js"),__vite__mapDeps([0,1]))),Pe=Z.memo(function({htmlSegment:n}){return t.jsx("span",{dangerouslySetInnerHTML:{__html:n}})}),Ue=e=>{if(e instanceof Element)return e.closest("[data-message-id]")?.getAttribute("data-message-id")??void 0};function Le({wrapperClassName:e,codeClassName:n,language:s,content:a,shouldWrapCode:r,clientThreadId:o,removeTopBorderRadius:i,showActionBar:c=!0,codeContainerClassName:d}){const l=ne(),p=g.useRef(null),x=re(),f=oe(),v=ve(),V=g.useCallback(u=>{u.preventDefault(),u.stopPropagation();const m=window.getSelection()?.toString();m&&A(m,void 0,u)},[]),W=g.useCallback(u=>{const m=(X,k,K)=>{if(f||o==null||k===void 0)return;const I=le(o);I!=null&&we(l,{source:X,type:"copy",messageId:k,serverThreadId:I,selectedText:K,location:"code-snippet"})},Q=Ue(u.target);A(a,x,u),m("mouse",Q,a)},[l,a,x,f,o]),_=h(),{isWithinDataAnalysisToolMessage:q}=g.useContext(B),[y,z]=g.useState(null);g.useEffect(()=>{De().then(u=>{if(u!=null)try{z(u.highlightCode(a,s))}catch(m){if(!(m instanceof Error&&/Unknown language/i.test(m.message)))throw m}})},[a,s]);const J=s==="svg"||(s==="xml"||s==="html")&&ze(a),w=g.useMemo(()=>y?.html.split(/(<span[^>]*>.*?<\/span>)/g).filter(Boolean),[y?.html]),G=J?t.jsx(ie,{svgString:a,className:"max-h-96 w-full"}):w&&w.length>0?t.jsx("span",{children:w.map((u,m)=>t.jsx(Pe,{htmlSegment:u},m))}):y?.html?t.jsx("span",{dangerouslySetInnerHTML:{__html:y.html}}):t.jsx("span",{children:a});return t.jsx(He,{ref:p,title:y?.language??s,shouldWrapCode:r,stickyTitleRightContent:t.jsxs("div",{className:"bg-token-sidebar-surface-primary text-token-text-secondary dark:bg-token-main-surface-secondary flex items-center rounded-sm px-2 font-sans text-xs",children:[q&&t.jsx(Be,{}),t.jsx(Fe,{buttonText:v?_.formatMessage({id:"6NJu7m",defaultMessage:"Copy"}):_.formatMessage({id:"zIa6ZQ",defaultMessage:"Copy code"}),onCopy:W,className:v?"px-4 py-1":"py-1",iconClassName:v?"icon-xs":"icon-sm"}),o&&v&&t.jsx(Oe,{content:a,codeLanguage:s??"",codeSnippetRef:p,clientThreadId:o})]}),codeClassName:n,codeContainerClassName:d,onCopy:V,className:e,removeTopBorderRadius:i,showActionBar:c,children:G})}function Be(){const n=je(!0),{data:s=!1}=Te(F.ShowExpandedCodeView),a=h();return t.jsxs("div",{className:"border-token-border-medium me-2 flex items-center gap-2 border-e pe-2",children:[t.jsx("label",{htmlFor:"ada-always-show",children:t.jsx(M,{defaultMessage:"Always show details",id:"message.tools.codeInterpreter.alwaysShowAnalysis"})}),t.jsx(Ee,{id:"ada-always-show",size:"small",onChange:r=>{n.mutate({setting:F.ShowExpandedCodeView,value:r})},enabled:s,label:s?a.formatMessage({defaultMessage:"Toggle to always expand detail view for code analysis on",id:"message.tools.codeInterpreter.alwaysShowAnalysis.enabled"}):a.formatMessage({defaultMessage:"Toggle to always expand detail view for code analysis off",id:"message.tools.codeInterpreter.alwaysShowAnalysis.disabled"})})]})}function He({children:e,title:n,stickyTitleRightContent:s,shouldWrapCode:a=!1,className:r,codeContainerClassName:o,codeClassName:i,ref:c,onCopy:d,removeTopBorderRadius:l,showActionBar:p=!0}){return t.jsxs($e,{className:r,children:[p&&t.jsxs(t.Fragment,{children:[t.jsx(Ve,{$removeTopBorderRadius:l,children:n}),t.jsx("div",{className:"sticky top-9",children:t.jsx("div",{className:"absolute end-0 bottom-0 flex h-9 items-center pe-2",children:s})})]}),t.jsx(We,{ref:c,className:o,children:t.jsx(qe,{$shouldWrap:a,className:i,onCopy:d,children:e})})]})}const $e=N.div`contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary`,Ve=N.div`flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary select-none ${e=>e.$removeTopBorderRadius?"":"rounded-t-[5px]"}`,We=function({children:n,className:s,ref:a}){return t.jsx("div",{ref:a,className:C("overflow-y-auto p-4",s),dir:"ltr",children:n})},qe=N.code`${e=>e.$shouldWrap?"whitespace-pre-wrap!":"whitespace-pre!"}`;function ze(e){return e.trim().startsWith("<svg")}function Je({node:e,className:n,wrapperClassName:s,children:a,inline:r,clientThreadId:o,removeTopBorderRadius:i,showActionBar:c=!0,codeContainerClassName:d,...l}){if(r)return t.jsx("code",{className:n,...l,children:a});{const p=n?.split(" ").find(f=>f.startsWith("language-"))?.split("-")[1],x=e?Re(e):"";return t.jsx(Le,{clientThreadId:o,language:p,wrapperClassName:s,codeContainerClassName:d,codeClassName:n,content:x,removeTopBorderRadius:i,showActionBar:c})}}function H(e){return e.type==="element"}function Ge(e){return H(e)?e.tagName==="code":!1}function ot(){return function(e){Me(e,"element",function(n,s,a){Ge(n)&&(a&&H(a)&&a.tagName==="pre"?n.properties.inline=!1:n.properties.inline=!0)})}}function O({jupyterMessage:e}){const n=Ne(),s=h(),{width:a,height:r}=e;if(n)return t.jsxs("div",{className:"text-token-text-tertiary my-1 flex h-52 w-full max-w-xs flex-col items-center justify-center gap-2 rounded-md border-black/5 bg-gray-100 p-7 text-center dark:border-white/10",children:[t.jsx(_e,{className:"icon-lg"}),t.jsx(M,{...T.imageNotSupported})]});if(e.image_payload!=null)return t.jsx("img",{className:"my-1 max-h-full max-w-full object-contain",src:`data:image/png;base64,${e.image_payload}`,alt:s.formatMessage(T.altText),width:a,height:r});if(e.image_url!=null){const o=ke(e.image_url);return t.jsx(Ze,{fileId:o,width:a,height:r})}return null}const Qe=30*1e3,$=100,j=1.5,Xe=Math.log(1-Qe*(1-j)/$)/Math.log(j);function Ke(e,n){return te({queryKey:["getFileDownloadLink",e],queryFn:()=>ue.getFileDownloadLink(e,void 0,n),refetchInterval:s=>{const a=s.state.dataUpdateCount;return s.state.data?.status===S.Success||a>Xe||s.state.status===S.Error?!1:Math.pow(j,a)*$}})}function Ze({fileId:e,width:n,height:s}){const a=h(),{isUnauthenticated:r}=de(),{data:o,isLoading:i,refetch:c}=Y(Ke(e,r));return g.useEffect(()=>{if(o?.status===S.Success){const l=new URL(o.download_url,location.toString()).searchParams.get("se");l!=null&&!i&&new Date>new Date(l)&&c()}},[o,i,c]),o?.status!==S.Success?null:t.jsx("img",{src:o.download_url,className:"my-1 max-h-full max-w-full object-contain",alt:a.formatMessage(T.altText),width:n,height:s})}const T=ee({imageNotSupported:{id:"CodeExecutionOutputImage.imageNotSupported",defaultMessage:"Image output is not supported in a shared chat"},altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function it({FormattedText:e,message:n,codeRendererClassName:s,forceDarkMode:a,removeTopBorderRadius:r,showActionBar:o,codeContainerClassName:i}){const c=P()||a,d=Ye(n);return d==null?null:t.jsx(B.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:t.jsx(e,{className:C("markdown prose dark:prose-invert w-full break-words",c?"dark":"light"),forceDarkMode:a,componentOverrides:{code:l=>t.jsx(Je,{...l,wrapperClassName:s,codeContainerClassName:i,removeTopBorderRadius:r,showActionBar:o})},children:d})})}function Ye(e){function n(s,a){return`\`\`\`${a}
${s}
\`\`\``}if(e.content.content_type==="code")return n(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")return b.addError("Unexpected content type for code message"),null;const s=e.content.parts;return s.length!==1||typeof s[0]!="string"?(b.addError("Unexpected parts for code message"),null):n(s[0],"python")}return b.addError("Unexpected code message format"),null}function lt({message:e,showLabel:n=!0,wrapperClassName:s,codeContainerClassName:a,forceDarkMode:r}){const o=h();if(e.content.content_type!==U.ExecutionOutput)return null;const i=e.metadata?.aggregate_result;if(!i)return b.addError("Corrupt code execution result message"),null;const c=i.messages.filter(tt),d=c.length>0,l=i.final_expression_output!=null,p=i.in_kernel_exception!=null;return t.jsxs(t.Fragment,{children:[d&&t.jsx(D,{forceDarkMode:r,label:n?"STDOUT/STDERR":null,wrapperClassName:s,output:c.map((x,f)=>t.jsx("span",{className:x.stream_name==="stderr"?"text-red-500":"",children:x.text},`${f}`))}),l&&t.jsx(D,{forceDarkMode:r,wrapperClassName:s,codeContainerClassName:a,label:n?o.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}):null,output:i.final_expression_output}),p&&t.jsx(et,{traceback:i.in_kernel_exception.traceback.join("")})]})}function D({wrapperClassName:e,label:n,output:s,codeContainerClassName:a,forceDarkMode:r}){const o=P()||r;return t.jsxs("div",{className:C("bg-token-sidebar-surface-primary p-4 text-xs",e),children:[n&&t.jsx("div",{className:"mb-1 text-gray-400",children:n}),t.jsx("div",{className:C("prose flex flex-col-reverse",o?"text-white":"text-black"),children:t.jsx("pre",{className:C("shrink-0 overflow-visible",a),children:s})})]})}function et({traceback:e}){return t.jsx("div",{className:"overflow-auto border-t border-gray-500 bg-black text-white",children:t.jsx("div",{className:"border-s-4 border-red-500 p-2 text-xs",children:t.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:t.jsx("pre",{className:"shrink-0",children:e})})})})}function ct({message:e,isCoT:n=!1}){if(e.content.content_type!==U.ExecutionOutput)return null;const s=e.metadata?.aggregate_result;return s?n?s.messages.filter(E).map((a,r)=>t.jsx(O,{jupyterMessage:a},r)):t.jsx("div",{className:"flex flex-wrap gap-2",children:s.messages.filter(E).map((a,r)=>t.jsx("div",{className:"max-h-64 items-start justify-start sm:max-h-80",children:t.jsx(O,{jupyterMessage:a})},r))}):(b.addError("Corrupt code execution result message"),null)}function tt(e){return e.message_type==="stream"}function E(e){return e.message_type==="image"||"image_url"in e&&Ie(e.image_url+"")}function dt(e){return e.metadata?.aggregate_result?.messages.some(E)??!1}export{ct as C,it as a,lt as b,Ke as c,Je as d,O as e,Ye as g,dt as h,E as i,ot as r};
//# sourceMappingURL=ici1r2pdfnai9c6r.js.map
