import{j as e,M as y,a8 as w,r as m}from"./khl8ktun31iepecq.js";import{W as v}from"./eiq9v0oy1lyfg3c8.js";import{aI as _,aJ as S,aK as R,aL as T,R as F,aM as z,ay as A,aA as D,aN as j,aO as E,aP as L,aQ as W,aR as q}from"./n4exq6o15ap1g74l.js";import{P as x,a as H}from"./dblaaxd78ezocyc0.js";import{o as O,R as k,aN as U}from"./haannt40upmuwmtk.js";const J={positive:A,negative:D,neutral:j,mixed:j},K={positive:"Positive",negative:"Negative",neutral:"Mixed",mixed:"Mixed"};function se({clientThreadId:s,messageId:a,product:i,trackContentReferenceEvent:o,onProductEntityUpdated:n}){const{productInfo:t,isLoading:d,isCached:u}=G({clientThreadId:s,messageId:a,product:i}),[r]=m.useState(u);return m.useEffect(()=>{n&&t.productEntity&&n(t.productEntity)},[t.productEntity,n]),E(),e.jsx("div",{children:d?e.jsxs("div",{className:"flex flex-col gap-4 px-6 pb-6",children:[e.jsx(x,{index:0,width:50,heightSize:"sm"}),e.jsxs(H,{children:[e.jsx(x,{index:1,width:100,heightSize:"sm"}),e.jsx(x,{index:2,width:100,heightSize:"sm"}),e.jsx(x,{index:3,width:30,heightSize:"sm"})]})]}):e.jsxs("div",{className:"bg-token-bg-primary flex flex-col",children:[e.jsx(Q,{contentReference:t.productRationale,trackContentReferenceEvent:o,disableAnimation:r}),e.jsx(X,{contentReference:t.productReviews,trackContentReferenceEvent:o,disableAnimation:r}),!1]})})}function Q({contentReference:s,trackContentReferenceEvent:a,disableAnimation:i}){return s?e.jsx(_,{title:e.jsx(y,{id:"XgsZPF",defaultMessage:"Why you might like this"}),children:e.jsx("div",{className:"text-sm",children:e.jsx(S,{isDisabled:i,children:e.jsxs(R,{tag:"p","data-start":0,"data-end":s.rationale.length,children:[e.jsx("span",{className:"me-1",children:s.rationale}),e.jsx(Z,{citations:s.citations,trackContentReferenceEvent:a,analyticsMetadata:{section:"product_rationale"}})]})})})}):null}function X({contentReference:s,trackContentReferenceEvent:a,disableAnimation:i}){function o(t){return new URL(t).hostname.replace(/^www\./,"")}function n(t){return s?t.cite?s.cite_map[t.cite]?.url:t.cite_url:null}return s?e.jsx(_,{title:e.jsx(y,{id:"p8XHcJ",defaultMessage:"What people are saying"}),children:e.jsxs("div",{className:"flex flex-col gap-6",children:[s.summary&&e.jsx(S,{isDisabled:i,children:e.jsx(T,{className:"-mb-2 text-sm",children:s.summary})}),s.reviews.map((t,d)=>{const u=J[t.sentiment??"neutral"],r=n(t);return e.jsxs(w.div,{className:"relative flex flex-col gap-2",...!i&&{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4}},children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(F,{url:r??"",className:"h-8 w-8 rounded-full",size:128,minSize:16,fallback:e.jsx(z,{className:"text-token-text-tertiary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.source}),e.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-1 text-xs",children:[e.jsx("div",{children:r?o(r):""}),t.sentiment&&e.jsxs(e.Fragment,{children:["Â·",e.jsx(u,{className:"icon-sm text-token-text-secondary"}),K[t.sentiment]]})]})]})]}),e.jsxs("div",{className:"text-sm",children:[t.theme&&e.jsx("div",{className:"font-semibold",children:t.theme}),e.jsx("span",{className:"me-1",children:t.summary}),e.jsx($,{cite:t.cite,contentReference:s,trackContentReferenceEvent:a})]})]},d)})]})}):null}function Z({citations:s,trackContentReferenceEvent:a,analyticsMetadata:i}){return!s||s.length===0||!a?null:e.jsx("div",{className:"inline-flex flex-row gap-1",children:s.map((o,n)=>e.jsx(v,{webpageItem:o,trackContentReferenceEvent:a,analyticsMetadata:{section_location:"response",...i},noMarginStart:!0},n))})}function $({cite:s,contentReference:a,trackContentReferenceEvent:i,analyticsMetadata:o}){const{cite_map:n}=a,t=s?n[s]:null;return!t||!i?null:e.jsx(v,{webpageItem:t,trackContentReferenceEvent:i,analyticsMetadata:{section:"product_reviews",section_location:"response",...o},noMarginStart:!0})}async function*B({conversationId:s,messageId:a,productQuery:i,evalPreset:o},n){const t=q(`${U}/search/product_info`,{method:"POST",headers:{...k.getAuthedHeaders({isAuthOptional:!0}),"Content-Type":"application/json"},body:{conversation_id:s,message_id:a,product_query:i,eval_preset:o},signal:n});for await(const d of t)"data"in d&&(yield d.data)}const p=new Map;function G({clientThreadId:s,messageId:a,product:i}){const o=O(s)??s,n=[o,a,i.title].join(":"),[t,d]=m.useState(p.get(n)??{productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0}),[u,r]=m.useState(!1),h=m.useRef(!1);return m.useEffect(()=>{async function b({conversationId:g,messageId:P,productQuery:N}){if(h.current)return;const f=L({namespace:W.ProductSidebar});try{h.current=!0,r(!0);const I=new URLSearchParams(window.location.search).get("product_reviews_eval_preset"),M=B({conversationId:g,messageId:P,productQuery:N,evalPreset:I});let c={productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0};for await(const l of M)l.type==="product_reviews"?(c={...c,productReviews:l},f.logTiming("time_to_first_review")):l.type==="product_rationale"?(c={...c,productRationale:l},f.logTiming("time_to_rationale")):l.type==="product_entity"?(c={...c,productEntity:l},f.logTiming("time_to_product_entity")):l.type==="__debug"&&(c={...c,__debug:l}),["product_reviews","product_rationale"].includes(l.type)&&r(!1),d(c);p.set(n,c)}finally{h.current=!1,r(!1),f.logTiming("sidebar_loaded")}}(async function(){p.has(n)||o&&a&&await b({conversationId:o,messageId:a,productQuery:i.title})})()},[a,i.title,n,o]),{productInfo:t,isLoading:u,isCached:p.has(n)}}export{se as P,Q as a,X as b};
//# sourceMappingURL=dlwdwnl197lh1mf5.js.map
