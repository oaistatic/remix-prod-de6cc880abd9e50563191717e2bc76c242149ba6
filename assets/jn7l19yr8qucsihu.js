const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/k0515ugmnvo5fanm.js","assets/haannt40upmuwmtk.js","assets/khl8ktun31iepecq.js","assets/root-eulobrch.css","assets/n4exq6o15ap1g74l.js","assets/conversation-small-bh1estgu.css","assets/c6cvb002ahbvyqou.js","assets/fzqqp5co14uzbyc0.js","assets/o1bzkr20ape07jec.js","assets/l0u04bzc302go3qr.js","assets/k1s179c6hw2g8g6f.js","assets/gy64pge8qevmvg7e.js","assets/df5ydpeigsqu9j4m.js","assets/hvdwpbr2ljyv44tg.js","assets/njo9pfieeq6nr82k.js","assets/i6znoehwjoglo80e.js","assets/n1d2aipnlhx1bwjb.js","assets/f4utbn0o0nytlu92.js"])))=>i.map(i=>d[i]);
import{j as e,r as i,M as U,ao as Ln,al as Dn,ai as ks,a8 as O,d as Ys,f as Un,a9 as fe,e as Ae,R as Bn}from"./khl8ktun31iepecq.js";import{bm as Xs,d9 as Hn,ky as We,dF as On,mJ as Qs,mK as Ms,mL as Gn,lO as Vn,lR as zn,mM as Js,mN as Wn,mO as qn,mP as Me,mQ as $n,aO as Zs,mR as Kn,gw as Yn,gx as Xn,mC as me,eM as et,mz as Qn,mu as te,b9 as Jn,mS as st,mT as Zn,mU as ea,mV as sa,mW as tt,eU as ta,eV as na,eX as aa,mX as oa,W as nt,eW as ra,mA as at,mY as ot,e7 as ia,mZ as la,m_ as ca,m$ as da,me as ua,n0 as ma,n1 as ga,n2 as ha,n3 as we,iI as rt,aX as pa,iA as fa,n4 as xa,as as va,cb as ba,gs as ge,a5 as it,aD as lt,n5 as ct,n6 as dt,ax as ya,ay as ut,az as _a,aA as mt,n7 as Sa,n8 as Ta,n9 as ja,na as Ca,E as ka,cV as gt,cW as ht,c2 as pt,d as Ma,nb as wa,nc as Ia,c6 as Ea,e_ as Na,d7 as Ra,nd as Aa,ne as ft,ac as Fa,nf as Pa,g5 as La,ja as Da,x as Ua,cd as xt,ng as Ba,gv as Ha,nh as Oa,c4 as Ga,ni as Va,k_ as za,nj as Wa,nk as qa,nl as $a,nm as Ka,ca as Ya,jo as Xa,gI as Qa,nn as Ja,c7 as Za,no as eo,np as so,jb as to,nq as no,nr as ao,ki as qe,ns as oo,kj as Ne,nt as $e,d6 as ro,nu as io,nv as vt,gK as lo,bL as co,jl as uo,nw as mo,nx as go,ny as ho,nz as po,mx as fo,nA as xo,nB as vo,nC as bo,nD as yo,nE as _o,nF as So,nG as To,nH as jo,bb as Co,nI as ko,aG as Mo,jH as wo,jI as Io}from"./n4exq6o15ap1g74l.js";import{a as D,co as le,bX as ne,cp as de,gI as bt,bL as Eo,aj as J,n as ws,F as L,D as Ke,B as A,b8 as he,bf as es,o as ce,E as Re,fD as No,b9 as yt,ak as ss,z as G,aA as Ye,R as _t,cH as St,P as B,bF as X,aL as ts,ft as Tt,aG as pe,e9 as Ro,cF as K,cr as Ao,dR as Fo,e6 as Po,fc as Lo,am as Y,a_ as Do,bz as Uo,h2 as Bo,m as jt,V as Ct,T as Ho,cK as kt,ag as Mt,cJ as Oo,e3 as Go,dP as Vo,cX as zo,I as wt,l as It,aH as Et,cL as Wo,gp as qo,f9 as $o,gf as Oe,ap as Ko,fb as Yo,M as Xo,ac as Is,gF as Qo,gG as Jo,cq as Zo,K as er,db as Es,fS as sr,gU as tr,b$ as nr,fM as ar}from"./haannt40upmuwmtk.js";import"./l6prrb6nf9agh4ql.js";import{M as or,O as rr}from"./d7qdtm0x38jq0qqt.js";import{a as ir,G as lr}from"./m4g7yy9fehqi204r.js";import{C as Xe,F as cr}from"./iuzjvviw85b4ghdw.js";import{b as Nt}from"./dblaaxd78ezocyc0.js";import{u as Rt}from"./jjqeoesb3rhorlyg.js";import{u as dr}from"./i7mohl0pdm5438yu.js";const ur="bg-token-main-surface-primary text-token-text-primary",mr="openai",Ns=["bg-blue-300 text-white"];function gr(t){return Ns[(t?.charCodeAt(0)??0)%Ns.length]}const Ie=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:D(i.isValidElement(t)&&t.type===We?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Qe(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",d=n[0]?.metadata?.shared_conversation_id,c=d!=null,g=Xs(),{gizmoEditorData:u,mode:p}=Hn();let y=e.jsx(Ie,{children:e.jsx(We,{className:s??ur,iconName:mr,size:r})});return o?y=e.jsx(Ie,{children:e.jsx(ir,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):u!=null&&p==="test"&&(y=e.jsx(lr,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?c?e.jsx(Ie,{children:e.jsx(We,{className:gr(d),iconName:"user",size:r})}):e.jsx(Ie,{children:e.jsx(On,{user:g,size:r})}):y})}const Rs=le(()=>de(()=>import("./k0515ugmnvo5fanm.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult));function As(t,n,a){he(t,s=>{es.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const Fs=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function hr(t){const n=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(At,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(pr,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function pr(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=ns(),l=bt(),d=Eo(),[c,g]=a,u=i.useMemo(()=>Qs(c+g)()>=.5,[c,g]),[p,y]=u?[g,c]:[c,g],[v,h,T]=J(n,_=>{const R=ws(_).tree.getLeafFromNode(p).id,I=ws(_).tree.getLeafFromNode(y).id,S=L.getConversationTurns(_,R),E=L.getConversationTurns(_,I),w=s<S.length?S[s]:null,j=s<E.length?E[s]:null;return w||Ke.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:S.length,lastTurnRole:A(S)?.role,lastMessageAuthor:A(A(S)?.messages)?.author,lastMessageContentType:A(A(S)?.messages)?.content.content_type,lastMessageMetadata:A(A(S)?.messages)?.metadata,altTurnCount:E.length,altLastTurnRole:A(E)?.role,altLastMessageRole:A(A(E)?.messages)?.author.role}),j||Ke.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:E.length,lastTurnRole:A(E)?.role,lastMessageAuthor:A(A(E)?.messages)?.author,lastMessageContentType:A(A(E)?.messages)?.content.content_type,lastMessageMetadata:A(A(E)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:A(S)?.role,altLastMessageRole:A(A(S)?.messages)?.author.role}),[R,w,j]}),[C,k]=u?[T,h]:[h,T],N=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(Ms.setState({displayingSideBySideFeedback:!0}),()=>{Ms.setState({displayingSideBySideFeedback:!1})}),[]),Gn();const F=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),m=i.useCallback((_,{shouldSubmitParagenFeedback:R=!0}={})=>{if(!h||!T||!C||!k)throw new Error("Expected both turns to exist");he(n,P=>{es.setCurrentBranch(P,_)});const I=_===p,S=_===c;C.messages.length>0&&As(n,C.messages[C.messages.length-1].id,S?"original":"new"),k.messages.length>0&&As(n,k.messages[k.messages.length-1].id,S?"original":"new");const E=ce(n),w=[h,T].map((P,z)=>({messageId:P.messages[P.messages.length-1].id,loadFirstTokenTime:z===0?o.current.left:o.current.right,loadEndTime:A(P.messages)?.clientMetadata?.completionSampleFinishTime})),j=I?w[0].messageId:w[1].messageId,f=L.getParentPromptNode(Re(n),v);if(!f)throw new Error("Expected prompt for side by side feedback");const b={},M=f.message.clientMetadata?.variantsInStreamInfo==null&&f.message.metadata?.paragen_variants_info!=null;for(const P of w)b[P.messageId]=M?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:P.loadFirstTokenTime,load_end_time:P.loadEndTime};R&&Hs({params:{conversation_id:E,displayed_message_ids:w.map(P=>P.messageId),message_metadatas:b,rating:"selected",selected_message_id:j,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:f.message.id}})},[n,p,c,C,k,h,T,v,o,t.conversationTurnMountTime,r]);return i.useEffect(()=>No(yt,{requestCompletion:_=>{const R=ce(n),I=L.getParentPromptNode(Re(n),v);if(!I)throw new Error("Expected prompt for side by side feedback");if(!h||!T)throw new Error("Expected both turns to exist");const S=[h,T].map((f,b)=>({messageId:f.messages[f.messages.length-1].id,loadFirstTokenTime:b===0?o.current.left:o.current.right,loadEndTime:A(f.messages)?.clientMetadata?.completionSampleFinishTime})),E={},w=I.message.clientMetadata?.variantsInStreamInfo==null&&I.message.metadata?.paragen_variants_info!=null;for(const f of S)E[f.messageId]=w?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:f.loadFirstTokenTime,load_end_time:f.loadEndTime};const j=_.isForSkippingParagen;Hs({params:{conversation_id:R,displayed_message_ids:S.map(f=>f.messageId),message_metadatas:E,rating:j?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:j?3:r?2:1,user_prompt_message_id:I.message.id}}),j&&m(p,{shouldSubmitParagenFeedback:!1})}}),[h,T,v,n,t.conversationTurnMountTime,N,C?.messages,k?.messages,d,r,o,m,p]),e.jsx(At,{...t,setPreferredFeedback:m,leftVariantId:p,rightVariantId:y,leftTurn:h,rightTurn:T,hasActiveRequest:l,originalTurn:C,visibilityStateRef:F})}function At({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:d,...c}){const g=(s&&Fs(s))??null,u=(o&&Fs(o))??null,p=i.useMemo(()=>s?.messages??[],[s?.messages]),y=i.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:v,firstVisibleTokenTimestampsRef:h}=c,T=i.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),C=i.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),k=Vn(),N=Re(c.clientThreadId),F=A(s?.messages),m=A(o?.messages),_=ss(L.getRequestId(N,F?.id??m?.id)),R=_&&!F?.end_turn,I=_&&!m?.end_turn,S=s?.role===G.User,E=o?.role===G.User,w=i.useRef(null),j=i.useRef(null),f=i.useRef(null),b=s!=null,M=o!=null;!b&&h.current.left==null&&(h.current.left=Date.now()),!M&&h.current.right==null&&(h.current.right=Date.now()),i.useEffect(()=>{if(w.current&&j.current&&f.current){const ee=Array(11).fill(0).map((ve,q)=>q/10),ue=new IntersectionObserver(ve=>ve.forEach(q=>{q.target===j.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=q.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,q.intersectionRatio)):q.target===f.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=q.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,q.intersectionRatio))}),{root:w.current,threshold:ee});return ue.observe(j.current),ue.observe(f.current),()=>ue.disconnect()}},[d]);const{data:P}=zn(void 0,!1,k),z=ns(),xe=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",z?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),z?xe:null]}),z?null:xe,e.jsx("div",{className:D(Js,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:w,children:e.jsxs("div",{className:D("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",z&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!z&&"gap-4 sm:gap-6"),children:[e.jsxs(Ps,{horizontalScrollContainerRef:w,rootElementRef:j,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:b,children:[e.jsxs(Us,{children:[e.jsx(Qe,{messages:p,isUserTurn:S,avatarClassName:v}),e.jsx(Ds,{children:e.jsx(U,{...Os.responseNumber,values:{responseIndex:1,display_label:g}})})]}),z&&b?e.jsx(Ls,{}):e.jsxs(e.Fragment,{children:[P!=null&&!S&&e.jsx(Rs,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),e.jsx(Xe,{...c,allMessages:p,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:S,isFinalUserTurn:!1,isCompletionRequestInProgress:R,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Bs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:s,originalTurn:l})]})]}),e.jsxs(Ps,{horizontalScrollContainerRef:w,rootElementRef:f,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:M,children:[e.jsxs(Us,{children:[e.jsx(Qe,{messages:y,isUserTurn:E,avatarClassName:v}),e.jsx(Ds,{children:e.jsx(U,{...Os.responseNumber,values:{responseIndex:2,display_label:u}})})]}),z&&M?e.jsx(Ls,{}):e.jsxs(e.Fragment,{children:[P!=null&&!E&&e.jsx(Rs,{clientThreadId:c.clientThreadId,messages:y,isParagen:!0}),e.jsx(Xe,{...c,allMessages:y,groupedMessagesToRender:C,allGroupedMessages:C,isFinalUserTurn:!1,isUserTurn:E,isCompletionRequestInProgress:I,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Bs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:o,originalTurn:l})]})]})]})})]})}function Ps({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const l=ns(),{scrollX:d}=Ln({layoutEffect:!1,container:t,target:n}),c=Wn(),g=qn(),u=i.useRef(null),p=i.useRef(null),y=i.useRef(null),[v,h]=i.useState(!1),[T,C]=i.useState(!1),[k,N]=i.useState(!1),[F,m]=i.useState(0);i.useEffect(()=>{if(!l)return;const j=new IntersectionObserver(f=>{for(const b of f)b.target===u.current?h(b.isIntersecting):b.target===y.current?N(b.isIntersecting):b.target===p.current&&C(b.isIntersecting)},{root:c?.current});return u.current&&p.current&&y.current&&(j.observe(u.current),j.observe(p.current),j.observe(y.current)),()=>{j.disconnect()}},[F,l,c]);const _=!k&&(T||v),R=Dn(d,j=>_?-1*j:0),I=ks(0);i.useEffect(()=>{if(!l)return;const j=new ResizeObserver(f=>{Me(f.length===1,"entryList.length === 1");const b=f[0];Me(b.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),I.set(b.contentBoxSize[0].inlineSize)});return n.current&&j.observe(n.current),()=>{j.disconnect()}},[l,I,n]);const S=ks(0);i.useEffect(()=>{if(!l)return;const j=new ResizeObserver(f=>{Me(f.length===1,"entryList.length === 1");const b=f[0];Me(b.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),S.set(b.contentBoxSize[0].blockSize+16),m(b.contentBoxSize[0].blockSize)});return g.current&&j.observe(g.current),()=>{j.disconnect()}},[l,S,g]);const E=e.jsx(St,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),w=r;return e.jsx("div",{"data-paragen-root":!0,className:D("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",l?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:D($n,Js,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:D("absolute top-48 right-0! left-0! h-px","invisible"),ref:u}),e.jsx("div",{className:D("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:p}),e.jsx("div",{className:D("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:y}),s,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:w?null:e.jsx(O.div,{style:{translateX:R,width:I,bottom:S},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:_,"z-20 flex w-full justify-center":!0}),children:E})}):o?null:E]})})}function Ls(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ie,{className:"h-4 w-[75%]"}),e.jsx(ie,{className:"h-4 w-[50%]"}),e.jsx(ie,{className:"h-4 w-[80%]"}),e.jsx(ie,{className:"h-4 w-[55%]"}),e.jsx(ie,{className:"h-4 w-[66%]"}),e.jsx(ie,{className:"h-4 w-[64%]"}),e.jsx(ie,{className:"h-4 w-[48%]"})]})}function ns(){const{layer:t}=Ye("3119715334");return t.get("should-enable-hojicha",!1)}const Ds=ne.div`text-sm text-token-text-secondary font-semibold`,Us=ne.div`flex gap-4 items-center mb-1`,ie=ne.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Bs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=Zs();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],d=l?.metadata?.__internal,c=l?.metadata?.paragen_display_label;if(d){const{model_id:p,model_definition_slug:y,model_definition_virtual_model_id:v,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:C,augmented_paragen_prompt:k}=d;p&&(r+=`
Model ID: ${p}`),y&&(r+=`
Model Slug: ${y}`),v&&(r+=`
Virtual Model ID: ${v}`),h&&(r+=`
Alternative Model Rule: ${h}`),T&&(r+=`
Prompt Group ID: ${T}`),C&&(r+=`
Prompt ID: ${C}`),k&&(r+=`
Prompt: ${k}`),c&&(r+=`
Display Label: ${c}`)}r+=`
Message ID: ${l.id}`;const g=L.getParentPromptNode(Re(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const u=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${n} (persisted)`:A(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Hs({params:t}){await _t.safePost("/paragen_submission",{requestBody:t,anonAware:!0})}const Os=Ys({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function fr({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=J(n,u=>[L.getTurnContentReferences(u,a),L.getConversationTurnAtIndex(u,a).messages]),l=i.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),d=i.useRef(!1);i.useEffect(()=>{d.current||(d.current=!0,B.logEvent("File Sources Footer Shown",l))},[l]);const c=i.useCallback(()=>{B.logEvent("File Sources Footer Clicked",l),t()},[t,l]),g=i.useMemo(()=>{const u=new Set,p=[];function y(h){!h||u.has(h)||(u.add(h),p.push(h))}if(o.forEach(h=>{h.type==="file"?y(h.cloud_doc_url??h.extra?.cloud_doc_url):h.type==="file_navlist"&&h.items.forEach(T=>{y(T.cloud_doc_url)})}),s){for(const h of r)if(Kn(h)){const T=Yn(h.content.result),C=h.metadata?.cloud_doc_urls??[],k=T.chunks;for(let N=0;N<k.length;N++){const F=k[N];if(!F.documentId)continue;if(N<C.length){y(C[N]);continue}const m=F.documentId.endsWith("--google")?F.documentId.split("--")[1]:void 0,_=F.metadata.cloud_doc_url??(m?`https://drive.google.com/file/d/${m}`:void 0);y(_?.toString())}break}}const v=[];for(let h=0;h<p.length;h++){const T=p[h],C=Xn(T);if(C&&v.push(C.Icon),v.length>=3)break}return v},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(O.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:D("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:c,children:[g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((u,p)=>e.jsx(O.div,{className:D("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-sm"})},p))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(U,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function Ft({followups:t,analyticsMetadata:n}){const[a,s]=i.useState(-1),o=i.useRef(!1),r=Rt();return i.useEffect(()=>{o.current||(o.current=!0,t.forEach((l,d)=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...X(n),action:"show",position:d+1,followup_text:me(l)})}))},[t,n]),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((l,d)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:d*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>s(d),onMouseLeave:()=>s(-1),children:[d>0&&e.jsx(Pt,{$isSelected:a===d||a===d-1}),e.jsx(xr,{followUp:l,onSelectingSuggestedReply:r,analyticsMetadata:n,position:d})]},d))})}const Pt=ne.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function xr({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s}){return e.jsxs(O.button,{whileHover:"hover",className:"bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-2 py-3 text-start",onClick:o=>{n(o,t,[],0),B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...X(a),action:"click",position:s+1,followup_text:me(t)})},onMouseEnter:()=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...X(a),action:"hover",position:s+1,followup_text:me(t)})},children:[e.jsx(O.div,{className:"flex items-center justify-center pt-0.5 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(et,{className:"text-token-text-secondary h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:me(t)})]})}const vr=()=>e.jsx(Nt,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),br=t=>({[te.Search]:"Web Search",[te.Research]:"Research",[te.PictureV2]:"Draw Image",[te.Think]:"Think Harder"})[t]??"Title",Je=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...X(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t})},yr=(t,n)=>{const a=i.useRef(!1);i.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Je("show",s,n,o+1)}))},[t,n])},Lt=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Rt();return yr(n,a),e.jsx(e.Fragment,{children:n.map((r,l)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:l*.03},className:D("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&l>0&&e.jsx(Pt,{$isSelected:!1}),e.jsx(_r,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:l+1,analyticsMetadata:a,style:s})]},r.prompt))})},_r=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,style:r="default"})=>{const{setThreadSystemHintMode:l}=Qn(),d=ts(),c=Un();return e.jsx(O.button,{onClick:g=>{if(Je("click",n,s,o),n.categoryId===te.Research)if(d?.isFree()){Jn(c,"Suggested Capabilities Upsell");return}else l(n.categoryId,!0,s);a(g,n,[],0)},onMouseEnter:()=>{Je("hover",n,s,o)},className:D("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",r==="default"&&"gap-4 p-2"),children:r==="compact"?e.jsx(Sr,{clientThreadId:t,suggestion:n}):e.jsx(Tr,{clientThreadId:t,suggestion:n})})},Sr=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=st(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(et,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(Tt,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:me(t)})]})},Tr=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:l,prompt:d}=n,{systemHints:c}=st(t),g=c.find(u=>u.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===te.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(Zn,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??br(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((u,p)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},p))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ea,{isBadge:!0,className:"opacity-100",logo:e.jsx(Tt,{svgString:g?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??d}),l&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[l,e.jsx(O.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(sa,{})})]})]})]})},Ze=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...X(a),tabId:n,position:s,action:t})},jr=(t,n)=>{const a=i.useRef(!1);i.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Ze("show",s.value,n,o+1)}))},[t,n])},Cr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:c,title:g,suggestions:u})=>({value:c,message:g,suggestions:u?.map(tt)??[]})),[l,d]=i.useState(r[0].value);return jr(r,s),e.jsxs(ta,{value:l,onValueChange:d,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(na,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((c,g)=>e.jsx(Mr,{value:c.value,message:c.message,isActive:l===c.value,analyticsMetadata:s,position:g+1},c.value))}),r.map(c=>e.jsx(aa,{value:c.value,children:e.jsx(kr,{initialSuggestions:c.suggestions,clientThreadId:t,categoryId:c.value,isActive:l===c.value,lastMessageId:a,analyticsMetadata:s,style:o})},c.value))]})},kr=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:l="default"})=>{const d=ce(n),c=s&&t.length===0,{suggestions:g,isLoading:u}=oa({categoryId:a,shouldFetch:c,serverThreadId:d,lastMessageId:o}),p=c?g:t;return a==="ask"?u?e.jsx(vr,{}):e.jsx(Ft,{followups:p.map(y=>({type:nt.Reply,text:y.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Gs,{}),e.jsx(Gs,{})]}):e.jsx(Lt,{clientThreadId:n,suggestions:p,analyticsMetadata:r,style:l})})},Mr=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(ra,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{Ze("click",t,s,o)},onMouseEnter:()=>{Ze("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(fe,{children:a&&e.jsx(O.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Gs=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Nt,{lines:3,size:"sm"})})]}),wr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],l=r.suggestions.length>0?r.suggestions:void 0;return o&&l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(Lt,{clientThreadId:t,suggestions:l.map(tt),analyticsMetadata:s,style:r.style})]}):e.jsx(Cr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Ir({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,l]=i.useState(null),d=at.useIsEnabled(t),{capabilitySuggestionsEnabled:c}=ot(),g=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Rr,{visible:r==="conversation"}),e.jsx(Ar,{visible:r==="global"}),d&&(c?g&&e.jsx(wr,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Er,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:l}))]})}function Er({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=pe("2281969373");return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Nr,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(Ft,{followups:n,analyticsMetadata:s})]})}function Nr({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=at.useStore(),[o,r]=i.useState(!1);return e.jsxs(Ro,{size:"small",onOpenChange:l=>r(l),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(ia,{className:D("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(K.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...X(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(U,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(K.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...X(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(U,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Dt={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Rr({visible:t}){return e.jsx(fe,{children:t&&e.jsx(O.div,{...Dt,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(U,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Ar({visible:t}){return e.jsx(fe,{children:t&&e.jsxs(O.div,{id:"disableForAllConvos",...Dt,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(U,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(U,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Fr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:l}=Do(),[d,c]=i.useState("initial");i.useEffect(()=>{if(n){const y=setTimeout(()=>c("show"),500),v=setTimeout(()=>c("initial"),2e3);return()=>{clearTimeout(y),clearTimeout(v)}}c("initial")},[n]);const{shorterLabel:g}=l?.categories.find(({defaultModel:y})=>y===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},p=a?"visible":o?"show":d;return e.jsxs(O.div,{initial:"initial",animate:p,className:"flex items-center pb-0",children:[e.jsx(rt,{className:"icon-md"}),(s||r)&&e.jsx(O.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:u,transition:{type:"tween",duration:.18},children:g}),s&&e.jsx(pa,{className:"icon-sm"})]})}function Ge(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===Uo.RATE_LIMIT&&s===Bo.PLUS&&!n}const Ee="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Pr({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o}){const[r,l]=i.useState(null),[d,c]=i.useState(!1),[g,u]=i.useState(!1),p=a.metadata?.model_slug,y=a.id,v=i.useRef(null),h=F=>{F||setTimeout(()=>{v.current&&v.current.blur()},10)};if(i.useEffect(()=>{h(d)},[d]),J(n,fa))return null;const C=la(n,a.id),k=a.metadata?.model_slug,N=xa(C,k);return e.jsxs(K.Root,{onOpenChange:F=>{o&&(k&&ca(n,k),c(F),h(F))},children:[o?e.jsx(Ao,{sideOffset:0,label:e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Fo,{ref:v,className:D("cursor-pointer",t),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:e.jsx(Fr,{modelSlug:k,animateModelLabelOnRender:N,isDropdownOpen:d,isRegenerateEnabled:o,isHovered:g})})}):null,o&&e.jsx(K.Portal,{children:e.jsxs(K.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(K.Item,{disabled:!0,className:"pt-2 pb-0",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Lr,{clientThreadId:n,messageId:y,message:a,onModelSelect:s,messageModelSlug:p,setHoveredOption:l,hoveredOption:r})]})})]})}function Lr({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:l}){const d=Ae(),{data:c=null}=Po(),g=c&&Lo(c),{modelOptions:u,messageModelEnabledTools:p}=da({clientThreadId:t,message:n}),y=p.includes(te.Search),v=i.useMemo(()=>u.find(m=>m.value===s),[u,s]),[h,T]=i.useMemo(()=>ua(u,m=>m.subcategory),[u]),C=ma(n);i.useEffect(()=>{const m=u.some(_=>Ge(_,g));B.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:m,is_new_regen_dropdown:!0})},[]);const k=i.useMemo(()=>{const m=new Map;return h.forEach(_=>{const R=_.subcategory;R&&(m.has(R)||m.set(R,[]),m.get(R)?.push(_))}),m},[h]),N=D("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),F=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(Ve.search),icon:e.jsx(ga,{className:N}),condition:y&&!C,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(Ve.nosearch),icon:e.jsx(ha,{className:N}),condition:y&&C,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(m=>{const{value:_,...R}=m;return e.jsx(we,{value:_,onSelect:I=>{Y.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:I,requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Ge(m,g),className:Ee,...R,icon:e.jsx("span",{className:N}),clientThreadId:t},_)}),[...k.entries()].map(([m,_])=>e.jsxs(K.Sub,{children:[e.jsx(K.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:m})}),e.jsx(K.Portal,{children:e.jsx(K.SubContent,{className:"min-w-fit",children:_.map(R=>{const{value:I,...S}=R;return e.jsx(we,{value:I,onSelect:E=>{Y.logEvent("chatgpt_regenerate_switch_model_button_clicked",I,{requestedModelId:I,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:E,requestedModelId:I})},includeRegenerate:!1,onMouseEnter:()=>r(I),onMouseLeave:()=>r(null),isHovered:l===I,messageModelSlug:s,includeCheck:!1,className:Ee,...S,icon:null,shouldShowUpsell:Ge(R,g),clientThreadId:t},m+"-"+I)})})})]},m)),!!v&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsx(we,{onSelect:m=>{Y.logEvent("chatgpt_regenerate_try_again_button_clicked",v.value,{requestedModelId:v.value,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:m,requestedModelId:v.value})},includeRegenerate:!0,onMouseEnter:()=>r(v.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ee,...v,label:d.formatMessage(Ve.tryAgain),subtitle:v.label,icon:e.jsx(rt,{className:N}),clientThreadId:t},v.value),F.filter(m=>m.condition).map(m=>e.jsx(we,{onSelect:_=>{Y.logEvent(m.eventName,v.value,{requestedModelId:v.value,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:v.value,extraStreamParams:m.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(m.key),onMouseLeave:()=>r(null),isHovered:l===m.key,messageModelSlug:s,includeCheck:!1,className:Ee,...v,label:m.label,subtitle:"",icon:m.icon,clientThreadId:t},m.key))]})]})}const Ve=Ys({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Dr=i.memo(Pr),Ur=le(()=>de(()=>import("./fzqqp5co14uzbyc0.js"),__vite__mapDeps([7,2,1,3,8,9,4,5,10,11])).then(t=>t.VoicePlayButton)),Br=le(async()=>Promise.resolve(()=>null)),Hr=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=i.useRef(null);return i.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:D("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:D("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-position:100%_0%] [mask-size:300%_100%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Or=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:l,onRate:d,showCanvasButton:c,showCopyButton:g,showPagination:u,showPlayButton:p,showRatingButtons:y,showRegenerateButton:v,isJam:h,turn:T,turnIndex:C})=>{const k=jt(),N=Ae(),F=Ct(),m=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const _=o.findLast(b=>{const[M]=b.author.name?.split(".")??[];return M===Ho.T2UAY3K&&kt.getImageAssetPointers(b).length>0}),R=!!_,I=Mt(),S=va(),E=ba(),w=ce(n),j=!h&&w!=null;let f=null;return j&&(_&&!I&&S()?f=e.jsx(zr,{clientThreadId:n,message:_}):E&&Oo(k,"1547743984").get("show_share_button_inline",!1)&&(f=e.jsx(ge,{onClick:()=>{w&&it.openSharingModal(w)},label:N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:lt}))),e.jsxs(e.Fragment,{children:[u&&e.jsx(ct,{currentPage:t,onChangeIndex:l,length:r}),!1,g&&e.jsx(Ut,{onClick:b=>{dt(k,n,C,F,b)}}),!R&&y&&e.jsxs(e.Fragment,{children:[m!=="thumbsDown"&&e.jsx(ge,{onClick:()=>d("thumbsUp"),disabled:m==="thumbsUp",icon:m==="thumbsUp"?ya:ut,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),m!=="thumbsUp"&&e.jsx(ge,{onClick:()=>d("thumbsDown"),disabled:m==="thumbsDown",icon:m==="thumbsDown"?_a:mt,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&s&&e.jsx(Ur,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!R&&c&&e.jsx(Sa,{turn:T}),v&&s&&e.jsx(Vr,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:R}),f]})},Gr=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:l,showEditMessageButton:d,showPagination:c,turnIndex:g})=>{const u=jt(),p=Ct();return e.jsxs(e.Fragment,{children:[l&&e.jsx(Ut,{onClick:y=>{dt(u,n,g,p,y)}}),d&&e.jsx(Ta,{onAnticipateEdit:s,onEnterEdit:r}),c&&e.jsx(ct,{currentPage:t,onChangeIndex:o,length:a})]})},Vr=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o})=>{const r=ja({clientThreadId:t,conversationMode:n}),l=Ca(t,o),d=i.useCallback(({sourceEvent:c,requestedModelId:g,appendMessages:u,extraStreamParams:p})=>{o&&r({sourceEvent:c,nodeId:o.id,requestedModelId:g,appendMessages:u,extraStreamParams:p})},[o,r]);return s?e.jsx(Br,{messages:a,onModelSelect:d}):e.jsx(Dr,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:d,canRegenerateResponse:l})},Ut=({onClick:t})=>{const[n,a]=i.useState(!1),s=ka(),o=Ae(),r=i.useCallback(l=>{l.stopPropagation(),B.logEvent("ChatGPT Turn Action Copy Clicked"),t(l),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),Y.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(ge,{icon:n?Go:Vo,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function zr({clientThreadId:t,message:n}){const[a,s]=i.useState(!1),o=Ae(),r=dr({clientThreadId:t,messageId:n.id});return i.useEffect(()=>{B.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(ge,{onClick:async()=>{s(!0);try{await r()}finally{s(!1)}B.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:o.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:a?zo:lt,disabled:a})}const Vs=[1,2,3,4,10,20,30],Wr=1,qr=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function $r({clientThreadId:t}){const n=gt(ht.isBusinessWorkspace),a=pt(),s=i.useRef(!1),o=wt(t),[r,l,d,c]=J(t,f=>[f?.mode,L.getRequestId(f),L.getConversationLastTurn(f),L.getConversationTurns(f).filter(b=>b.role===G.Assistant).length]),{isUnauthenticated:g}=It(),u=i.useMemo(()=>{if(!o)return-1;const f=Qs(o);return f()>Wr?-1:Vs[Math.floor(f()*Vs.length)]},[o]),p=ss(l),y=function(){return Math.random()<.5?"default":"personality_v1"},[v,h]=i.useState(null),[T,C]=i.useState(!1),[k,N]=i.useState(!1),[F,m]=i.useState(!1),[_,R]=i.useState(y),I=(f,b)=>{const M=d?.messages[0]?.id;h(f),R(b),E(M,f,b)},S=d?.role===G.Assistant,E=i.useMemo(()=>Ma((f,b,M)=>{o&&f&&(n&&a?wa({rating:Ea(b),shown_at_assistant_turn:u,prompt:M},o,f):n||_t.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:f,rating:b,shown_at_assistant_turn:u,prompt:M},anonAware:!0})),B.logEvent("Conversation Rating Submitted",{rating:b,showAtAssistantTurn:u,conversationId:o,prompt:M}),C(!0),setTimeout(()=>{N(!0)},1500)},2e3),[n,a,o,u]),w=c!==u||p||!S||!!n&&!a||r?.kind!==Et.PrimaryAssistant&&r?.gizmo_id!==void 0&&!qr.includes(r?.gizmo_id)||F||g;i.useEffect(()=>{!w&&!s.current&&(B.logEvent("Conversation Rating Shown",{showAtAssistantTurn:u,conversationId:o}),s.current=!0)},[w]);const j=Ia();return F||!j.forceShowConvoRating&&w?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(fe,{children:T&&!k&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(zs,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(zs,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[_==="personality_v1"?e.jsx(U,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(U,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(ze,{$selected:v==="thumbsUp",onClick:()=>I("thumbsUp",_),children:e.jsx(ut,{className:"icon-md"})}),e.jsx(ze,{$selected:v==="thumbsDown",onClick:()=>I("thumbsDown",_),children:e.jsx(mt,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(ze,{className:"p-3",$selected:!1,onClick:()=>m(!0),children:e.jsx(Wo,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const ze=ne.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,zs=ne.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Kr=le(()=>de(()=>import("./df5ydpeigsqu9j4m.js"),__vite__mapDeps([12,2,1,3,4,5,13])));function Yr({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=ts()?.isWorkspacePlan()??!1;let l=null;const d=J(t,y=>{const v=L.getConversationTurns(y);let h=0;for(let T=v.length-1;T>=0;T--){const C=v[T];if(C.messages.some(k=>k.metadata?.is_indepth_feedback))return!0;if(C.messages.some(k=>k.author.role===G.Assistant)&&h++,h>=3)break}return!1}),c=wt(t),g=Na(y=>y.voiceFeedbackThread),u=c===g,{voiceName:p}=Ra();return d?null:(u&&c&&!r?(qo.feedbackShown.success({voice:p}),l=e.jsx("div",{className:"text-center",children:e.jsx(Aa,{serverThreadId:c})})):a.clientMetadata?.rating&&n?l=e.jsx(Kr,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):l=e.jsx("div",{className:"text-center",children:e.jsx($r,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const Xr=le(()=>de(()=>import("./k0515ugmnvo5fanm.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult)),Qr=le(()=>de(()=>import("./njo9pfieeq6nr82k.js"),__vite__mapDeps([14,2,4,1,3,5,15,16])).then(t=>t.AutomationSourceHeader)),Ws=le(()=>de(()=>import("./f4utbn0o0nytlu92.js"),__vite__mapDeps([17,2,1,3,4,5])).then(t=>t.TextMessageEditor)),qs=80,Jr=16,$s={minHeight:`calc(100dvh - ${io}px - 120px)`};function Zr(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:l,showAvatar:d,scrollToMessageId:c,dateHeaderType:g}=t,{isNewScrollEnabled:u}=ft(),p=Xs();ts()?.normalizedAccountUserId;const y=!!p&&$o(p),v=Fa(),h=gt(ht.isBusinessWorkspace),T=vt(),{value:C}=pe("1760640904"),{value:k}=pe("1456513860"),N=d??!k,m=null!=null,{value:_}=pe("1887864177"),{capabilitySuggestionsEnabled:R}=ot(),I=Pa(),[S,E]=J(s,x=>{const H=L.getConversationTurnAtIndex(x,n),$=n>0?L.getConversationTurnAtIndex(x,n-1):null,Z=$?.role===G.User&&$.messages.some(W=>W.metadata?.visually_hide_response_from_conversation);return[H,Z]}),{messages:w,messageGroups:j}=S,f=La(),b=w[0],M=A(w),{messages:P,visibleMessages:z,messageGroups:xe,lastMessageToRender:ee,doesTurnHaveDelayedMessages:ue}=i.useMemo(()=>{const x=f.size===0?-1:j.findIndex(W=>W.type===Oe?W.groups.some(oe=>oe.messages.some(Be=>f.has(Be?.id))):W.messages.some(oe=>f.has(oe?.id))),H=x!==-1&&x+1<j.length,$=H?j.slice(0,x+1):j,Z=H?$.flatMap(W=>W.type===Oe?W.groups.flatMap(oe=>oe.messages):W.messages):w;return{messages:Z,visibleMessages:Z.filter(Ko),messageGroups:$,lastMessageToRender:A(Z),doesTurnHaveDelayedMessages:x!==-1}},[w,j,f]),ve=i.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:M?.id}),[s,n,M?.id]),q=!1,[as,os]=i.useState(!1),[Bt,Ht]=i.useState(!1),Ot=i.useContext(Da)!=null,V=S.role===G.User,rs=Mt(),be=Yo(s),Fe=Ua(S.gizmoId??be).data,Pe=xt(s),Gt=Ba(s),is=Ha(Pe),Vt=Oa(Pe,Gt),ls=pt(),[ye,zt,Wt,cs,Le,ri,qt,$t,Kt,ds,Yt,ae,us]=J(s,x=>{const H=L.getParentPromptNode(x,b.id),$=H?.message.clientMetadata?.variantsInStreamInfo??(H?.message.metadata?.paragen_variant_choice?void 0:H?.message.metadata?.paragen_variants_info),Z=L.getVariantIds(x,b.id),W=L.getCurrentVariantId(x,b.id),oe=L.getIsDoNotRemember(x),Be=W?Z.indexOf(W):0,Pn=$&&x?.tree!=null&&Z.some(re=>{const{errType:Cs}=x.tree.getLeafFromNode(re).message.clientMetadata??{};return Cs!=null&&Cs!=="info"}),He=L.getConversationTurns(x);return[x?.async_status===Is.STREAMING,L.isMessageTurnEnded(x,M?.id),Pn,lo(x?.mode,Fe?.gizmo.id),x?.continuingFromSharedConversationId!=null,null,He.findIndex(re=>re.role===G.User)===n,er(He,re=>re.role===G.User)===n,He.findIndex(re=>re.role===G.Assistant)===n,L.getRequestId(x,M?.id),$,Z,Be,oe]});let Xt="default";const Qt=P.some(x=>x.content.content_type===Xo.MultimodalText),{layer:Jt}=Ye("3119715334"),Zt=Jt.get("should-enable-skip",!1),{isUnauthenticated:ms}=It(),en=S.messages.map(x=>x.id),se=i.useRef(null),gs=!u&&(c?.length??0)>2&&c!=="finalAgentTurn"&&a&&T,_e=V?A(z):void 0,De=_e?.id,sn=i.useCallback(()=>{De&&(B.logEvent("Edit Prompt",{id:De,threadId:ce(s)}),Y.logEvent("chatgpt_edit_prompt"),os(!0))},[De,s]),tn=i.useCallback(()=>{os(!1)},[]),hs=Ga()??!1,{onChangeRating:nn}=Va({clientThreadId:s,currentModelConfig:Pe}),an=x=>{if(!M)return;nn({nodeId:M.id,messageId:M.id,rating:x});const H=hs&&j.some($=>$.type!==Oe&&$.messages?.some(co));B.logEventWithStatsig(x==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:M.id,threadId:ce(s),model:r,rating:x,...hs?{isCATriggered:H}:{}}),Ht(!0)},[on]=i.useState(()=>Date.now()),rn=za(s),{layer:ln}=Ye("109457",{shouldLogExposure:!1}),ps=J(s,x=>rn&&L.getConversationTurns(x).filter(H=>H.role===G.Assistant).length<=ln.get("onboarding_inject_cards_position",3)),fs=ds!=null,cn=ss(ds),Q=!zt&&cn||ue,xs=bt(),[dn,vs]=i.useState(fs),bs=i.useRef(!1),un=Wa(s,M);i.useEffect(()=>{if(!u){if(bs.current||c===void 0||!T||!se.current){c==="finalAgentTurn"&&a&&he(s,x=>{x.scrollToMessageId=void 0});return}(en.includes(c)||c==="finalAgentTurn"&&a)&&(bs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(se.current)if(c==="finalAgentTurn"&&a)se.current.scrollIntoView({behavior:"instant",block:"end"}),he(s,x=>{x.scrollToMessageId=void 0});else{const x=se.current.offsetHeight;let H;x>qs?H=qs-x:H=0,se.current.style.scrollMarginTop=`${H+Jr}px`,se.current.scrollIntoView({behavior:"smooth"})}})}))}},[c,se.current]);const{showDebugConversationTurns:mn}=Zs(),gn=qa(),hn=!v&&!Le&&!rs&&!V,pn=$a(),fn=ee?.author.role===G.Assistant?ee:null,xn=ee?.metadata?.system_hints?.includes(te.Research);Ka({isCompletionRequestInProgress:Q,isUserTurn:V,message:fn});const{isOpen:vn}=Ya(),bn=Xa(),Se=Qa(cs),Te=!pn&&!Se&&hn&&a&&Yt?.num_variants_in_stream===2&&ae.length<=2&&!M?.clientMetadata?.inlineComparisonRating&&!Wt,je=a&&fs,yn=Ja(s)?.value===Is.STREAMING,_n=(dn||je)&&!as&&!v&&!Le&&!Se&&!ye&&!Q&&!vn&&!ps&&!yn&&S.role!==G.Developer,Sn=P.some(x=>Qo(x)===Jo.l1239dk1),Tn=je&&!Q&&!Le&&!v&&!Sn&&(_||I||R),Ce=M!=null&&!m&&(!h||Vt||y||ls)&&!Se&&!ms&&!rs&&!M.metadata?.b1de6e2_s,jn=(!h||ls)&&Ce&&je&&!ye&&!Q,ys=!v&&!((Q||ye)&&a)&&ae.length>1&&!Te&&!m&&!ps,_s=V&&P.some(x=>Za(x)?.shouldHideContent),Cn=V&&_e!=null&&!Se&&!v&&!Qt&&!_s&&!ms&&!m&&!xn,kn=M!=null&&(M.clientMetadata?.disclaimers??[]).length===0,Ss=i.useCallback(x=>{he(s,H=>{es.setCurrentBranch(H,ae[x])}),B.logEvent("Change Active Node",{intent:"toggle_between"})},[s,ae]),Mn=eo(S,P,mn),{toggleThreadSidebar:Ts}=Zo(),ke=M?.id,wn=i.useCallback(()=>{ke&&Ts({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:ke})},[ke,Ts,s,n]),In=i.useMemo(()=>so(S,is,!!be),[is,be,S]);if(!Mn&&!Te)return gs?e.jsx("div",{style:$s}):null;if(E)return null;const En=ee?.metadata?.followup_prompts?ee.metadata.followup_prompts.map(x=>({text:x,type:nt.Reply})):[],Nn=ee?.metadata?.category_suggestions,Rn=!P.some(x=>kt.getAudioAssetPointers(x).length>0)&&!m&&!be,An=!Q&&P.some(x=>x.author.role===G.Assistant&&x.metadata?.onboarding?.main_usages),Ue=P.find(x=>!!x.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,js=!_s&&(!V||C)&&(!a||!Q);if(gn&&!m&&!a&&z.length===0)return null;const Fn=!a&&S.messages.some(x=>x.clientMetadata?.isLastMessageFromSharedConversation);return e.jsxs(to.Provider,{value:Kt,children:[e.jsx(no,{dateHeaderType:g,turn:S}),e.jsxs("article",{className:D("text-token-text-primary w-full",!u&&c==="finalAgentTurn"&&T?"opacity-0":"",{hidden:Ot&&qt}),style:gs?$s:void 0,ref:se,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!u&&a,children:[e.jsx(ao,{role:S.role}),e.jsxs(qe,{verticalPadding:Xt,horizontalPadding:Te?"none":"standard",children:[Te?e.jsxs(e.Fragment,{children:[e.jsx(hr,{isFeedbackEnabled:Ce,variantIds:ae,conversationTurnMountTime:on,...t}),Zt&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(St,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{yt.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(oo,{className:"text-token-text-secondary me-1"}),e.jsx(U,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ne,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>vs(!0),onPointerEnter:()=>vs(!0),children:e.jsxs(e.Fragment,{children:[q,!V&&!q&&N&&e.jsx(si,{children:e.jsx(Qe,{messages:P,isUserTurn:V,avatarClassName:l,gizmo:Fe})}),e.jsx("div",{className:$e({isUserTurn:V}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!V&&!v&&e.jsx(Xr,{messages:P,clientThreadId:s,gizmoId:Fe?.gizmo.id}),bn&&!V&&e.jsx(Qr,{clientThreadId:s,messages:P}),as&&_e?e.jsx(Ws,{message:_e,clientThreadId:s,onRequestCompletion:o,onExitEdit:tn,disabled:xs}):e.jsx(Xe,{allMessages:w,groupedMessagesToRender:xe,allGroupedMessages:j,...t,isUserTurn:V,isFinalUserTurn:$t,isCompletionRequestInProgress:Q,isFeedbackEnabled:Ce,isFinalTurn:a,hasActiveRequest:xs}),In&&e.jsx(fr,{handleShowRetrievalResults:wn,clientThreadId:s,turnIndex:n,responseComplete:!(Q||ye)}),An&&e.jsx(or,{clientThreadId:s}),Ue&&Ue.length>0&&!Q&&e.jsx(rr,{clientThreadId:s,examples:Ue}),_n&&e.jsx(Hr,{isUserTurn:V,alwaysShow:je,children:V?e.jsx(Gr,{activeVariantIndex:us,clientThreadId:s,numVariants:ae.length,onAnticipateEdit:Ws.prefetch,onChangeIndex:Ss,onEnterEdit:sn,showCopyButton:js,showEditMessageButton:Cn,showPagination:ys,turnIndex:n}):e.jsx(Or,{activeVariantIndex:us,clientThreadId:s,conversationMode:cs,lastMessage:M,messages:P,numVariants:ae.length,onChangeIndex:Ss,onRate:an,showCanvasButton:un&&!m,showCopyButton:js,showPagination:ys,showPlayButton:kn,showRatingButtons:Ce,showRegenerateButton:Rn,isJam:m,turn:S,turnIndex:n})}),jn&&e.jsx(Yr,{canShowInlineMessageFeedback:Bt,clientThreadId:s,messageForRating:M,allGroupedMessages:j,currentModelId:r}),Tn&&e.jsx(Ir,{followups:En,categorySuggestions:Nn,clientThreadId:s,lastMessageId:ke,analyticsMetadata:ve})]})})})]})}),Fn&&e.jsx("div",{className:"mx-auto mt-8 -mb-2 flex justify-center",children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(ro,{className:"icon-xs me-2"}),e.jsx(U,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})})]})]})]})}const ei=Bn.memo(Zr),si=ne.div`shrink-0 flex flex-col relative items-end`;function ti(t){const n=L.getConversationTurns(t),a=n.findIndex(o=>o.role===G.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Es.SearchGPTQuery){const l=s.messageGroups.slice(o+1).find(({type:c})=>c===Es.Text);if(l==null)return;const d=sr(l.messages[0]);if(d?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:d[0],message:l.messages[0]}}}function ni(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function ai({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=i.use(n),{value:o}=pe("1032814809");i.useEffect(()=>{window.__oai_SSR_NAVLINK&&uo.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),i.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=i.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(c=>({...c,subtitle:c.subtitle??c.domain}))},[s]),l=J(t,ti),d=i.useMemo(()=>ni(r,l?.navigationCitation),[l,r]);return s==null||d==null?null:e.jsxs("div",{children:[e.jsx(qe,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsx("div",{className:$e({isUserTurn:!0}),children:e.jsx("div",{className:mo(!0),children:e.jsx(go,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(ho,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(qe,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsxs("div",{className:$e({isUserTurn:!1}),children:[e.jsx(cr,{clientThreadId:t,turnIndex:l?.turnIndex??2,nextMessage:l?.message,navigationCitation:d}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(oi,{})]}):null]})})})}),e.jsx(po,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function oi(){const[t,n]=i.useState(null);return i.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(l=>l??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function bi({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,l,d,c]=J(n,b=>[b?.mode,L.getConversationTurnIds(b),b?.conversationOrigin===tr.APPLE,b?.scrollToMessageId]),{isNewScrollEnabled:g}=ft(),u=fo(),p=xo(),y=vt(),v=vo(),[h]=bo(),T=yo(),[C]=_o(),k=xt(n),N=u.store.useContentAreaDimensions(So.Header,b=>b?.height?b.height:void 0),F=To(k.id),m=r?.kind===Et.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":F;i.useEffect(()=>{p&&(Y.logEvent("chatgpt_continue_conversation_page_loaded"),B.logEvent("Continue Conversation: Page Loaded"),Y.logEvent("chatgpt_conversation_share_page_loaded"),B.logEvent("Share Public Chat: Shared Conversation Loaded"))},[p]);const _=i.useCallback(()=>{g||v({behavior:"smooth"})},[g,v]),[R,I]=i.useState(!1),S=R||!y,E=jo(n),w=i.useRef(null),{getAndroidKeyboardLayout:j}=Co(),f=ko(n);return e.jsxs("div",{onCopy:E,className:D("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",j()&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",N?null:!g&&"pb-25"),style:{paddingBottom:N},children:[s?e.jsx(nr,{name:"prefetch-navlink",onError:b=>{Ke.addError("Error with prefetch navlink",{error:b}),o(void 0)},children:e.jsx(i.Suspense,{fallback:null,children:e.jsx(ai,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,p&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{it.openModal(Mo.ReportConversation),Y.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),B.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),l.map((b,M)=>e.jsx(ei,{isFinalTurn:M===l.length-1,turnIndex:M,clientThreadId:n,onRequestCompletion:t,currentModelId:k.id,avatarClassName:m,scrollToBottom:g?void 0:_,scrollToMessageId:g?void 0:c,dateHeaderType:f(M),showAvatar:void 0},b)),!g&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(ar,{setIsScrolledToEdge:I,options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:w}),d&&h&&!C&&e.jsx(Ks,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{Y.logEvent("chatgpt_thread_scroll_to_top"),T({behavior:"smooth"})},children:e.jsx(wo,{className:"icon-md text-token-text-primary"})}),e.jsx(fe,{children:S&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Ks,{className:D(N?null:"bottom-8"),style:{bottom:N},onClick:()=>{Y.logEvent("chatgpt_thread_scroll_to_bottom"),w.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Io,{className:"icon-md text-token-text-primary"})})})})]})]})}const Ks=ne.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{bi as T};
//# sourceMappingURL=jn7l19yr8qucsihu.js.map
