import{r as u,ah as U,k as V,e as B,j as n,a8 as f,a9 as q}from"./khl8ktun31iepecq.js";import{ho as K,hp as Y,hq as X,C,hr as $,hs as Q,ht as J,hu as Z,hv as tt,hw as et,hx as st,gl as at,hy as ot,hz as nt,hA as it,hB as _,hC as M,gj as rt,hD as ct,hE as dt,fQ as lt,hF as ut,u as ht,hG as N,a5 as j,hH as F}from"./n4exq6o15ap1g74l.js";import{gK as S,g as W,aj as pt,F as b,ak as mt,H as gt,gf as ft,db as xt,b$ as Ct,gl as vt,gL as wt}from"./haannt40upmuwmtk.js";import{L as Tt,u as bt}from"./4yav5vtwjczc7whm.js";import{T as yt}from"./egygp32u90enqkm4.js";import{g as It}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./l6prrb6nf9agh4ql.js";import"./dblaaxd78ezocyc0.js";import"./jf5c1e7milql0vok.js";import"./o1bzkr20ape07jec.js";import"./m7dukzpngt1iaaya.js";import"./gy64pge8qevmvg7e.js";import"./kiredz58u04n7vci.js";import"./oghjpi4z21x1edph.js";import"./dfz2bdgqh4yduujb.js";import"./jjzyh6kngpoa9x2y.js";import"./fzrn137102spawew.js";import"./n4mh0ete7jlifz2u.js";import"./iuzjvviw85b4ghdw.js";import"./k1s179c6hw2g8g6f.js";import"./iqn1sco9xm33m83q.js";import"./lg9iewuzavytplg0.js";import"./mhqi8r5v3dwotfod.js";import"./e473oe6zkw5lqbph.js";import"./m4g7yy9fehqi204r.js";import"./jjqeoesb3rhorlyg.js";import"./b3mht1lg7zv7qd3d.js";import"./kw97lv1qq6sjlhnf.js";const D="oai/apps/canmoreSidebarWidth",St=.25,Et=400,O=400;function L(t){return t-Et}function y(t,s){return U(O,L(t),s??St*t)}function At(){const t=S.useState(S.selectWindowWidth),s=y(t,K(W.DANGER_SECRET_FOLDERS_ONLY_getItem(D))),a=k(),[e,i]=u.useState(s);u.useEffect(()=>{(e<O||e>L(t))&&i(y(t,e))},[t]);function o(c){i(x=>y(t,x+=c.delta.x))}function r(c){i(c),W.DANGER_SECRET_FOLDERS_ONLY_setItem(D,c)}function l(){const c=y(t,void 0);r(c)}const p=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:p,viewportWidth:t,handleDrag:o,handleDoubleClick:l,persist:r}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function k(t){const s=S.useState(S.selectWindowWidth);return(t??s)>1e3}const A="sharedCanvas";function Rt(){const[t,s]=V(),a=t.get(A),e=B();u.useEffect(()=>{const i=a&&Y.createRemixTempTextdoc(a,e);if(!i)return;requestAnimationFrame(()=>{X(i)});const o=new URLSearchParams(t);o.delete(A),s(o);const r=new URL(window.location.href);r.searchParams.delete(A),history.replaceState(null,"",r)},[a,t,s,e])}function _t(t,s){let a;return s?.type===C.Textdoc&&(s.textdocId.startsWith($)||(a={type:"canvas_textdoc",id:s.textdocId})),Q(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const P=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:i=!1,width:o})=>{const{setTargetedContent:r}=J(),l=u.useRef(!1);if(u.useEffect(()=>(l.current&&r(void 0),l.current=!0,()=>{l.current=!1}),[a]),a==null)return null;switch(a.type){case C.Textdoc:return n.jsx(yt,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:o});case C.ADAVisualization:return null}},Nt=300,jt=t=>{switch(t?.type){case C.Textdoc:return t.textdocId;default:return null}};function Ft(t,s){const[a,e,i,o]=pt(t,d=>[b.getRequestId(d),b.getConversationLastTurn(d),b.isMessageTurnEnded(d),b.getVariantIds(d).length>1]),r=mt(a),l=Z(),[p,c]=u.useMemo(()=>{if(e&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!i&&e&&(d=gt(e.messageGroups,m=>m.type!==ft)),Wt({groupedMessage:d,isRequestActive:r,latestTextdocId:l})},[i,e,o,s,r,l]),x=c!=null,v=jt(c),w=tt("canvas");u.useEffect(()=>{if(c&&p&&!et()&&(w(),st(c,p),c.type===C.Textdoc)){const{textdocId:d}=c,m=It(d);at(document.getElementById(m))}},[x,v])}function Wt({groupedMessage:t,isRequestActive:s,latestTextdocId:a}){switch(t?.type){case xt.Canmore:{const[e,i]=t.messages;if(!ot(e))break;const o=nt(s,e,i??null),r=o.textdocId??a;if(r&&(o.function===it.CreateTextdoc?(o.content??"").length>Nt||o.status===_.WAITING:o.status===_.STREAMING))return[o.messageId,{type:C.Textdoc,textdocId:r}];break}}return[void 0,null]}const Dt=260,I={type:"spring",bounce:.12,duration:.64},Mt={type:"spring",bounce:0,duration:.58},Ot=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:o,handleDoubleClick:r,persist:l}=At(),[p,c]=u.useState(!0),[x,v]=u.useState(!1),w=ct(({rect:h})=>h),{windowHeight:d,windowWidth:m}=vt(h=>h,{windowWidth:0,windowHeight:0});let g=w??{top:0,left:e,width:m-e,height:d},R=!1;if(w&&(g.top<0||g.top+g.height>d)){R=!0;const h={width:(m-e)*.75,height:d*.75};g={top:d/2-h.height/2,left:(m-e-h.width)/2+e,width:h.width,height:h.height}}const T=w?.borderRadius,E=dt(),H=E?.history!=null||E?.showChangesAtVersion!=null,z=lt();return n.jsxs(n.Fragment,{children:[H&&n.jsx(Tt,{onClick:()=>ut(E.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(f.div,{initial:{marginRight:z?0:-Dt},animate:{marginRight:0},transition:Mt,children:[n.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(f.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(f.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:R?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:e,y:0,width:i,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:x?{duration:0}:I,onAnimationComplete:()=>c(!1),children:n.jsx(f.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:n.jsxs("div",{className:"h-full",children:[n.jsx(f.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(h,G)=>o(G),onDragEnd:()=>{v(!1),l(e)},onDoubleClick:()=>r()}),x&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(P,{onClose:a,clientThreadId:t,isAnimating:p,focusedObject:s,width:m-e})]})})})]})},Lt=u.memo(Ot),kt=({clientThreadId:t,focusedObject:s,onClose:a})=>n.jsx(wt,{children:n.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:n.jsx(P,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})}),Pt=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=k(s),i=bt();Ft(t,a||i),Rt();const o=ht();u.useEffect(()=>{M()},[t]);const r=o&&(e?n.jsx(Lt,{clientThreadId:t,onClose:F,focusedObject:o},"canvas-sidebar"):n.jsx(kt,{clientThreadId:t,onClose:F,focusedObject:o},"canvas-modal"));u.useEffect(()=>{if(o)return N(p=>_t(p,o)),()=>N(null)},[o]);const l=r!=null;return u.useEffect(()=>(j.setActiveStageSidebar(l),()=>{l&&j.setActiveStageSidebar(!1)}),[l]),n.jsx(q,{children:r},t)},ge=t=>{const s=u.useRef(null);return n.jsx(Ct,{ref:s,onError:(a,e)=>{M(),setTimeout(()=>{s.current?.resetErrorBoundary()}),rt.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Pt,{...t})})};export{ge as CanvasFocusedViewManager};
//# sourceMappingURL=c3wzd81h0p77h10w.js.map
