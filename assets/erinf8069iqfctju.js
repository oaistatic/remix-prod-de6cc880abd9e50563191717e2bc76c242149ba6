import{j as t,r as x,w as B,a9 as C,a8 as W}from"./khl8ktun31iepecq.js";import{ct as j,cu as f,M as y,cv as N,cw as Q,cx as U,cy as X,cz as V,L as E,R as L,cA as $,cB as H,cC as J}from"./n4exq6o15ap1g74l.js";import{E as K,bX as Y,dC as T,bF as M,P as h,m as Z,dE as ee,c as te,dF as P,cV as ne,cL as se,a as re,F as A,cx as ae}from"./haannt40upmuwmtk.js";import{u as ie,a as oe,g as ce,b as z,S as le}from"./dryvpx92fe6zevra.js";function ue(e,n){const a=A.getTurnContentReferences(e,n),r=$(a),i=de(e,n);return H(r.concat(i),"content_url")}function de(e,n){const a=A.getConversationTurnAtIndex(e,n).messages;return a?ae(a.flatMap(r=>r.metadata?.image_results??[])).map(r=>({...r,thumbnail_url:r.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:r.content_url.replace(/^http:\/\//,"https://")})):[]}function me(e,n,a,r){const{product:i}=J({thread:e,messageId:n,contentReferenceStartIndex:a,productIndex:r});return!i||!i.image_urls?[]:i.image_urls.map(c=>({url:c,content_url:c,thumbnail_url:c,title:i.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function ve({clientThreadId:e}){const n=j.useCurrentImage();if(!n)return null;const{image:a,source:r,analyticsMetadata:i,contentReferenceStartIndex:c,productIndex:l}=n;if(r==null||e==null||i?.turnIndex==null)return t.jsx(p,{image:a,analyticsMetadata:{}});const o=K(e),w=r===f.ProductDetails?me(o,i.messageId,c,l):ue(o,i.turnIndex);return t.jsx(p,{image:a,group:w,analyticsMetadata:i,groupSource:r})}function _e(){const e=j.useCurrentImage();if(!e)return null;const{image:n,source:a}=e;if(a==null)return t.jsx(p,{image:n,analyticsMetadata:{}});switch(a){case f.ImagesTab:return t.jsx(xe,{image:n});case f.Turn:return t.jsx(he,{image:n});default:return null}}function xe({image:e}){const{imageResults:n}=ie();return t.jsx(p,{image:e,group:n,groupSource:f.ImagesTab,analyticsMetadata:{}})}function he({image:e}){const{imageResults:n}=oe();return t.jsx(p,{image:e,group:n,groupSource:f.Turn,analyticsMetadata:{}})}const F=Y.div`grow flex items-start p-8`,ge={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},D=1e4,fe=(e,n)=>Math.abs(e)*n;function p({image:e,group:n,groupSource:a,analyticsMetadata:r}){const i=x.useRef(null),c=e.attribution??y(e.url),l=j.useCurrentImage(),o=j.useStore(),w=l?.mountDirection;x.useEffect(()=>{window?.history?.state?.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const s=()=>{window?.history?.state?.imageModalOpen||o.setCurrentImage(void 0)};return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[o]);const S=e.content_url.replace(/^http:\/\//,"https://"),u=n?.findIndex(s=>T(e,s))??0,d=n?.length??1,m=u!=null&&d>1,g={...M(r),url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(u+1).toString()};x.useEffect(()=>{i.current!==e.url&&(i.current=e.url,h.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",{...M(r),type:"full_screen_image",url:e.url,image_url:S}),h.logEventWithStatsig("link_action","link_action",{...g,action:"show"}))},[S]);const v=()=>{window.history.go(-1),o.setCurrentImage(void 0)},I=x.useCallback(()=>{!m||n==null||o.setCurrentImage({image:n[(u+1)%n.length],source:a,mountDirection:N.FromRight,analyticsMetadata:r,contentReferenceStartIndex:l?.contentReferenceStartIndex,productIndex:l?.productIndex})},[m,n,o,u,a,r,l]);B({queries:(n??[]).map(s=>ce(s.thumbnail_url))});const b=x.useCallback(()=>{!m||n==null||o.setCurrentImage({image:n[(u-1+n.length)%n.length],source:a,mountDirection:N.FromLeft,analyticsMetadata:r,contentReferenceStartIndex:l?.contentReferenceStartIndex,productIndex:l?.productIndex})},[m,n,o,u,a,r,l]),G=Z(),_=ee(G,"2804795149");return x.useEffect(()=>{if(!_)return te(document,{keydown:s=>{s.key==="ArrowRight"?I():s.key==="ArrowLeft"&&b()}})},[_,I,b]),_?t.jsxs(Q,{forceDarkMode:!0,imageList:n??[],initialIndex:u,onClose:v,children:[m&&t.jsx(U,{children:s=>t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[(n?.findIndex(k=>T(s,k))??0)+1," /"," ",d]})}),t.jsx(X,{children:s=>t.jsx(O,{image:s,isNewLightbox:!0})}),t.jsx(V,{children:s=>t.jsx("div",{className:"flex w-full justify-start",children:t.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:t.jsx(E,{onClick:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"click"})},onMouseEnter:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"hover"})},href:s.is_proxied_image?s.content_url:s.url,className:"flex min-h-20 w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(L,{url:s.content_url,className:"rounded-sm",size:16}),c??y(s.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:s.title})]})})})})})]}):t.jsx(C,{children:e&&t.jsx(P.Root,{isOpen:!0,onClose:v,testId:"modal-image-result",children:t.jsx(P.Overlay,{children:t.jsxs(ne,{className:"flex h-full w-full flex-col bg-black/95",children:[t.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[t.jsxs("div",{className:"absolute end-4 top-4 flex items-center sm:end-6 sm:top-6",children:[m&&t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[u+1," / ",d]}),t.jsx("button",{onClick:s=>{s.stopPropagation(),v()},className:"flex h-9 w-9 items-center justify-center outline-hidden hover:opacity-70",children:t.jsx(se,{className:"h-6 w-6 text-gray-400"})})]}),d>1&&t.jsx(F,{className:"cursor-w-resize",onClick:s=>{s.stopPropagation(),b()}}),t.jsx(C,{initial:!1,custom:w,children:t.jsx(W.div,{variants:ge,custom:w??0,className:"absolute top-24 bottom-4",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:d>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:k,velocity:q})=>{const R=fe(k.x,q.x);R<-D?I():R>D&&b()},children:t.jsx(O,{image:e})},u)}),d>1&&t.jsx(F,{className:"cursor-e-resize",onClick:s=>{s.stopPropagation(),I()}})]}),t.jsx(E,{onClick:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"click"})},onMouseEnter:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"hover"})},href:e.is_proxied_image?e.content_url:e.url,className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pt-8 pb-3 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(L,{url:e.content_url,className:"rounded-sm",size:16}),c??y(e.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function O({image:e,isNewLightbox:n=!1}){const a=e.content_url.replace(/^http:\/\//,"https://"),r=e.thumbnail_url.replace(/^http:\/\//,"https://"),i=e.content_size.width/e.content_size.height,{isError:c}=z(a),{isError:l}=z(r),o=e.is_proxied_image?e.url:c?r:a;return!l||!c||e.is_proxied_image?t.jsx(W.img,{src:o,alt:e.title,style:{backgroundImage:r?`url(${r})`:void 0,backgroundSize:"contain",aspectRatio:i,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:re(n?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):t.jsx("div",{className:"flex h-full grow items-center justify-center",children:t.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:t.jsx(le,{className:"text-token-text-tertiary h-12 w-12"})})})}export{ve as ImageLightbox,_e as ImageLightboxSearchGPT};
//# sourceMappingURL=erinf8069iqfctju.js.map
