import{j as g,r as o}from"./khl8ktun31iepecq.js";import{n as O}from"./haannt40upmuwmtk.js";import{cP as F}from"./n4exq6o15ap1g74l.js";import{p as t}from"./kg48zifqnjesj3z8.js";import"./joa8jajuiu4xqpzn.js";function J({drawingCanvasRef:n,...r}){return g.jsx(N,{ref:n,...r})}const N=o.forwardRef(function({color:r,dashedOutlineColor:l,cursorWidth:f,canvasWidth:v,canvasHeight:d,currentDrawnShape:s,onNewDrawnShape:j},A){const u=o.useRef(null),a=o.useRef(null),[w,h]=o.useState(),[D,M]=o.useState(!1);o.useImperativeHandle(A,()=>({getImageData:()=>{const e=c(u);s!=null&&($(s),t.view.update());const i=e.getContext("2d")?.getImageData(0,0,e.width,e.height);if(i==null)throw new Error("Failed to get image data from canvas");return s!=null&&l!=null&&z(s,new t.Color(l)),i},sendEventToCanvas:e=>{c(u).dispatchEvent(e)}}));const m=o.useMemo(()=>F(e=>{if(a.current!=null){const i=T(e.point,c(u)),R=Y(a.current.prevPoint,i,f);if(a.current.shape!=null){const _=a.current.shape;a.current.shape=a.current.shape.unite(R),_.remove(),R.remove()}else a.current.shape=R;a.current.shape.fillColor=new t.Color(r),a.current.prevPoint=i}},50),[r,f]),C=o.useCallback(e=>m(e),[m]),x=o.useCallback(()=>{if(m.cancel(),a.current?.shape!=null){const e=new t.Path.Rectangle({point:[0,0],size:t.view.size}),i=a.current.shape.intersect(e);i.fillColor=new t.Color(r),l!=null&&z(i,new t.Color(l)),j(i),a.current.shape.remove(),e.remove()}a.current=null,M(!1)},[m,r,l,j]),P=o.useCallback(e=>{let i=null;s!=null&&(i=s.clone(),$(i),s.remove()),a.current={shape:i,prevPoint:T(e.point,c(u))},M(!0)},[s]),E=o.useCallback(()=>{s!=null&&s.dashArray.length>0&&(s.dashOffset+=.2)},[s]),b=o.useCallback(e=>{e.preventDefault()},[]),k=o.useCallback(e=>{e.pointerType==="mouse"&&h(new t.Point([e.offsetX,e.offsetY]))},[]),y=o.useCallback(e=>{e.pointerType==="mouse"&&h(new t.Point([e.offsetX,e.offsetY]))},[]),L=o.useCallback(e=>{e.pointerType==="mouse"&&h(void 0)},[]);o.useEffect(()=>{t.setup(c(u)),t.view.viewSize=new t.Size(v,d)},[]),o.useEffect(()=>{t.project.activeLayer.removeChildren(),s!=null&&t.project.activeLayer.addChild(s)},[s]),o.useEffect(()=>{const e=c(u);return e.addEventListener("pointerover",k),e.addEventListener("pointermove",y),e.addEventListener("pointerout",L),e.addEventListener("touchstart",b),()=>{e.removeEventListener("pointerover",k),e.removeEventListener("pointermove",y),e.removeEventListener("pointerout",L),e.removeEventListener("touchstart",b)}},[k,y,L,b]),o.useEffect(()=>(t.view.on("mousedown",P),t.view.on("mousedrag",C),t.view.on("mouseup",x),t.view.on("frame",E),()=>{t.view.off("mousedown",P),t.view.off("mousedrag",C),t.view.off("mouseup",x),t.view.off("frame",E)}),[P,C,x,E]);const I=o.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),p=u.current?X(f,u.current):f;return g.jsxs("div",{className:"relative h-full w-full cursor-none",children:[g.jsx("canvas",{ref:u,width:v,height:d,className:"h-full w-full","data-paper-hidpi":"off",onContextMenu:I}),w&&g.jsx("div",{className:"pointer-events-none absolute start-0 top-0 rounded-full border-[3px] shadow-[0_2px_3px_0_rgba(0,0,0,0.25)]",style:{width:`${p}px`,height:`${p}px`,transform:`translate(${w.x-p/2}px, ${w.y-p/2}px) scale(${D?1:1.05})`}})]})});function c(n){return O(n.current)}function X(n,r){return n*r.offsetWidth/r.width}function T(n,r){return n.multiply(r.width/r.offsetWidth)}function Y(n,r,l){const f=n.getDistance(r),v=new t.Rectangle(n.subtract([l/2,l/2]),new t.Size(f+l,l)),d=new t.Size(l/2,l/2),s=new t.Path.Rectangle(v,d);return s.rotate(r.subtract(n).angle,n),s}function z(n,r){n.strokeColor=r,n.strokeWidth=2,n.strokeCap="round",n.dashArray=[6,8],n.dashOffset=0}function $(n){n.strokeColor=null,n.strokeWidth=0,n.dashArray=[],n.dashOffset=0}export{J as DynamicDrawingCanvas};
//# sourceMappingURL=c4zzbqabre3tco5o.js.map
