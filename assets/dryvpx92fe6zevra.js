import{r as o,q as P,u as M,j as q,a8 as b}from"./khl8ktun31iepecq.js";import{d as y,cP as v,cA as V}from"./n4exq6o15ap1g74l.js";import{R as l,gS as u,D as p,b as $,x as O,cx as E,dC as D}from"./haannt40upmuwmtk.js";const re=e=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 34 34",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},o.createElement("g",{id:"icon / robot-sad"},o.createElement("path",{id:"Rectangle 49961",d:"M4.9585 9.91667C4.9585 8.35186 6.22702 7.08333 7.79183 7.08333H26.2085C27.7733 7.08333 29.0418 8.35186 29.0418 9.91667V21.25C29.0418 24.3796 26.5048 26.9167 23.3752 26.9167H10.6252C7.49555 26.9167 4.9585 24.3796 4.9585 21.25V9.91667Z",stroke:"currentColor",strokeWidth:2.83333}),o.createElement("circle",{id:"Ellipse 32520",cx:12.0415,cy:14.1667,r:2.125,fill:"currentColor"}),o.createElement("circle",{id:"Ellipse 32521",cx:21.9585,cy:14.1667,r:2.125,fill:"currentColor"}),o.createElement("path",{id:"Vector 2380",d:"M17 7.08333V4.25",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{id:"Vector 2381",d:"M4.95817 14.1667V14.1667C4.17577 14.1667 3.5415 14.8009 3.5415 15.5833V17C3.5415 17.7824 4.17577 18.4167 4.95817 18.4167V18.4167",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{id:"Vector 2382",d:"M29.0418 14.1667V14.1667C29.8242 14.1667 30.4585 14.8009 30.4585 15.5833V17C30.4585 17.7824 29.8242 18.4167 29.0418 18.4167V18.4167",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{id:"Vector 2386",d:"M19.8335 21.158C17.8696 20.3362 16.1307 20.3362 14.1668 21.158",stroke:"currentColor",strokeWidth:2.83333,strokeLinecap:"round",strokeLinejoin:"round"})));var T=(e=>(e.SCALLION="scallion",e.SCALLION_RC="scallion-rc",e.SCALLION_RC0="scallion-rc0",e.SCALLION_RC1="scallion-rc1",e.SCALLION_RC2="scallion-rc2",e.CHIVE="chive",e.CHIVE_RC="chive-rc",e.CHIVE_RC0="chive-rc0",e.CHIVE_RC1="chive-rc1",e))(T||{});const ne=async({queryKey:e})=>{const[t,n]=e;if(n.length<2)return[];const r=new URLSearchParams({query_fragment:n});return l.get(`${u}/suggestions?${r.toString()}`).then(s=>s.suggestions).catch(()=>[])};async function se({threadId:e,sessionId:t,query:n,agentSettingsOverrides:r,metadata:s,extraTurnData:c}){const d=w(r),i=e?`${u}/threads/${e}/turns?blocking=false`:`${u}/turns?nonce=${t}`;r.emulated_location&&(s={...s,...r.emulated_location});const _=new PerformanceObserver(R=>{const g=R.getEntriesByName(i,"resource");if(g.length){const f=g[0];if(f.connectEnd){const L=f.connectEnd-f.fetchStart;p.addAction("sonic.web.home.new_turn_connection_time",{durationMs:L})}_.disconnect()}});return _.observe({type:"resource"}),l.post(i,{...d,turn:{user_query:n,now:r.emulated_date?new Date(r.emulated_date).toISOString():void 0,...c},user_metadata:s})}async function oe(){return l.delete(`${u}/threads`)}function w(e){return{settings_overrides:{search_results:{search_engines:e.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:e.show_image_to_model,completion_model:e.completion_model&&e.completion_model!=="production"?{model:e.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:e.base_config??T.SCALLION,eval_preset:e.eval_preset}}async function ae({threadId:e,threadUserId:t,routePrefix:n}){let r=u;n&&(r=r+n);const s=new URL(`${r}/threads/${e}/with_turns`);return t&&s.searchParams.append("thread_user_id",t),await l.get(s.toString())}async function ie(e){const t=new FormData;return t.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,model_instructions:e.modelInstructions,tags:e.tags,user_email:e.userEmail})),e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),l.post(`${u}/feedback/turns`,t)}async function F(e,t){return l.post(`${u}/threads/${e}/turns/${t}/images_try_hard`)}async function ue(e){const t=new FormData;return e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),t.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail,turn_index:e.turnIndex})),l.post(`${u}/feedback/links`,t)}function ce(e){const t=w(e.agentSettingsOverrides);l.post(`${u}/prefetch`,{...t,turn:{user_query:e.query},user_metadata:e.metadata})}function le(){return l.get(`${u}/healthcheck`)}function C(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,s]of e)if(!Object.is(s,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}class de extends Error{constructor(t){super(t),this.name="WebsocketConnectError"}}class k extends Error{constructor(t){super(t),this.name="TurnError"}}class he extends Error{constructor(t){super(t),this.name="TurnDeltaMessageError"}}function N(e){return e?e.model_response?.text!=null&&e.model_response.text.length>0:!1}function m(e){return e.execution_status==="fatal_system_error"}function H(e){return e.execution_status==="in_progress"||e.execution_status===null}function z(e){return a(t=>t.thread?.turns.map(n=>e.reduce((r,s)=>(r[s]=n[s],r),{}))??[],(t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!C(t[r],n[r]))return!1;return!0})}function W(){return a(e=>E(e.thread?.turns.flatMap(t=>t.model_response?.citations)),C)}const x={thread:null,error:void 0},a=$(O(()=>({...x}))),Q=y(()=>{p.addError(new k("got updateTurn with no current thread"))},1e3),U=y(e=>{p.addError(new k("turn not found"),{turnIndex:e})},1e3),h={threadId:e=>e.thread?.id??null,turns:e=>e.thread?.turns??[],turnCitations:e=>t=>t.thread?.turns[e].model_response?.citations??[],hasResponse:e=>N(e.thread?.turns[0]),firstTurn:e=>e.thread!=null?e.thread.turns[0]:void 0,lastTurn:e=>e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0,numTurns:e=>e.thread?.turns.length??0,isLastTurnStreaming:e=>{const t=e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0;return t!=null&&H(t)},hasModelResponseText:e=>e.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:e=>{const t=e.thread?.turns[0];return!!t&&m(t)},hasTurnError:e=>e.thread?.turns.some(m)??!1,threadError:e=>e.error,__deprecated_sportsWidget:e=>e.thread?.turns[0]?.sports_widget??null},fe={appendTurn(e,t,n){a.setState(r=>{r.thread?.id!==e&&(n?.(e),r.thread={id:e,turns:[]}),r.thread.turns.push(t)})},updateTurn(e,t){a.setState(n=>{const r=n.thread;if(!r){Q();return}const s=r.turns[e];if(!s){U(e);return}t(s)})},clearThread(){a.setState(()=>({...x}))},setError(e){a.setState(t=>{t.error=e})},setThread(e,t){a.setState(n=>{n.thread={id:e,turns:t}})}};class A{queue=[];attempted=new Set;isProcessing=!1;enqueue(t){this.queue.push(t),this._processQueue()}async _processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)try{const t=this.queue.shift();if(!t)continue;await this._preload(t)}catch{}this.isProcessing=!1}}_preload(t){return new Promise(n=>{this.attempted.has(t)&&n();const r=new Image;r.onload=()=>{this.attempted.add(t),n()},r.onerror=()=>{this.attempted.add(t),n()},r.src=t})}}const J=new A;function X(e){const t=o.useRef(e);return D(t.current,e)||(t.current=e),t.current}function Y(e,{enabled:t=!0}={}){const n=X(e);o.useEffect(()=>{if(!t||"connection"in navigator&&navigator.connection.type==="cellular")return;const s=setTimeout(()=>{n.forEach(c=>{c&&J.enqueue(c)})},1e3);return()=>{clearTimeout(s)}},[t,n])}function me(){const{imageResults:e}=Z();Y([...e.map(t=>I(t))])}const K=v((...e)=>F(...e),5e3);function Z(e=!1){const t=z(["image_results","image_try_hard_status","execution_status"]),n=a(h.threadId),r=E(t.toReversed().flatMap(i=>i.image_results?.entries)).map(i=>({...i,thumbnail_url:i.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:i.content_url.replace(/^http:\/\//,"https://")})),s=a(h.hasModelResponseText),c=t.some(i=>m(i));let d=r.length===0&&!s;return n!=null&&e&&!d&&r.length===0&&t[0]?.image_try_hard_status==="not_attempted"&&(K(n,0),d=!0),e&&t[0]?.image_try_hard_status==="in_progress"&&(d=!0),{imageResults:r,isLoading:d,isErrored:r.length===0&&c}}function pe(){const e=W(),t=a(h.hasTurnError),n=a(h.hasModelResponseText),r=V(e);return{imageResults:r,isLoading:r.length===0&&!n,isErrored:r.length===0&&t}}function G(e){return P({queryKey:["downloadImage",{imageUrl:e}],queryFn:()=>new Promise((t,n)=>{const r=new Image;r.onload=()=>{t({width:r.width,height:r.height})},r.onerror=()=>{n()},r.src=e}),enabled:!!e})}function _e(e){return M(G(e))}const S={width:474,square:!0};function I(e,t=S){if(e==null||e.is_proxied_image)return;const n=new URL(e.thumbnail_url);if(n.hostname.indexOf(".bing.")===-1)return e.thumbnail_url;const r=Math.min(t.width,e.content_size.width),s=t.height??Math.floor(r*e.content_size.height/e.content_size.width);if(n.searchParams.delete("pid"),t.square){const c=Math.min(r,s);n.searchParams.set("w",c.toString()),n.searchParams.set("h",c.toString())}else n.searchParams.set("w",r.toString()),n.searchParams.set("h",s.toString());return n.searchParams.set("c","7"),n.toString()}function ge(e,t=S){return o.useMemo(()=>I(e,t),[e,t])}const j={type:"spring",stiffness:700,damping:82};function ye({children:e,className:t}){return q.jsx(b.div,{animate:{opacity:1},initial:{width:"100%",height:"100%",translateX:0,translateY:0,opacity:0},whileHover:{width:"103%",height:"103%",translateX:"-1.5%",translateY:"-1.5%"},transition:j,className:t,children:e})}export{T as B,ye as I,re as S,fe as T,de as W,pe as a,_e as b,ae as c,a as d,h as e,se as f,G as g,k as h,he as i,oe as j,ne as k,z as l,m,ie as n,ue as o,le as p,H as q,ce as r,me as s,ge as t,Z as u,j as v};
//# sourceMappingURL=dryvpx92fe6zevra.js.map
