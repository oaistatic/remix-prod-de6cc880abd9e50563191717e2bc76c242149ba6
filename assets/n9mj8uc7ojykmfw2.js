import{aj as f,aL as p,f9 as _,cP as w,bW as h,L as l,g as u,F as g,ae as c,cN as m,R as y,cp as S}from"./haannt40upmuwmtk.js";import{bm as b,bU as F,bV as V,bW as x}from"./n4exq6o15ap1g74l.js";import{r as i,u as d}from"./khl8ktun31iepecq.js";import{i as E}from"./ici1r2pdfnai9c6r.js";function v(){const a=b(),e=p();return e&&a&&!_(a)&&e.isEnterprisey()}function D(){return w(h.ChartSerialization)}function H(a,e){const t=a==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,o]=i.useState(u.getItem(t,{userId:e})??!1),n=i.useCallback(()=>{o(!0),u.setItem(t,!0,{userId:e})},[t,e]);return[s,n]}function N(a){const[e,t]=i.useState([]),s=f(a,g.getBranch);return i.useEffect(()=>{const o=I(s);o.length!==e.length&&t(o)},[e.length,a,s]),e}function z(a){const e=a.metadata?.aggregate_result?.messages.filter(E)??[];let t=0;const s=(a.metadata?.ada_visualizations??[]).map(n=>{let r=n;return n.type=="chart"&&(r={...n,fallback_image:e[t++]}),r}),o=(a.metadata?.attachments??[]).filter(n=>F(n.name)).map(n=>({type:"table",file_id:n.id??"",title:V(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...o]}function I(a){return a.filter(t=>t.message?.author.role==="tool"&&t.message?.author.name==="python"||(t.message?.metadata?.attachments??[]).length>0).flatMap(t=>z(t.message))}async function T(a,e,t){const s=await a.text(),{parse:o}=await S(async()=>{const{parse:r}=await import("./oeujip5i1ptrxie5.js");return{parse:r}},[]),n=o(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:e,download_url:t}}function A(a){const e=a[0].values.length,t=[];for(let s=0;s<e;s++){const o=a.map(n=>n.values[s]);t.push(o)}return t}function k(a){return d({queryKey:["ada-visualization","chart",a.file_id],queryFn:async()=>{const e=await c.getFileDownloadLink(a.file_id);if(e.status===m.Success){const s=await(await fetch(e.download_url)).json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:e.file_name??"",download_url:e.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function M(a){return d({queryKey:["ada-visualization","table",a.file_id],queryFn:async()=>{if(a.file_name&&x(a.file_name)){const e=await y.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:a.file_id}}});return{content:e.sheets.map(t=>({name:t.name,columnNames:t.columns.map(s=>s.name),columnTypes:t.columns.map(()=>"string"),rows:A(t.columns)})),download_url:e.download_url,file_name:a.file_name}}else{const e=await c.getFileDownloadLink(a.file_id);if(e.status===m.Success){const t=await fetch(e.download_url);return T(t,e.file_name??"",e.download_url)}else throw new Error("Failed to download from interpreter")}},throwOnError:!1})}export{N as a,M as b,k as c,v as d,H as e,z as g,D as u};
//# sourceMappingURL=n9mj8uc7ojykmfw2.js.map
