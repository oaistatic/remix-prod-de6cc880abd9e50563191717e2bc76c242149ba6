const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/n5hhcdj0vwv4yndd.js","assets/khl8ktun31iepecq.js","assets/n4exq6o15ap1g74l.js","assets/haannt40upmuwmtk.js","assets/root-eulobrch.css","assets/conversation-small-bh1estgu.css","assets/m4g7yy9fehqi204r.js"])))=>i.map(i=>d[i]);
import{R as _,co as I,cp as q,bb as A,z as x,A as L,M as T,V as W,o as G,gg as B,a as N,cH as P,aG as D,P as v,b8 as w,bf as R,cm as K}from"./haannt40upmuwmtk.js";import{r as y,b as U,u as V,j as e,e as Q,M as d,c as z}from"./khl8ktun31iepecq.js";import{eI as Y,a5 as H,aG as X,eJ as J,aF as $,a6 as S,eK as Z,a7 as ee,eL as te}from"./n4exq6o15ap1g74l.js";import{S as oe}from"./c6cvb002ahbvyqou.js";const j="memories/current_memory_undo_id",C={async getCurrentMemoryUndoId(t){return await _.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:t}}})},async undoMemoryWrite(t,o){return await _.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:t,memory_undo_id:o}})}},ne=I(()=>q(()=>import("./n5hhcdj0vwv4yndd.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6])));let k=!1;function E(t){return t.find(o=>o.author.role===x.Tool&&o.metadata?.pending_memory_info)}function se(t){return t.filter((o,n)=>{const s=t[n+1],i=s?.recipient==="assistant"&&s?.author.role===x.Tool&&s?.author.name==="bio"&&L(s).startsWith("Model set context");return o.author.role===x.Assistant&&o.recipient==="bio"&&i}).flatMap(o=>{const n=o.content.content_type;return n===T.Text?o.content.parts:n===T.Code?[o.content.text]:[]}).map(fe)}function re(t){return t.some(o=>o.author.role===x.Assistant&&o.recipient==="bio"&&o.status==="in_progress")}function ae(t){return t.find(n=>n.author.role===x.Tool&&n.author.name==="bio"&&n.recipient===x.Assistant)?.metadata?.current_memory_undo_id}function ie(t){const{eligible:o,isLoading:n}=Y(),s=y.useMemo(()=>t.length>0,[t]);y.useEffect(()=>{s&&o&&!n&&H.openModal(X.GlobalMemoryOnboarding)},[s,o,n])}function le(t){const[o,n]=y.useState(!1);return{isPopoverOpen:o,setIsPopoverOpen:n,handleTogglePopover:r=>{const i=r??!o;n(i),i&&v.logEvent("Memory Update Popover Shown",{updateCount:t.length})}}}function O({memoryWrites:t,popoverState:o,triggerButton:n,isParagen:s,gizmoId:r,memoryUndoId:i,setShowMemoriesModal:l}){return e.jsxs(te,{open:o.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 max-w-96 min-w-60 text-sm",onOpenChange:a=>o.handleTogglePopover(a),disableAutofocus:!0,triggerButton:n,children:[e.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary mb-2 rounded-sm border",children:t.map((a,u)=>e.jsx("div",{className:"border-token-border-default border-b px-3 py-2 first-letter:uppercase last:border-b-0",children:a},u))}),s?e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(d,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{gizmoId:r,memoryUndoId:i}),e.jsx(F,{onClick:()=>{l(!0),v.logEvent("Memory Update Popover Manage Button Clicked",{updateCount:t.length})},children:e.jsx(d,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage"})})]})]})}function de({clientThreadId:t,pendingMessage:o,memoryWrites:n,popoverState:s,setShowMemoriesModal:r}){const i=W(),l=Q(),a=G(t),u=B({clientThreadId:t}),h=n.join(" ");let f=h.slice(0,50).replace(new RegExp("^\\p{L}","u"),c=>c.toLocaleUpperCase()).replace(/\.$/,"");h.length>50&&(f+="...");const m=async c=>{if(!a)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const M=o.metadata?.pending_memory_info;w(t,p=>{R.updateTree(p,g=>{g.updateNodeMessageMetadata(o.id,{pending_memory_info:{...M,is_pending:!1,confirm_result:c}})})});try{await _.safePost("/memories/confirm_or_reject",{requestBody:{message_id:o.id,conversation_id:a,is_confirm:c},parameters:{},anonAware:!0})}catch{i.danger(l.formatMessage({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"})),w(t,g=>{R.updateTree(g,b=>{b.updateNodeMessageMetadata(o.id,{pending_memory_info:M})})})}};return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-token-text-tertiary inline-block text-sm font-semibold outline-hidden",children:e.jsx(d,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:e.jsx("div",{className:"inline-block py-1",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:e.jsx(O,{memoryWrites:n,popoverState:s,triggerButton:e.jsx("button",{className:N("text-start font-normal",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:e.jsx(d,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:f}})}),setShowMemoriesModal:r})})}})}),e.jsx(P,{className:"text-token-text-tertiary hover:text-token-text-primary ms-3",size:"xs",color:"secondary",disabled:u,onClick:()=>{m(!0)},children:e.jsx(d,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),e.jsx(P,{className:"text-token-text-tertiary hover:text-token-text-primary ms-2",size:"xs",color:"secondary",disabled:u,onClick:()=>{m(!1)},children:e.jsx(d,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function ue({memoryWrites:t,popoverState:o,isParagen:n,memoryUndoId:s,gizmoId:r,setShowMemoriesModal:i,showTooltip:l}){const a=J(),{eligible:u,markAsViewed:h,isLoading:f}=$(S.hasSeenMemoryUpdatedTooltip),{value:m}=D("604639887"),c=!Z(),[M,p]=y.useState(!1);return y.useEffect(()=>{!f&&u&&a&&l===!0&&!k?(p(!0),k=!0):!f&&!u&&p(!1)},[l,f,u,a]),t.length===0?null:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{announcementKey:S.hasSeenMemoryUpdatedTooltip,show:M,onDismiss:()=>{h(),v.logEventWithStatsig("Memory Updated Tooltip Dismissed","memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:c?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:e.jsx(d,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:e.jsxs(e.Fragment,{children:[e.jsx(d,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, but you can still manage individual saved memories."}),e.jsx("br",{}),e.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(d,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:e.jsx("div",{style:{width:1,height:1}})}),e.jsx("div",{className:"inline-block",onMouseOver:()=>o.handleTogglePopover(!0),onMouseOut:()=>o.handleTogglePopover(!1),children:e.jsx(O,{memoryWrites:t,popoverState:o,isParagen:n,gizmoId:r,memoryUndoId:s,triggerButton:e.jsxs("button",{className:N("my-1 flex items-center gap-1 text-sm font-semibold outline-hidden",o.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[e.jsx(oe,{className:"mb-[-1px]"}),m?t.length===1?e.jsx(d,{id:"MemoryActionResult.memoryWriteSingular.New",defaultMessage:"Updated saved memory"}):e.jsx(d,{id:"MemoryActionResult.memoryWritePlural.New",defaultMessage:"Updated saved memories"}):t.length===1?e.jsx(d,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory Updated"}):e.jsx(d,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories Updated"})]}),setShowMemoriesModal:i})})]})}function me(t){const o=E(t),n=o?.metadata?.pending_memory_info?.confirm_result;return o==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function Me({messages:t,clientThreadId:o,gizmoId:n,isParagen:s}){const r=se(t),i=le(r),l=re(t),a=ae(t);ie(r);const u=E(t),{config:h}=A("3983984123"),f=h.get("is_memory_undo_enabled",!1),m=y.useRef(!1),c=U();y.useEffect(()=>{l&&m.current===!1&&(m.current=!0),!l&&!u&&a&&m.current&&c.invalidateQueries({queryKey:[j,n]})},[l,u,a,n,c]);const{data:M}=V({queryKey:[j,n],queryFn:()=>C.getCurrentMemoryUndoId(n),enabled:f&&!l&&!u}),[p,g]=y.useState(!1),b=me(t);return b==="denied"?null:l?e.jsx("div",{className:"result-streaming",children:e.jsx("span",{children:e.jsx("pre",{})})}):e.jsxs(e.Fragment,{children:[b==="pending"?e.jsx(de,{clientThreadId:o,memoryWrites:r,popoverState:i,setShowMemoriesModal:g,pendingMessage:u}):e.jsx(ue,{memoryWrites:r,popoverState:i,isParagen:s,memoryUndoId:M?.current_memory_undo_id===a?a:void 0,setShowMemoriesModal:g,showTooltip:m.current&&r.length>0}),p&&e.jsx(ne,{initialGizmoId:n,onClose:()=>g(!1)})]})}function F({children:t,disabled:o,onClick:n}){return e.jsxs("button",{className:"hover:bg-token-main-surface-secondary flex w-full items-center justify-between rounded-sm px-3 py-2 font-semibold",disabled:o,onClick:n,children:[t,e.jsx(K,{className:"icon-md text-token-text-tertiary -me-1"})]})}function ce({gizmoId:t,memoryUndoId:o}){const{config:n}=A("3983984123"),s=n.get("is_memory_undo_enabled",!1),r=U(),{isPending:i,mutate:l}=z({mutationFn:a=>C.undoMemoryWrite(t,a),onSuccess:()=>{r.invalidateQueries({queryKey:[j,t]})}});return!s||!o?null:e.jsx(F,{disabled:i,onClick:()=>{o&&l(o)},children:e.jsx(d,{id:"qeyS8G",defaultMessage:"Undo"})})}function fe(t){const o=["The user ","The user's ","User ","User's "];for(const n of o)if(t.startsWith(n))return t.slice(n.length);return t}export{Me as MemoryActionResult};
//# sourceMappingURL=k0515ugmnvo5fanm.js.map
